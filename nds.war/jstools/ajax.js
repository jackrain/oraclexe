function AjaxRequest(c,l){var f;var b=l;var h=b.returnArgs;var a=b.method;var j=b.ajaxId;if(window.XMLHttpRequest){f=new XMLHttpRequest();if(f.overrideMimeType){f.overrideMimeType("text/html")}}else{if(window.ActiveXObject){try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){try{f=new XMLHttpRequest()}catch(i){}}}}}var d=b.onComplete;var k=function(){if(f.readyState==4){try{if(f.status==200){var m;try{m=f.getResponseHeader("Ajax-ID")}catch(n){m=""}if(d){d(f,h)}if(m&&m!=""){AjaxUtil.remove(parseInt(m))}}}catch(n){}}};var g=function(n){var m=n.split("?");var q=m[0];var o=m[1];try{if(a=="get"){f.open("GET",n,true);f.onreadystatechange=k;f.send("")}else{f.open("POST",q,true);f.setRequestHeader("Method","POST "+q+" HTTP/1.1");f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.setRequestHeader("Ajax-ID",j);f.onreadystatechange=k;f.send(o)}}catch(p){}};g(c);this.resend=function(m,e){b=e;d=b.onComplete;g(m)};this.getId=function(){return j};this.cleanUp=function(){f.onreadystatechange=function(){};k=null;h=null;f=null}}var AjaxUtil={counter:1,requests:new Array(),request:function(c,b){var e=(b==null)?(new Object()):b;var a=(e.reverseAjax)?0:AjaxUtil.getNextId();e.ajaxId=a;var d;if(a==0&&AjaxUtil.requests[0]){d=AjaxUtil.requests[0];d.resend(c,e)}else{d=new AjaxRequest(c,e);AjaxUtil.requests[a]=d}if(!e.onComplete){AjaxUtil.remove(a)}},update:function(b,e,a){var c=$(e);if(c){if(a==null){a=new Object()}var d=a.onComplete;a.onComplete=function(g,f){c.innerHTML=g.responseText;executeLoadedScript(c);if(d){d()}};AjaxUtil.request(b,a)}},getNextId:function(){var a=AjaxUtil.counter++;if(AjaxUtil.counter>20){AjaxUtil.counter=1}return a},remove:function(b){if(b){var a=AjaxUtil.requests[b];if(a){a.cleanUp();a=null}}}};var ReverseAjax={initialize:function(){Event.observe(window,"unload",function(){ReverseAjax.release()});ReverseAjax.request()},request:function(){AjaxUtil.request(themeDisplay.getPathMain()+"/portal/reverse_ajax",{onComplete:ReverseAjax.response,reverseAjax:true})},response:function(c){var b=$J(c.responseText);var a=b.status;if(a&&a!="failure"){if(a=="success"){if(b.chatMessages){Messaging.getChatsReturn(b.chatMessages)}if(b.chatRoster){MessagingRoster.getEntriesReturn(b.chatRoster)}}ReverseAjax.request()}},release:function(){AjaxUtil.request(themeDisplay.getPathMain()+"/portal/reverse_ajax?release=1",{reverseAjax:true})}};function $J(JSONText){return eval("("+JSONText+")")}function executeLoadedScript(el){var scripts=el.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){if(scripts[i].src){var head=document.getElementsByTagName("head")[0];var scriptObj=document.createElement("script");scriptObj.setAttribute("type","text/javascript");scriptObj.setAttribute("src",scripts[i].src);head.appendChild(scriptObj)}else{try{if(is_safari){eval(scripts[i].innerHTML)}else{if(is_mozilla){eval(scripts[i].textContent)}else{var dj_global=this;if(window.execScript){window.execScript(scripts[i].text)}else{if(dj_global.eval){dj_global.eval(scripts[i].text)}else{eval(scripts[i].text)}}}}}catch(e){if(console!=undefined){console.log(e);console.log(scripts[i].textContent)}alert("error executeLoadedScript:"+e)}}}}function loadForm(b,c,d,j){var h=c.indexOf("?");var k=c;var a="";if(h!=-1){k=c.substring(0,h);a=c.substring(h+1,c.length)}if(!endsWith(a,"&")){a+="&"}for(var f=0;f<b.elements.length;f++){var g=b.elements[f];if((g.name!=null)&&(g.value!=null)){a+=g.name+"="+encodeURIComponent(g.value)+"&"}}if(d!=null){document.body.style.cursor="wait";h=k.indexOf("/portal/layout");k=k.substring(0,h)+"/portal/render_portlet";j=function(e){document.getElementById(d).innerHTML=e.responseText;document.body.style.cursor="default"}}loadPage(k,a,j)}function loadPage(c,d,b,a){AjaxUtil.request(c+"?"+d,{onComplete:b,returnArgs:a})}function printJSON(a){if(a&&a.id){var b=document.getElementById(a.id);if(b){b.innerHTML=a.toString()}}};