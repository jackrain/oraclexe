var dqComboboxQueries=null;var dqComboboxes=null;var dq=null;var oq=null;var dcq=null;var DynamicQuery=Class.create();var DropdownQuery=Class.create();var ObjectQuery=Class.create();ObjectQuery.prototype={initialize:function(){this._gridQuery=[];this._accepter_id=[];this._mainobjurl=[];this._returnType=[];this._partialData=null;this.multi_result=[];this._queryindex=-1;this._xmlid=[];this.condition="IN";application.addEventListener("QueryObject",this._onQueryObject,this);application.addEventListener("ReturnSQL",this._onReturnSQL,this);application.addEventListener("ReturnSET",this._onReturnSET,this);application.addEventListener("Return_Result",this._onReturn_Result,this)},toggle:function(d,f,c){var b=$(f+"_link");if(b==null||(b!=null&&b.title=="popup")){d=reconstructQueryURL(d,c,f);if(d==null){return}this._queryindex=this._queryindex+1;this.multi_result[this._queryindex]=new Array();this._accepter_id[this._queryindex]=f;var a=Alerts.fireMessageBox({width:610,modal:true,noCenter:true,title:gMessageHolder.SEARCH,queryindex:this._queryindex,onClose:function(){oq.close_query()}});new Ajax.Request(d,{method:"get",onSuccess:function(h){var g=$(a);g.innerHTML=h.responseText;executeLoadedScript(g)},onFailure:function(i){if(i.getResponseHeader("nds.code")=="1"){window.location="/c/portal/login";return}var g=i.getResponseHeader("nds.exception");if(g!=null&&g.length>0){alert(decodeURIComponent(g))}else{var h=$(a);h.innerHTML=i.responseText;executeLoadedScript(h)}}})}else{$(f+"_link").title="popup";$(f+"_img").alt="";$(f).value="";$(f+"_img").src="/html/nds/images/filterobj.gif";if($(f+"_fd")!=null){$(f+"_fd").value="";$(f+"_fd").readOnly=false}if($(f+"_sql")!=null){$(f+"_sql").value="";$(f).readOnly=false}var e=$(f+"_expr");if(e!=null){e.value=""}}},toggle_m:function(d,f,c){var b=$(f+"_link");if(b==null||(b!=null&&b.title=="popup")){d=reconstructQueryURL(d,c,f);if(d==null){return}this._queryindex=this._queryindex+1;this.multi_result[this._queryindex]=new Array();this._accepter_id[this._queryindex]=f;var a=Alerts.fireMessageBox({width:790,modal:true,noCenter:true,title:gMessageHolder.SEARCH,queryindex:this._queryindex,onClose:function(){oq.close_query()}});new Ajax.Request(d,{method:"get",onSuccess:function(h){var g=$(a);g.innerHTML=h.responseText;executeLoadedScript(g)},onFailure:function(i){if(i.getResponseHeader("nds.code")=="1"){window.location="/c/portal/login";return}var g=i.getResponseHeader("nds.exception");if(g!=null&&g.length>0){alert(decodeURIComponent(g))}else{var h=$(a);h.innerHTML=i.responseText;executeLoadedScript(h)}}})}else{$(f+"_link").title="popup";$(f+"_img").alt="";$(f).value="";if(this._returnType[this._queryindex]=="a"){$(f+"_img").src="/html/nds/images/add_filter.gif";if($("tab_"+f)!=null){$("tab_"+f).innerHTML=""}}else{$(f+"_img").src="/html/nds/images/filterobj.gif"}if($(f+"_fd")!=null){$(f+"_fd").value="";$(f+"_fd").readOnly=false}if($(f+"_sql")!=null){$(f+"_sql").value="";$(f).readOnly=false}var e=$(f+"_expr");if(e!=null){e.value=""}}},setQueryObject:function(f,b,a){this._gridQuery[this._queryindex]=f;this._gridQuery[this._queryindex].callbackEvent="QueryObject";this._gridQuery[this._queryindex].returnType=a;this._returnType[this._queryindex]=a;this._xmlid[this._queryindex]=0;this._initGridSelectionControl();this._mainobjurl[this._queryindex]=b;var d=$("pop-up-title-"+this._queryindex);if(d){d.innerHTML=gMessageHolder.SEARCH+" - "+f.table_desc}if(a=="s"){var c=$("btn-rsql");if(c){c.hide()}c=$("btn-sql");if(c){c.hide()}c=$("qcsa");if(c){c.hide()}}},search:function(){this._partialData=null;if($("mulit-info_"+this._queryindex)!=null){$("mulit-info_"+this._queryindex).remove()}var b=$("q_form_"+this._queryindex);this._gridQuery[this._queryindex].param_str=b.serialize();this._gridQuery[this._queryindex].start=0;var a=$("q_form_param_expr_"+this._queryindex);if(a!=null){this._gridQuery[this._queryindex].param_expr=a.value}this._executeQuery(this._gridQuery[this._queryindex])},returnSQL:function(){var a=$("q_form_"+this._queryindex);var b=Object.clone(this._gridQuery[this._queryindex]);b.param_str=a.serialize();b.callbackEvent="ReturnSQL";b.noresult=true;if(this._returnType[this._queryindex]=="f"){b.resulthandler="/html/nds/query/search_result_filter_dropdown.jsp"}else{b.resulthandler="/html/nds/query/search_result_sql.jsp"}this._executeQuery(b)},returnRow:function(d){var a=$(this._accepter_id[this._queryindex]);if(a==null){this.close();return}a.value=d.alt;fireEvent(a,"change");var e=$("fk_"+this._accepter_id[this._queryindex]);if(e!=null){e.value=d.id.replace(/chk_obj_/i,"")}try{a.focus()}catch(b){}if(this._partialData!=null&&a.onaction){var c=Number(d.title);if(c>=0&&c<this._partialData.length){a.onaction(this._partialData[c])}}this.close()},returnValue:function(){var g=Array();var f=Array();var c;var b=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");if(b==null||b.length==0){this.close();return}for(var d=0;d<b.length;d++){if(b[d].checked){g.push(b[d].value);f.push(b[d].id)}}if(g.length==0){alert(gMessageHolder.PLEASE_CHECK_SELECTED_LINES);return}var k=" IN ("+g.join(",")+")";var h=gMessageHolder.CONTAINS+" ("+f.join(",")+")";var e=null;if(this._returnType[this._queryindex]=="f"){var c={expr:{desc:h,clink:this._gridQuery[this._queryindex].table+".ID",condition:k}};var a={filter:{desc:h,sql:k,expr:c}};e=json2xml(a,false);this.returnFilterObj_dropdown(h,e)}else{this.returnQuery(k,h,e)}},returnFilterObj_dropdown:function(b,a){if(b==""){$(this._accepter_id[this._queryindex]+"_fd").value=gMessageHolder.AVAILABLE}else{$(this._accepter_id[this._queryindex]+"_fd").value=b}fireEvent($(this._accepter_id[this._queryindex]+"_fd"),"change");$(this._accepter_id[this._queryindex]).value=a;$(this._accepter_id[this._queryindex]+"_fd").readOnly=true;$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;this.close()},returnFilterObj:function(g,c){var f=this._xmlid[this._queryindex]+"_xml";var a=true;if(g==""){g=gMessageHolder.AVAILABLE}var e={id:g,condition:this.condition,value:f,set:c};var b=this.multi_result[this._queryindex].length;for(var d=0;d<b;d++){if(this.multi_result[this._queryindex][d].id==e.id){a=false;if(this.multi_result[this._queryindex][d].condition!=this.condition){if(this.multi_result[this._queryindex][d].condition=="IN"){alert(gMessageHolder.SET_ALREADY_CHOOSED)}else{alert(gMessageHolder.SET_ALREADY_EXCLUDE)}}break}}if(a){this.multi_result[this._queryindex][b]=e;dwr.util.cloneNode("m_multiple_row_"+this._queryindex,{idPrefix:this.multi_result[this._queryindex][b].value+"_"});$(this.multi_result[this._queryindex][b].value+"_m_multiple_"+this._queryindex).innerHTML='<input type="checkbox" name="m_multiple_'+this._queryindex+'"  value='+this.multi_result[this._queryindex][b].value+">";dwr.util.setValue(this.multi_result[this._queryindex][b].value+"_m_multiple_value_"+this._queryindex,this.multi_result[this._queryindex][b].id);$(this.multi_result[this._queryindex][b].value+"_m_multiple_row_"+this._queryindex).style.display="";this._xmlid[this._queryindex]++}},returnQuery:function(c,a,d){$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;$(this._accepter_id[this._queryindex]).value=a;$(this._accepter_id[this._queryindex]).readOnly=true;fireEvent($(this._accepter_id[this._queryindex]),"change");$(this._accepter_id[this._queryindex]+"_sql").value=c;var b=$(this._accepter_id[this._queryindex]+"_expr");if(b!=null){b.value=d}this.close()},isEmpty:function(b){var a=$(b);return((a!=null&&dwr.util.getValue(a).empty())||a==null)},close:function(){window.setTimeout("Alerts.killAlert(document.getElementById('pop-up-title-"+this._queryindex+"'))",1)},close_query:function(){this.multi_result[this._queryindex]=null;this.condition="IN";this._xmlid[this._queryindex]=0;this._queryindex=this._queryindex-1;if(this._queryindex==-1){this._gridQuery=[]}},onSearchReturn:function(a){if(!a){a=window.event}if(a&&a.keyCode&&a.keyCode==13){this.search()}},_onReturnSQL:function(e){var qr=e.getUserData().data;if(qr.pagecontent!=null){eval(qr.pagecontent)}},_toggleButtons:function(a){if(a){$("btn-search").disable();if($("btn-value")!=null){$("btn-value").disable()}if($("btn-search")!=null){$("btn-search").disable()}if($("btn-sql")!=null){$("btn-sql").disable()}}else{$("btn-search").enable();if($("btn-value")!=null){$("btn-value").enable()}if($("btn-search")!=null){$("btn-search").enable()}if($("btn-sql")!=null){$("btn-sql").enable()}}},_onQueryObject:function(i){var l=i.getUserData().data;if(l.pagecontent!=null){if(Prototype.Browser.IE){var b=$("q_embed_lines_"+this._queryindex);var d=b.innerHTML;var c=d.indexOf("<!--$QGRIDTABLE_START-->");var k=d.indexOf("<!--$QGRIDTABLE_END-->");var g=d.substring(0,c+"<!--$QGRIDTABLE_START-->".length);var j=d.substr(k);var a=g.concat("<tbody id='q_grid_table_"+this._queryindex+"'>",l.pagecontent,"</tbody>",j);b.innerHTML=a;executeLoadedScript(b);this._initGridSelectionControl()}else{var f=$("q_grid_table_"+this._queryindex);dwr.util.removeAllRows(f);f.innerHTML=l.pagecontent;executeLoadedScript(f)}}if(l.rows!=null){this._partialData=l.rows;l.rows=null}else{this._partialData=null}this._syncGridControl(l);var h=l.queryDesc;if(l.message!=undefined&&l.message!=null){h+="<br><blink><span class='err'>***"+l.message+"</blink>"}$("q_filter_setting_"+this._queryindex).innerHTML=h;dwr.util.setValue($("q_chk_select_all_"+this._queryindex),false);$("query-data_"+this._queryindex).show()},_syncGridControl:function(a){this._gridQuery[this._queryindex].totalRowCount=a.totalRowCount;this._gridQuery[this._queryindex].start=a.start;if(this._gridQuery[this._queryindex].order_columns!=null){var b=$("q_title_"+this._gridQuery[this._queryindex].order_columns);if(b!=null){b.innerHTML="<img src='/html/nds/images/"+(this._gridQuery[this._queryindex].order_asc?"up":"down")+"simple.png'>"}}if($("q_txtRange_"+this._queryindex)!=null){$("q_txtRange_"+this._queryindex).innerHTML=((a.start+1)+"-"+(a.start+a.rowCount)+"/"+a.totalRowCount);if(a.start>0){$("q_begin_btn_"+this._queryindex).setEnabled(true);$("q_prev_btn_"+this._queryindex).setEnabled(true)}else{$("q_begin_btn_"+this._queryindex).setEnabled(false);$("q_prev_btn_"+this._queryindex).setEnabled(false)}if((a.start+a.rowCount)<a.totalRowCount){$("q_next_btn_"+this._queryindex).setEnabled(true);$("q_end_btn_"+this._queryindex).setEnabled(true)}else{$("q_next_btn_"+this._queryindex).setEnabled(false);$("q_end_btn_"+this._queryindex).setEnabled(false)}}},_executeQuery:function(b){$("q_progress_"+this._queryindex).show();this._toggleButtons(true);var a=Object.toJSON(b);Controller.query(a,function(e){var c=e.evalJSON();if(c.code!=0){oq._toggleButtons(false);msgbox(c.message)}else{var d=new BiEvent(c.callbackEvent);d.setUserData(c);application.dispatchEvent(d);oq._toggleButtons(false)}});$("q_progress_"+this._queryindex).hide()},_initGridSelectionControl:function(){var a=new SelectableTableRows(document.getElementById("q_inc_table"),false);if(this._returnType[this._queryindex]!="s"){a.ondoubleclick=function(b){oq.mo(b.id.replace(/_qtemplaterow/i,""))}}else{a.ondoubleclick=function(f){var d=$("chk_obj_"+f.id.replace(/_qtemplaterow/i,""));var b=$(oq._accepter_id[this._queryindex]);b.value=d.alt;var e=$("fk_"+oq._accepter_id[this._queryindex]);if(e!=null){e.value=d.id.replace(/chk_obj_/i,"")}if(oq._partialData!=null&&b.onaction){var c=Number(d.title);if(c>=0&&c<oq._partialData.length){b.onaction(oq._partialData[c])}}oq.close()}}},fk:function(b,a){popup_window("/html/nds/object/object.jsp?table="+b+"&id="+a)},mo:function(a){popup_window(this._mainobjurl[this._queryindex]+a)},refreshGrid:function(){this._executeQuery(this._gridQuery[this._queryindex])},orderGrid:function(b){var c=this._gridQuery[this._queryindex].order_columns;var d=this._gridQuery[this._queryindex].order_asc;if(c==b){this._gridQuery[this._queryindex].order_asc=!d}else{var a=$("q_title_"+c+"_"+this._queryindex);if(a!=null){a.innerHTML=""}this._gridQuery[this._queryindex].order_columns=b;this._gridQuery[this._queryindex].order_asc=true}this._executeQuery(this._gridQuery[this._queryindex])},scrollPage:function(d){var e;var c=Object.clone(this._gridQuery[this._queryindex]);var a=c.start;var b=parseInt($("q_range_select_"+this._queryindex).value,10);var f=c.totalRowCount;if(d=="q_begin_btn_"+this._queryindex){e=0}else{if(d=="q_prev_btn_"+this._queryindex){e=a-b}else{if(d=="q_next_btn_"+this._queryindex){e=a+b}else{if(d=="q_end_btn_"+this._queryindex){e=f-b}else{e=a}}}}c.start=e;c.range=b;this._gridQuery[this._queryindex].range=b;this._executeQuery(c)},selectAll:function(){var a=$("q_chk_select_all_"+this._queryindex);a.checked=a.checked|0;var b=a.checked;var d=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");for(var c=0;c<d.length;c++){d[c].checked=b;this.dynamic_add(d[c].id)}},return_content:function(c){var a=null;var b=this.multi_result[this._queryindex].length;var k=this.multi_result[this._queryindex].length;var l=false;var g=false;var e=null;var o=null;var m=null;var d=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");for(var h=0;h<d.length;h++){l=false;if(d[h].id==c){o=this.condition+"("+d[h].value+")";a={id:d[h].id,value:d[h].value,condition:this.condition,clkstr:this._gridQuery[this._queryindex].table+".ID"};for(var f=0;f<b;f++){if(this.multi_result[this._queryindex][f].value==d[h].value){l=true;if(this.multi_result[this._queryindex][f].condition!=this.condition){if(this.multi_result[this._queryindex][f].condition=="IN"){alert(this.multi_result[this._queryindex][f].id+gMessageHolder.ALREADY_CHOOSED)}else{alert(this.multi_result[this._queryindex][f].id+gMessageHolder.ALREADY_EXCLUDE)}g=true}break}}if(!l){this.multi_result[this._queryindex][k]=a;k++}}}for(var n=b;n<this.multi_result[this._queryindex].length;n++){dwr.util.cloneNode("m_multiple_row_"+this._queryindex,{idPrefix:this.multi_result[this._queryindex][n].value+"_"});$(this.multi_result[this._queryindex][n].value+"_m_multiple_"+this._queryindex).innerHTML='<input type="checkbox" name="m_multiple_'+this._queryindex+'"  value='+this.multi_result[this._queryindex][n].id+">";if(this.multi_result[this._queryindex][n].condition!="IN"){dwr.util.setValue(this.multi_result[this._queryindex][n].value+"_m_multiple_value_"+this._queryindex,gMessageHolder.NOTCONTAINS+"("+this.multi_result[this._queryindex][n].id+")")}else{dwr.util.setValue(this.multi_result[this._queryindex][n].value+"_m_multiple_value_"+this._queryindex,gMessageHolder.CONTAINS+"("+this.multi_result[this._queryindex][n].id+")")}$(this.multi_result[this._queryindex][n].value+"_m_multiple_row_"+this._queryindex).style.display=""}},remove_choosed_rows:function(){var a=false;var d=this._queryindex;var e=document.getElementsByName("m_multiple_"+d);for(var c=e.length-1;c>=0;c--){if(e[c].checked){a=true;var b=this.multi_result[this._queryindex][c].value;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(f){return(f.id==b+"_m_multiple_row_"+d)}});this.multi_result[this._queryindex].splice(c,1)}}if(!a){alert(gMessageHolder.PLEASE_CHECK_SELECTED_LINES)}},remove_all:function(){var a=this._queryindex;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(b){return(b.id!="m_multiple_row_"+a)}});this.multi_result[this._queryindex]=null;this.multi_result[this._queryindex]=new Array();this.condition="IN"},return_set:function(){var a=$("q_form_"+this._queryindex);var b=Object.clone(this._gridQuery[this._queryindex]);b.param_str=a.serialize();b.callbackEvent="ReturnSET";b.noresult=true;b.condition=this.condition;b.returnType=this._returnType[this._queryindex];b.resulthandler="/html/nds/query/search_result_filter.jsp";this._executeQuery(b)},return_result:function(){if(this.multi_result[this._queryindex].length==0){alert(gMessageHolder.NO_DATA_TO_PROCESS)}else{var a={};a.command="Return_Result";a.params=this.multi_result[this._queryindex];a.table=this._gridQuery[this._queryindex].table;a.returnType=this._returnType[this._queryindex];a.callbackEvent="Return_Result";this._executeCommandEvent(a)}},_onReturn_Result:function(c){var b=c.getUserData();var a=b.data;if(this._returnType[this._queryindex]=="f"){if(a.desc==""){$(this._accepter_id[this._queryindex]+"_fd").value=gMessageHolder.AVAILABLE}else{$(this._accepter_id[this._queryindex]+"_fd").value=a.desc}$(this._accepter_id[this._queryindex]).value=a.filterxml;$(this._accepter_id[this._queryindex]+"_fd").readOnly=true;$(this._accepter_id[this._queryindex]+"_fd").title=$(this._accepter_id[this._queryindex]+"_fd").value}else{if(this._returnType[this._queryindex]=="a"){$(this._accepter_id[this._queryindex]).value=a.desc;if($("tab_"+this._accepter_id[this._queryindex])!=null){$("tab_"+this._accepter_id[this._queryindex]).innerHTML=a.desc}$(this._accepter_id[this._queryindex]+"_expr").value=a.filterxml;$(this._accepter_id[this._queryindex]+"_sql").value=a.sql;$(this._accepter_id[this._queryindex]).readOnly=true;$(this._accepter_id[this._queryindex]).title=a.desc}else{$(this._accepter_id[this._queryindex]).value=a.desc;$(this._accepter_id[this._queryindex]+"_filter").value=a.filterxml;$(this._accepter_id[this._queryindex]+"_sql").value=a.sql;$(this._accepter_id[this._queryindex]).readOnly=true;$(this._accepter_id[this._queryindex]).title=a.desc}}$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;this.close()},reverse_condition:function(){if($("condition_"+this._queryindex).checked){$("btn-choose-set_"+this._queryindex).value=gMessageHolder.EXCLUDE_ALL;this.condition="NOT IN"}else{$("btn-choose-set_"+this._queryindex).value=gMessageHolder.ADD_ALL;this.condition="IN"}},_executeCommandEvent:function(a){Controller.handle(Object.toJSON(a),function(d){var b=d.evalJSON();var c=new BiEvent(b.callbackEvent);c.setUserData(b);application.dispatchEvent(c)})},_onReturnSET:function(e){var qr=e.getUserData().data;if(qr.pagecontent!=null){eval(qr.pagecontent)}},dynamic_add:function(a){if($("multi-list_"+this._queryindex)!=null){if($(a).checked){this.return_content(a)}else{this.dyn_remove_choosed_rows(a)}}},dyn_remove_choosed_rows:function(a){var d=this._queryindex;var e=document.getElementsByName("m_multiple_"+d);for(var c=e.length-1;c>=0;c--){if(e[c].value==a){if(this.multi_result[this._queryindex][c].condition==this.condition){var b=this.multi_result[this._queryindex][c].value;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(f){return(f.id==b+"_m_multiple_row_"+d)}});this.multi_result[this._queryindex].splice(c,1)}else{if(this.multi_result[this._queryindex][c].condition=="IN"){alert(this.multi_result[this._queryindex][c].id+gMessageHolder.ALREADY_CHOOSED)}else{alert(this.multi_result[this._queryindex][c].id+gMessageHolder.ALREADY_EXCLUDE)}}break}}},unselectall:function(){dwr.util.setValue($("q_chk_select_all_"+this._queryindex),false)}};ObjectQuery.main=function(){oq=new ObjectQuery()};jQuery(document).ready(ObjectQuery.main);DropdownQuery.prototype={initialize:function(){this._selTb=null;this._prevSelected=null;this._accepter_id=null;this._temp=null;application.addEventListener("DropdownQueryRefresh",this._refreshGrid,this)},toggle:function(k,i,n){if(i){this._accepter_id=i}var l,m,c,d;d="div_"+i;var b=document.getElementById(i);var a=document.getElementById(d);var g=document.getElementById("dwrloading_"+i);if(n!=undefined&&n!=null){k=reconstructQueryURL(k,n,i);if(k==null){return}if(a!=null){a.innerHTML="<div id='content_"+i+"' style='width:160;position: relative; z-index: 10;'><span id='dwrloading_"+i+"' style='width:160;height:20;'>"+gMessageHolder.LOADING+"</span></div><iframe id='json_"+i+"' frameborder='0' style='width:160px; height:20; position: absolute; top: 0; left: 0; z-index: 9;'></iframe>";g=document.getElementById("dwrloading_"+i)}}if(a==null||g!=null){if(a==null){a=document.createElement("div");a.id=d;a.className="comboBoxList";a.innerHTML="<div id='content_"+i+"' style='width:160;position: relative; z-index: 10;'><span id='dwrloading_"+i+"' style='width:160;height:20;'>"+gMessageHolder.LOADING+"</span></div><iframe id='json_"+i+"' frameborder='0' style='width:160px; height:20; position: absolute; top: 0; left: 0; z-index: 9;'></iframe>";document.body.appendChild(a)}this._resize(i);l=k.indexOf("?");m=k;c="";if(l!=-1){m=k.substring(0,l);c=k.substring(l+1,k.length)}loadPage(m,c,this._returnQuery,i);if(dqComboboxes==null){dqComboboxes=new Array();dqComboboxQueries={};dqtemps={};Event.observe(document.body,"mousedown",function(p){var j=$(Event.element(p)).up(".comboBoxList");var o,f;for(o=dqComboboxes.length-1;o>=0;o--){f=$(dqComboboxes[o]);if(f!=null&&f.style.display=="block"){if(j==null||j.id!=f.id){f.style.display="none"}}}})}var e,h=false;for(e=0;e<dqComboboxes.length;e++){if(dqComboboxes[e]==d){h=true;break}}if(h==false){dqComboboxes[dqComboboxes.length]=d}}else{if(a.style.display=="none"){this._repos(i)}}},_repos:function(d){var b=document.getElementById("div_"+d);var c=getOffsets(d);var a=document.getElementById(d);b.style.top=c.y+(a.offsetHeight?a.offsetHeight:22)+"px";b.style.left=c.x+"px";b.style.display="block"},_resize:function(d){var b=document.getElementById("div_"+d);var c=document.getElementById("content_"+d);var a=document.getElementById("tdv_"+d);if(a!=null){c.style.width=a.style.width}b.style.width=c.style.width;this._repos(d)},_returnQuery:function(b,c){var a=document.getElementById("content_"+c);a.innerHTML=b.responseText;executeLoadedScript(a);this._resize(c)},_refreshGrid:function(b){var c=b.getUserData().data.tag;var a=document.getElementById("content_"+c);a.innerHTML=b.getUserData().data.pagecontent;executeLoadedScript(a);this.syncGridControl(this._accepter_id)},syncGridControl:function(a){var c=dqComboboxQueries[a];var d=c.accepter_id;var b=$("begin_btn_"+d);if(c.start>1){$("begin_btn_"+d).setEnabled(true);$("prev_btn_"+d).setEnabled(true)}else{$("begin_btn_"+d).setEnabled(false);$("prev_btn_"+d).setEnabled(false)}if((c.start+c.rowcount)<c.totalCount){$("next_btn_"+d).setEnabled(true);$("end_btn_"+d).setEnabled(true)}else{$("next_btn_"+d).setEnabled(false);$("end_btn_"+d).setEnabled(false)}},scrollPage:function(d,b){var e;var g=Object.clone(dqComboboxQueries[b]);g.tag=b;var a=g.start;var c=g.range;var f=g.totalCount;if(d=="refresh_"+b){e=0}else{if(d=="begin_btn_"+b){e=0}else{if(d=="prev_btn_"+b){e=a-c-1}else{if(d=="next_btn_"+b){e=a+c-1}else{if(d=="end_btn_"+b){e=f-c-1}else{e=a}}}}}g.start=e;g.range=c;this._executeQuery(g)},_executeQuery:function(b){var a=Object.toJSON(b);Controller.query(a,function(e){var c=e.evalJSON();if(c.code!=0){msgbox(c.message)}else{var d=new BiEvent(c.callbackEvent);d.setUserData(c);application.dispatchEvent(d)}})},returnRow:function(a){var b=document.getElementById(this._accepter_id);if(b){b.value=a.title;var d=$("fk_"+this._accepter_id);if(d!=null){d.value=a.id.replace(/chk_obj_/i,"")}if(b.onaction){b.onaction(a.id.replace(/chk_obj_/i,""))}try{var f=this._accepter_id.split("_")[1];document.sheet_item_modify.selectedItemIdx[f].checked=true}catch(c){}fireEvent(b,"change")}this._hidePopupWindow()},_init_result:function(a){this._selTb=new SelectableTableRows(document.getElementById(a),false);this._selTb.ondoubleclick=function(e){var c=$("chk_obj_"+e.title);var b=$(dq._accepter_id);b.value=c.title;var d=$("fk_"+dq._accepter_id);if(d!=null){d.value=e.title}if(b.onaction){b.onaction(e.title)}dq._hidePopupWindow()}},_hidePopupWindow:function(){var b=document.getElementById("div_"+this._accepter_id);if(b==null){b=document.getElementById("object_query_content")}if(b!=null){b.style.display="none"}var a=document.getElementById(this._accepter_id);if(a){a.focus()}},drawTable:function(j,m){var d,g,f,n;var l=m.accepter_id;dqComboboxQueries[l]=m;var c=document.getElementById("tdv_"+l);var e=document.getElementById("content_"+l);var a=document.getElementById("div_"+l);if(j.length==0){k="<iframe id='json_"+l+"' frameborder='0' style='position: absolute; top: 0; left: 0; z-index: 9;'>";k='<table id="table_'+l+"\" style='width:140; overflow:hidden;'  border='0' cellspacing='0' cellpadding='0'  align='center'onselectstart='if(window.event.ctrlKey || window.event.shiftKey) return false;else return true;'>";k=k+"<tr>";k=k+'<td align="center">'+gMessageHolder.NO_DATA+"</td>";k=k+"</tr></table>"}else{var k="<iframe id='json_"+l+"' frameborder='0' style='width:160; position: absolute; top: 0; left: 0; z-index: 9;'>";k='<table id="table_'+l+"\"   border='0' cellspacing='0' cellpadding='0' align='center'onselectstart='if(window.event.ctrlKey || window.event.shiftKey) return false;else return true;'>";k=k+"<tbady>";var h=0;for(h=0;h<j.length;h++){d=j[h][0];g=j[h][1];f=j[h][2];k=k+"<tr height='20' class='"+(h%2==1?"odd-row":"even-row")+"' title='"+d+"'>";k=k+'<td id="td_obj_'+d+'"  align="center" width="1%"  nowrap height="20" title="'+g+'">';k=k+"<input type='hidden' name='itemid' value='"+d+"'>";k=k+"<input class='cbx' type='radio'  id='chk_obj_"+d+"' name='selectedItemIdx' value='"+h+"' onclick='dq.returnRow(this)' title='"+g+"'></td>";k=k+"<td nowrap>"+g+"</td>";k=k+"<td nowrap>"+f+"</td>";k=k+"</tr>"}k=k+"</tbody></table>"}k=k+"<table class='dq-scroll'><tr>";k=k+"<td id='refresh_"+l+"' onaction=\"dq.scrollPage('refresh_"+l+"','"+l+"')\"><img src=\"/html/nds/images/tb_refresh.gif\" align='absmiddle' border=0></td>";k=k+"<td id='pop_"+l+"' onaction=\"popup_window('"+m.poppath+"&action=input')\"><img src=\"/html/nds/images/tb_new.gif\" align='absmiddle' border=0></td>";k=k+"<td >-</td>";k=k+"<td id='begin_btn_"+l+"' onaction=\"dq.scrollPage('begin_btn_"+l+"','"+l+"')\"><img src=\"/html/nds/images/begin.gif\" width='16' height='16'></td>";k=k+"<td id='prev_btn_"+l+"' onaction=\"dq.scrollPage('prev_btn_"+l+"','"+l+"')\"><img src=\"/html/nds/images/back.gif\" width='16' height='16'></td>";k=k+"<td id='next_btn_"+l+"' onaction=\"dq.scrollPage('next_btn_"+l+"','"+l+"')\"><img src=\"/html/nds/images/next.gif\" width='16' height='16'></td>";k=k+"<td id='end_btn_"+l+"' onaction=\"dq.scrollPage('end_btn_"+l+"','"+l+"')\"><img src=\"/html/nds/images/end.gif\" width='16' height='16'></td>";k=k+"</tr></table></iframe>";c.innerHTML=k;var b=document.getElementById("table_"+l);var o=document.getElementById("json_"+l);if(b.offsetWidth!=0){e.style.width=b.offsetWidth+17;a.style.width=e.style.width;o.style.width=e.style.width;e.style.height=b.offsetHeight+26;a.style.height=e.style.height;o.style.height=e.style.height;if(j.length==0){e.style.width=160;a.style.width=e.style.width;o.style.width=e.style.width;e.style.height=40;a.style.height=e.style.height;o.style.height=e.style.height}}createButton($("refresh_"+l));createButton($("pop_"+l));createButton($("begin_btn_"+l));createButton($("prev_btn_"+l));createButton($("next_btn_"+l));createButton($("end_btn_"+l));dq.syncGridControl(l);this._init_result("table_"+l)}};DropdownQuery.main=function(){dq=new DropdownQuery()};jQuery(document).ready(DropdownQuery.main);DynamicQuery.prototype={initialize:function(){this._tr_cloosed_index=-1;this._dynshow_json=null;this._accepter_id=null;this._mouseOnSug=false;this._iskey=false;this._dynshowjson=null;this._dcqjsonlist=null},toggle:function(l){var j=false;var e=null;var c=null;var g="";var d="";if(this._dcqjsonlist!=null){this._accepter_id=this._dcqjsonlist[l].column_acc_Id;e=this._dcqjsonlist[l].tableId;c=this._dcqjsonlist[l].columnId;g=this._dcqjsonlist[l].newvalue;d=this._dcqjsonlist[l].oldvalue}if(this._dynshowjson!=null){for(var h=0;h<this._dynshowjson.length;h++){if(this._dynshowjson[h][0]==$(this._accepter_id).value){j=true;break}}}if(this._dynshow_json!=null){if(this._dynshow_json.qdata==$(this._accepter_id).value&&d!=""){j=true}}if(g==""&&$("div_dyn")!=null){$("div_dyn").style.display="none"}if(g!=""&&g!=d&&!j){var k="/html/nds/query/dynamicshow_result.jsp?table="+e+"&column="+c+"&accepter_id="+this._accepter_id+"&qdata="+g;var m,n,b,a;if($("div_dyn")!=null){$("div_dyn").style.display="";$("div_dyn").innerHTML="<div id='divcontent_dyn' style='z-index: 10;'></div>"}else{var a=document.createElement("div");a.id="div_dyn";a.style.display="";a.innerHTML="<div id='divcontent_dyn' style='z-index:10;'></div>";document.body.appendChild(a)}$("div_dyn").style.border="1px solid #ffffff";var f=getOffsets(this._accepter_id);m=k.indexOf("?");n=k;b="";if(m!=-1){n=k.substring(0,m);b=k.substring(m+1,k.length)}loadPage(n,b,this._returnQuery,this._accepter_id)}},closediv:function(){if(Prototype.Browser.IE){if($("sug_ie")!=null){$("sug_ie").style.display="none"}}$("div_dyn").style.display="none"},creattable:function(){var a=$("tb_"+dcq._accepter_id).rows;for(var b=0;b<a.length;b++){a[b].className="odd-row"}},clktr:function(a){return function(){$(dcq._accepter_id).blur();dcq.closediv();$(dcq._accepter_id).value=this.cells[0].innerHTML}},setdynamicdata:function(){$(this._accepter_id).onkeydown=this.keyboard;var isClkSug=false;$(this._accepter_id).onblur=function(e){if(!isClkSug){dcq.closediv()}isClkSug=false;time=0};if(typeof(this._dynshow_json.dynshowjson)!="object"||typeof(this._dynshow_json.qdata)=="undefined"||this._dynshow_json.qdata==""){return}var tab=document.createElement("table");with(tab){id="tb_"+this._accepter_id;style.width="100%";style.backgroundColor="#fff";cellspacing=0;cellpadding=0;style.cursor="default"}var tb=document.createElement("tbody");tab.appendChild(tb);for(var i=0;i<this._dynshow_json.dynshowjson.length;i++){var tr=tb.insertRow(-1);tr.onmouseover=function(){dcq.creattable;this.className="selected";this._mouseOnSug=true};tr.onmouseout=dcq.creattable;tr.onmousedown=function(e){$(dcq._accepter_id).blur();$(dcq._accepter_id).value=this.cells[0].innerHTML};tr.onclick=this.clktr(i);var td=tr.insertCell(-1);td.innerHTML=this._dynshow_json.dynshowjson[i][0];td=tr.insertCell(-1);td.innerHTML=this._dynshow_json.dynshowjson[i][1]}var th=tb.insertRow(-1);var td=th.insertCell(-1);td.innerHTML="";td=th.insertCell(-1);td.style.textAlign="right";td.innerHTML="<a href='javascript:void(0)'onclick='dcq.closediv();'>"+gMessageHolder.CLOSE_DIALOG+"</a>";var offsets=getOffsets(this._accepter_id);var div_top=offsets.y+(Prototype.Browser.Gecko?$(this._accepter_id).offsetHeight-3:$(this._accepter_id).offsetHeight);var dataheight=(this._dynshow_json.dynshowjson.length+1)*20;if(document.body.clientHeight-offsets.y-15<dataheight){div_top=div_top-dataheight-20}$("div_dyn").style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("div_dyn").style.top=div_top+"px";$("div_dyn").style.left=offsets.x;$("div_dyn").style.padding=0;$("div_dyn").style.position="absolute";$("div_dyn").style.zIndex=10;$("divcontent_dyn").style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("divcontent_dyn").style.top=div_top+"px";$("divcontent_dyn").style.left=offsets.x;$("tdiv_"+this._accepter_id).innerHTML="";$("tdiv_"+this._accepter_id).appendChild(tab);$("tdiv_"+this._accepter_id).style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("tdiv_"+this._accepter_id).style.top=div_top+"px";$("tdiv_"+this._accepter_id).style.left=offsets.x;$("tdiv_"+this._accepter_id).style.display="";if(Prototype.Browser.IE){var sug_ie=$("sug_ie");if(sug_ie==null){sug_ie=document.createElement("div");sug_ie.id="sug_ie";document.body.appendChild(sug_ie)}div_top=$(this._accepter_id).offsetHeight-14;if(document.body.clientHeight-div_top<dataheight){div_top=div_top-dataheight}with(sug_ie.style){display="";position="absolute";top=div_top+"px";left="0px";width=$("div_dyn").offsetWidth+"px";height=tab.offsetHeight+"px"}sug_ie.appendChild($("div_dyn"))}this._tr_cloosed_index=-1},keyboard:function(f){f=f||window.event;this._iskey=false;var d;if(f.keyCode==13){if(dcq._tr_cloosed_index>=0){dcq.closediv()}}if(f.keyCode==38||f.keyCode==40){this._mouseOnSug=false;if($("div_dyn").style.display!="none"){var a=$("tb_"+dcq._accepter_id).rows;var b=a.length-1;for(var c=0;c<b;c++){if(a[c].className=="selected"){dcq._tr_cloosed_index=c;break}}dcq.creattable();if(f.keyCode==38){if(dcq._tr_cloosed_index==0){$(dcq._accepter_id).value=dcq._dynshow_json.qdata;dcq._tr_cloosed_index=-1;this._iskey=true}else{if(dcq._tr_cloosed_index==-1){dcq._tr_cloosed_index=b}d=a[--dcq._tr_cloosed_index];d.className="selected";$(dcq._accepter_id).value=d.cells[0].innerHTML}}if(f.keyCode==40){if(dcq._tr_cloosed_index==b-1){$(dcq._accepter_id).value=dcq._dynshow_json.qdata;dcq._tr_cloosed_index=-1;this._iskey=true}else{d=a[++dcq._tr_cloosed_index];d.className="selected";$(dcq._accepter_id).value=d.cells[0].innerHTML}}}}},_returnQuery:function(c,d){var b=document.getElementById("divcontent_dyn");var a=c.responseText;b.innerHTML=c.responseText;executeLoadedScript(b);if(b.innerHTML!=""){$("div_dyn").style.border="1px solid #000000"}},createdynlist:function(b){if(this._dcqjsonlist==null){this._dcqjsonlist=b}else{var a=this._dcqjsonlist.length;var c=true;for(var e=0;e<b.length;e++){c=true;for(var d=0;d<a;d++){if(this._dcqjsonlist[d].column_acc_Id==b[e].column_acc_Id){c=false;break}}if(c){this._dcqjsonlist[a]=b[e];a++}}}},dynquery:function(){if(this._dcqjsonlist!=null){for(var a=0;a<this._dcqjsonlist.length;a++){if(this._dcqjsonlist[a].column_acc_Id==document.activeElement.id){if($(this._dcqjsonlist[a].column_acc_Id).value!=this._dcqjsonlist[a].newvalue){this._dcqjsonlist[a].oldvalue=this._dcqjsonlist[a].newvalue;this._dcqjsonlist[a].newvalue=$(this._dcqjsonlist[a].column_acc_Id).value;this.toggle(a);break}}}}},dynjson:function(a){this._dynshow_json=a;if(this._dynshow_json.dynshowjson.length>0){this._tr_cloosed_index=-1;this._dynshowjson=this._dynshow_json.dynshowjson;this.setdynamicdata()}}};DynamicQuery.main=function(){dcq=new DynamicQuery()};jQuery(document).ready(DynamicQuery.main);function reconstructQueryURL(j,l,f){var c=j;if(l!=undefined&&l!=null){var e,g,k,h,d;var a=(l.ta?l.rc:l.prc);var b=l.ta?[]:l.rc;for(e=0;e<a.length;e++){k=$("column_"+a[e]);d=oc.getColumnById(a[e]);if(k!=null){h=dwr.util.getValue(k);if(h==null||h.blank()){if(d!=null&&!d.isNullable){alert(gMessageHolder.INPUT_FIELD.replace("0",d.description));k.focus();return}}else{c+="&wfc_"+a[e]+"="+encodeURIComponent(h)}}}for(e=0;e<b.length;e++){d=gc.getColumnById(b[e]);if(d==null){continue}if(f.startsWith("eo_")){k=$("eo_"+d.name)}else{k=$(f.split("_",1)+"_"+d.name)}if(k!=null){h=dwr.util.getValue(k);if(h==null||h.blank()){if(!d.isNullable){alert(gMessageHolder.INPUT_FIELD.replace("0",d.description));k.focus();return}}else{c+="&wfc_"+b[e]+"="+encodeURIComponent(h)}}}}return c}function handleObjectInputKey(b,a){if(!b){b=window.event}if(b.altKey&&b.keyCode==191){oq.toggle(a,b.srcElement.id)}}function handleDropdownInputKey(b,a){if(!b){b=window.event}if(b.altKey&&b.keyCode==191){dq.toggle(a,b.srcElement.id)}}function getOffsets(a,b){if(!b){b=new Object();b.x=b.y=0}if(typeof a=="string"){a=document.getElementById(a)}b.x+=a.offsetLeft-a.scrollLeft;b.y+=a.offsetTop-a.scrollTop;do{a=a.offsetParent;if(!a){break}if(a.tagName.toUpperCase()!="BODY"){b.x+=a.offsetLeft-a.scrollLeft;b.y+=a.offsetTop-a.scrollTop}else{b.x+=a.offsetLeft;b.y+=a.offsetTop}}while(a.tagName.toUpperCase()!="BODY");return b}function json2xml(d,c){var e=function(g,j,o){var h="";if(g instanceof Array){for(var k=0,p=g.length;k<p;k++){h+=o+e(g[k],j,o+"\t")+"\n"}}else{if(typeof(g)=="object"){var l=false;h+=o+"<"+j;for(var f in g){if(f.charAt(0)=="@"){h+=" "+f.substr(1)+'="'+g[f].toString()+'"'}else{l=true}}h+=l?">":"/>";if(l){for(var f in g){if(f=="#text"){h+=g[f]}else{if(f=="#cdata"){h+="<![CDATA["+g[f]+"]]>"}else{if(f.charAt(0)!="@"){h+=e(g[f],f,o+"\t")}}}}h+=(h.charAt(h.length-1)=="\n"?o:"")+"</"+j+">"}}else{h+=o+"<"+j+">"+g.toString()+"</"+j+">"}}return h},b="";for(var a in d){b+=e(d[a],a,"")}return c?b.replace(/\t/g,c):b.replace(/\t|\n/g,"")}function fireEvent(b,c){if(document.createEventObject){var a=document.createEventObject();return b.fireEvent("on"+c,a)}else{var a=document.createEvent("HTMLEvents");a.initEvent(c,true,true);return !b.dispatchEvent(a)}};