var Prototype={Version:"1.5.1",Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:(document.createElement("div").__proto__!==document.createElement("form").__proto__)},ScriptFragment:"<script[^>]*>([\u0001-\uFFFF]*?)<\/script>",JSONFilter:/^\/\*-secure-\s*(.*)\s*\*\/\s*$/,emptyFunction:function(){},K:function(c){return c}};var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var Abstract=new Object();Object.extend=function(c,e){for(var d in e){c[d]=e[d]}return c};Object.extend(Object,{inspect:function(c){try{if(c===undefined){return"undefined"}if(c===null){return"null"}return c.inspect?c.inspect():c.toString()}catch(d){if(d instanceof RangeError){return"..."}throw d}},toJSON:function(c){var e=typeof c;switch(e){case"undefined":case"function":case"unknown":return;case"boolean":return c.toString()}if(c===null){return"null"}if(c.toJSON){return c.toJSON()}if(c.ownerDocument===document){return}var d=[];for(var g in c){var f=Object.toJSON(c[g]);if(f!==undefined){d.push(g.toJSON()+": "+f)}}return"{"+d.join(", ")+"}"},keys:function(c){var d=[];for(var e in c){d.push(e)}return d},values:function(d){var c=[];for(var e in d){c.push(d[e])}return c},clone:function(c){return Object.extend({},c)}});Function.prototype.bind=function(){var c=this,e=$A(arguments),d=e.shift();return function(){return c.apply(d,e.concat($A(arguments)))}};Function.prototype.bindAsEventListener=function(e){var c=this,d=$A(arguments),e=d.shift();return function(f){return c.apply(e,[f||window.event].concat(d))}};Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(c){$R(0,this,true).each(c);return this},toPaddedString:function(e,d){var c=this.toString(d||10);return"0".times(e-c.length)+c},toJSON:function(){return isFinite(this)?this.toString():"null"}});Date.prototype.toJSON=function(){return'"'+this.getFullYear()+"-"+(this.getMonth()+1).toPaddedString(2)+"-"+this.getDate().toPaddedString(2)+"T"+this.getHours().toPaddedString(2)+":"+this.getMinutes().toPaddedString(2)+":"+this.getSeconds().toPaddedString(2)+'"'};var Try={these:function(){var f;for(var d=0,g=arguments.length;d<g;d++){var c=arguments[d];try{f=c();break}catch(h){}}return f}};var PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(d,c){this.callback=d;this.frequency=c;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.callback(this)}finally{this.currentlyExecuting=false}}}};Object.extend(String,{interpret:function(c){return c==null?"":String(c)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(g,e){var c="",f=this,d;e=arguments.callee.prepareReplacement(e);while(f.length>0){if(d=f.match(g)){c+=f.slice(0,d.index);c+=String.interpret(e(d));f=f.slice(d.index+d[0].length)}else{c+=f,f=""}}return c},sub:function(e,c,d){c=this.gsub.prepareReplacement(c);d=d===undefined?1:d;return this.gsub(e,function(f){if(--d<0){return f[0]}return c(f)})},scan:function(d,c){this.gsub(d,c);return this},truncate:function(d,c){d=d||30;c=c===undefined?"...":c;return this.length>d?this.slice(0,d-c.length)+c:this},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var d=new RegExp(Prototype.ScriptFragment,"img");var c=new RegExp(Prototype.ScriptFragment,"im");return(this.match(d)||[]).map(function(e){return(e.match(c)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var c=arguments.callee;c.text.data=this;return c.div.innerHTML},unescapeHTML:function(){var c=document.createElement("div");c.innerHTML=this.stripTags();return c.childNodes[0]?(c.childNodes.length>1?$A(c.childNodes).inject("",function(d,e){return d+e.nodeValue}):c.childNodes[0].nodeValue):""},toQueryParams:function(d){var c=this.strip().match(/([^?#]*)(#.*)?$/);if(!c){return{}}return c[1].split(d||"&").inject({},function(g,h){if((h=h.split("="))[0]){var e=decodeURIComponent(h.shift());var f=h.length>1?h.join("="):h[0];if(f!=undefined){f=decodeURIComponent(f)}if(e in g){if(g[e].constructor!=Array){g[e]=[g[e]]}g[e].push(f)}else{g[e]=f}}return g})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(e){var c="";for(var d=0;d<e;d++){c+=this}return c},camelize:function(){var f=this.split("-"),c=f.length;if(c==1){return f[0]}var e=this.charAt(0)=="-"?f[0].charAt(0).toUpperCase()+f[0].substring(1):f[0];for(var d=1;d<c;d++){e+=f[d].charAt(0).toUpperCase()+f[d].substring(1)}return e},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(d){var c=this.gsub(/[\x00-\x1f\\]/,function(e){var f=String.specialChar[e[0]];return f?f:"\\u00"+e[0].charCodeAt().toPaddedString(2,16)});if(d){return'"'+c.replace(/"/g,'\\"')+'"'}return"'"+c.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(c){return this.sub(c||Prototype.JSONFilter,"#{1}")},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(json))){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(c){return this.indexOf(c)>-1},startsWith:function(c){return this.indexOf(c)===0},endsWith:function(c){var e=this.length-c.length;return e>=0&&this.lastIndexOf(c)===e},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(d){if(typeof d=="function"){return d}var c=new Template(d);return function(e){return c.evaluate(e)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});with(String.prototype.escapeHTML){div.appendChild(text)}var Template=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;Template.prototype={initialize:function(c,d){this.template=c.toString();this.pattern=d||Template.Pattern},evaluate:function(c){return this.template.gsub(this.pattern,function(d){var e=d[1];if(e=="\\"){return d[2]}return e+String.interpret(c[d[3]])})}};var $break={},$continue=new Error('"throw $continue" is deprecated, use "return" instead');var Enumerable={each:function(d){var c=0;try{this._each(function(e){d(e,c++)})}catch(f){if(f!=$break){throw f}}return this},eachSlice:function(e,d){var c=-e,f=[],g=this.toArray();while((c+=e)<g.length){f.push(g.slice(c,c+e))}return f.map(d)},all:function(d){var c=true;this.each(function(f,e){c=c&&!!(d||Prototype.K)(f,e);if(!c){throw $break}});return c},any:function(d){var c=false;this.each(function(f,e){if(c=!!(d||Prototype.K)(f,e)){throw $break}});return c},collect:function(d){var c=[];this.each(function(f,e){c.push((d||Prototype.K)(f,e))});return c},detect:function(d){var c;this.each(function(f,e){if(d(f,e)){c=f;throw $break}});return c},findAll:function(d){var c=[];this.each(function(f,e){if(d(f,e)){c.push(f)}});return c},grep:function(e,d){var c=[];this.each(function(h,g){var f=h.toString();if(f.match(e)){c.push((d||Prototype.K)(h,g))}});return c},include:function(c){var d=false;this.each(function(e){if(e==c){d=true;throw $break}});return d},inGroupsOf:function(d,c){c=c===undefined?null:c;return this.eachSlice(d,function(e){while(e.length<d){e.push(c)}return e})},inject:function(c,d){this.each(function(f,e){c=d(c,f,e)});return c},invoke:function(d){var c=$A(arguments).slice(1);return this.map(function(e){return e[d].apply(e,c)})},max:function(d){var c;this.each(function(f,e){f=(d||Prototype.K)(f,e);if(c==undefined||f>=c){c=f}});return c},min:function(d){var c;this.each(function(f,e){f=(d||Prototype.K)(f,e);if(c==undefined||f<c){c=f}});return c},partition:function(e){var d=[],c=[];this.each(function(g,f){((e||Prototype.K)(g,f)?d:c).push(g)});return[d,c]},pluck:function(d){var c=[];this.each(function(f,e){c.push(f[d])});return c},reject:function(d){var c=[];this.each(function(f,e){if(!d(f,e)){c.push(f)}});return c},sortBy:function(c){return this.map(function(e,d){return{value:e,criteria:c(e,d)}}).sort(function(g,f){var e=g.criteria,d=f.criteria;return e<d?-1:e>d?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var d=Prototype.K,c=$A(arguments);if(typeof c.last()=="function"){d=c.pop()}var e=[this].concat(c).map($A);return this.map(function(g,f){return d(e.pluck(f))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var $A=Array.from=function(f){if(!f){return[]}if(f.toArray){return f.toArray()}else{var d=[];for(var c=0,e=f.length;c<e;c++){d.push(f[c])}return d}};if(Prototype.Browser.WebKit){$A=Array.from=function(f){if(!f){return[]}if(!(typeof f=="function"&&f=="[object NodeList]")&&f.toArray){return f.toArray()}else{var d=[];for(var c=0,e=f.length;c<e;c++){d.push(f[c])}return d}}}Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(d){for(var c=0,e=this.length;c<e;c++){d(this[c])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(c){return c!=null})},flatten:function(){return this.inject([],function(d,c){return d.concat(c&&c.constructor==Array?c.flatten():[c])})},without:function(){var c=$A(arguments);return this.select(function(d){return !c.include(d)})},indexOf:function(c){for(var d=0,e=this.length;d<e;d++){if(this[d]==c){return d}}return -1},reverse:function(c){return(c!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(c){return this.inject([],function(f,e,d){if(0==d||(c?f.last()!=e:!f.include(e))){f.push(e)}return f})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var c=[];this.each(function(d){var e=Object.toJSON(d);if(e!==undefined){c.push(e)}});return"["+c.join(", ")+"]"}});Array.prototype.toArray=Array.prototype.clone;function $w(c){c=c.strip();return c?c.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var g=[];for(var d=0,e=this.length;d<e;d++){g.push(this[d])}for(var d=0,e=arguments.length;d<e;d++){if(arguments[d].constructor==Array){for(var c=0,f=arguments[d].length;c<f;c++){g.push(arguments[d][c])}}else{g.push(arguments[d])}}return g}}var Hash=function(c){if(c instanceof Hash){this.merge(c)}else{Object.extend(this,c||{})}};Object.extend(Hash,{toQueryString:function(d){var c=[];c.add=arguments.callee.addPair;this.prototype._each.call(d,function(f){if(!f.key){return}var e=f.value;if(e&&typeof e=="object"){if(e.constructor==Array){e.each(function(g){c.add(f.key,g)})}return}c.add(f.key,e)});return c.join("&")},toJSON:function(c){var d=[];this.prototype._each.call(c,function(f){var e=Object.toJSON(f.value);if(e!==undefined){d.push(f.key.toJSON()+": "+e)}});return"{"+d.join(", ")+"}"}});Hash.toQueryString.addPair=function(c,e,d){c=encodeURIComponent(c);if(e===undefined){this.push(c)}else{this.push(c+"="+(e==null?"":encodeURIComponent(e)))}};Object.extend(Hash.prototype,Enumerable);Object.extend(Hash.prototype,{_each:function(d){for(var c in this){var e=this[c];if(e&&e==Hash.prototype[c]){continue}var f=[c,e];f.key=c;f.value=e;d(f)}},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},merge:function(c){return $H(c).inject(this,function(d,e){d[e.key]=e.value;return d})},remove:function(){var c;for(var d=0,e=arguments.length;d<e;d++){var f=this[arguments[d]];if(f!==undefined){if(c===undefined){c=f}else{if(c.constructor!=Array){c=[c]}c.push(f)}}delete this[arguments[d]]}return c},toQueryString:function(){return Hash.toQueryString(this)},inspect:function(){return"#<Hash:{"+this.map(function(c){return c.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Hash.toJSON(this)}});function $H(c){if(c instanceof Hash){return c}return new Hash(c)}if(function(){var c=0,e=function(f){this.key=f};e.prototype.key="foo";for(var d in new e("bar")){c++}return c>1}()){Hash.prototype._each=function(e){var c=[];for(var d in this){var f=this[d];if((f&&f==Hash.prototype[d])||c.include(d)){continue}c.push(d);var g=[d,f];g.key=d;g.value=f;e(g)}}}ObjectRange=Class.create();Object.extend(ObjectRange.prototype,Enumerable);Object.extend(ObjectRange.prototype,{initialize:function(e,c,d){this.start=e;this.end=c;this.exclusive=d},_each:function(c){var d=this.start;while(this.include(d)){c(d);d=d.succ()}},include:function(c){if(c<this.start){return false}if(this.exclusive){return c<this.end}return c<=this.end}});var $R=function(e,c,d){return new ObjectRange(e,c,d)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(c){this.responders._each(c)},register:function(c){if(!this.include(c)){this.responders.push(c)}},unregister:function(c){this.responders=this.responders.without(c)},dispatch:function(f,d,e,c){this.each(function(g){if(typeof g[f]=="function"){try{g[f].apply(g,[d,e,c])}catch(h){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=function(){};Ajax.Base.prototype={setOptions:function(c){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:""};Object.extend(this.options,c||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=this.options.parameters.toQueryParams()}}};Ajax.Request=Class.create();Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Request.prototype=Object.extend(new Ajax.Base(),{_complete:false,initialize:function(d,c){this.transport=Ajax.getTransport();this.setOptions(c);this.request(d)},request:function(c){this.url=c;this.method=this.options.method;var f=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){f._method=this.method;this.method="post"}this.parameters=f;if(f=Hash.toQueryString(f)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{if(this.options.onCreate){this.options.onCreate(this.transport)}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var c=this.transport.readyState;if(c>1&&!((c==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var g={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){g["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){g.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var e=this.options.requestHeaders;if(typeof e.push=="function"){for(var d=0,f=e.length;d<f;d+=2){g[e[d]]=e[d+1]}}else{$H(e).each(function(h){g[h.key]=h.value})}}for(var c in g){this.transport.setRequestHeader(c,g[c])}},success:function(){return !this.transport.status||(this.transport.status>=200&&this.transport.status<300)},respondToReadyState:function(c){var f=Ajax.Request.Events[c];var j=this.transport,d=this.evalJSON();if(f=="Complete"){try{this._complete=true;(this.options["on"+this.transport.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(j,d)}catch(g){this.dispatchException(g)}var h=this.getHeader("Content-type");if(h&&h.strip().match(/^(text|application)\/(x-)?(java|ecma)script(;.*)?$/i)){this.evalResponse()}}try{(this.options["on"+f]||Prototype.emptyFunction)(j,d);Ajax.Responders.dispatch("on"+f,this,j,d)}catch(g){this.dispatchException(g)}if(f=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},getHeader:function(c){try{return this.transport.getResponseHeader(c)}catch(d){return null}},evalJSON:function(){try{var c=this.getHeader("X-JSON");return c?c.evalJSON():null}catch(d){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(c){(this.options.onException||Prototype.emptyFunction)(this,c);Ajax.Responders.dispatch("onException",this,c)}});Ajax.Updater=Class.create();Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(c,e,d){this.container={success:(c.success||c),failure:(c.failure||(c.success?null:c))};this.transport=Ajax.getTransport();this.setOptions(d);var f=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=(function(h,g){this.updateContent();f(h,g)}).bind(this);this.request(e)},updateContent:function(){var d=this.container[this.success()?"success":"failure"];var c=this.transport.responseText;if(!this.options.evalScripts){c=c.stripScripts()}if(d=$(d)){if(this.options.insertion){new this.options.insertion(d,c)}else{d.update(c)}}if(this.success()){if(this.onComplete){setTimeout(this.onComplete.bind(this),10)}}}});Ajax.PeriodicalUpdater=Class.create();Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base(),{initialize:function(c,e,d){this.setOptions(d);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=c;this.url=e;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(c){if(this.options.decay){this.decay=(c.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=c.responseText}this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1000)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(d){if(arguments.length>1){for(var c=0,f=[],e=arguments.length;c<e;c++){f.push($(arguments[c]))}return f}if(typeof d=="string"){d=document.getElementById(d)}return Element.extend(d)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(h,c){var e=[];var g=document.evaluate(h,$(c)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var d=0,f=g.snapshotLength;d<f;d++){e.push(g.snapshotItem(d))}return e};document.getElementsByClassName=function(d,c){var e=".//*[contains(concat(' ', @class, ' '), ' "+d+" ')]";return document._getElementsByXPath(e,c)}}else{document.getElementsByClassName=function(f,c){var e=($(c)||document.body).getElementsByTagName("*");var h=[],j;for(var d=0,g=e.length;d<g;d++){j=e[d];if(Element.hasClassName(j,f)){h.push(Element.extend(j))}}return h}}if(!window.Element){var Element={}}Element.extend=function(g){var h=Prototype.BrowserFeatures;if(!g||!g.tagName||g.nodeType==3||g._extended||h.SpecificElementExtensions||g==window){return g}var d={},f=g.tagName,c=Element.extend.cache,e=Element.Methods.ByTag;if(!h.ElementExtensions){Object.extend(d,Element.Methods),Object.extend(d,Element.Methods.Simulated)}if(e[f]){Object.extend(d,e[f])}for(var l in d){var j=d[l];if(typeof j=="function"&&!(l in g)){g[l]=c.findOrStore(j)}}g._extended=Prototype.emptyFunction;return g};Element.extend.cache={findOrStore:function(c){return this[c]=this[c]||function(){return c.apply(null,[this].concat($A(arguments)))}}};Element.Methods={visible:function(c){return $(c).style.display!="none"},toggle:function(c){c=$(c);Element[Element.visible(c)?"hide":"show"](c);return c},hide:function(c){$(c).style.display="none";return c},show:function(c){$(c).style.display="";return c},remove:function(c){c=$(c);c.parentNode.removeChild(c);return c},update:function(d,c){c=typeof c=="undefined"?"":c.toString();$(d).innerHTML=c.stripScripts();setTimeout(function(){c.evalScripts()},10);return d},replace:function(e,d){e=$(e);d=typeof d=="undefined"?"":d.toString();if(e.outerHTML){e.outerHTML=d.stripScripts()}else{var c=e.ownerDocument.createRange();c.selectNodeContents(e);e.parentNode.replaceChild(c.createContextualFragment(d.stripScripts()),e)}setTimeout(function(){d.evalScripts()},10);return e},inspect:function(d){d=$(d);var c="<"+d.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(h){var g=h.first(),e=h.last();var f=(d[g]||"").toString();if(f){c+=" "+e+"="+f.inspect(true)}});return c+">"},recursivelyCollect:function(c,e){c=$(c);var d=[];while(c=c[e]){if(c.nodeType==1){d.push(Element.extend(c))}}return d},ancestors:function(c){return $(c).recursivelyCollect("parentNode")},descendants:function(c){return $A($(c).getElementsByTagName("*")).each(Element.extend)},firstDescendant:function(c){c=$(c).firstChild;while(c&&c.nodeType!=1){c=c.nextSibling}return $(c)},immediateDescendants:function(c){if(!(c=$(c).firstChild)){return[]}while(c&&c.nodeType!=1){c=c.nextSibling}if(c){return[c].concat($(c).nextSiblings())}return[]},previousSiblings:function(c){return $(c).recursivelyCollect("previousSibling")},nextSiblings:function(c){return $(c).recursivelyCollect("nextSibling")},siblings:function(c){c=$(c);return c.previousSiblings().reverse().concat(c.nextSiblings())},match:function(d,c){if(typeof c=="string"){c=new Selector(c)}return c.match($(d))},up:function(d,f,c){d=$(d);if(arguments.length==1){return $(d.parentNode)}var e=d.ancestors();return f?Selector.findElement(e,f,c):e[c||0]},down:function(d,e,c){d=$(d);if(arguments.length==1){return d.firstDescendant()}var f=d.descendants();return e?Selector.findElement(f,e,c):f[c||0]},previous:function(d,f,c){d=$(d);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(d))}var e=d.previousSiblings();return f?Selector.findElement(e,f,c):e[c||0]},next:function(e,f,d){e=$(e);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(e))}var c=e.nextSiblings();return f?Selector.findElement(c,f,d):c[d||0]},getElementsBySelector:function(){var c=$A(arguments),d=$(c.shift());return Selector.findChildElements(d,c)},getElementsByClassName:function(c,d){return document.getElementsByClassName(d,c)},readAttribute:function(e,c){e=$(e);if(Prototype.Browser.IE){if(!e.attributes){return null}var d=Element._attributeTranslations;if(d.values[c]){return d.values[c](e,c)}if(d.names[c]){c=d.names[c]}var f=e.attributes[c];return f?f.nodeValue:null}return e.getAttribute(c)},getHeight:function(c){return $(c).getDimensions().height},getWidth:function(c){return $(c).getDimensions().width},classNames:function(c){return new Element.ClassNames(c)},hasClassName:function(c,d){if(!(c=$(c))){return}var e=c.className;if(e.length==0){return false}if(e==d||e.match(new RegExp("(^|\\s)"+d+"(\\s|$)"))){return true}return false},addClassName:function(c,d){if(!(c=$(c))){return}Element.classNames(c).add(d);return c},removeClassName:function(c,d){if(!(c=$(c))){return}Element.classNames(c).remove(d);return c},toggleClassName:function(c,d){if(!(c=$(c))){return}Element.classNames(c)[c.hasClassName(d)?"remove":"add"](d);return c},observe:function(){Event.observe.apply(Event,arguments);return $A(arguments).first()},stopObserving:function(){Event.stopObserving.apply(Event,arguments);return $A(arguments).first()},cleanWhitespace:function(d){d=$(d);var e=d.firstChild;while(e){var c=e.nextSibling;if(e.nodeType==3&&!/\S/.test(e.nodeValue)){d.removeChild(e)}e=c}return d},empty:function(c){return $(c).innerHTML.blank()},descendantOf:function(d,c){d=$(d),c=$(c);while(d=d.parentNode){if(d==c){return true}}return false},scrollTo:function(c){c=$(c);var d=Position.cumulativeOffset(c);window.scrollTo(d[0],d[1]);return c},getStyle:function(d,e){d=$(d);e=e=="float"?"cssFloat":e.camelize();var f=d.style[e];if(!f){var c=document.defaultView.getComputedStyle(d,null);f=c?c[e]:null}if(e=="opacity"){return f?parseFloat(f):1}return f=="auto"?null:f},getOpacity:function(c){return $(c).getStyle("opacity")},setStyle:function(c,e,d){c=$(c);var g=c.style;for(var f in e){if(f=="opacity"){c.setOpacity(e[f])}else{g[(f=="float"||f=="cssFloat")?(g.styleFloat===undefined?"cssFloat":"styleFloat"):(d?f:f.camelize())]=e[f]}}return c},setOpacity:function(c,d){c=$(c);c.style.opacity=(d==1||d==="")?"":(d<0.00001)?0:d;return c},getDimensions:function(e){e=$(e);var j=$(e).getStyle("display");if(j!="none"&&j!=null){return{width:e.offsetWidth,height:e.offsetHeight}}var d=e.style;var h=d.visibility;var f=d.position;var c=d.display;d.visibility="hidden";d.position="absolute";d.display="block";var l=e.clientWidth;var g=e.clientHeight;d.display=c;d.position=f;d.visibility=h;return{width:l,height:g}},makePositioned:function(c){c=$(c);var d=Element.getStyle(c,"position");if(d=="static"||!d){c._madePositioned=true;c.style.position="relative";if(window.opera){c.style.top=0;c.style.left=0}}return c},undoPositioned:function(c){c=$(c);if(c._madePositioned){c._madePositioned=undefined;c.style.position=c.style.top=c.style.left=c.style.bottom=c.style.right=""}return c},makeClipping:function(c){c=$(c);if(c._overflow){return c}c._overflow=c.style.overflow||"auto";if((Element.getStyle(c,"overflow")||"visible")!="hidden"){c.style.overflow="hidden"}return c},undoClipping:function(c){c=$(c);if(!c._overflow){return c}c.style.overflow=c._overflow=="auto"?"":c._overflow;c._overflow=null;return c}};Object.extend(Element.Methods,{childOf:Element.Methods.descendantOf,childElements:Element.Methods.immediateDescendants});if(Prototype.Browser.Opera){Element.Methods._getStyle=Element.Methods.getStyle;Element.Methods.getStyle=function(c,d){switch(d){case"left":case"top":case"right":case"bottom":if(Element._getStyle(c,"position")=="static"){return null}default:return Element._getStyle(c,d)}}}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(c,d){c=$(c);d=(d=="float"||d=="cssFloat")?"styleFloat":d.camelize();var e=c.style[d];if(!e&&c.currentStyle){e=c.currentStyle[d]}if(d=="opacity"){if(e=(c.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(e[1]){return parseFloat(e[1])/100}}return 1}if(e=="auto"){if((d=="width"||d=="height")&&(c.getStyle("display")!="none")){return c["offset"+d.capitalize()]+"px"}return null}return e};Element.Methods.setOpacity=function(c,f){c=$(c);var e=c.getStyle("filter"),d=c.style;if(f==1||f===""){d.filter=e.replace(/alpha\([^\)]*\)/gi,"");return c}else{if(f<0.00001){f=0}}d.filter=e.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(f*100)+")";return c};Element.Methods.update=function(e,d){e=$(e);d=typeof d=="undefined"?"":d.toString();var c=e.tagName.toUpperCase();if(["THEAD","TBODY","TR","TD"].include(c)){var f=document.createElement("div");switch(c){case"THEAD":case"TBODY":f.innerHTML="<table><tbody>"+d.stripScripts()+"</tbody></table>";depth=2;break;case"TR":f.innerHTML="<table><tbody><tr>"+d.stripScripts()+"</tr></tbody></table>";depth=3;break;case"TD":f.innerHTML="<table><tbody><tr><td>"+d.stripScripts()+"</td></tr></tbody></table>";depth=4}$A(e.childNodes).each(function(g){e.removeChild(g)});depth.times(function(){f=f.firstChild});$A(f.childNodes).each(function(g){e.appendChild(g)})}else{e.innerHTML=d.stripScripts()}setTimeout(function(){d.evalScripts()},10);return e}}else{if(Prototype.Browser.Gecko){Element.Methods.setOpacity=function(c,d){c=$(c);c.style.opacity=(d==1)?0.999999:(d==="")?"":(d<0.00001)?0:d;return c}}}}Element._attributeTranslations={names:{colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc"},values:{_getAttr:function(c,d){return c.getAttribute(d,2)},_flag:function(c,d){return $(c).hasAttribute(d)?d:null},style:function(c){return c.style.cssText.toLowerCase()},title:function(c){var d=c.getAttributeNode("title");return d.specified?d.nodeValue:null}}};(function(){Object.extend(this,{href:this._getAttr,src:this._getAttr,type:this._getAttr,disabled:this._flag,checked:this._flag,readonly:this._flag,multiple:this._flag})}).call(Element._attributeTranslations.values);Element.Methods.Simulated={hasAttribute:function(d,f){var c=Element._attributeTranslations,e;f=c.names[f]||f;e=$(d).getAttributeNode(f);return e&&e.specified}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true}Element.hasAttribute=function(c,d){if(c.hasAttribute){return c.hasAttribute(d)}return Element.Methods.Simulated.hasAttribute(c,d)};Element.addMethods=function(e){var l=Prototype.BrowserFeatures,f=Element.Methods.ByTag;if(!e){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var d=e;e=arguments[1]}if(!d){Object.extend(Element.Methods,e||{})}else{if(d.constructor==Array){d.each(j)}else{j(d)}}function j(n){n=n.toUpperCase();if(!Element.Methods.ByTag[n]){Element.Methods.ByTag[n]={}}Object.extend(Element.Methods.ByTag[n],e)}function c(q,o,n){n=n||false;var p=Element.extend.cache;for(var s in q){var r=q[s];if(!n||!(s in o)){o[s]=p.findOrStore(r)}}}function g(p){var n;var o={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(o[p]){n="HTML"+o[p]+"Element"}if(window[n]){return window[n]}n="HTML"+p+"Element";if(window[n]){return window[n]}n="HTML"+p.capitalize()+"Element";if(window[n]){return window[n]}window[n]={};window[n].prototype=document.createElement(p).__proto__;return window[n]}if(l.ElementExtensions){c(Element.Methods,HTMLElement.prototype);c(Element.Methods.Simulated,HTMLElement.prototype,true)}if(l.SpecificElementExtensions){for(var m in Element.Methods.ByTag){var h=g(m);if(typeof h=="undefined"){continue}c(f[m],h.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag};var Toggle={display:Element.toggle};Abstract.Insertion=function(c){this.adjacency=c};Abstract.Insertion.prototype={initialize:function(d,f){this.element=$(d);this.content=f.stripScripts();if(this.adjacency&&this.element.insertAdjacentHTML){try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(g){var c=this.element.tagName.toUpperCase();if(["TBODY","TR"].include(c)){this.insertContent(this.contentFromAnonymousTable())}else{throw g}}}else{this.range=this.element.ownerDocument.createRange();if(this.initializeRange){this.initializeRange()}this.insertContent([this.range.createContextualFragment(this.content)])}setTimeout(function(){f.evalScripts()},10)},contentFromAnonymousTable:function(){var c=document.createElement("div");c.innerHTML="<table><tbody>"+this.content+"</tbody></table>";return $A(c.childNodes[0].childNodes[0].childNodes)}};var Insertion=new Object();Insertion.Before=Class.create();Insertion.Before.prototype=Object.extend(new Abstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(c){c.each((function(d){this.element.parentNode.insertBefore(d,this.element)}).bind(this))}});Insertion.Top=Class.create();Insertion.Top.prototype=Object.extend(new Abstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(true)},insertContent:function(c){c.reverse(false).each((function(d){this.element.insertBefore(d,this.element.firstChild)}).bind(this))}});Insertion.Bottom=Class.create();Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element);this.range.collapse(this.element)},insertContent:function(c){c.each((function(d){this.element.appendChild(d)}).bind(this))}});Insertion.After=Class.create();Insertion.After.prototype=Object.extend(new Abstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(c){c.each((function(d){this.element.parentNode.insertBefore(d,this.element.nextSibling)}).bind(this))}});Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(c){this.element=$(c)},_each:function(c){this.element.className.split(/\s+/).select(function(d){return d.length>0})._each(c)},set:function(c){this.element.className=c},add:function(c){if(this.include(c)){return}this.set($A(this).concat(c).join(" "))},remove:function(c){if(!this.include(c)){return}this.set($A(this).without(c).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);var Selector=Class.create();Selector.prototype={initialize:function(c){this.expression=c.strip();this.compileMatcher()},compileMatcher:function(){if(Prototype.BrowserFeatures.XPath&&!(/\[[\w-]*?:/).test(this.expression)){return this.compileXPathMatcher()}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return}this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(typeof c[i]=="function"?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var h=this.expression,j=Selector.patterns,d=Selector.xpath,g,c;if(Selector._cache[h]){this.xpath=Selector._cache[h];return}this.matcher=[".//*"];while(h&&g!=h&&(/\S/).test(h)){g=h;for(var f in j){if(c=h.match(j[f])){this.matcher.push(typeof d[f]=="function"?d[f](c):new Template(d[f]).evaluate(c));h=h.replace(c[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(c){c=c||document;if(this.xpath){return document._getElementsByXPath(this.xpath,c)}return this.matcher(c)},match:function(c){return this.findElements(document).include(c)},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}};Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(c){if(c[1]=="*"){return""}return"[local-name()='"+c[1].toLowerCase()+"' or local-name()='"+c[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:"[@#{1}]",attr:function(c){c[3]=c[5]||c[6];return new Template(Selector.xpath.operators[c[2]]).evaluate(c)},pseudo:function(c){var d=Selector.xpath.pseudos[c[1]];if(!d){return""}if(typeof d==="function"){return d(c)}return new Template(Selector.xpath.pseudos[c[1]]).evaluate(c)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(d){var n=d[6],l=Selector.patterns,c=Selector.xpath,h,d,f;var j=[];while(n&&h!=n&&(/\S/).test(n)){h=n;for(var g in l){if(d=n.match(l[g])){f=typeof c[g]=="function"?c[g](d):new Template(c[g]).evaluate(d);j.push("("+f.substring(1,f.length-1)+")");n=n.replace(d[0],"");break}}}return"[not("+j.join(" and ")+")]"},"nth-child":function(c){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",c)},"nth-last-child":function(c){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",c)},"nth-of-type":function(c){return Selector.xpath.pseudos.nth("position() ",c)},"nth-last-of-type":function(c){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",c)},"first-of-type":function(c){c[6]="1";return Selector.xpath.pseudos["nth-of-type"](c)},"last-of-type":function(c){c[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](c)},"only-of-type":function(c){var d=Selector.xpath.pseudos;return d["first-of-type"](c)+d["last-of-type"](c)},nth:function(g,e){var h,j=e[6],d;if(j=="even"){j="2n+0"}if(j=="odd"){j="2n+1"}if(h=j.match(/^(\d+)$/)){return"["+g+"= "+h[1]+"]"}if(h=j.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(h[1]=="-"){h[1]=-1}var f=h[1]?Number(h[1]):1;var c=h[2]?Number(h[2]):0;d="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(d).evaluate({fragment:g,a:f,b:c})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);   c = false;',className:'n = h.className(n, r, "#{1}", c); c = false;',id:'n = h.id(n, r, "#{1}", c);        c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}"); c = false;',attr:function(c){c[3]=(c[5]||c[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}"); c = false;').evaluate(c)},pseudo:function(c){if(c[6]){c[6]=c[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(c)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|\s|(?=:))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\]]*?)\4|([^'"][^\]]*?)))?\]/},handlers:{concat:function(d,c){for(var e=0,f;f=c[e];e++){d.push(f)}return d},mark:function(c){for(var d=0,e;e=c[d];d++){e._counted=true}return c},unmark:function(c){for(var d=0,e;e=c[d];d++){e._counted=undefined}return c},index:function(c,f,h){c._counted=true;if(f){for(var d=c.childNodes,g=d.length-1,e=1;g>=0;g--){node=d[g];if(node.nodeType==1&&(!h||node._counted)){node.nodeIndex=e++}}}else{for(var g=0,e=1,d=c.childNodes;node=d[g];g++){if(node.nodeType==1&&(!h||node._counted)){node.nodeIndex=e++}}}},unique:function(d){if(d.length==0){return d}var f=[],g;for(var e=0,c=d.length;e<c;e++){if(!(g=d[e])._counted){g._counted=true;f.push(Element.extend(g))}}return Selector.handlers.unmark(f)},descendant:function(c){var f=Selector.handlers;for(var e=0,d=[],g;g=c[e];e++){f.concat(d,g.getElementsByTagName("*"))}return d},child:function(c){var l=Selector.handlers;for(var g=0,f=[],m;m=c[g];g++){for(var d=0,e=[],n;n=m.childNodes[d];d++){if(n.nodeType==1&&n.tagName!="!"){f.push(n)}}}return f},adjacent:function(c){for(var e=0,d=[],g;g=c[e];e++){var f=this.nextElementSibling(g);if(f){d.push(f)}}return d},laterSibling:function(c){var f=Selector.handlers;for(var e=0,d=[],g;g=c[e];e++){f.concat(d,Element.nextSiblings(g))}return d},nextElementSibling:function(c){while(c=c.nextSibling){if(c.nodeType==1){return c}}return null},previousElementSibling:function(c){while(c=c.previousSibling){if(c.nodeType==1){return c}}return null},tagName:function(d,c,g,m){g=g.toUpperCase();var f=[],j=Selector.handlers;if(d){if(m){if(m=="descendant"){for(var e=0,l;l=d[e];e++){j.concat(f,l.getElementsByTagName(g))}return f}else{d=this[m](d)}if(g=="*"){return d}}for(var e=0,l;l=d[e];e++){if(l.tagName.toUpperCase()==g){f.push(l)}}return f}else{return c.getElementsByTagName(g)}},id:function(d,c,m,j){var l=$(m),f=Selector.handlers;if(!d&&c==document){return l?[l]:[]}if(d){if(j){if(j=="child"){for(var e=0,g;g=d[e];e++){if(l.parentNode==g){return[l]}}}else{if(j=="descendant"){for(var e=0,g;g=d[e];e++){if(Element.descendantOf(l,g)){return[l]}}}else{if(j=="adjacent"){for(var e=0,g;g=d[e];e++){if(Selector.handlers.previousElementSibling(l)==g){return[l]}}}else{d=f[j](d)}}}}for(var e=0,g;g=d[e];e++){if(g==l){return[l]}}return[]}return(l&&Element.descendantOf(l,c))?[l]:[]},className:function(d,c,e,f){if(d&&f){d=this[f](d)}return Selector.handlers.byClassName(d,c,e)},byClassName:function(e,d,h){if(!e){e=Selector.handlers.descendant([d])}var l=" "+h+" ";for(var g=0,f=[],j,c;j=e[g];g++){c=j.className;if(c.length==0){continue}if(c==h||(" "+c+" ").include(l)){f.push(j)}}return f},attrPresence:function(e,d,c){var g=[];for(var f=0,h;h=e[f];f++){if(Element.hasAttribute(h,c)){g.push(h)}}return g},attr:function(c,l,j,m,d){if(!c){c=l.getElementsByTagName("*")}var n=Selector.operators[d],f=[];for(var g=0,e;e=c[g];g++){var h=Element.readAttribute(e,j);if(h===null){continue}if(n(h,m)){f.push(e)}}return f},pseudo:function(d,e,g,c,f){if(d&&f){d=this[f](d)}if(!d){d=c.getElementsByTagName("*")}return Selector.pseudos[e](d,g,c)}},pseudos:{"first-child":function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(Selector.handlers.previousElementSibling(g)){continue}e.push(g)}return e},"last-child":function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(Selector.handlers.nextElementSibling(g)){continue}e.push(g)}return e},"only-child":function(d,l,c){var g=Selector.handlers;for(var f=0,e=[],j;j=d[f];f++){if(!g.previousElementSibling(j)&&!g.nextElementSibling(j)){e.push(j)}}return e},"nth-child":function(d,e,c){return Selector.pseudos.nth(d,e,c)},"nth-last-child":function(d,e,c){return Selector.pseudos.nth(d,e,c,true)},"nth-of-type":function(d,e,c){return Selector.pseudos.nth(d,e,c,false,true)},"nth-last-of-type":function(d,e,c){return Selector.pseudos.nth(d,e,c,true,true)},"first-of-type":function(d,e,c){return Selector.pseudos.nth(d,"1",c,false,true)},"last-of-type":function(d,e,c){return Selector.pseudos.nth(d,"1",c,true,true)},"only-of-type":function(d,f,c){var e=Selector.pseudos;return e["last-of-type"](e["first-of-type"](d,f,c),f,c)},getIndices:function(d,c,e){if(d==0){return c>0?[c]:[]}return $R(1,e).inject([],function(f,g){if(0==(g-c)%d&&(g-c)/d>=0){f.push(g)}return f})},nth:function(c,t,v,s,e){if(c.length==0){return[]}if(t=="even"){t="2n+0"}if(t=="odd"){t="2n+1"}var r=Selector.handlers,q=[],d=[],g;r.mark(c);for(var p=0,f;f=c[p];p++){if(!f.parentNode._counted){r.index(f.parentNode,s,e);d.push(f.parentNode)}}if(t.match(/^\d+$/)){t=Number(t);for(var p=0,f;f=c[p];p++){if(f.nodeIndex==t){q.push(f)}}}else{if(g=t.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(g[1]=="-"){g[1]=-1}var w=g[1]?Number(g[1]):1;var u=g[2]?Number(g[2]):0;var x=Selector.pseudos.getIndices(w,u,c.length);for(var p=0,f,n=x.length;f=c[p];p++){for(var o=0;o<n;o++){if(f.nodeIndex==x[o]){q.push(f)}}}}}r.unmark(c);r.unmark(d);return q},empty:function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(g.tagName=="!"||(g.firstChild&&!g.innerHTML.match(/^\s*$/))){continue}e.push(g)}return e},not:function(c,f,o){var l=Selector.handlers,p,e;var n=new Selector(f).findElements(o);l.mark(n);for(var j=0,g=[],d;d=c[j];j++){if(!d._counted){g.push(d)}}l.unmark(n);return g},enabled:function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(!g.disabled){e.push(g)}}return e},disabled:function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(g.disabled){e.push(g)}}return e},checked:function(d,h,c){for(var f=0,e=[],g;g=d[f];f++){if(g.checked){e.push(g)}}return e}},operators:{"=":function(d,c){return d==c},"!=":function(d,c){return d!=c},"^=":function(d,c){return d.startsWith(c)},"$=":function(d,c){return d.endsWith(c)},"*=":function(d,c){return d.include(c)},"~=":function(d,c){return(" "+d+" ").include(" "+c+" ")},"|=":function(d,c){return("-"+d.toUpperCase()+"-").include("-"+c.toUpperCase()+"-")}},matchElements:function(j,l){var g=new Selector(l).findElements(),f=Selector.handlers;f.mark(g);for(var e=0,d=[],c;c=j[e];e++){if(c._counted){d.push(c)}}f.unmark(g);return d},findElement:function(d,e,c){if(typeof e=="number"){c=e;e=false}return Selector.matchElements(d,e||"*")[c||0]},findChildElements:function(g,m){var n=m.join(","),m=[];n.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(h){m.push(h[1].strip())});var f=[],j=Selector.handlers;for(var e=0,d=m.length,c;e<d;e++){c=new Selector(m[e].strip());j.concat(f,c.findElements(g))}return(d>1)?j.unique(f):f}});function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(c){$(c).reset();return c},serializeElements:function(e,c){var d=e.inject({},function(f,h){if(!h.disabled&&h.name){var g=h.name,j=$(h).getValue();if(j!=null){if(g in f){if(f[g].constructor!=Array){f[g]=[f[g]]}f[g].push(j)}else{f[g]=j}}}return f});return c?d:Hash.toQueryString(d)}};Form.Methods={serialize:function(d,c){return Form.serializeElements(Form.getElements(d),c)},getElements:function(c){return $A($(c).getElementsByTagName("*")).inject([],function(d,e){if(Form.Element.Serializers[e.tagName.toLowerCase()]){d.push(Element.extend(e))}return d})},getInputs:function(j,e,f){j=$(j);var c=j.getElementsByTagName("input");if(!e&&!f){return $A(c).map(Element.extend)}for(var g=0,l=[],h=c.length;g<h;g++){var d=c[g];if((e&&d.type!=e)||(f&&d.name!=f)){continue}l.push(Element.extend(d))}return l},disable:function(c){c=$(c);Form.getElements(c).invoke("disable");return c},enable:function(c){c=$(c);Form.getElements(c).invoke("enable");return c},findFirstElement:function(c){return $(c).getElements().find(function(d){return d.type!="hidden"&&!d.disabled&&["input","select","textarea"].include(d.tagName.toLowerCase())})},focusFirstElement:function(c){c=$(c);c.findFirstElement().activate();return c},request:function(d,c){d=$(d),c=Object.clone(c||{});var e=c.parameters;c.parameters=d.serialize(true);if(e){if(typeof e=="string"){e=e.toQueryParams()}Object.extend(c.parameters,e)}if(d.hasAttribute("method")&&!c.method){c.method=d.method}return new Ajax.Request(d.readAttribute("action"),c)}};Form.Element={focus:function(c){$(c).focus();return c},select:function(c){$(c).select();return c}};Form.Element.Methods={serialize:function(c){c=$(c);if(!c.disabled&&c.name){var d=c.getValue();if(d!=undefined){var e={};e[c.name]=d;return Hash.toQueryString(e)}}return""},getValue:function(c){c=$(c);var d=c.tagName.toLowerCase();return Form.Element.Serializers[d](c)},clear:function(c){$(c).value="";return c},present:function(c){return $(c).value!=""},activate:function(c){c=$(c);try{c.focus();if(c.select&&(c.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(c.type))){c.select()}}catch(d){}return c},disable:function(c){c=$(c);c.blur();c.disabled=true;return c},enable:function(c){c=$(c);c.disabled=false;return c}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(c){switch(c.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(c);default:return Form.Element.Serializers.textarea(c)}},inputSelector:function(c){return c.checked?c.value:null},textarea:function(c){return c.value},select:function(c){return this[c.type=="select-one"?"selectOne":"selectMany"](c)},selectOne:function(d){var c=d.selectedIndex;return c>=0?this.optionValue(d.options[c]):null},selectMany:function(f){var c,g=f.length;if(!g){return null}for(var e=0,c=[];e<g;e++){var d=f.options[e];if(d.selected){c.push(this.optionValue(d))}}return c},optionValue:function(c){return Element.extend(c).hasAttribute("value")?c.value:c.text}};Abstract.TimedObserver=function(){};Abstract.TimedObserver.prototype={initialize:function(c,d,e){this.frequency=d;this.element=$(c);this.callback=e;this.lastValue=this.getValue();this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},onTimerEvent:function(){var c=this.getValue();var d=("string"==typeof this.lastValue&&"string"==typeof c?this.lastValue!=c:String(this.lastValue)!=String(c));if(d){this.callback(this.element,c);this.lastValue=c}}};Form.Element.Observer=Class.create();Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create();Form.Observer.prototype=Object.extend(new Abstract.TimedObserver(),{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=function(){};Abstract.EventObserver.prototype={initialize:function(c,d){this.element=$(c);this.callback=d;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var c=this.getValue();if(this.lastValue!=c){this.callback(this.element,c);this.lastValue=c}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this))},registerCallback:function(c){if(c.type){switch(c.type.toLowerCase()){case"checkbox":case"radio":Event.observe(c,"click",this.onElementEvent.bind(this));break;default:Event.observe(c,"change",this.onElementEvent.bind(this));break}}}};Form.Element.EventObserver=Class.create();Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create();Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver(),{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event=new Object()}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,element:function(c){return $(c.target||c.srcElement)},isLeftClick:function(c){return(((c.which)&&(c.which==1))||((c.button)&&(c.button==1)))},pointerX:function(c){return c.pageX||(c.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(c){return c.pageY||(c.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},stop:function(c){if(c.preventDefault){c.preventDefault();c.stopPropagation()}else{c.returnValue=false;c.cancelBubble=true}},findElement:function(e,d){var c=Event.element(e);while(c.parentNode&&(!c.tagName||(c.tagName.toUpperCase()!=d.toUpperCase()))){c=c.parentNode}return c},observers:false,_observeAndCache:function(f,e,d,c){if(!this.observers){this.observers=[]}if(f.addEventListener){this.observers.push([f,e,d,c]);f.addEventListener(e,d,c)}else{if(f.attachEvent){this.observers.push([f,e,d,c]);f.attachEvent("on"+e,d)}}},unloadCache:function(){if(!Event.observers){return}for(var c=0,d=Event.observers.length;c<d;c++){Event.stopObserving.apply(this,Event.observers[c]);Event.observers[c][0]=null}Event.observers=false},observe:function(f,e,d,c){f=$(f);c=c||false;if(e=="keypress"&&(Prototype.Browser.WebKit||f.attachEvent)){e="keydown"}Event._observeAndCache(f,e,d,c)},stopObserving:function(g,f,d,c){g=$(g);c=c||false;if(f=="keypress"&&(Prototype.Browser.WebKit||g.attachEvent)){f="keydown"}if(g.removeEventListener){g.removeEventListener(f,d,c)}else{if(g.detachEvent){try{g.detachEvent("on"+f,d)}catch(h){}}}}});if(Prototype.Browser.IE){Event.observe(window,"unload",Event.unloadCache,false)}var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(d){var c=0,e=0;do{c+=d.scrollTop||0;e+=d.scrollLeft||0;d=d.parentNode}while(d);return[e,c]},cumulativeOffset:function(d){var c=0,e=0;do{c+=d.offsetTop||0;e+=d.offsetLeft||0;d=d.offsetParent}while(d);return[e,c]},positionedOffset:function(d){var c=0,f=0;do{c+=d.offsetTop||0;f+=d.offsetLeft||0;d=d.offsetParent;if(d){if(d.tagName=="BODY"){break}var e=Element.getStyle(d,"position");if(e=="relative"||e=="absolute"){break}}}while(d);return[f,c]},offsetParent:function(c){if(c.offsetParent){return c.offsetParent}if(c==document.body){return c}while((c=c.parentNode)&&c!=document.body){if(Element.getStyle(c,"position")!="static"){return c}}return document.body},within:function(d,c,e){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(d,c,e)}this.xcomp=c;this.ycomp=e;this.offset=this.cumulativeOffset(d);return(e>=this.offset[1]&&e<this.offset[1]+d.offsetHeight&&c>=this.offset[0]&&c<this.offset[0]+d.offsetWidth)},withinIncludingScrolloffsets:function(d,c,f){var e=this.realOffset(d);this.xcomp=c+e[0]-this.deltaX;this.ycomp=f+e[1]-this.deltaY;this.offset=this.cumulativeOffset(d);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+d.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+d.offsetWidth)},overlap:function(d,c){if(!d){return 0}if(d=="vertical"){return((this.offset[1]+c.offsetHeight)-this.ycomp)/c.offsetHeight}if(d=="horizontal"){return((this.offset[0]+c.offsetWidth)-this.xcomp)/c.offsetWidth}},page:function(f){var c=0,e=0;var d=f;do{c+=d.offsetTop||0;e+=d.offsetLeft||0;if(d.offsetParent==document.body){if(Element.getStyle(d,"position")=="absolute"){break}}}while(d=d.offsetParent);d=f;do{if(!window.opera||d.tagName=="BODY"){c-=d.scrollTop||0;e-=d.scrollLeft||0}}while(d=d.parentNode);return[e,c]},clone:function(e,g){var c=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});e=$(e);var f=Position.page(e);g=$(g);var h=[0,0];var d=null;if(Element.getStyle(g,"position")=="absolute"){d=Position.offsetParent(g);h=Position.page(d)}if(d==document.body){h[0]-=document.body.offsetLeft;h[1]-=document.body.offsetTop}if(c.setLeft){g.style.left=(f[0]-h[0]+c.offsetLeft)+"px"}if(c.setTop){g.style.top=(f[1]-h[1]+c.offsetTop)+"px"}if(c.setWidth){g.style.width=e.offsetWidth+"px"}if(c.setHeight){g.style.height=e.offsetHeight+"px"}},absolutize:function(d){d=$(d);if(d.style.position=="absolute"){return}Position.prepare();var f=Position.positionedOffset(d);var h=f[1];var g=f[0];var e=d.clientWidth;var c=d.clientHeight;d._originalLeft=g-parseFloat(d.style.left||0);d._originalTop=h-parseFloat(d.style.top||0);d._originalWidth=d.style.width;d._originalHeight=d.style.height;d.style.position="absolute";d.style.top=h+"px";d.style.left=g+"px";d.style.width=e+"px";d.style.height=c+"px"},relativize:function(c){c=$(c);if(c.style.position=="relative"){return}Position.prepare();c.style.position="relative";var e=parseFloat(c.style.top||0)-(c._originalTop||0);var d=parseFloat(c.style.left||0)-(c._originalLeft||0);c.style.top=e+"px";c.style.left=d+"px";c.style.height=c._originalHeight;c.style.width=c._originalWidth}};if(Prototype.Browser.WebKit){Position.cumulativeOffset=function(d){var c=0,e=0;do{c+=d.offsetTop||0;e+=d.offsetLeft||0;if(d.offsetParent==document.body){if(Element.getStyle(d,"position")=="absolute"){break}}d=d.offsetParent}while(d);return[e,c]}}Element.addMethods();(function(){var W=this,ab,F=W.jQuery,S=W.$,T=W.jQuery=W.$=function(d,c){return new T.fn.init(d,c)},M=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,ac=/^.[^:#\[\.,]*$/;T.fn=T.prototype={init:function(g,d){g=g||document;if(g.nodeType){this[0]=g;this.length=1;this.context=g;return this}if(typeof g==="string"){var e=M.exec(g);if(e&&(e[1]||!d)){if(e[1]){g=T.clean([e[1]],d)}else{var c=document.getElementById(e[3]);if(c&&c.id!=e[3]){return T().find(g)}var f=T(c||[]);f.context=document;f.selector=g;return f}}else{return T(d).find(g)}}else{if(T.isFunction(g)){return T(document).ready(g)}}if(g.selector&&g.context){this.selector=g.selector;this.context=g.context}return this.setArray(T.isArray(g)?g:T.makeArray(g))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(c){return c===ab?Array.prototype.slice.call(this):this[c]},pushStack:function(e,c,f){var d=T(e);d.prevObject=this;d.context=this.context;if(c==="find"){d.selector=this.selector+(this.selector?" ":"")+f}else{if(c){d.selector=this.selector+"."+c+"("+f+")"}}return d},setArray:function(c){this.length=0;Array.prototype.push.apply(this,c);return this},each:function(c,d){return T.each(this,c,d)},index:function(c){return T.inArray(c&&c.jquery?c[0]:c,this)},attr:function(e,c,d){var f=e;if(typeof e==="string"){if(c===ab){return this[0]&&T[d||"attr"](this[0],e)}else{f={};f[e]=c}}return this.each(function(g){for(e in f){T.attr(d?this.style:this,e,T.prop(this,f[e],d,g,e))}})},css:function(d,c){if((d=="width"||d=="height")&&parseFloat(c)<0){c=ab}return this.attr(d,c,"curCSS")},text:function(c){if(typeof c!=="object"&&c!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(c))}var d="";T.each(c||this,function(){T.each(this.childNodes,function(){if(this.nodeType!=8){d+=this.nodeType!=1?this.nodeValue:T.fn.text([this])}})});return d},wrapAll:function(d){if(this[0]){var c=T(d,this[0].ownerDocument).clone();if(this[0].parentNode){c.insertBefore(this[0])}c.map(function(){var e=this;while(e.firstChild){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(c){return this.each(function(){T(this).contents().wrapAll(c)})},wrap:function(c){return this.each(function(){T(this).wrapAll(c)})},append:function(){return this.domManip(arguments,true,function(c){if(this.nodeType==1){this.appendChild(c)}})},prepend:function(){return this.domManip(arguments,true,function(c){if(this.nodeType==1){this.insertBefore(c,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(c){this.parentNode.insertBefore(c,this)})},after:function(){return this.domManip(arguments,false,function(c){this.parentNode.insertBefore(c,this.nextSibling)})},end:function(){return this.prevObject||T([])},push:[].push,sort:[].sort,splice:[].splice,find:function(d){if(this.length===1){var c=this.pushStack([],"find",d);c.length=0;T.find(d,this[0],c);return c}else{return this.pushStack(T.unique(T.map(this,function(e){return T.find(d,e)})),"find",d)}},clone:function(d){var f=this.map(function(){if(!T.support.noCloneEvent&&!T.isXMLDoc(this)){var h=this.outerHTML;if(!h){var g=this.ownerDocument.createElement("div");g.appendChild(this.cloneNode(true));h=g.innerHTML}return T.clean([h.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(d===true){var c=this.find("*").andSelf(),e=0;f.find("*").andSelf().each(function(){if(this.nodeName!==c[e].nodeName){return}var j=T.data(c[e],"events");for(var g in j){for(var h in j[g]){T.event.add(this,g,j[g][h],j[g][h].data)}}e++})}return f},filter:function(c){return this.pushStack(T.isFunction(c)&&T.grep(this,function(d,e){return c.call(d,e)})||T.multiFilter(c,T.grep(this,function(d){return d.nodeType===1})),"filter",c)},closest:function(e){var c=T.expr.match.POS.test(e)?T(e):null,d=0;return this.map(function(){var f=this;while(f&&f.ownerDocument){if(c?c.index(f)>-1:T(f).is(e)){T.data(f,"closest",d);return f}f=f.parentNode;d++}})},not:function(d){if(typeof d==="string"){if(ac.test(d)){return this.pushStack(T.multiFilter(d,this,true),"not",d)}else{d=T.multiFilter(d,this)}}var c=d.length&&d[d.length-1]!==ab&&!d.nodeType;return this.filter(function(){return c?T.inArray(this,d)<0:this!=d})},add:function(c){return this.pushStack(T.unique(T.merge(this.get(),typeof c==="string"?T(c):T.makeArray(c))))},is:function(c){return !!c&&T.multiFilter(c,this).length>0},hasClass:function(c){return !!c&&this.is("."+c)},val:function(e){if(e===ab){var m=this[0];if(m){if(T.nodeName(m,"option")){return(m.attributes.value||{}).specified?m.value:m.text}if(T.nodeName(m,"select")){var g=m.selectedIndex,d=[],c=m.options,h=m.type=="select-one";if(g<0){return null}for(var l=h?g:0,f=h?g+1:c.length;l<f;l++){var j=c[l];if(j.selected){e=T(j).val();if(h){return e}d.push(e)}}return d}return(m.value||"").replace(/\r/g,"")}return ab}if(typeof e==="number"){e+=""}return this.each(function(){if(this.nodeType!=1){return}if(T.isArray(e)&&/radio|checkbox/.test(this.type)){this.checked=(T.inArray(this.value,e)>=0||T.inArray(this.name,e)>=0)}else{if(T.nodeName(this,"select")){var n=T.makeArray(e);T("option",this).each(function(){this.selected=(T.inArray(this.value,n)>=0||T.inArray(this.text,n)>=0)});if(!n.length){this.selectedIndex=-1}}else{this.value=e}}})},html:function(c){return c===ab?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(c)},replaceWith:function(c){return this.after(c).remove()},eq:function(c){return this.slice(c,+c+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(c){return this.pushStack(T.map(this,function(d,e){return c.call(d,e,d)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(f,c,d){if(this[0]){var g=(this[0].ownerDocument||this[0]).createDocumentFragment(),l=T.clean(f,(this[0].ownerDocument||this[0]),g),h=g.firstChild;if(h){for(var j=0,m=this.length;j<m;j++){d.call(e(this[j],h),this.length>1||j>0?g.cloneNode(true):g)}}if(l){T.each(l,E)}}return this;function e(o,n){return c&&T.nodeName(o,"table")&&T.nodeName(n,"tr")?(o.getElementsByTagName("tbody")[0]||o.appendChild(o.ownerDocument.createElement("tbody"))):o}}};T.fn.init.prototype=T.fn;function E(d,c){if(c.src){T.ajax({url:c.src,async:false,dataType:"script"})}else{T.globalEval(c.text||c.textContent||c.innerHTML||"")}if(c.parentNode){c.parentNode.removeChild(c)}}function ad(){return +new Date}T.extend=T.fn.extend=function(){var e=arguments[0]||{},g=1,f=arguments.length,l=false,h;if(typeof e==="boolean"){l=e;e=arguments[1]||{};g=2}if(typeof e!=="object"&&!T.isFunction(e)){e={}}if(f==g){e=this;--g}for(;g<f;g++){if((h=arguments[g])!=null){for(var j in h){var d=e[j],c=h[j];if(e===c){continue}if(l&&c&&typeof c==="object"&&!c.nodeType){e[j]=T.extend(l,d||(c.length!=null?[]:{}),c)}else{if(c!==ab){e[j]=c}}}}}return e};var ag=/z-?index|font-?weight|opacity|zoom|line-?height/i,Q=document.defaultView||{},L=Object.prototype.toString;T.extend({noConflict:function(c){W.$=S;if(c){W.jQuery=F}return T},isFunction:function(c){return L.call(c)==="[object Function]"},isArray:function(c){return L.call(c)==="[object Array]"},isXMLDoc:function(c){return c.nodeType===9&&c.documentElement.nodeName!=="HTML"||!!c.ownerDocument&&T.isXMLDoc(c.ownerDocument)},globalEval:function(c){if(c&&/\S/.test(c)){var d=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.type="text/javascript";if(T.support.scriptEval){e.appendChild(document.createTextNode(c))}else{e.text=c}d.insertBefore(e,d.firstChild);d.removeChild(e)}},nodeName:function(c,d){return c.nodeName&&c.nodeName.toUpperCase()==d.toUpperCase()},each:function(g,c,h){var j,f=0,e=g.length;if(h){if(e===ab){for(j in g){if(c.apply(g[j],h)===false){break}}}else{for(;f<e;){if(c.apply(g[f++],h)===false){break}}}}else{if(e===ab){for(j in g){if(c.call(g[j],j,g[j])===false){break}}}else{for(var d=g[0];f<e&&c.call(d,f,d)!==false;d=g[++f]){}}}return g},prop:function(d,c,e,f,g){if(T.isFunction(c)){c=c.call(d,f)}return typeof c==="number"&&e=="curCSS"&&!ag.test(g)?c+"px":c},className:{add:function(d,c){T.each((c||"").split(/\s+/),function(f,e){if(d.nodeType==1&&!T.className.has(d.className,e)){d.className+=(d.className?" ":"")+e}})},remove:function(d,c){if(d.nodeType==1){d.className=c!==ab?T.grep(d.className.split(/\s+/),function(e){return !T.className.has(c,e)}).join(" "):""}},has:function(c,d){return c&&T.inArray(d,(c.className||c).toString().split(/\s+/))>-1}},swap:function(d,e,c){var g={};for(var f in e){g[f]=d.style[f];d.style[f]=e[f]}c.call(d);for(var f in e){d.style[f]=g[f]}},css:function(g,j,e,l){if(j=="width"||j=="height"){var c,h={position:"absolute",visibility:"hidden",display:"block"},d=j=="width"?["Left","Right"]:["Top","Bottom"];function f(){c=j=="width"?g.offsetWidth:g.offsetHeight;if(l==="border"){return}T.each(d,function(){if(!l){c-=parseFloat(T.curCSS(g,"padding"+this,true))||0}if(l==="margin"){c+=parseFloat(T.curCSS(g,"margin"+this,true))||0}else{c-=parseFloat(T.curCSS(g,"border"+this+"Width",true))||0}})}if(g.offsetWidth!==0){f()}else{T.swap(g,h,f)}return Math.max(0,Math.round(c))}return T.curCSS(g,j,e)},curCSS:function(g,l,j){var d,m=g.style;if(l=="opacity"&&!T.support.opacity){d=T.attr(m,"opacity");return d==""?"1":d}if(l.match(/float/i)){l=H}if(!j&&m&&m[l]){d=m[l]}else{if(Q.getComputedStyle){if(l.match(/float/i)){l="float"}l=l.replace(/([A-Z])/g,"-$1").toLowerCase();var c=Q.getComputedStyle(g,null);if(c){d=c.getPropertyValue(l)}if(l=="opacity"&&d==""){d="1"}}else{if(g.currentStyle){var f=l.replace(/\-(\w)/g,function(o,n){return n.toUpperCase()});d=g.currentStyle[l]||g.currentStyle[f];if(!/^\d+(px)?$/i.test(d)&&/^\d/.test(d)){var h=m.left,e=g.runtimeStyle.left;g.runtimeStyle.left=g.currentStyle.left;m.left=d||0;d=m.pixelLeft+"px";m.left=h;g.runtimeStyle.left=e}}}}return d},clean:function(j,d,f){d=d||document;if(typeof d.createElement==="undefined"){d=d.ownerDocument||d[0]&&d[0].ownerDocument||document}if(!f&&j.length===1&&typeof j[0]==="string"){var g=/^<(\w+)\s*\/?>$/.exec(j[0]);if(g){return[d.createElement(g[1])]}}var h=[],l=[],c=d.createElement("div");T.each(j,function(p,m){if(typeof m==="number"){m+=""}if(!m){return}if(typeof m==="string"){m=m.replace(/(<(\w+)[^>]*?)\/>/g,function(u,t,v){return v.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?u:t+"></"+v+">"});var q=m.replace(/^\s+/,"").substring(0,10).toLowerCase();var o=!q.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!q.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||q.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!q.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!q.indexOf("<td")||!q.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!q.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!T.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];c.innerHTML=o[1]+m+o[2];while(o[0]--){c=c.lastChild}if(!T.support.tbody){var n=/<tbody/i.test(m),r=!q.indexOf("<table")&&!n?c.firstChild&&c.firstChild.childNodes:o[1]=="<table>"&&!n?c.childNodes:[];for(var s=r.length-1;s>=0;--s){if(T.nodeName(r[s],"tbody")&&!r[s].childNodes.length){r[s].parentNode.removeChild(r[s])}}}if(!T.support.leadingWhitespace&&/^\s/.test(m)){c.insertBefore(d.createTextNode(m.match(/^\s*/)[0]),c.firstChild)}m=T.makeArray(c.childNodes)}if(m.nodeType){h.push(m)}else{h=T.merge(h,m)}});if(f){for(var e=0;h[e];e++){if(T.nodeName(h[e],"script")&&(!h[e].type||h[e].type.toLowerCase()==="text/javascript")){l.push(h[e].parentNode?h[e].parentNode.removeChild(h[e]):h[e])}else{if(h[e].nodeType===1){h.splice.apply(h,[e+1,0].concat(T.makeArray(h[e].getElementsByTagName("script"))))}f.appendChild(h[e])}}return l}return h},attr:function(e,h,d){if(!e||e.nodeType==3||e.nodeType==8){return ab}var g=!T.isXMLDoc(e),c=d!==ab;h=g&&T.props[h]||h;if(e.tagName){var j=/href|src|style/.test(h);if(h=="selected"&&e.parentNode){e.parentNode.selectedIndex}if(h in e&&g&&!j){if(c){if(h=="type"&&T.nodeName(e,"input")&&e.parentNode){throw"type property can't be changed"}e[h]=d}if(T.nodeName(e,"form")&&e.getAttributeNode(h)){return e.getAttributeNode(h).nodeValue}if(h=="tabIndex"){var f=e.getAttributeNode("tabIndex");return f&&f.specified?f.value:e.nodeName.match(/(button|input|object|select|textarea)/i)?0:e.nodeName.match(/^(a|area)$/i)&&e.href?0:ab}return e[h]}if(!T.support.style&&g&&h=="style"){return T.attr(e.style,"cssText",d)}if(c){e.setAttribute(h,""+d)}var l=!T.support.hrefNormalized&&g&&j?e.getAttribute(h,2):e.getAttribute(h);return l===null?ab:l}if(!T.support.opacity&&h=="opacity"){if(c){e.zoom=1;e.filter=(e.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(d)+""=="NaN"?"":"alpha(opacity="+d*100+")")}return e.filter&&e.filter.indexOf("opacity=")>=0?(parseFloat(e.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}h=h.replace(/-([a-z])/ig,function(n,m){return m.toUpperCase()});if(c){e[h]=d}return e[h]},trim:function(c){return(c||"").replace(/^\s+|\s+$/g,"")},makeArray:function(c){var e=[];if(c!=null){var d=c.length;if(d==null||typeof c==="string"||T.isFunction(c)||c.setInterval){e[0]=c}else{while(d){e[--d]=c[d]}}}return e},inArray:function(d,c){for(var f=0,e=c.length;f<e;f++){if(c[f]===d){return f}}return -1},merge:function(d,g){var f=0,e,c=d.length;if(!T.support.getAll){while((e=g[f++])!=null){if(e.nodeType!=8){d[c++]=e}}}else{while((e=g[f++])!=null){d[c++]=e}}return d},unique:function(c){var h=[],j={};try{for(var g=0,f=c.length;g<f;g++){var d=T.data(c[g]);if(!j[d]){j[d]=true;h.push(c[g])}}}catch(e){h=c}return h},grep:function(g,c,h){var f=[];for(var e=0,d=g.length;e<d;e++){if(!h!=!c(g[e],e)){f.push(g[e])}}return f},map:function(h,c){var g=[];for(var f=0,e=h.length;f<e;f++){var d=c(h[f],f);if(d!=null){g[g.length]=d}}return g.concat.apply([],g)}});var O=navigator.userAgent.toLowerCase();T.browser={version:(O.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(O),opera:/opera/.test(O),msie:/msie/.test(O)&&!/opera/.test(O),mozilla:/mozilla/.test(O)&&!/(compatible|webkit)/.test(O)};T.each({parent:function(c){return c.parentNode},parents:function(c){return T.dir(c,"parentNode")},next:function(c){return T.nth(c,2,"nextSibling")},prev:function(c){return T.nth(c,2,"previousSibling")},nextAll:function(c){return T.dir(c,"nextSibling")},prevAll:function(c){return T.dir(c,"previousSibling")},siblings:function(c){return T.sibling(c.parentNode.firstChild,c)},children:function(c){return T.sibling(c.firstChild)},contents:function(c){return T.nodeName(c,"iframe")?c.contentDocument||c.contentWindow.document:T.makeArray(c.childNodes)}},function(d,c){T.fn[d]=function(f){var e=T.map(this,c);if(f&&typeof f=="string"){e=T.multiFilter(f,e)}return this.pushStack(T.unique(e),d,f)}});T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(d,c){T.fn[d]=function(l){var g=[],e=T(l);for(var f=0,j=e.length;f<j;f++){var h=(f>0?this.clone(true):this).get();T.fn[c].apply(T(e[f]),h);g=g.concat(h)}return this.pushStack(g,d,l)}});T.each({removeAttr:function(c){T.attr(this,c,"");if(this.nodeType==1){this.removeAttribute(c)}},addClass:function(c){T.className.add(this,c)},removeClass:function(c){T.className.remove(this,c)},toggleClass:function(c,d){if(typeof d!=="boolean"){d=!T.className.has(this,c)}T.className[d?"add":"remove"](this,c)},remove:function(c){if(!c||T.filter(c,[this]).length){T("*",this).add([this]).each(function(){T.event.remove(this);T.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){T(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(d,c){T.fn[d]=function(){return this.each(c,arguments)}});function Y(d,c){return d[0]&&parseInt(T.curCSS(d[0],c,true),10)||0}var aa="jQuery"+ad(),I=0,R={};T.extend({cache:{},data:function(e,f,d){e=e==W?R:e;var c=e[aa];if(!c){c=e[aa]=++I}if(f&&!T.cache[c]){T.cache[c]={}}if(d!==ab){T.cache[c][f]=d}return f?T.cache[c][f]:c},removeData:function(e,f){e=e==W?R:e;var c=e[aa];if(f){if(T.cache[c]){delete T.cache[c][f];f="";for(f in T.cache[c]){break}if(!f){T.removeData(e)}}}else{try{delete e[aa]}catch(d){if(e.removeAttribute){e.removeAttribute(aa)}}delete T.cache[c]}},queue:function(e,f,c){if(e){f=(f||"fx")+"queue";var d=T.data(e,f);if(!d||T.isArray(c)){d=T.data(e,f,T.makeArray(c))}else{if(c){d.push(c)}}}return d},dequeue:function(c,d){var f=T.queue(c,d),e=f.shift();if(!d||d==="fx"){e=f[0]}if(e!==ab){e.call(c)}}});T.fn.extend({data:function(f,d){var c=f.split(".");c[1]=c[1]?"."+c[1]:"";if(d===ab){var e=this.triggerHandler("getData"+c[1]+"!",[c[0]]);if(e===ab&&this.length){e=T.data(this[0],f)}return e===ab&&c[1]?this.data(c[0]):e}else{return this.trigger("setData"+c[1]+"!",[c[0],d]).each(function(){T.data(this,f,d)})}},removeData:function(c){return this.each(function(){T.removeData(this,c)})},queue:function(d,c){if(typeof d!=="string"){c=d;d="fx"}if(c===ab){return T.queue(this[0],d)}return this.each(function(){var e=T.queue(this,d,c);if(d=="fx"&&e.length==1){e[0].call(this)}})},dequeue:function(c){return this.each(function(){T.dequeue(this,c)})}});(function(){var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,l=0,p=Object.prototype.toString;var r=function(v,z,am,al){am=am||[];z=z||document;if(z.nodeType!==1&&z.nodeType!==9){return[]}if(!v||typeof v!=="string"){return am}var u=[],x,ai,B,A,ak,y,w=true;d.lastIndex=0;while((x=d.exec(v))!==null){u.push(x[1]);if(x[2]){y=RegExp.rightContext;break}}if(u.length>1&&j.exec(v)){if(u.length===2&&o.relative[u[0]]){ai=n(u[0]+u[1],z)}else{ai=o.relative[u[0]]?[z]:r(u.shift(),z);while(u.length){v=u.shift();if(o.relative[v]){v+=u.shift()}ai=n(v,ai)}}}else{var aj=al?{expr:u.pop(),set:s(al)}:r.find(u.pop(),u.length===1&&z.parentNode?z.parentNode:z,e(z));ai=r.filter(aj.expr,aj.set);if(u.length>0){B=s(ai)}else{w=false}while(u.length){var C=u.pop(),D=C;if(!o.relative[C]){C=""}else{D=u.pop()}if(D==null){D=z}o.relative[C](B,D,e(z))}}if(!B){B=ai}if(!B){throw"Syntax error, unrecognized expression: "+(C||v)}if(p.call(B)==="[object Array]"){if(!w){am.push.apply(am,B)}else{if(z.nodeType===1){for(var t=0;B[t]!=null;t++){if(B[t]&&(B[t]===true||B[t].nodeType===1&&m(z,B[t]))){am.push(ai[t])}}}else{for(var t=0;B[t]!=null;t++){if(B[t]&&B[t].nodeType===1){am.push(ai[t])}}}}}else{s(B,am)}if(y){r(y,z,am,al);if(q){hasDuplicate=false;am.sort(q);if(hasDuplicate){for(var t=1;t<am.length;t++){if(am[t]===am[t-1]){am.splice(t--,1)}}}}}return am};r.matches=function(u,t){return r(u,null,null,t)};r.find=function(t,A,B){var u,w;if(!t){return[]}for(var x=0,y=o.order.length;x<y;x++){var v=o.order[x],w;if((w=o.match[v].exec(t))){var z=RegExp.leftContext;if(z.substr(z.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,"");u=o.find[v](w,A,B);if(u!=null){t=t.replace(o.match[v],"");break}}}}if(!u){u=A.getElementsByTagName("*")}return{set:u,expr:t}};r.filter=function(ak,al,D,x){var y=ak,B=[],t=al,v,A,u=al&&al[0]&&e(al[0]);while(ak&&al.length){for(var am in o.filter){if((v=o.match[am].exec(ak))!=null){var z=o.filter[am],C,ai;A=false;if(t==B){B=[]}if(o.preFilter[am]){v=o.preFilter[am](v,t,D,B,x,u);if(!v){A=C=true}else{if(v===true){continue}}}if(v){for(var w=0;(ai=t[w])!=null;w++){if(ai){C=z(ai,v,w,t);var aj=x^!!C;if(D&&C!=null){if(aj){A=true}else{t[w]=false}}else{if(aj){B.push(ai);A=true}}}}}if(C!==ab){if(!D){t=B}ak=ak.replace(o.match[am],"");if(!A){return[]}break}}}if(ak==y){if(A==null){throw"Syntax error, unrecognized expression: "+ak}else{break}}y=ak}return t};var o=r.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")}},relative:{"+":function(t,A,u){var w=typeof A==="string",B=w&&!/\W/.test(A),v=w&&!B;if(B&&!u){A=A.toUpperCase()}for(var x=0,y=t.length,z;x<y;x++){if((z=t[x])){while((z=z.previousSibling)&&z.nodeType!==1){}t[x]=v||z&&z.nodeName===A?z||false:z===A}}if(v){r.filter(A,t,true)}},">":function(y,v,x){var A=typeof v==="string";if(A&&!/\W/.test(v)){v=x?v:v.toUpperCase();for(var u=0,w=y.length;u<w;u++){var z=y[u];if(z){var t=z.parentNode;y[u]=t.nodeName===v?t:false}}}else{for(var u=0,w=y.length;u<w;u++){var z=y[u];if(z){y[u]=A?z.parentNode:z.parentNode===v}}if(A){r.filter(v,y,true)}}},"":function(t,v,x){var u=l++,w=c;if(!v.match(/\W/)){var y=v=x?v:v.toUpperCase();w=f}w("parentNode",v,u,t,y,x)},"~":function(t,v,x){var u=l++,w=c;if(typeof v==="string"&&!v.match(/\W/)){var y=v=x?v:v.toUpperCase();w=f}w("previousSibling",v,u,t,y,x)}},find:{ID:function(v,u,t){if(typeof u.getElementById!=="undefined"&&!t){var w=u.getElementById(v[1]);return w?[w]:[]}},NAME:function(u,y,x){if(typeof y.getElementsByName!=="undefined"){var v=[],z=y.getElementsByName(u[1]);for(var t=0,w=z.length;t<w;t++){if(z[t].getAttribute("name")===u[1]){v.push(z[t])}}return v.length===0?null:v}},TAG:function(u,t){return t.getElementsByTagName(u[1])}},preFilter:{CLASS:function(t,v,u,w,y,x){t=" "+t[1].replace(/\\/g,"")+" ";if(x){return t}for(var A=0,z;(z=v[A])!=null;A++){if(z){if(y^(z.className&&(" "+z.className+" ").indexOf(t)>=0)){if(!u){w.push(z)}}else{if(u){v[A]=false}}}}return false},ID:function(t){return t[1].replace(/\\/g,"")},TAG:function(u,v){for(var t=0;v[t]===false;t++){}return v[t]&&e(v[t])?u[1]:u[1].toUpperCase()},CHILD:function(u){if(u[1]=="nth"){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(u[2]=="even"&&"2n"||u[2]=="odd"&&"2n+1"||!/\D/.test(u[2])&&"0n+"+u[2]||u[2]);u[2]=(t[1]+(t[2]||1))-0;u[3]=t[3]-0}u[0]=l++;return u},ATTR:function(z,v,u,w,y,x){var t=z[1].replace(/\\/g,"");if(!x&&o.attrMap[t]){z[1]=o.attrMap[t]}if(z[2]==="~="){z[4]=" "+z[4]+" "}return z},PSEUDO:function(y,v,u,w,x){if(y[1]==="not"){if(y[3].match(d).length>1||/^\w/.test(y[3])){y[3]=r(y[3],null,null,v)}else{var t=r.filter(y[3],v,u,true^x);if(!u){w.push.apply(w,t)}return false}}else{if(o.match.POS.test(y[0])||o.match.CHILD.test(y[0])){return true}}return y},POS:function(t){t.unshift(true);return t}},filters:{enabled:function(t){return t.disabled===false&&t.type!=="hidden"},disabled:function(t){return t.disabled===true},checked:function(t){return t.checked===true},selected:function(t){t.parentNode.selectedIndex;return t.selected===true},parent:function(t){return !!t.firstChild},empty:function(t){return !t.firstChild},has:function(t,u,v){return !!r(v[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.type},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||t.nodeName.toUpperCase()==="BUTTON"},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,u){return u===0},last:function(u,v,w,t){return v===t.length-1},even:function(t,u){return u%2===0},odd:function(t,u){return u%2===1},lt:function(t,u,v){return u<v[3]-0},gt:function(t,u,v){return u>v[3]-0},nth:function(t,u,v){return v[3]-0==u},eq:function(t,u,v){return v[3]-0==u}},filter:{PSEUDO:function(y,u,t,x){var v=u[1],A=o.filters[v];if(A){return A(y,t,u,x)}else{if(v==="contains"){return(y.textContent||y.innerText||"").indexOf(u[3])>=0}else{if(v==="not"){var z=u[3];for(var t=0,w=z.length;t<w;t++){if(z[t]===y){return false}}return true}}}},CHILD:function(A,x){var u=x[1],z=A;switch(u){case"only":case"first":while(z=z.previousSibling){if(z.nodeType===1){return false}}if(u=="first"){return true}z=A;case"last":while(z=z.nextSibling){if(z.nodeType===1){return false}}return true;case"nth":var y=x[2],B=x[3];if(y==1&&B==0){return true}var v=x[0],C=A.parentNode;if(C&&(C.sizcache!==v||!A.nodeIndex)){var w=0;for(z=C.firstChild;z;z=z.nextSibling){if(z.nodeType===1){z.nodeIndex=++w}}C.sizcache=v}var t=A.nodeIndex-B;if(y==0){return t==0}else{return(t%y==0&&t/y>=0)}}},ID:function(t,u){return t.nodeType===1&&t.getAttribute("id")===u},TAG:function(t,u){return(u==="*"&&t.nodeType===1)||t.nodeName===u},CLASS:function(t,u){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(u)>-1},ATTR:function(y,t){var u=t[1],w=o.attrHandle[u]?o.attrHandle[u](y):y[u]!=null?y[u]:y.getAttribute(u),x=w+"",z=t[2],v=t[4];return w==null?z==="!=":z==="="?x===v:z==="*="?x.indexOf(v)>=0:z==="~="?(" "+x+" ").indexOf(v)>=0:!v?x&&w!==false:z==="!="?x!=v:z==="^="?x.indexOf(v)===0:z==="$="?x.substr(x.length-v.length)===v:z==="|="?x===v||x.substr(0,v.length+1)===v+"-":false},POS:function(y,v,u,x){var w=v[2],t=o.setFilters[w];if(t){return t(y,u,v,x)}}}};var j=o.match.POS;for(var g in o.match){o.match[g]=RegExp(o.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var s=function(t,u){t=Array.prototype.slice.call(t);if(u){u.push.apply(u,t);return u}return t};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(h){s=function(x,t){var v=t||[];if(p.call(x)==="[object Array]"){Array.prototype.push.apply(v,x)}else{if(typeof x.length==="number"){for(var u=0,w=x.length;u<w;u++){v.push(x[u])}}else{for(var u=0;x[u];u++){v.push(x[u])}}}return v}}var q;if(document.documentElement.compareDocumentPosition){q=function(u,v){var t=u.compareDocumentPosition(v)&4?-1:u===v?0:1;if(t===0){hasDuplicate=true}return t}}else{if("sourceIndex" in document.documentElement){q=function(u,v){var t=u.sourceIndex-v.sourceIndex;if(t===0){hasDuplicate=true}return t}}else{if(document.createRange){q=function(t,v){var u=t.ownerDocument.createRange(),w=v.ownerDocument.createRange();u.selectNode(t);u.collapse(true);w.selectNode(v);w.collapse(true);var x=u.compareBoundaryPoints(Range.START_TO_END,w);if(x===0){hasDuplicate=true}return x}}}}(function(){var u=document.createElement("form"),t="script"+(new Date).getTime();u.innerHTML="<input name='"+t+"'/>";var v=document.documentElement;v.insertBefore(u,v.firstChild);if(!!document.getElementById(t)){o.find.ID=function(z,y,x){if(typeof y.getElementById!=="undefined"&&!x){var w=y.getElementById(z[1]);return w?w.id===z[1]||typeof w.getAttributeNode!=="undefined"&&w.getAttributeNode("id").nodeValue===z[1]?[w]:ab:[]}};o.filter.ID=function(x,w){var y=typeof x.getAttributeNode!=="undefined"&&x.getAttributeNode("id");return x.nodeType===1&&y&&y.nodeValue===w}}v.removeChild(u)})();(function(){var t=document.createElement("div");t.appendChild(document.createComment(""));if(t.getElementsByTagName("*").length>0){o.find.TAG=function(w,x){var y=x.getElementsByTagName(w[1]);if(w[1]==="*"){var u=[];for(var v=0;y[v];v++){if(y[v].nodeType===1){u.push(y[v])}}y=u}return y}}t.innerHTML="<a href='#'></a>";if(t.firstChild&&typeof t.firstChild.getAttribute!=="undefined"&&t.firstChild.getAttribute("href")!=="#"){o.attrHandle.href=function(u){return u.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var u=r,t=document.createElement("div");t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}r=function(y,z,w,v){z=z||document;if(!v&&z.nodeType===9&&!e(z)){try{return s(z.querySelectorAll(y),w)}catch(x){}}return u(y,z,w,v)};r.find=u.find;r.filter=u.filter;r.selectors=u.selectors;r.matches=u.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var t=document.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>";if(t.getElementsByClassName("e").length===0){return}t.lastChild.className="e";if(t.getElementsByClassName("e").length===1){return}o.order.splice(1,0,"CLASS");o.find.CLASS=function(w,v,u){if(typeof v.getElementsByClassName!=="undefined"&&!u){return v.getElementsByClassName(w[1])}}})()}function f(z,u,v,B,t,C){var D=z=="previousSibling"&&!C;for(var x=0,y=B.length;x<y;x++){var A=B[x];if(A){if(D&&A.nodeType===1){A.sizcache=v;A.sizset=x}A=A[z];var w=false;while(A){if(A.sizcache===v){w=B[A.sizset];break}if(A.nodeType===1&&!C){A.sizcache=v;A.sizset=x}if(A.nodeName===u){w=A;break}A=A[z]}B[x]=w}}}function c(z,u,v,B,t,C){var D=z=="previousSibling"&&!C;for(var x=0,y=B.length;x<y;x++){var A=B[x];if(A){if(D&&A.nodeType===1){A.sizcache=v;A.sizset=x}A=A[z];var w=false;while(A){if(A.sizcache===v){w=B[A.sizset];break}if(A.nodeType===1){if(!C){A.sizcache=v;A.sizset=x}if(typeof u!=="string"){if(A===u){w=true;break}}else{if(r.filter(u,[A]).length>0){w=A;break}}}A=A[z]}B[x]=w}}}var m=document.compareDocumentPosition?function(t,u){return t.compareDocumentPosition(u)&16}:function(t,u){return t!==u&&(t.contains?t.contains(u):true)};var e=function(t){return t.nodeType===9&&t.documentElement.nodeName!=="HTML"||!!t.ownerDocument&&e(t.ownerDocument)};var n=function(w,y){var t=[],A="",z,u=y.nodeType?[y]:y;while((z=o.match.PSEUDO.exec(w))){A+=z[0];w=w.replace(o.match.PSEUDO,"")}w=o.relative[w]?w+"*":w;for(var x=0,v=u.length;x<v;x++){r(w,u[x],t)}return r.filter(A,t)};T.find=r;T.filter=r.filter;T.expr=r.selectors;T.expr[":"]=T.expr.filters;r.selectors.filters.hidden=function(t){return t.offsetWidth===0||t.offsetHeight===0};r.selectors.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0};r.selectors.filters.animated=function(t){return T.grep(T.timers,function(u){return t===u.elem}).length};T.multiFilter=function(t,v,u){if(u){t=":not("+t+")"}return r.matches(t,v)};T.dir=function(u,v){var w=[],t=u[v];while(t&&t!=document){if(t.nodeType==1){w.push(t)}t=t[v]}return w};T.nth=function(x,w,u,t){w=w||1;var v=0;for(;x;x=x[u]){if(x.nodeType==1&&++v==w){break}}return x};T.sibling=function(t,u){var v=[];for(;t;t=t.nextSibling){if(t.nodeType==1&&t!=u){v.push(t)}}return v};return;W.Sizzle=r})();T.event={add:function(e,h,f,c){if(e.nodeType==3||e.nodeType==8){return}if(e.setInterval&&e!=W){e=W}if(!f.guid){f.guid=this.guid++}if(c!==ab){var g=f;f=this.proxy(g);f.data=c}var j=T.data(e,"events")||T.data(e,"events",{}),d=T.data(e,"handle")||T.data(e,"handle",function(){return typeof T!=="undefined"&&!T.event.triggered?T.event.handle.apply(arguments.callee.elem,arguments):ab});d.elem=e;T.each(h.split(/\s+/),function(o,n){var m=n.split(".");n=m.shift();f.type=m.slice().sort().join(".");var l=j[n];if(T.event.specialAll[n]){T.event.specialAll[n].setup.call(e,c,m)}if(!l){l=j[n]={};if(!T.event.special[n]||T.event.special[n].setup.call(e,c,m)===false){if(e.addEventListener){e.addEventListener(n,d,false)}else{if(e.attachEvent){e.attachEvent("on"+n,d)}}}}l[f.guid]=f;T.event.global[n]=true});e=null},guid:1,global:{},remove:function(d,g,e){if(d.nodeType==3||d.nodeType==8){return}var h=T.data(d,"events"),j,l;if(h){if(g===ab||(typeof g==="string"&&g.charAt(0)==".")){for(var f in h){this.remove(d,f+(g||""))}}else{if(g.type){e=g.handler;g=g.type}T.each(g.split(/\s+/),function(q,o){var m=o.split(".");o=m.shift();var p=RegExp("(^|\\.)"+m.slice().sort().join(".*\\.")+"(\\.|$)");if(h[o]){if(e){delete h[o][e.guid]}else{for(var n in h[o]){if(p.test(h[o][n].type)){delete h[o][n]}}}if(T.event.specialAll[o]){T.event.specialAll[o].teardown.call(d,m)}for(j in h[o]){break}if(!j){if(!T.event.special[o]||T.event.special[o].teardown.call(d,m)===false){if(d.removeEventListener){d.removeEventListener(o,T.data(d,"handle"),false)}else{if(d.detachEvent){d.detachEvent("on"+o,T.data(d,"handle"))}}}j=null;delete h[o]}}})}for(j in h){break}if(!j){var c=T.data(d,"handle");if(c){c.elem=null}T.removeData(d,"events");T.removeData(d,"handle")}}},trigger:function(f,d,g,l){var h=f.type||f;if(!l){f=typeof f==="object"?f[aa]?f:T.extend(T.Event(h),f):T.Event(h);if(h.indexOf("!")>=0){f.type=h=h.slice(0,-1);f.exclusive=true}if(!g){f.stopPropagation();if(this.global[h]){T.each(T.cache,function(){if(this.events&&this.events[h]){T.event.trigger(f,d,this.handle.elem)}})}}if(!g||g.nodeType==3||g.nodeType==8){return ab}f.result=ab;f.target=g;d=T.makeArray(d);d.unshift(f)}f.currentTarget=g;var e=T.data(g,"handle");if(e){e.apply(g,d)}if((!g[h]||(T.nodeName(g,"a")&&h=="click"))&&g["on"+h]&&g["on"+h].apply(g,d)===false){f.result=false}if(!l&&g[h]&&!f.isDefaultPrevented()&&!(T.nodeName(g,"a")&&h=="click")){this.triggered=true;try{g[h]()}catch(c){}}this.triggered=false;if(!f.isPropagationStopped()){var j=g.parentNode||g.ownerDocument;if(j){T.event.trigger(f,d,j,true)}}},handle:function(d){var e,l;d=arguments[0]=T.event.fix(d||W.event);d.currentTarget=this;var c=d.type.split(".");d.type=c.shift();e=!c.length&&!d.exclusive;var f=RegExp("(^|\\.)"+c.slice().sort().join(".*\\.")+"(\\.|$)");l=(T.data(this,"events")||{})[d.type];for(var h in l){var g=l[h];if(e||f.test(g.type)){d.handler=g;d.data=g.data;var j=g.apply(this,arguments);if(j!==ab){d.result=j;if(j===false){d.preventDefault();d.stopPropagation()}}if(d.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(e){if(e[aa]){return e}var g=e;e=T.Event(g);for(var f=this.props.length,c;f;){c=this.props[--f];e[c]=g[c]}if(!e.target){e.target=e.srcElement||document}if(e.target.nodeType==3){e.target=e.target.parentNode}if(!e.relatedTarget&&e.fromElement){e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement}if(e.pageX==null&&e.clientX!=null){var d=document.documentElement,h=document.body;e.pageX=e.clientX+(d&&d.scrollLeft||h&&h.scrollLeft||0)-(d.clientLeft||0);e.pageY=e.clientY+(d&&d.scrollTop||h&&h.scrollTop||0)-(d.clientTop||0)}if(!e.which&&((e.charCode||e.charCode===0)?e.charCode:e.keyCode)){e.which=e.charCode||e.keyCode}if(!e.metaKey&&e.ctrlKey){e.metaKey=e.ctrlKey}if(!e.which&&e.button){e.which=(e.button&1?1:(e.button&2?3:(e.button&4?2:0)))}return e},proxy:function(c,d){d=d||function(){return c.apply(this,arguments)};d.guid=c.guid=c.guid||d.guid||this.guid++;return d},special:{ready:{setup:P,teardown:function(){}}},specialAll:{live:{setup:function(d,c){T.event.add(this,c[0],af)},teardown:function(c){if(c.length){var e=0,d=RegExp("(^|\\.)"+c[0]+"(\\.|$)");T.each((T.data(this,"events").live||{}),function(){if(d.test(this.type)){e++}});if(e<1){T.event.remove(this,c[0],af)}}}}}};T.Event=function(c){if(!this.preventDefault){return new T.Event(c)}if(c&&c.type){this.originalEvent=c;this.type=c.type}else{this.type=c}this.timeStamp=ad();this[aa]=true};function X(){return false}function J(){return true}T.Event.prototype={preventDefault:function(){this.isDefaultPrevented=J;var c=this.originalEvent;if(!c){return}if(c.preventDefault){c.preventDefault()}c.returnValue=false},stopPropagation:function(){this.isPropagationStopped=J;var c=this.originalEvent;if(!c){return}if(c.stopPropagation){c.stopPropagation()}c.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=J;this.stopPropagation()},isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X};var ah=function(d){var e=d.relatedTarget;while(e&&e!=this){try{e=e.parentNode}catch(c){e=this}}if(e!=this){d.type=d.data;T.event.handle.apply(this,arguments)}};T.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(c,d){T.event.special[d]={setup:function(){T.event.add(this,c,ah,d)},teardown:function(){T.event.remove(this,c,ah)}}});T.fn.extend({bind:function(d,c,e){return d=="unload"?this.one(d,c,e):this.each(function(){T.event.add(this,d,e||c,e&&c)})},one:function(d,c,e){var f=T.event.proxy(e||c,function(g){T(this).unbind(g,f);return(e||c).apply(this,arguments)});return this.each(function(){T.event.add(this,d,f,e&&c)})},unbind:function(c,d){return this.each(function(){T.event.remove(this,c,d)})},trigger:function(d,c){return this.each(function(){T.event.trigger(d,c,this)})},triggerHandler:function(e,c){if(this[0]){var d=T.Event(e);d.preventDefault();d.stopPropagation();T.event.trigger(d,c,this[0]);return d.result}},toggle:function(c){var e=arguments,d=1;while(d<e.length){T.event.proxy(c,e[d++])}return this.click(T.event.proxy(c,function(f){this.lastToggle=(this.lastToggle||0)%d;f.preventDefault();return e[this.lastToggle++].apply(this,arguments)||false}))},hover:function(d,c){return this.mouseenter(d).mouseleave(c)},ready:function(c){P();if(T.isReady){c.call(document,T)}else{T.readyList.push(c)}return this},live:function(c,d){var e=T.event.proxy(d);e.guid+=this.selector+c;T(document).bind(Z(c,this.selector),this.selector,e);return this},die:function(c,d){T(document).unbind(Z(c,this.selector),d?{guid:d.guid+this.selector+c}:null);return this}});function af(c){var f=RegExp("(^|\\.)"+c.type+"(\\.|$)"),d=true,e=[];T.each(T.data(this,"events").live||[],function(j,h){if(f.test(h.type)){var g=T(c.target).closest(h.data)[0];if(g){e.push({elem:g,fn:h})}}});e.sort(function(g,h){return T.data(g.elem,"closest")-T.data(h.elem,"closest")});T.each(e,function(){if(this.fn.call(this.elem,c,this.fn.data)===false){return(d=false)}});return d}function Z(c,d){return["live",c,d.replace(/\./g,"`").replace(/ /g,"|")].join(".")}T.extend({isReady:false,readyList:[],ready:function(){if(!T.isReady){T.isReady=true;if(T.readyList){T.each(T.readyList,function(){this.call(document,T)});T.readyList=null}T(document).triggerHandler("ready")}}});var G=false;function P(){if(G){return}G=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);T.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);T.ready()}});if(document.documentElement.doScroll&&W==W.top){(function(){if(T.isReady){return}try{document.documentElement.doScroll("left")}catch(c){setTimeout(arguments.callee,0);return}T.ready()})()}}}T.event.add(W,"load",T.ready)}T.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(c,d){T.fn[d]=function(e){return e?this.bind(d,e):this.trigger(d)}});T(W).bind("unload",function(){for(var c in T.cache){if(c!=1&&T.cache[c].handle){T.event.remove(T.cache[c].handle.elem)}}});(function(){T.support={};var h=document.documentElement,g=document.createElement("script"),c=document.createElement("div"),d="script"+(new Date).getTime();c.style.display="none";c.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var f=c.getElementsByTagName("*"),j=c.getElementsByTagName("a")[0];if(!f||!f.length||!j){return}T.support={leadingWhitespace:c.firstChild.nodeType==3,tbody:!c.getElementsByTagName("tbody").length,objectAll:!!c.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!c.getElementsByTagName("link").length,style:/red/.test(j.getAttribute("style")),hrefNormalized:j.getAttribute("href")==="/a",opacity:j.style.opacity==="0.5",cssFloat:!!j.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};g.type="text/javascript";try{g.appendChild(document.createTextNode("window."+d+"=1;"))}catch(e){}h.insertBefore(g,h.firstChild);if(W[d]){T.support.scriptEval=true;delete W[d]}h.removeChild(g);if(c.attachEvent&&c.fireEvent){c.attachEvent("onclick",function(){T.support.noCloneEvent=false;c.detachEvent("onclick",arguments.callee)});c.cloneNode(true).fireEvent("onclick")}T(function(){var l=document.createElement("div");l.style.width=l.style.paddingLeft="1px";document.body.appendChild(l);T.boxModel=T.support.boxModel=l.offsetWidth===2;document.body.removeChild(l).style.display="none"})})();var H=T.support.cssFloat?"cssFloat":"styleFloat";T.props={"for":"htmlFor","class":"className","float":H,cssFloat:H,styleFloat:H,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};T.fn.extend({_load:T.fn.load,load:function(g,d,c){if(typeof g!=="string"){return this._load(g)}var e=g.indexOf(" ");if(e>=0){var j=g.slice(e,g.length);g=g.slice(0,e)}var f="GET";if(d){if(T.isFunction(d)){c=d;d=null}else{if(typeof d==="object"){d=T.param(d);f="POST"}}}var h=this;T.ajax({url:g,type:f,dataType:"html",data:d,complete:function(m,l){if(l=="success"||l=="notmodified"){h.html(j?T("<div/>").append(m.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(j):m.responseText)}if(c){h.each(c,[m.responseText,l,m])}}});return this},serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?T.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(e,d){var c=T(this).val();return c==null?null:T.isArray(c)?T.map(c,function(f,g){return{name:d.name,value:f}}):{name:d.name,value:c}}).get()}});T.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(d,c){T.fn[c]=function(e){return this.bind(c,e)}});var N=ad();T.extend({get:function(f,d,c,e){if(T.isFunction(d)){c=d;d=null}return T.ajax({type:"GET",url:f,data:d,success:c,dataType:e})},getScript:function(d,c){return T.get(d,null,c,"script")},getJSON:function(e,d,c){return T.get(e,d,c,"json")},post:function(f,d,c,e){if(T.isFunction(d)){c=d;d={}}return T.ajax({type:"POST",url:f,data:d,success:c,dataType:e})},ajaxSetup:function(c){T.extend(T.ajaxSettings,c)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return W.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(o){o=T.extend(true,o,T.extend(true,{},T.ajaxSettings,o));var c,v=/=\?(&|$)/g,h,d,u=o.type.toUpperCase();if(o.data&&o.processData&&typeof o.data!=="string"){o.data=T.param(o.data)}if(o.dataType=="jsonp"){if(u=="GET"){if(!o.url.match(v)){o.url+=(o.url.match(/\?/)?"&":"?")+(o.jsonp||"callback")+"=?"}}else{if(!o.data||!o.data.match(v)){o.data=(o.data?o.data+"&":"")+(o.jsonp||"callback")+"=?"}}o.dataType="json"}if(o.dataType=="json"&&(o.data&&o.data.match(v)||o.url.match(v))){c="jsonp"+N++;if(o.data){o.data=(o.data+"").replace(v,"="+c+"$1")}o.url=o.url.replace(v,"="+c+"$1");o.dataType="script";W[c]=function(y){d=y;s();p();W[c]=ab;try{delete W[c]}catch(x){}if(t){t.removeChild(f)}}}if(o.dataType=="script"&&o.cache==null){o.cache=false}if(o.cache===false&&u=="GET"){var w=ad();var e=o.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+w+"$2");o.url=e+((e==o.url)?(o.url.match(/\?/)?"&":"?")+"_="+w:"")}if(o.data&&u=="GET"){o.url+=(o.url.match(/\?/)?"&":"?")+o.data;o.data=null}if(o.global&&!T.active++){T.event.trigger("ajaxStart")}var j=/^(\w+:)?\/\/([^\/?#]+)/.exec(o.url);if(o.dataType=="script"&&u=="GET"&&j&&(j[1]&&j[1]!=location.protocol||j[2]!=location.host)){var t=document.getElementsByTagName("head")[0];var f=document.createElement("script");f.src=o.url;if(o.scriptCharset){f.charset=o.scriptCharset}if(!c){var m=false;f.onload=f.onreadystatechange=function(){if(!m&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){m=true;s();p();f.onload=f.onreadystatechange=null;t.removeChild(f)}}}t.appendChild(f);return ab}var q=false;var r=o.xhr();if(o.username){r.open(u,o.url,o.async,o.username,o.password)}else{r.open(u,o.url,o.async)}try{if(o.data){r.setRequestHeader("Content-Type",o.contentType)}if(o.ifModified){r.setRequestHeader("If-Modified-Since",T.lastModified[o.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.setRequestHeader("Accept",o.dataType&&o.accepts[o.dataType]?o.accepts[o.dataType]+", */*":o.accepts._default)}catch(g){}if(o.beforeSend&&o.beforeSend(r,o)===false){if(o.global&&!--T.active){T.event.trigger("ajaxStop")}r.abort();return false}if(o.global){T.event.trigger("ajaxSend",[r,o])}var n=function(z){if(r.readyState==0){if(l){clearInterval(l);l=null;if(o.global&&!--T.active){T.event.trigger("ajaxStop")}}}else{if(!q&&r&&(r.readyState==4||z=="timeout")){q=true;if(l){clearInterval(l);l=null}h=z=="timeout"?"timeout":!T.httpSuccess(r)?"error":o.ifModified&&T.httpNotModified(r,o.url)?"notmodified":"success";if(h=="success"){try{d=T.httpData(r,o.dataType,o)}catch(x){h="parsererror"}}if(h=="success"){var y;try{y=r.getResponseHeader("Last-Modified")}catch(x){}if(o.ifModified&&y){T.lastModified[o.url]=y}if(!c){s()}}else{T.handleError(o,r,h)}p();if(z){r.abort()}if(o.async){r=null}}}};if(o.async){var l=setInterval(n,13);if(o.timeout>0){setTimeout(function(){if(r&&!q){n("timeout")}},o.timeout)}}try{r.send(o.data)}catch(g){T.handleError(o,r,null,g)}if(!o.async){n()}function s(){if(o.success){o.success(d,h)}if(o.global){T.event.trigger("ajaxSuccess",[r,o])}}function p(){if(o.complete){o.complete(r,h)}if(o.global){T.event.trigger("ajaxComplete",[r,o])}if(o.global&&!--T.active){T.event.trigger("ajaxStop")}}return r},handleError:function(e,c,f,d){if(e.error){e.error(c,f,d)}if(e.global){T.event.trigger("ajaxError",[c,e,d])}},active:0,httpSuccess:function(c){try{return !c.status&&location.protocol=="file:"||(c.status>=200&&c.status<300)||c.status==304||c.status==1223}catch(d){}return false},httpNotModified:function(d,f){try{var c=d.getResponseHeader("Last-Modified");return d.status==304||c==T.lastModified[f]}catch(e){}return false},httpData:function(c,e,f){var g=c.getResponseHeader("content-type"),h=e=="xml"||!e&&g&&g.indexOf("xml")>=0,d=h?c.responseXML:c.responseText;if(h&&d.documentElement.tagName=="parsererror"){throw"parsererror"}if(f&&f.dataFilter){d=f.dataFilter(d,e)}if(typeof d==="string"){if(e=="script"){T.globalEval(d)}if(e=="json"){d=W["eval"]("("+d+")")}}return d},param:function(f){var d=[];function c(h,g){d[d.length]=encodeURIComponent(h)+"="+encodeURIComponent(g)}if(T.isArray(f)||f.jquery){T.each(f,function(){c(this.name,this.value)})}else{for(var e in f){if(T.isArray(f[e])){T.each(f[e],function(){c(e,this)})}else{c(e,T.isFunction(f[e])?f[e]():f[e])}}}return d.join("&").replace(/%20/g,"+")}});var V={},U,ae=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function K(d,e){var c={};T.each(ae.concat.apply([],ae.slice(0,e)),function(){c[this]=d});return c}T.fn.extend({show:function(e,c){if(e){return this.animate(K("show",3),e,c)}else{for(var g=0,j=this.length;g<j;g++){var l=T.data(this[g],"olddisplay");this[g].style.display=l||"";if(T.css(this[g],"display")==="none"){var h=this[g].tagName,d;if(V[h]){d=V[h]}else{var f=T("<"+h+" />").appendTo("body");d=f.css("display");if(d==="none"){d="block"}f.remove();V[h]=d}T.data(this[g],"olddisplay",d)}}for(var g=0,j=this.length;g<j;g++){this[g].style.display=T.data(this[g],"olddisplay")||""}return this}},hide:function(d,c){if(d){return this.animate(K("hide",3),d,c)}else{for(var e=0,f=this.length;e<f;e++){var g=T.data(this[e],"olddisplay");if(!g&&g!=="none"){T.data(this[e],"olddisplay",T.css(this[e],"display"))}}for(var e=0,f=this.length;e<f;e++){this[e].style.display="none"}return this}},_toggle:T.fn.toggle,toggle:function(c,d){var e=typeof c==="boolean";return T.isFunction(c)&&T.isFunction(d)?this._toggle.apply(this,arguments):c==null||e?this.each(function(){var f=e?c:T(this).is(":hidden");T(this)[f?"show":"hide"]()}):this.animate(K("toggle",3),c,d)},fadeTo:function(e,c,d){return this.animate({opacity:c},e,d)},animate:function(c,f,d,e){var g=T.speed(f,d,e);return this[g.queue===false?"each":"queue"](function(){var j=T.extend({},g),m,h=this.nodeType==1&&T(this).is(":hidden"),l=this;for(m in c){if(c[m]=="hide"&&h||c[m]=="show"&&!h){return j.complete.call(this)}if((m=="height"||m=="width")&&this.style){j.display=T.css(this,"display");j.overflow=this.style.overflow}}if(j.overflow!=null){this.style.overflow="hidden"}j.curAnim=T.extend({},c);T.each(c,function(s,o){var p=new T.fx(l,j,s);if(/toggle|show|hide/.test(o)){p[o=="toggle"?h?"show":"hide":o](c)}else{var q=o.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),n=p.cur(true)||0;if(q){var t=parseFloat(q[2]),r=q[3]||"px";if(r!="px"){l.style[s]=(t||1)+r;n=((t||1)/p.cur(true))*n;l.style[s]=n+r}if(q[1]){t=((q[1]=="-="?-1:1)*t)+n}p.custom(n,t,r)}else{p.custom(n,o,"")}}});return true})},stop:function(d,e){var c=T.timers;if(d){this.queue([])}this.each(function(){for(var f=c.length-1;f>=0;f--){if(c[f].elem==this){if(e){c[f](true)}c.splice(f,1)}}});if(!e){this.dequeue()}return this}});T.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(d,c){T.fn[d]=function(f,e){return this.animate(c,f,e)}});T.extend({speed:function(d,c,e){var f=typeof d==="object"?d:{complete:e||!e&&c||T.isFunction(d)&&d,duration:d,easing:e&&c||c&&!T.isFunction(c)&&c};f.duration=T.fx.off?0:typeof f.duration==="number"?f.duration:T.fx.speeds[f.duration]||T.fx.speeds._default;f.old=f.complete;f.complete=function(){if(f.queue!==false){T(this).dequeue()}if(T.isFunction(f.old)){f.old.call(this)}};return f},easing:{linear:function(d,c,f,e){return f+e*d},swing:function(d,c,f,e){return((-Math.cos(d*Math.PI)/2)+0.5)*e+f}},timers:[],fx:function(d,e,c){this.options=e;this.elem=d;this.prop=c;if(!e.orig){e.orig={}}}});T.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(T.fx.step[this.prop]||T.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(c){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var d=parseFloat(T.css(this.elem,this.prop,c));return d&&d>-10000?d:parseFloat(T.curCSS(this.elem,this.prop))||0},custom:function(c,d,e){this.startTime=ad();this.start=c;this.end=d;this.unit=e||this.unit||"px";this.now=this.start;this.pos=this.state=0;var g=this;function f(h){return g.step(h)}f.elem=this.elem;if(f()&&T.timers.push(f)&&!U){U=setInterval(function(){var h=T.timers;for(var j=0;j<h.length;j++){if(!h[j]()){h.splice(j--,1)}}if(!h.length){clearInterval(U);U=ab}},13)}},show:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());T(this.elem).show()},hide:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(e){var f=ad();if(e||f>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var h=true;for(var g in this.options.curAnim){if(this.options.curAnim[g]!==true){h=false}}if(h){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(T.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){T(this.elem).hide()}if(this.options.hide||this.options.show){for(var d in this.options.curAnim){T.attr(this.elem.style,d,this.options.orig[d])}}this.options.complete.call(this.elem)}return false}else{var c=f-this.startTime;this.state=c/this.options.duration;this.pos=T.easing[this.options.easing||(T.easing.swing?"swing":"linear")](this.state,c,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};T.extend(T.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(c){T.attr(c.elem.style,"opacity",c.now)},_default:function(c){if(c.elem.style&&c.elem.style[c.prop]!=null){c.elem.style[c.prop]=c.now+c.unit}else{c.elem[c.prop]=c.now}}}});if(document.documentElement.getBoundingClientRect){T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}var h=this[0].getBoundingClientRect(),e=this[0].ownerDocument,j=e.body,l=e.documentElement,c=l.clientTop||j.clientTop||0,d=l.clientLeft||j.clientLeft||0,f=h.top+(self.pageYOffset||T.boxModel&&l.scrollTop||j.scrollTop)-c,g=h.left+(self.pageXOffset||T.boxModel&&l.scrollLeft||j.scrollLeft)-d;return{top:f,left:g}}}else{T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}T.offset.initialized||T.offset.initialize();var h=this[0],m=h.offsetParent,n=h,c=h.ownerDocument,e,l=c.documentElement,g=c.body,f=c.defaultView,o=f.getComputedStyle(h,null),d=h.offsetTop,j=h.offsetLeft;while((h=h.parentNode)&&h!==g&&h!==l){e=f.getComputedStyle(h,null);d-=h.scrollTop,j-=h.scrollLeft;if(h===m){d+=h.offsetTop,j+=h.offsetLeft;if(T.offset.doesNotAddBorder&&!(T.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(h.tagName))){d+=parseInt(e.borderTopWidth,10)||0,j+=parseInt(e.borderLeftWidth,10)||0}n=m,m=h.offsetParent}if(T.offset.subtractsBorderForOverflowNotVisible&&e.overflow!=="visible"){d+=parseInt(e.borderTopWidth,10)||0,j+=parseInt(e.borderLeftWidth,10)||0}o=e}if(o.position==="relative"||o.position==="static"){d+=g.offsetTop,j+=g.offsetLeft}if(o.position==="fixed"){d+=Math.max(l.scrollTop,g.scrollTop),j+=Math.max(l.scrollLeft,g.scrollLeft)}return{top:d,left:j}}}T.offset={initialize:function(){if(this.initialized){return}var e=document.body,m=document.createElement("div"),j,l,c,h,d,n,g=e.style.marginTop,f='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';d={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(n in d){m.style[n]=d[n]}m.innerHTML=f;e.insertBefore(m,e.firstChild);j=m.firstChild,l=j.firstChild,h=j.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(l.offsetTop!==5);this.doesAddBorderForTableAndCells=(h.offsetTop===5);j.style.overflow="hidden",j.style.position="relative";this.subtractsBorderForOverflowNotVisible=(l.offsetTop===-5);e.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(e.offsetTop===0);e.style.marginTop=g;e.removeChild(m);this.initialized=true},bodyOffset:function(e){T.offset.initialized||T.offset.initialize();var c=e.offsetTop,d=e.offsetLeft;if(T.offset.doesNotIncludeMarginInBodyOffset){c+=parseInt(T.curCSS(e,"marginTop",true),10)||0,d+=parseInt(T.curCSS(e,"marginLeft",true),10)||0}return{top:c,left:d}}};T.fn.extend({position:function(){var d=0,e=0,g;if(this[0]){var f=this.offsetParent(),c=this.offset(),h=/^body|html$/i.test(f[0].tagName)?{top:0,left:0}:f.offset();c.top-=Y(this,"marginTop");c.left-=Y(this,"marginLeft");h.top+=Y(f,"borderTopWidth");h.left+=Y(f,"borderLeftWidth");g={top:c.top-h.top,left:c.left-h.left}}return g},offsetParent:function(){var c=this[0].offsetParent||document.body;while(c&&(!/^body|html$/i.test(c.tagName)&&T.css(c,"position")=="static")){c=c.offsetParent}return T(c)}});T.each(["Left","Top"],function(d,e){var c="scroll"+e;T.fn[c]=function(f){if(!this[0]){return null}return f!==ab?this.each(function(){this==W||this==document?W.scrollTo(!d?f:T(W).scrollLeft(),d?f:T(W).scrollTop()):this[c]=f}):this[0]==W||this[0]==document?self[d?"pageYOffset":"pageXOffset"]||T.boxModel&&document.documentElement[c]||document.body[c]:this[0][c]}});T.each(["Height","Width"],function(d,f){var h=d?"Left":"Top",e=d?"Right":"Bottom",g=f.toLowerCase();T.fn["inner"+f]=function(){return this[0]?T.css(this[0],g,false,"padding"):null};T.fn["outer"+f]=function(j){return this[0]?T.css(this[0],g,false,j?"margin":"border"):null};var c=f.toLowerCase();T.fn[c]=function(j){return this[0]==W?document.compatMode=="CSS1Compat"&&document.documentElement["client"+f]||document.body["client"+f]:this[0]==document?Math.max(document.documentElement["client"+f],document.body["scroll"+f],document.documentElement["scroll"+f],document.body["offset"+f],document.documentElement["offset"+f]):j===ab?(this.length?T.css(this[0],c):null):this.css(c,typeof j==="string"?j:j+"px")}})})();jQuery.noConflict();var hexcase=0;var b64pad="";var chrsz=8;function hex_md5(c){return binl2hex(core_md5(str2binl(c),c.length*chrsz))}function b64_md5(c){return binl2b64(core_md5(str2binl(c),c.length*chrsz))}function hex_hmac_md5(c,d){return binl2hex(core_hmac_md5(c,d))}function b64_hmac_md5(c,d){return binl2b64(core_hmac_md5(c,d))}function calcMD5(c){return binl2hex(core_md5(str2binl(c),c.length*chrsz))}function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72"}function core_md5(q,l){q[l>>5]|=128<<((l)%32);q[(((l+64)>>>9)<<4)+14]=l;var p=1732584193;var o=-271733879;var n=-1732584194;var m=271733878;for(var g=0;g<q.length;g+=16){var j=p;var h=o;var f=n;var e=m;p=md5_ff(p,o,n,m,q[g+0],7,-680876936);m=md5_ff(m,p,o,n,q[g+1],12,-389564586);n=md5_ff(n,m,p,o,q[g+2],17,606105819);o=md5_ff(o,n,m,p,q[g+3],22,-1044525330);p=md5_ff(p,o,n,m,q[g+4],7,-176418897);m=md5_ff(m,p,o,n,q[g+5],12,1200080426);n=md5_ff(n,m,p,o,q[g+6],17,-1473231341);o=md5_ff(o,n,m,p,q[g+7],22,-45705983);p=md5_ff(p,o,n,m,q[g+8],7,1770035416);m=md5_ff(m,p,o,n,q[g+9],12,-1958414417);n=md5_ff(n,m,p,o,q[g+10],17,-42063);o=md5_ff(o,n,m,p,q[g+11],22,-1990404162);p=md5_ff(p,o,n,m,q[g+12],7,1804603682);m=md5_ff(m,p,o,n,q[g+13],12,-40341101);n=md5_ff(n,m,p,o,q[g+14],17,-1502002290);o=md5_ff(o,n,m,p,q[g+15],22,1236535329);p=md5_gg(p,o,n,m,q[g+1],5,-165796510);m=md5_gg(m,p,o,n,q[g+6],9,-1069501632);n=md5_gg(n,m,p,o,q[g+11],14,643717713);o=md5_gg(o,n,m,p,q[g+0],20,-373897302);p=md5_gg(p,o,n,m,q[g+5],5,-701558691);m=md5_gg(m,p,o,n,q[g+10],9,38016083);n=md5_gg(n,m,p,o,q[g+15],14,-660478335);o=md5_gg(o,n,m,p,q[g+4],20,-405537848);p=md5_gg(p,o,n,m,q[g+9],5,568446438);m=md5_gg(m,p,o,n,q[g+14],9,-1019803690);n=md5_gg(n,m,p,o,q[g+3],14,-187363961);o=md5_gg(o,n,m,p,q[g+8],20,1163531501);p=md5_gg(p,o,n,m,q[g+13],5,-1444681467);m=md5_gg(m,p,o,n,q[g+2],9,-51403784);n=md5_gg(n,m,p,o,q[g+7],14,1735328473);o=md5_gg(o,n,m,p,q[g+12],20,-1926607734);p=md5_hh(p,o,n,m,q[g+5],4,-378558);m=md5_hh(m,p,o,n,q[g+8],11,-2022574463);n=md5_hh(n,m,p,o,q[g+11],16,1839030562);o=md5_hh(o,n,m,p,q[g+14],23,-35309556);p=md5_hh(p,o,n,m,q[g+1],4,-1530992060);m=md5_hh(m,p,o,n,q[g+4],11,1272893353);n=md5_hh(n,m,p,o,q[g+7],16,-155497632);o=md5_hh(o,n,m,p,q[g+10],23,-1094730640);p=md5_hh(p,o,n,m,q[g+13],4,681279174);m=md5_hh(m,p,o,n,q[g+0],11,-358537222);n=md5_hh(n,m,p,o,q[g+3],16,-722521979);o=md5_hh(o,n,m,p,q[g+6],23,76029189);p=md5_hh(p,o,n,m,q[g+9],4,-640364487);m=md5_hh(m,p,o,n,q[g+12],11,-421815835);n=md5_hh(n,m,p,o,q[g+15],16,530742520);o=md5_hh(o,n,m,p,q[g+2],23,-995338651);p=md5_ii(p,o,n,m,q[g+0],6,-198630844);m=md5_ii(m,p,o,n,q[g+7],10,1126891415);n=md5_ii(n,m,p,o,q[g+14],15,-1416354905);o=md5_ii(o,n,m,p,q[g+5],21,-57434055);p=md5_ii(p,o,n,m,q[g+12],6,1700485571);m=md5_ii(m,p,o,n,q[g+3],10,-1894986606);n=md5_ii(n,m,p,o,q[g+10],15,-1051523);o=md5_ii(o,n,m,p,q[g+1],21,-2054922799);p=md5_ii(p,o,n,m,q[g+8],6,1873313359);m=md5_ii(m,p,o,n,q[g+15],10,-30611744);n=md5_ii(n,m,p,o,q[g+6],15,-1560198380);o=md5_ii(o,n,m,p,q[g+13],21,1309151649);p=md5_ii(p,o,n,m,q[g+4],6,-145523070);m=md5_ii(m,p,o,n,q[g+11],10,-1120210379);n=md5_ii(n,m,p,o,q[g+2],15,718787259);o=md5_ii(o,n,m,p,q[g+9],21,-343485551);p=safe_add(p,j);o=safe_add(o,h);n=safe_add(n,f);m=safe_add(m,e)}return Array(p,o,n,m)}function md5_cmn(h,e,d,c,g,f){return safe_add(bit_rol(safe_add(safe_add(e,h),safe_add(c,f)),g),d)}function md5_ff(g,f,m,l,e,j,h){return md5_cmn((f&m)|((~f)&l),g,f,e,j,h)}function md5_gg(g,f,m,l,e,j,h){return md5_cmn((f&l)|(m&(~l)),g,f,e,j,h)}function md5_hh(g,f,m,l,e,j,h){return md5_cmn(f^m^l,g,f,e,j,h)}function md5_ii(g,f,m,l,e,j,h){return md5_cmn(m^(f|(~l)),g,f,e,j,h)}function core_hmac_md5(e,h){var g=str2binl(e);if(g.length>16){g=core_md5(g,e.length*chrsz)}var c=Array(16),f=Array(16);for(var d=0;d<16;d++){c[d]=g[d]^909522486;f[d]=g[d]^1549556828}var j=core_md5(c.concat(str2binl(h)),512+h.length*chrsz);return core_md5(f.concat(j),512+128)}function safe_add(c,f){var e=(c&65535)+(f&65535);var d=(c>>16)+(f>>16)+(e>>16);return(d<<16)|(e&65535)}function bit_rol(c,d){return(c<<d)|(c>>>(32-d))}function str2binl(f){var e=Array();var c=(1<<chrsz)-1;for(var d=0;d<f.length*chrsz;d+=chrsz){e[d>>5]|=(f.charCodeAt(d/chrsz)&c)<<(d%32)}return e}function binl2hex(e){var d=hexcase?"0123456789ABCDEF":"0123456789abcdef";var f="";for(var c=0;c<e.length*4;c++){f+=d.charAt((e[c>>2]>>((c%4)*8+4))&15)+d.charAt((e[c>>2]>>((c%4)*8))&15)}return f}function binl2b64(f){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var h="";for(var d=0;d<f.length*4;d+=3){var g=(((f[d>>2]>>8*(d%4))&255)<<16)|(((f[d+1>>2]>>8*((d+1)%4))&255)<<8)|((f[d+2>>2]>>8*((d+2)%4))&255);for(var c=0;c<4;c++){if(d*8+c*6>f.length*32){h+=b64pad}else{h+=e.charAt((g>>6*(3-c))&63)}}}return h}function generateMd5(c,f,g,d,e){return hex_md5(c+""+f+""+g+""+d+""+e)}function getMins(c){return(c.getHours()*60+c.getMinutes())}function getUserInfoByStoreIdAndEmail(c,e){var f={};var g={};g.sql="select password,id,name,truename,isret from users where C_STORE_ID="+c+" and EMAIL='"+e+"'";f.param=g;var d=MainApp.GetReturnData(Object.toJSON(f));if(d){d=d.evalJSON();if(d&&d.NewDataSet&&d.NewDataSet.Table){d=d.NewDataSet.Table;return d}}}function isIE(){return window.ActiveXObject?1:0}(function(j){var e=[];var l=false;var c=[];var p={screenLockerBackground:"#000",screenLockerOpacity:"0.5"};j.setupJMPopups=function(q){p=jQuery.extend(p,q);return this};j.openPopupLayer=function(q){if(typeof(q.name)!="undefined"&&!n(q.name)){q=jQuery.extend({width:"auto",height:"auto",parameters:{},target:"",success:function(){},error:function(){},beforeClose:function(){},afterClose:function(){},reloadSuccess:null,cache:false},q);m(q,true);return this}};j.closePopupLayer=function(q){if(q){for(var r=0;r<e.length;r++){if(e[r].name==q){var s=e[r];e.splice(r,1);s.beforeClose();j("#popupLayer_"+q).fadeOut(function(){j("#popupLayer_"+q).remove();c.pop();if(c.length>0){j(c[c.length-1]).focus()}s.afterClose();o(q)});break}}}else{if(e.length>0){j.closePopupLayer(e[e.length-1].name)}}return this};j.reloadPopupLayer=function(q,s){if(q){for(var r=0;r<e.length;r++){if(e[r].name==q){if(s){e[r].reloadSuccess=s}m(e[r],false);break}}}else{if(e.length>0){j.reloadPopupLayer(e[e.length-1].name)}}return this};function f(){if(l){j("#popupLayerScreenLocker").height(j(document).height()+"px")}}function n(q){if(q){for(var r=0;r<e.length;r++){if(e[r].name==q){return true}}}return false}function h(){if(j("#popupLayerScreenLocker").length){if(e.length==1){l=true;f();j("#popupLayerScreenLocker").fadeIn()}if(j.browser.msie&&j.browser.version<7){j("select:not(.hidden-by-jmp)").addClass("hidden-by-jmp hidden-by-"+e[e.length-1].name).css("visibility","hidden")}j("#popupLayerScreenLocker").css("z-index",parseInt(e.length==1?999:j("#popupLayer_"+e[e.length-2].name).css("z-index"))+1)}else{j("body").append("<div id='popupLayerScreenLocker'><!-- --></div>");j("#popupLayerScreenLocker").css({position:"absolute",background:p.screenLockerBackground,left:"0",top:"0",opacity:p.screenLockerOpacity,display:"none"});h();j("#popupLayerScreenLocker").click(function(){j.closePopupLayer()})}}function o(q){if(e.length==0){screenlocker=false;j("#popupLayerScreenLocker").fadeOut()}else{j("#popupLayerScreenLocker").css("z-index",parseInt(j("#popupLayer_"+e[e.length-1].name).css("z-index"))-1)}if(j.browser.msie&&j.browser.version<7){j("select.hidden-by-"+q).removeClass("hidden-by-jmp hidden-by-"+q).css("visibility","visible")}}function g(v,r){if(v){if(v.width()<j(window).width()){var u=(document.documentElement.offsetWidth-v.width())/2}else{var u=document.documentElement.scrollLeft+5}if(v.height()<j(window).height()){var t=document.documentElement.scrollTop+(j(window).height()-v.height())/2}else{var t=document.documentElement.scrollTop+5}var q={left:u+"px",top:t+"px"};if(!r){v.css(q)}else{v.animate(q,"slow")}f()}else{for(var s=0;s<e.length;s++){g(j("#popupLayer_"+e[s].name),true)}}}function d(q,w,v){var u="popupLayer_"+q.name;if(w){h();j("body").append("<div id='"+u+"'><!-- --></div>");var x=parseInt(e.length==1?1000:j("#popupLayer_"+e[e.length-2].name).css("z-index"))+2}else{var x=j("#"+u).css("z-index")}var y=j("#"+u);y.css({visibility:"hidden",width:q.width=="auto"?"":q.width+"px",height:q.height=="auto"?"":q.height+"px",position:"absolute","z-index":x});var t="<a href='#' class='jmp-link-at-top' style='position:absolute; left:-9999px; top:-1px;'>&nbsp;</a><input class='jmp-link-at-top' style='position:absolute; left:-9999px; top:-1px;' />";var r="<a href='#' class='jmp-link-at-bottom' style='position:absolute; left:-9999px; bottom:-1px;'>&nbsp;</a><input class='jmp-link-at-bottom' style='position:absolute; left:-9999px; top:-1px;' />";y.html(t+v+r);g(y);y.css("display","none");y.css("visibility","visible");if(w){y.fadeIn()}else{y.show()}j("#"+u+" .jmp-link-at-top, #"+u+" .jmp-link-at-bottom").focus(function(){j(c[c.length-1]).focus()});var s=j("#"+u+" a:visible:not(.jmp-link-at-top, .jmp-link-at-bottom), #"+u+" *:input:visible:not(.jmp-link-at-top, .jmp-link-at-bottom)");if(s.length==0){var z="<a href='#' class='jmp-link-inside-popup' style='position:absolute; left:-9999px;'>&nbsp;</a>";y.find(".jmp-link-at-top").after(z);c.push(j(y).find(".jmp-link-inside-popup")[0])}else{s.each(function(){if(!j(this).hasClass("jmp-link-at-top")&&!j(this).hasClass("jmp-link-at-bottom")){c.push(this);return false}})}j(c[c.length-1]).focus();q.success();if(q.reloadSuccess){q.reloadSuccess();q.reloadSuccess=null}}function m(q,r){if(r){e.push(q)}if(q.target!=""){d(q,r,j("#"+q.target).html())}else{j.ajax({url:q.url,data:q.parameters,cache:q.cache,dataType:"html",method:"GET",success:function(s){d(q,r,s)},error:q.error})}}j(window).resize(function(){f();g()});j(document).keydown(function(q){if(q.keyCode==27){j.closePopupLayer()}})})(jQuery);(function(c){c.fn.tipInput=function(d){var g=c(this);var e=g.attr("id");var f=g.attr("name");g.wrapAll('<div style="position:relative; display:inline-block; *display:inline; zoom:1;"></div>');g.before('<label  id="'+e+'Tip" for="'+f+'" >'+d+"</label>");var h=c("#"+e+"Tip");h.css("padding-top",g.css("padding-top")).css("padding-right",g.css("padding-right")).css("padding-bottom",g.css("padding-bottom")).css("padding-left",g.css("padding-left"));h.css("margin-top",g.css("margin-top")).css("margin-right",g.css("margin-right")).css("margin-bottom",g.css("margin-bottom")).css("margin-left",g.css("margin-left"));h.css("line-height",g.css("height"));h.css("position","absolute").css("left","0px").css("top","0px").css("color","#888888").css("cursor","text");if(g.val()||g.text()){h.hide()}g.focus(function(){h.hide()});g.blur(function(){if(g.val()||g.text()){h.hide()}else{h.show()}});h.click(function(){g.focus()})}})(jQuery);(function(c){c.fn.extend({autocomplete:function(d,e){var f=typeof d=="string";e=c.extend({},c.Autocompleter.defaults,{url:f?d:null,data:f?null:d,delay:f?c.Autocompleter.defaults.delay:10,max:e&&!e.scroll?10:150},e);e.highlight=e.highlight||function(g){return g};e.formatMatch=e.formatMatch||e.formatItem;return this.each(function(){new c.Autocompleter(this,e)})},result:function(d){return this.bind("result",d)},search:function(d){return this.trigger("search",[d])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(d){return this.trigger("setOptions",[d])},unautocomplete:function(){return this.trigger("unautocomplete")}});c.Autocompleter=function(p,j){var e={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var d=c(p).attr("autocomplete","off").addClass(j.inputClass);var n;var t="";var q=c.Autocompleter.Cache(j);var g=0;var y;var B={mouseDownOnSelect:false};var v=c.Autocompleter.Select(j,p,f,B);var A;c.browser.opera&&c(p.form).bind("submit.autocomplete",function(){if(A){A=false;return false}});d.bind((c.browser.opera?"keypress":"keydown")+".autocomplete",function(C){g=1;y=C.keyCode;switch(C.keyCode){case e.UP:C.preventDefault();if(v.visible()){v.prev()}else{x(0,true)}break;case e.DOWN:C.preventDefault();if(v.visible()){v.next()}else{x(0,true)}break;case e.PAGEUP:C.preventDefault();if(v.visible()){v.pageUp()}else{x(0,true)}break;case e.PAGEDOWN:C.preventDefault();if(v.visible()){v.pageDown()}else{x(0,true)}break;case j.multiple&&c.trim(j.multipleSeparator)==","&&e.COMMA:case e.TAB:case e.RETURN:if(f()){C.preventDefault();A=true;return false}break;case e.ESC:v.hide();break;default:clearTimeout(n);n=setTimeout(x,j.delay);break}}).focus(function(){g++}).blur(function(){g=0;if(!B.mouseDownOnSelect){w()}}).click(function(){if(g++>1&&!v.visible()){x(0,true)}}).bind("search",function(){var C=(arguments.length>1)?arguments[1]:null;function D(H,G){var E;if(G&&G.length){for(var F=0;F<G.length;F++){if(G[F].result.toLowerCase()==H.toLowerCase()){E=G[F];break}}}if(typeof C=="function"){C(E)}else{d.trigger("result",E&&[E.data,E.value])}}c.each(l(d.val()),function(E,F){h(F,D,D)})}).bind("flushCache",function(){q.flush()}).bind("setOptions",function(){c.extend(j,arguments[1]);if("data" in arguments[1]){q.populate()}}).bind("unautocomplete",function(){v.unbind();d.unbind();c(p.form).unbind(".autocomplete")});function f(){var F=v.selected();if(!F){return false}var C=F.result;t=C;if(j.multiple){var I=l(d.val());if(I.length>1){var E=j.multipleSeparator.length;var H=c(p).selection().start;var G,D=0;c.each(I,function(J,K){D+=K.length;if(H<=D){G=J;return false}D+=E});I[G]=C;C=I.join(j.multipleSeparator)}C+=j.multipleSeparator}d.val(C);z();d.trigger("result",[F.data,F.value]);return true}function x(E,D){if(y==e.DEL){v.hide();return}var C=d.val();if(!D&&C==t){return}t=C;C=m(C);if(C.length>=j.minChars){d.addClass(j.loadingClass);if(!j.matchCase){C=C.toLowerCase()}h(C,o,z)}else{r();v.hide()}}function l(C){if(!C){return[""]}if(!j.multiple){return[c.trim(C)]}return c.map(C.split(j.multipleSeparator),function(D){return c.trim(C).length?c.trim(D):null})}function m(C){if(!j.multiple){return C}var E=l(C);if(E.length==1){return E[0]}var D=c(p).selection().start;if(D==C.length){E=l(C)}else{E=l(C.replace(C.substring(D),""))}return E[E.length-1]}function u(C,D){if(j.autoFill&&(m(d.val()).toLowerCase()==C.toLowerCase())&&y!=e.BACKSPACE){d.val(d.val()+D.substring(m(t).length));c(p).selection(t.length,t.length+D.length)}}function w(){clearTimeout(n);n=setTimeout(z,200)}function z(){var C=v.visible();v.hide();clearTimeout(n);r();if(j.mustMatch){d.search(function(D){if(!D){if(j.multiple){var E=l(d.val()).slice(0,-1);d.val(E.join(j.multipleSeparator)+(E.length?j.multipleSeparator:""))}else{d.val("");d.trigger("result",null)}}})}}function o(D,C){if(C&&C.length&&g){r();v.display(C,D);u(D,C[0].value);v.show()}else{z()}}function h(D,F,C){if(!j.matchCase){D=D.toLowerCase()}var E=q.load(D);if(E&&E.length){F(D,E)}else{if((typeof j.url=="string")&&(j.url.length>0)){var G={timestamp:+new Date()};c.each(j.extraParams,function(H,I){G[H]=typeof I=="function"?I():I});c.ajax({mode:"abort",port:"autocomplete"+p.name,dataType:j.dataType,url:j.url,data:c.extend({q:m(D),limit:j.max},G),success:function(I){var H=j.parse&&j.parse(I)||s(I);q.add(D,H);F(D,H)}})}else{v.emptyList();C(D)}}}function s(F){var C=[];var E=F.split("\n");for(var D=0;D<E.length;D++){var G=c.trim(E[D]);if(G){G=G.split("|");C[C.length]={data:G,value:G[0],result:j.formatResult&&j.formatResult(G,G[0])||G[0]}}}return C}function r(){d.removeClass(j.loadingClass)}};c.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(d){return d[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(e,d){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180};c.Autocompleter.Cache=function(e){var h={};var f=0;function l(o,n){if(!e.matchCase){o=o.toLowerCase()}var m=o.indexOf(n);if(e.matchContains=="word"){m=o.toLowerCase().search("\\b"+n.toLowerCase())}if(m==-1){return false}return m==0||e.matchContains}function j(n,m){if(f>e.cacheLength){d()}if(!h[n]){f++}h[n]=m}function g(){if(!e.data){return false}var n={},m=0;if(!e.url){e.cacheLength=1}n[""]=[];for(var p=0,o=e.data.length;p<o;p++){var s=e.data[p];s=(typeof s=="string")?[s]:s;var r=e.formatMatch(s,p+1,e.data.length);if(r===false){continue}var q=r.charAt(0).toLowerCase();if(!n[q]){n[q]=[]}var t={value:r,data:s,result:e.formatResult&&e.formatResult(s)||r};n[q].push(t);if(m++<e.max){n[""].push(t)}}c.each(n,function(u,v){e.cacheLength++;j(u,v)})}setTimeout(g,25);function d(){h={};f=0}return{flush:d,add:j,populate:g,load:function(p){if(!e.cacheLength||!f){return null}if(!e.url&&e.matchContains){var o=[];for(var m in h){if(m.length>0){var r=h[m];c.each(r,function(s,q){if(l(q.value,p)){o.push(q)}})}}return o}else{if(h[p]){return h[p]}else{if(e.matchSubset){for(var n=p.length-1;n>=e.minChars;n--){var r=h[p.substr(0,n)];if(r){var o=[];c.each(r,function(s,q){if(l(q.value,p)){o[o.length]=q}});return o}}}}}return null}}};c.Autocompleter.Select=function(g,n,p,t){var m={ACTIVE:"ac_over"};var o,h=-1,v,q="",w=true,e,s;function r(){if(!w){return}e=c("<div/>").hide().addClass(g.resultsClass).css("position","absolute").appendTo(document.body);s=c("<ul/>").appendTo(e).mouseover(function(x){if(u(x).nodeName&&u(x).nodeName.toUpperCase()=="LI"){h=c("li",s).removeClass(m.ACTIVE).index(u(x));c(u(x)).addClass(m.ACTIVE)}}).click(function(x){c(u(x)).addClass(m.ACTIVE);p();n.focus();return false}).mousedown(function(){t.mouseDownOnSelect=true}).mouseup(function(){t.mouseDownOnSelect=false});if(g.width>0){e.css("width",g.width)}w=false}function u(y){var x=y.target;while(x&&x.tagName!="LI"){x=x.parentNode}if(!x){return[]}return x}function l(x){o.slice(h,h+1).removeClass(m.ACTIVE);j(x);var z=o.slice(h,h+1).addClass(m.ACTIVE);if(g.scroll){var y=0;o.slice(0,h).each(function(){y+=this.offsetHeight});if((y+z[0].offsetHeight-s.scrollTop())>s[0].clientHeight){s.scrollTop(y+z[0].offsetHeight-s.innerHeight())}else{if(y<s.scrollTop()){s.scrollTop(y)}}}}function j(x){h+=x;if(h<0){h=o.size()-1}else{if(h>=o.size()){h=0}}}function d(x){return g.max&&g.max<x?g.max:x}function f(){s.empty();var y=d(v.length);for(var z=0;z<y;z++){if(!v[z]){continue}var A=g.formatItem(v[z].data,z+1,y,v[z].value,q);if(A===false){continue}var x=c("<li/>").html(g.highlight(A,q)).addClass(z%2==0?"ac_even":"ac_odd").appendTo(s)[0];c.data(x,"ac_data",v[z])}o=s.find("li");if(g.selectFirst){o.slice(0,1).addClass(m.ACTIVE);h=0}if(c.fn.bgiframe){s.bgiframe()}}return{display:function(y,x){r();v=y;q=x;f()},next:function(){l(1)},prev:function(){l(-1)},pageUp:function(){if(h!=0&&h-8<0){l(-h)}else{l(-8)}},pageDown:function(){if(h!=o.size()-1&&h+8>o.size()){l(o.size()-1-h)}else{l(8)}},hide:function(){e&&e.hide();o&&o.removeClass(m.ACTIVE);h=-1},visible:function(){return e&&e.is(":visible")},current:function(){return this.visible()&&(o.filter("."+m.ACTIVE)[0]||g.selectFirst&&o[0])},show:function(){var z=c(n).offset();e.css({width:typeof g.width=="string"||g.width>0?g.width:c(n).width(),top:z.top+n.offsetHeight,left:z.left}).show();if(g.scroll){s.scrollTop(0);s.css({maxHeight:g.scrollHeight,overflow:"auto"});if(c.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var x=0;o.each(function(){x+=this.offsetHeight});var y=x>g.scrollHeight;s.css("height",y?g.scrollHeight:x);if(!y){o.width(s.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right")))}}}},selected:function(){var x=o&&o.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return x&&x.length&&c.data(x[0],"ac_data")},emptyList:function(){s&&s.empty()},unbind:function(){e&&e.remove()}}};c.fn.selection=function(m,d){if(m!==undefined){return this.each(function(){if(this.createTextRange){var n=this.createTextRange();if(d===undefined||m==d){n.move("character",m);n.select()}else{n.collapse(true);n.moveStart("character",m);n.moveEnd("character",d);n.select()}}else{if(this.setSelectionRange){this.setSelectionRange(m,d)}else{if(this.selectionStart){this.selectionStart=m;this.selectionEnd=d}}}})}var j=this[0];if(j.createTextRange){var e=document.selection.createRange(),l=j.value,h="<->",f=e.text.length;e.text=h;var g=j.value.indexOf(h);j.value=l;this.selection(g,g+f);return{start:g,end:g+f}}else{if(j.selectionStart!==undefined){return{start:j.selectionStart,end:j.selectionEnd}}}}})(jQuery);jQuery.ui||(function(e){var m=e.fn.remove,f=e.browser.mozilla&&(parseFloat(e.browser.version)<1.9);e.ui={version:"1.7.2",plugin:{add:function(o,p,r){var q=e.ui[o].prototype;for(var n in r){q.plugins[n]=q.plugins[n]||[];q.plugins[n].push([p,r[n]])}},call:function(n,p,o){var r=n.plugins[p];if(!r||!n.element[0].parentNode){return}for(var q=0;q<r.length;q++){if(n.options[r[q][0]]){r[q][1].apply(n.element,o)}}}},contains:function(o,n){return document.compareDocumentPosition?o.compareDocumentPosition(n)&16:o!==n&&o.contains(n)},hasScroll:function(q,o){if(e(q).css("overflow")=="hidden"){return false}var n=(o&&o=="left")?"scrollLeft":"scrollTop",p=false;if(q[n]>0){return true}q[n]=1;p=(q[n]>0);q[n]=0;return p},isOverAxis:function(o,n,p){return(o>n)&&(o<(n+p))},isOver:function(s,o,r,q,n,p){return e.ui.isOverAxis(s,r,n)&&e.ui.isOverAxis(o,q,p)},keyCode:{BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38}};if(f){var h=e.attr,g=e.fn.removeAttr,l="http://www.w3.org/2005/07/aaa",c=/^aria-/,d=/^wairole:/;e.attr=function(o,n,p){var q=p!==undefined;return(n=="role"?(q?h.call(this,o,n,"wairole:"+p):(h.apply(this,arguments)||"").replace(d,"")):(c.test(n)?(q?o.setAttributeNS(l,n.replace(c,"aaa:"),p):h.call(this,o,n.replace(c,"aaa:"))):h.apply(this,arguments)))};e.fn.removeAttr=function(n){return(c.test(n)?this.each(function(){this.removeAttributeNS(l,n.replace(c,""))}):g.call(this,n))}}e.fn.extend({remove:function(){e("*",this).add(this).each(function(){e(this).triggerHandler("remove")});return m.apply(this,arguments)},enableSelection:function(){return this.attr("unselectable","off").css("MozUserSelect","").unbind("selectstart.ui")},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})},scrollParent:function(){var n;if((e.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){n=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(e.curCSS(this,"position",1))&&(/(auto|scroll)/).test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0)}else{n=this.parents().filter(function(){return(/(auto|scroll)/).test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!n.length?e(document):n}});e.extend(e.expr[":"],{data:function(p,o,n){return !!e.data(p,n[3])},focusable:function(o){var p=o.nodeName.toLowerCase(),n=e.attr(o,"tabindex");return(/input|select|textarea|button|object/.test(p)?!o.disabled:"a"==p||"area"==p?o.href||!isNaN(n):!isNaN(n))&&!e(o)["area"==p?"parents":"closest"](":hidden").length},tabbable:function(o){var n=e.attr(o,"tabindex");return(isNaN(n)||n>=0)&&e(o).is(":focusable")}});function j(q,r,s,p){function o(u){var t=e[q][r][u]||[];return(typeof t=="string"?t.split(/,?\s+/):t)}var n=o("getter");if(p.length==1&&typeof p[0]=="string"){n=n.concat(o("getterSetter"))}return(e.inArray(s,n)!=-1)}e.widget=function(o,n){var p=o.split(".")[0];o=o.split(".")[1];e.fn[o]=function(t){var r=(typeof t=="string"),s=Array.prototype.slice.call(arguments,1);if(r&&t.substring(0,1)=="_"){return this}if(r&&j(p,o,t,s)){var q=e.data(this[0],o);return(q?q[t].apply(q,s):undefined)}return this.each(function(){var u=e.data(this,o);(!u&&!r&&e.data(this,o,new e[p][o](this,t))._init());(u&&r&&e.isFunction(u[t])&&u[t].apply(u,s))})};e[p]=e[p]||{};e[p][o]=function(s,r){var q=this;this.namespace=p;this.widgetName=o;this.widgetEventPrefix=e[p][o].eventPrefix||o;this.widgetBaseClass=p+"-"+o;this.options=e.extend({},e.widget.defaults,e[p][o].defaults,e.metadata&&e.metadata.get(s)[o],r);this.element=e(s).bind("setData."+o,function(u,t,v){if(u.target==s){return q._setData(t,v)}}).bind("getData."+o,function(u,t){if(u.target==s){return q._getData(t)}}).bind("remove",function(){return q.destroy()})};e[p][o].prototype=e.extend({},e.widget.prototype,n);e[p][o].getterSetter="option"};e.widget.prototype={_init:function(){},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled")},option:function(p,q){var o=p,n=this;if(typeof p=="string"){if(q===undefined){return this._getData(p)}o={};o[p]=q}e.each(o,function(r,s){n._setData(r,s)})},_getData:function(n){return this.options[n]},_setData:function(n,o){this.options[n]=o;if(n=="disabled"){this.element[o?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",o)}},enable:function(){this._setData("disabled",false)},disable:function(){this._setData("disabled",true)},_trigger:function(p,q,r){var t=this.options[p],n=(p==this.widgetEventPrefix?p:this.widgetEventPrefix+p);q=e.Event(q);q.type=n;if(q.originalEvent){for(var o=e.event.props.length,s;o;){s=e.event.props[--o];q[s]=q.originalEvent[s]}}this.element.trigger(q,r);return !(e.isFunction(t)&&t.call(this.element[0],q,r)===false||q.isDefaultPrevented())}};e.widget.defaults={disabled:false};e.ui.mouse={_mouseInit:function(){var n=this;this.element.bind("mousedown."+this.widgetName,function(o){return n._mouseDown(o)}).bind("click."+this.widgetName,function(o){if(n._preventClickEvent){n._preventClickEvent=false;o.stopImmediatePropagation();return false}});if(e.browser.msie){this._mouseUnselectable=this.element.attr("unselectable");this.element.attr("unselectable","on")}this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);(e.browser.msie&&this.element.attr("unselectable",this._mouseUnselectable))},_mouseDown:function(p){p.originalEvent=p.originalEvent||{};if(p.originalEvent.mouseHandled){return}(this._mouseStarted&&this._mouseUp(p));this._mouseDownEvent=p;var o=this,q=(p.which==1),n=(typeof this.options.cancel=="string"?e(p.target).parents().add(p.target).filter(this.options.cancel).length:false);if(!q||n||!this._mouseCapture(p)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){o.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(p)&&this._mouseDelayMet(p)){this._mouseStarted=(this._mouseStart(p)!==false);if(!this._mouseStarted){p.preventDefault();return true}}this._mouseMoveDelegate=function(r){return o._mouseMove(r)};this._mouseUpDelegate=function(r){return o._mouseUp(r)};e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);(e.browser.safari||p.preventDefault());p.originalEvent.mouseHandled=true;return true},_mouseMove:function(n){if(e.browser.msie&&!n.button){return this._mouseUp(n)}if(this._mouseStarted){this._mouseDrag(n);return n.preventDefault()}if(this._mouseDistanceMet(n)&&this._mouseDelayMet(n)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,n)!==false);(this._mouseStarted?this._mouseDrag(n):this._mouseUp(n))}return !this._mouseStarted},_mouseUp:function(n){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=(n.target==this._mouseDownEvent.target);this._mouseStop(n)}return false},_mouseDistanceMet:function(n){return(Math.max(Math.abs(this._mouseDownEvent.pageX-n.pageX),Math.abs(this._mouseDownEvent.pageY-n.pageY))>=this.options.distance)},_mouseDelayMet:function(n){return this.mouseDelayMet},_mouseStart:function(n){},_mouseDrag:function(n){},_mouseStop:function(n){},_mouseCapture:function(n){return true}};e.ui.mouse.defaults={cancel:null,distance:1,delay:0}})(jQuery);if(dwr==null){var dwr={}}if(dwr.util==null){dwr.util={}}if(DWRUtil==null){var DWRUtil=dwr.util}dwr.util._escapeHtml=true;dwr.util.setEscapeHtml=function(c){dwr.util._escapeHtml=c};dwr.util._shouldEscapeHtml=function(c){if(c&&c.escapeHtml!=null){return c.escapeHtml}return dwr.util._escapeHtml};dwr.util.escapeHtml=function(c){var e=document.createElement("div");var d=document.createTextNode(c);e.appendChild(d);return e.innerHTML};dwr.util.unescapeHtml=function(c){var d=document.createElement("div");d.innerHTML=c.replace(/<\/?[^>]+>/gi,"");return d.childNodes[0]?d.childNodes[0].nodeValue:""};dwr.util.replaceXmlCharacters=function(c){c=c.replace("&","+");c=c.replace("<","\u2039");c=c.replace(">","\u203A");c=c.replace("'","\u2018");c=c.replace('"',"\u201C");return c};dwr.util.containsXssRiskyCharacters=function(c){return(c.indexOf("&")!=-1||c.indexOf("<")!=-1||c.indexOf(">")!=-1||c.indexOf("'")!=-1||c.indexOf('"')!=-1)};dwr.util.onReturn=function(c,d){if(!c){c=window.event}if(c&&c.keyCode&&c.keyCode==13){d()}};dwr.util.selectRange=function(f,g,c){try{f=dwr.util._getElementById(f,"selectRange()");if(f==null){return}if(f.setSelectionRange){f.setSelectionRange(g,c)}else{if(f.createTextRange){var d=f.createTextRange();d.moveStart("character",g);d.moveEnd("character",c-f.value.length);d.select()}}f.focus()}catch(e){}};if(document.getElementById){dwr.util.byId=function(){var e=new Array();for(var d=0;d<arguments.length;d++){var c=arguments[d];if(typeof c=="string"){c=document.getElementById(c)}if(arguments.length==1){return c}e.push(c)}return e}}else{if(document.all){dwr.util.byId=function(){var e=new Array();for(var d=0;d<arguments.length;d++){var c=arguments[d];if(typeof c=="string"){c=document.all[c]}if(arguments.length==1){return c}e.push(c)}return e}}}var $;if(!$){$=dwr.util.byId}dwr.util.toDescriptiveString=function(h,c,n){if(c===undefined){c=1}var e={};if(dwr.util._isObject(n)){e=n}var l={escapeHtml:false,baseIndent:"",childIndent:"\u00A0\u00A0",lineTerminator:"\n",oneLineMaxItems:5,shortStringMaxLength:13,propertyNameMaxLength:30};for(var d in l){if(!(d in e)){e[d]=l[d]}}if(typeof n=="number"){var j=n;e.baseIndent=dwr.util._indent2(j,e)}var m={document:true,ownerDocument:true,all:true,parentElement:true,parentNode:true,offsetParent:true,children:true,firstChild:true,lastChild:true,previousSibling:true,nextSibling:true,innerHTML:true,outerHTML:true,innerText:true,outerText:true,textContent:true,attributes:true,style:true,currentStyle:true,runtimeStyle:true,parentTextEdit:true};function g(u,o,q,B){var r="";try{if(typeof u=="string"){var x=u;if(o==0&&x.length>B.shortStringMaxLength){x=x.substring(0,B.shortStringMaxLength-3)+"..."}if(B.escapeHtml){var C=x.split("\n");for(var v=0;v<C.length;v++){C[v]=dwr.util.escapeHtml(C[v])}x=C.join("\n")}if(o==0){x=x.replace(/\n|\r|\t/g,function(D){switch(D){case"\n":return"\\n";case"\r":return"";case"\t":return"\\t"}})}else{x=x.replace(/\n|\r|\t/g,function(D){switch(D){case"\n":return B.lineTerminator+f(q+1,B);case"\r":return"";case"\t":return"\\t"}})}r='"'+x+'"'}else{if(typeof u=="function"){r="function"}else{if(dwr.util._isArray(u)){if(o==0){if(u.length>0){r="[...]"}else{r="[]"}}else{var A=[];A.push("[");var w=0;for(var v=0;v<u.length;v++){if(!(v in u)){continue}var y=u[v];if(w>0){A.push(", ")}if(o==1){if(w==B.oneLineMaxItems){A.push("...");break}}else{A.push(B.lineTerminator+f(q+1,B))}if(v!=w){A.push(v);A.push(":")}A.push(g(y,o-1,q+1,B));w++}if(o>1){A.push(B.lineTerminator+f(q,B))}A.push("]");r=A.join("")}}else{if(dwr.util._isObject(u)&&!dwr.util._isDate(u)){if(o==0){r=dwr.util._detailedTypeOf(u)}else{var A=[];if(dwr.util._detailedTypeOf(u)!="Object"){A.push(dwr.util._detailedTypeOf(u));if(typeof u.valueOf()!="object"){A.push(":");A.push(g(u.valueOf(),1,q,B))}A.push(" ")}A.push("{");var z=dwr.util._isHTMLElement(u);var w=0;for(var p in u){var t=u[p];if(z){if(!t){continue}if(typeof t=="function"){continue}if(m[p]){continue}if(p.toUpperCase()==p){continue}}if(w>0){A.push(", ")}if(o==1){if(w==B.oneLineMaxItems){A.push("...");break}}else{A.push(B.lineTerminator+f(q+1,B))}A.push(p.length>B.propertyNameMaxLength?p.substring(0,B.propertyNameMaxLength-3)+"...":p);A.push(":");A.push(g(t,o-1,q+1,B));w++}if(o>1&&w>0){A.push(B.lineTerminator+f(q,B))}A.push("}");r=A.join("")}}else{r=""+u}}}}return r}catch(s){return(s.message?s.message:""+s)}}function f(q,o){var r=[];r.push(o.baseIndent);for(var p=0;p<q;p++){r.push(o.childIndent)}return r.join("")}return g(h,c,0,e)};dwr.util.useLoadingMessage=function(c){var d;if(c){d=c}else{d="Loading"}dwr.engine.setPreHook(function(){var f=dwr.util.byId("disabledZone");if(!f){f=document.createElement("div");f.setAttribute("id","disabledZone");f.style.position="absolute";f.style.zIndex="1000";f.style.top="0px";f.style.right="0px";document.body.appendChild(f);var e=document.createElement("div");e.setAttribute("id","messageZone");e.style.position="absolute";e.style.top="0px";e.style.right="0px";e.style.width="80px";e.style.background="red";e.style.color="white";e.style.fontFamily="Arial,Helvetica,sans-serif";e.style.padding="4px";f.appendChild(e);var g=document.createTextNode(d);e.appendChild(g);dwr.util._disabledZoneUseCount=1}else{dwr.util.byId("messageZone").innerHTML=d;f.style.visibility="visible";dwr.util._disabledZoneUseCount++}});dwr.engine.setPostHook(function(){dwr.util._disabledZoneUseCount--;if(dwr.util._disabledZoneUseCount==0){dwr.util.byId("disabledZone").style.visibility="hidden"}else{dwr.util.byId("disabledZone").style.visibility="hidden"}})};dwr.util.setHighlightHandler=function(c){dwr.util._highlightHandler=c};dwr.util.yellowFadeHighlightHandler=function(c){dwr.util._yellowFadeProcess(c,0)};dwr.util._yellowFadeSteps=["d0","b0","a0","90","98","a0","a8","b0","b8","c0","c8","d0","d8","e0","e8","f0","f8"];dwr.util._yellowFadeProcess=function(c,d){c=dwr.util.byId(c);if(d<dwr.util._yellowFadeSteps.length){c.style.backgroundColor="#ffff"+dwr.util._yellowFadeSteps[d];setTimeout("dwr.util._yellowFadeProcess('"+c.id+"',"+(d+1)+")",200)}else{c.style.backgroundColor="transparent"}};dwr.util.borderFadeHighlightHandler=function(c){c.style.borderWidth="2px";c.style.borderStyle="solid";dwr.util._borderFadeProcess(c,0)};dwr.util._borderFadeSteps=["d0","b0","a0","90","98","a0","a8","b0","b8","c0","c8","d0","d8","e0","e8","f0","f8"];dwr.util._borderFadeProcess=function(c,d){c=dwr.util.byId(c);if(d<dwr.util._borderFadeSteps.length){c.style.borderColor="#ff"+dwr.util._borderFadeSteps[d]+dwr.util._borderFadeSteps[d];setTimeout("dwr.util._borderFadeProcess('"+c.id+"',"+(d+1)+")",200)}else{c.style.backgroundColor="transparent"}};dwr.util.focusHighlightHandler=function(d){try{d.focus()}catch(c){}};dwr.util._highlightHandler=null;dwr.util.highlight=function(d,c){if(c&&c.highlightHandler){c.highlightHandler(dwr.util.byId(d))}else{if(dwr.util._highlightHandler!=null){dwr.util._highlightHandler(dwr.util.byId(d))}}};dwr.util.setValue=function(h,l,e){if(l==null){l=""}if(e==null){e={}}if(dwr.util._shouldEscapeHtml(e)&&typeof(l)=="string"){l=dwr.util.escapeHtml(l)}var m=h;if(typeof h=="string"){h=dwr.util.byId(h);if(h&&h.id!=m){h=null}}var c=null;if(h==null){c=document.getElementsByName(m);if(c.length>=1){h=c.item(0)}}if(h==null){dwr.util._debug("setValue() can't find an element with id/name: "+m+".");return}dwr.util.highlight(h,e);if(dwr.util._isHTMLElement(h,"select")){if(h.type=="select-multiple"&&dwr.util._isArray(l)){dwr.util._selectListItems(h,l)}else{dwr.util._selectListItem(h,l)}return}if(dwr.util._isHTMLElement(h,"input")){if(h.type=="radio"||h.type=="checkbox"){if(c&&c.length>=1){for(var f=0;f<c.length;f++){var g=c.item(f);if(g.type!=h.type){continue}if(dwr.util._isArray(l)){g.checked=false;for(var d=0;d<l.length;d++){if(l[f]==g.value){g.checked=true}}}else{g.checked=(g.value==l)}}}else{h.checked=(l==true)}}else{h.value=l}return}if(dwr.util._isHTMLElement(h,"textarea")){h.value=l;return}if(l.nodeType){if(l.nodeType==9){l=l.documentElement}l=dwr.util._importNode(h.ownerDocument,l,true);h.appendChild(l);return}h.innerHTML=l};dwr.util._selectListItems=function(f,g){var e=false;var d;var c;for(d=0;d<f.options.length;d++){f.options[d].selected=false;for(c=0;c<g.length;c++){if(f.options[d].value==g[c]){f.options[d].selected=true}}}if(e){return}for(d=0;d<f.options.length;d++){for(c=0;c<g.length;c++){if(f.options[d].text==g[c]){f.options[d].selected=true}}}};dwr.util._selectListItem=function(e,f){var d=false;var c;for(c=0;c<e.options.length;c++){if(e.options[c].value==f){e.options[c].selected=true;d=true}else{e.options[c].selected=false}}if(d){return}for(c=0;c<e.options.length;c++){if(e.options[c].text==f){e.options[c].selected=true}else{e.options[c].selected=false}}};dwr.util.getValue=function(m,n){if(n==null){n={}}var j=m;if(typeof m=="string"){m=dwr.util.byId(m);if(m&&m.id!=j){m=null}}var c=null;if(m==null){c=document.getElementsByName(j);if(c.length>=1){m=c.item(0)}}if(m==null){dwr.util._debug("getValue() can't find an element with id/name: "+j+".");return""}if(dwr.util._isHTMLElement(m,"select")){if(m.type=="select-multiple"){var f=new Array();for(var h=0;h<m.options.length;h++){var l=m.options[h];if(l.selected){var g=l.getAttributeNode("value");if(g&&g.specified){f.push(l.value)}else{f.push(l.text)}}}return f}else{var d=m.selectedIndex;if(d!=-1){var l=m.options[d];var g=l.getAttributeNode("value");if(g&&g.specified){return l.value}return l.text}else{return""}}}if(dwr.util._isHTMLElement(m,"input")){if(m.type=="radio"){if(c&&c.length>=1){for(var h=0;h<c.length;h++){var e=c.item(h);if(e.type==m.type){if(e.checked){return e.value}}}}return m.checked}if(m.type=="checkbox"){if(c&&c.length>=1){var f=[];for(var h=0;h<c.length;h++){var e=c.item(h);if(e.type==m.type){if(e.checked){f.push(e.value)}}}return f}return m.checked}return m.value}if(dwr.util._isHTMLElement(m,"textarea")){return m.value}if(dwr.util._shouldEscapeHtml(n)){if(m.textContent){return m.textContent}else{if(m.innerText){return m.innerText}}}return m.innerHTML};dwr.util.getText=function(d){d=dwr.util._getElementById(d,"getText()");if(d==null){return null}if(!dwr.util._isHTMLElement(d,"select")){dwr.util._debug("getText() can only be used with select elements. Attempt to use: "+dwr.util._detailedTypeOf(d)+" from  id: "+orig+".");return""}var c=d.selectedIndex;if(c!=-1){return d.options[c].text}else{return""}};dwr.util.setValues=function(e,c){var d="";if(c&&c.prefix){d=c.prefix}if(c&&c.idPrefix){d=c.idPrefix}dwr.util._setValuesRecursive(e,d)};dwr.util._setValuesRecursive=function(e,g){if(dwr.util._isArray(e)&&e.length>0&&dwr.util._isObject(e[0])){for(var d=0;d<e.length;d++){dwr.util._setValuesRecursive(e[d],g+"["+d+"]")}}else{if(dwr.util._isObject(e)&&!dwr.util._isArray(e)){for(var f in e){var c=g?g+"."+f:f;if(dwr.util._isObject(e[f])&&!dwr.util._isArray(e[f])||dwr.util._isArray(e[f])&&e[f].length>0&&dwr.util._isObject(e[f][0])){dwr.util._setValuesRecursive(e[f],c)}else{if(typeof e[f]=="function"){}else{if(dwr.util.byId(c)!=null||document.getElementsByName(c).length>=1){dwr.util.setValue(c,e[f])}}}}}}};dwr.util.getValues=function(e,c){if(typeof e=="string"||dwr.util._isHTMLElement(e)){return dwr.util.getFormValues(e)}else{var d="";if(c!=null&&c.prefix){d=c.prefix}if(c!=null&&c.idPrefix){d=c.idPrefix}dwr.util._getValuesRecursive(e,d);return e}};dwr.util.getFormValues=function(c){var h=null;if(typeof c=="string"){h=document.forms[c];if(h==null){h=dwr.util.byId(c)}}else{if(dwr.util._isHTMLElement(c)){h=c}}if(h!=null){if(h.elements==null){alert("getFormValues() requires an object or reference to a form element.");return null}var f={};var d;var g;for(var e=0;e<h.elements.length;e++){if(h[e].type in {button:0,submit:0,reset:0,image:0,file:0}){continue}if(h[e].name){d=h[e].name;g=dwr.util.getValue(d)}else{if(h[e].id){d=h[e].id}else{d="element"+e}g=dwr.util.getValue(h[e])}f[d]=g}return f}};dwr.util._getValuesRecursive=function(e,g){if(dwr.util._isArray(e)&&e.length>0&&dwr.util._isObject(e[0])){for(var d=0;d<e.length;d++){dwr.util._getValuesRecursive(e[d],g+"["+d+"]")}}else{if(dwr.util._isObject(e)&&!dwr.util._isArray(e)){for(var f in e){var c=g?g+"."+f:f;if(dwr.util._isObject(e[f])&&!dwr.util._isArray(e[f])||dwr.util._isArray(e[f])&&e[f].length>0&&dwr.util._isObject(e[f][0])){dwr.util._getValuesRecursive(e[f],c)}else{if(typeof e[f]=="function"){}else{if(dwr.util.byId(c)!=null||document.getElementsByName(c).length>=1){e[f]=dwr.util.getValue(c)}}}}}}};dwr.util.addOptions=function(r,h){r=dwr.util._getElementById(r,"addOptions()");if(r==null){return}var e=dwr.util._isHTMLElement(r,"select");var m=dwr.util._isHTMLElement(r,["ul","ol"]);if(!e&&!m){dwr.util._debug("addOptions() can only be used with select/ul/ol elements. Attempt to use: "+dwr.util._detailedTypeOf(r));return}if(h==null){return}var l=arguments.length;var s={};var q=arguments[l-1];if(l>2&&dwr.util._isObject(q)){s=q;l--}var j=null;if(l>=3){j=arguments[2]}var f=null;if(l>=4){f=arguments[3]}if(!s.optionCreator&&e){s.optionCreator=dwr.util._defaultOptionCreator}if(!s.optionCreator&&m){s.optionCreator=dwr.util._defaultListItemCreator}var p,n,o;if(dwr.util._isArray(h)){for(var g=0;g<h.length;g++){s.data=h[g];s.text=null;s.value=null;if(e){if(j!=null){if(f!=null){s.text=dwr.util._getValueFrom(h[g],f);s.value=dwr.util._getValueFrom(h[g],j)}else{s.text=s.value=dwr.util._getValueFrom(h[g],j)}}else{s.text=s.value=dwr.util._getValueFrom(h[g])}if(s.text!=null||s.value){var d=s.optionCreator(s);d.text=s.text;d.value=s.value;r.options[r.options.length]=d}}else{s.value=dwr.util._getValueFrom(h[g],j);if(s.value!=null){o=s.optionCreator(s);if(dwr.util._shouldEscapeHtml(s)){s.value=dwr.util.escapeHtml(s.value)}o.innerHTML=s.value;r.appendChild(o)}}}}else{if(f!=null){if(!e){alert("dwr.util.addOptions can only create select lists from objects.");return}for(var c in h){s.data=h[c];s.value=dwr.util._getValueFrom(h[c],j);s.text=dwr.util._getValueFrom(h[c],f);if(s.text!=null||s.value){var d=s.optionCreator(s);d.text=s.text;d.value=s.value;r.options[r.options.length]=d}}}else{if(!e){dwr.util._debug("dwr.util.addOptions can only create select lists from objects.");return}for(var c in h){s.data=h[c];if(!j){s.value=c;s.text=h[c]}else{s.value=h[c];s.text=c}if(s.text!=null||s.value){var d=s.optionCreator(s);d.text=s.text;d.value=s.value;r.options[r.options.length]=d}}}}dwr.util.highlight(r,s)};dwr.util._getValueFrom=function(c,d){if(d==null){return c}else{if(typeof d=="function"){return d(c)}else{return c[d]}}};dwr.util._defaultOptionCreator=function(c){return new Option()};dwr.util._defaultListItemCreator=function(c){return document.createElement("li")};dwr.util.removeAllOptions=function(d){d=dwr.util._getElementById(d,"removeAllOptions()");if(d==null){return}var c=dwr.util._isHTMLElement(d,"select");var e=dwr.util._isHTMLElement(d,["ul","ol"]);if(!c&&!e){dwr.util._debug("removeAllOptions() can only be used with select, ol and ul elements. Attempt to use: "+dwr.util._detailedTypeOf(d));return}if(c){d.options.length=0}else{while(d.childNodes.length>0){d.removeChild(d.firstChild)}}};dwr.util.addRows=function(g,f,c,d){g=dwr.util._getElementById(g,"addRows()");if(g==null){return}if(!dwr.util._isHTMLElement(g,["table","tbody","thead","tfoot"])){dwr.util._debug("addRows() can only be used with table, tbody, thead and tfoot elements. Attempt to use: "+dwr.util._detailedTypeOf(g));return}if(!d){d={}}if(!d.rowCreator){d.rowCreator=dwr.util._defaultRowCreator}if(!d.cellCreator){d.cellCreator=dwr.util._defaultCellCreator}var e,h;if(dwr.util._isArray(f)){for(h=0;h<f.length;h++){d.rowData=f[h];d.rowIndex=h;d.rowNum=h;d.data=null;d.cellNum=-1;e=dwr.util._addRowInner(c,d);if(e!=null){g.appendChild(e)}}}else{if(typeof f=="object"){h=0;for(var j in f){d.rowData=f[j];d.rowIndex=j;d.rowNum=h;d.data=null;d.cellNum=-1;e=dwr.util._addRowInner(c,d);if(e!=null){g.appendChild(e)}h++}}}dwr.util.highlight(g,d)};dwr.util._addRowInner=function(c,d){var f=d.rowCreator(d);if(f==null){return null}for(var g=0;g<c.length;g++){var e=c[g];if(typeof e=="function"){d.data=e(d.rowData,d)}else{d.data=e||""}d.cellNum=g;var h=d.cellCreator(d);if(h!=null){if(d.data!=null){if(dwr.util._isHTMLElement(d.data)){h.appendChild(d.data)}else{if(dwr.util._shouldEscapeHtml(d)&&typeof(d.data)=="string"){h.innerHTML=dwr.util.escapeHtml(d.data)}else{h.innerHTML=d.data}}}f.appendChild(h)}}return f};dwr.util._defaultRowCreator=function(c){return document.createElement("tr")};dwr.util._defaultCellCreator=function(c){return document.createElement("td")};dwr.util.removeAllRows=function(e,c){e=dwr.util._getElementById(e,"removeAllRows()");if(e==null){return}if(!c){c={}}if(!c.filter){c.filter=function(){return true}}if(!dwr.util._isHTMLElement(e,["table","tbody","thead","tfoot"])){dwr.util._debug("removeAllRows() can only be used with table, tbody, thead and tfoot elements. Attempt to use: "+dwr.util._detailedTypeOf(e));return}var f=e.firstChild;var d;while(f!=null){d=f.nextSibling;if(c.filter(f)){e.removeChild(f)}f=d}};dwr.util.setClassName=function(d,c){d=dwr.util._getElementById(d,"setClassName()");if(d==null){return}d.className=c};dwr.util.addClassName=function(d,c){d=dwr.util._getElementById(d,"addClassName()");if(d==null){return}d.className+=" "+c};dwr.util.removeClassName=function(e,c){e=dwr.util._getElementById(e,"removeClassName()");if(e==null){return}var d=new RegExp("(^|\\s)"+c+"(\\s|$)","g");e.className=e.className.replace(d,"")};dwr.util.toggleClassName=function(e,c){e=dwr.util._getElementById(e,"toggleClassName()");if(e==null){return}var d=new RegExp("(^|\\s)"+c+"(\\s|$)");if(d.test(e.className)){e.className=e.className.replace(d,"")}else{e.className+=" "+c}};dwr.util.cloneNode=function(d,c){d=dwr.util._getElementById(d,"cloneNode()");if(d==null){return null}if(c==null){c={}}var e=d.cloneNode(true);if(c.idPrefix||c.idSuffix){dwr.util._updateIds(e,c)}else{dwr.util._removeIds(e)}d.parentNode.insertBefore(e,d);return e};dwr.util._updateIds=function(f,c){if(c==null){c={}}if(f.id){f.setAttribute("id",(c.idPrefix||"")+f.id+(c.idSuffix||""))}var e=f.childNodes;for(var d=0;d<e.length;d++){var g=e.item(d);if(g.nodeType==1){dwr.util._updateIds(g,c)}}};dwr.util._removeIds=function(e){if(e.id){e.removeAttribute("id")}var d=e.childNodes;for(var c=0;c<d.length;c++){var f=d.item(c);if(f.nodeType==1){dwr.util._removeIds(f)}}};dwr.util.cloneNodeForValues=function(c,e,d){c=dwr.util._getElementById(c,"cloneNodeForValues()");if(c==null){return null}if(d==null){d={}}var f;if(d.idPrefix!=null){f=d.idPrefix}else{f=c.id||""}return dwr.util._cloneNodeForValuesRecursive(c,e,f,d)};dwr.util._cloneNodeForValuesRecursive=function(c,e,g,m){if(dwr.util._isArray(e)){var j=[];for(var f=0;f<e.length;f++){var l=e[f];var h=dwr.util._cloneNodeForValuesRecursive(c,l,g+"["+f+"]",m);j.push(h)}return j}else{if(dwr.util._isObject(e)&&!dwr.util._isArray(e)){var h=c.cloneNode(true);if(m.updateCloneStyle&&h.style){for(var d in m.updateCloneStyle){h.style[d]=m.updateCloneStyle[d]}}dwr.util._replaceIds(h,c.id,g);c.parentNode.insertBefore(h,c);dwr.util._cloneSubArrays(e,g,m);return h}}return null};dwr.util._replaceIds=function(h,l,e){if(h.id){var d=null;if(h.id==l){d=e}else{if(h.id.length>l.length){if(h.id.substr(0,l.length)==l){var c=h.id.charAt(l.length);if(c=="."||c=="["){d=e+h.id.substr(l.length)}}}}if(d){h.setAttribute("id",d)}else{h.removeAttribute("id")}}var g=h.childNodes;for(var f=0;f<g.length;f++){var j=g.item(f);if(j.nodeType==1){dwr.util._replaceIds(j,l,e)}}};dwr.util._cloneSubArrays=function(e,h,c){for(prop in e){var d=e[prop];if(dwr.util._isArray(d)){if(d.length>0&&dwr.util._isObject(d[0])){var g=h+"."+prop;var f=dwr.util.byId(g);if(f!=null){dwr.util._cloneNodeForValuesRecursive(f,d,g,c)}}}else{if(dwr.util._isObject(d)){dwr.util._cloneSubArrays(d,h+"."+prop,c)}}}};dwr.util._getElementById=function(d,c){var e=d;d=dwr.util.byId(d);if(d==null){dwr.util._debug(c+" can't find an element with id: "+e+".")}return d};dwr.util._isHTMLElement=function(e,g){if(e==null||typeof e!="object"||e.nodeName==null){return false}if(g!=null){var f=e.nodeName.toLowerCase();if(typeof g=="string"){return f==g.toLowerCase()}if(dwr.util._isArray(g)){var c=false;for(var d=0;d<g.length&&!c;d++){if(f==g[d].toLowerCase()){c=true}}return c}dwr.util._debug("dwr.util._isHTMLElement was passed test node name that is neither a string or array of strings");return false}return true};dwr.util._detailedTypeOf=function(c){var d=typeof c;if(d=="object"){d=Object.prototype.toString.apply(c);d=d.substring(8,d.length-1)}return d};dwr.util._isObject=function(c){return(c&&typeof c=="object")};dwr.util._isArray=function(c){return(c&&c.join)};dwr.util._isDate=function(c){return(c&&c.toUTCString)?true:false};dwr.util._importNode=function(h,g,d){var f;if(g.nodeType==1){f=h.createElement(g.nodeName);for(var e=0;e<g.attributes.length;e++){var c=g.attributes[e];if(c.nodeValue!=null&&c.nodeValue!=""){f.setAttribute(c.name,c.nodeValue)}}if(typeof g.style!="undefined"){f.style.cssText=g.style.cssText}}else{if(g.nodeType==3){f=h.createTextNode(g.nodeValue)}}if(d&&g.hasChildNodes()){for(e=0;e<g.childNodes.length;e++){f.appendChild(dwr.util._importNode(h,g.childNodes[e],true))}}return f};dwr.util._debug=function(h,f){var c=false;try{if(window.console){if(f&&window.console.trace){window.console.trace()}window.console.log(h);c=true}else{if(window.opera&&window.opera.postError){window.opera.postError(h);c=true}}}catch(e){}if(!c){var d=document.getElementById("dwr-debug");if(d){var g=h+"<br/>"+d.innerHTML;if(g.length>2048){g=g.substring(0,2048)}d.innerHTML=g}}};if(dwr==null){var dwr={}}if(dwr.engine==null){dwr.engine={}}if(DWREngine==null){var DWREngine=dwr.engine}if(Controller==null){var Controller={}}Controller._path="/servlets/dwr";Controller.handle=function(d,c){dwr.engine._execute(Controller._path,"Controller","handle",d,{timeout:3000*1000,timeoutFunc:function(f){if(f&&!f.completed){var g=$("timeoutBox");if(g!=null){g.style.visibility="visible"}}else{if(f){clearInterval(f.interval)}}},callback:c})};Controller.query=function(d,c){dwr.engine._execute(Controller._path,"Controller","query",d,{timeout:600*1000,timeoutFunc:function(f){if(f&&!f.completed){var g=$("timeoutBox");if(g!=null){g.style.visibility="visible"}}else{if(f){clearInterval(f.interval)}}},callback:c})};if(dwr==null){var dwr={}}if(dwr.engine==null){dwr.engine={}}if(DWREngine==null){var DWREngine=dwr.engine}dwr.engine.setErrorHandler=function(c){dwr.engine._errorHandler=c};dwr.engine.setWarningHandler=function(c){dwr.engine._warningHandler=c};dwr.engine.setTextHtmlHandler=function(c){dwr.engine._textHtmlHandler=c};dwr.engine.setTimeout=function(c){dwr.engine._timeout=c};dwr.engine.setPreHook=function(c){dwr.engine._preHook=c};dwr.engine.setPostHook=function(c){dwr.engine._postHook=c};dwr.engine.setHeaders=function(c){dwr.engine._headers=c};dwr.engine.setParameters=function(c){dwr.engine._parameters=c};dwr.engine.XMLHttpRequest=1;dwr.engine.IFrame=2;dwr.engine.ScriptTag=3;dwr.engine.setRpcType=function(c){if(c!=dwr.engine.XMLHttpRequest&&c!=dwr.engine.IFrame&&c!=dwr.engine.ScriptTag){dwr.engine._handleError(null,{name:"dwr.engine.invalidRpcType",message:"RpcType must be one of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag"});return}dwr.engine._rpcType=c};dwr.engine.setHttpMethod=function(c){if(c!="GET"&&c!="POST"){dwr.engine._handleError(null,{name:"dwr.engine.invalidHttpMethod",message:"Remoting method must be one of GET or POST"});return}dwr.engine._httpMethod=c};dwr.engine.setOrdered=function(c){dwr.engine._ordered=c};dwr.engine.setAsync=function(c){dwr.engine._async=c};dwr.engine.setActiveReverseAjax=function(c){if(c){if(dwr.engine._activeReverseAjax){return}dwr.engine._activeReverseAjax=true;dwr.engine._poll()}else{if(dwr.engine._activeReverseAjax&&dwr.engine._pollReq){dwr.engine._pollReq.abort()}dwr.engine._activeReverseAjax=false}};dwr.engine.setPollType=function(c){if(c!=dwr.engine.XMLHttpRequest&&c!=dwr.engine.IFrame){dwr.engine._handleError(null,{name:"dwr.engine.invalidPollType",message:"PollType must be one of dwr.engine.XMLHttpRequest or dwr.engine.IFrame"});return}dwr.engine._pollType=c};dwr.engine.defaultErrorHandler=function(d,c){dwr.engine._debug("Error: "+c.name+", "+c.message,true);if(d==null||d==""){alert("A server error has occured. More information may be available in the console.")}else{if(d.indexOf("0x80040111")!=-1){dwr.engine._debug(d)}else{alert(d)}}};dwr.engine.defaultWarningHandler=function(d,c){dwr.engine._debug(d)};dwr.engine.beginBatch=function(){if(dwr.engine._batch){dwr.engine._handleError(null,{name:"dwr.engine.batchBegun",message:"Batch already begun"});return}dwr.engine._batch=dwr.engine._createBatch()};dwr.engine.endBatch=function(d){var c=dwr.engine._batch;if(c==null){dwr.engine._handleError(null,{name:"dwr.engine.batchNotBegun",message:"No batch in progress"});return}dwr.engine._batch=null;if(c.map.callCount==0){return}if(d){dwr.engine._mergeBatch(c,d)}if(dwr.engine._ordered&&dwr.engine._batchesLength!=0){dwr.engine._batchQueue[dwr.engine._batchQueue.length]=c}else{dwr.engine._sendData(c)}};dwr.engine.setPollMethod=function(c){dwr.engine.setPollType(c)};dwr.engine.setMethod=function(c){dwr.engine.setRpcType(c)};dwr.engine.setVerb=function(c){dwr.engine.setHttpMethod(c)};dwr.engine._origScriptSessionId="E8430AC41A13E616425835867C0BC9E0";dwr.engine._sessionCookieName="JSESSIONID";dwr.engine._allowGetForSafariButMakeForgeryEasier="false";dwr.engine._scriptTagProtection="throw 'allowScriptTagRemoting is false.';";dwr.engine._defaultPath="/servlets/dwr";dwr.engine._scriptSessionId=null;dwr.engine._getScriptSessionId=function(){if(dwr.engine._scriptSessionId==null){dwr.engine._scriptSessionId="yfzhu"+Math.floor(Math.random()*1000)}return dwr.engine._scriptSessionId};dwr.engine._errorHandler=dwr.engine.defaultErrorHandler;dwr.engine._warningHandler=dwr.engine.defaultWarningHandler;dwr.engine._preHook=null;dwr.engine._postHook=null;dwr.engine._batches={};dwr.engine._batchesLength=0;dwr.engine._batchQueue=[];dwr.engine._rpcType=dwr.engine.XMLHttpRequest;dwr.engine._httpMethod="POST";dwr.engine._ordered=false;dwr.engine._async=true;dwr.engine._batch=null;dwr.engine._timeout=0;dwr.engine._timeoutFunc=null;dwr.engine._DOMDocument=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];dwr.engine._XMLHTTP=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];dwr.engine._activeReverseAjax=false;dwr.engine._pollType=dwr.engine.XMLHttpRequest;dwr.engine._outstandingIFrames=[];dwr.engine._pollReq=null;dwr.engine._pollCometInterval=200;dwr.engine._pollRetries=0;dwr.engine._maxPollRetries=0;dwr.engine._textHtmlHandler=null;dwr.engine._headers=null;dwr.engine._parameters=null;dwr.engine._postSeperator="\n";dwr.engine._defaultInterceptor=function(c){return c};dwr.engine._urlRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._contentRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._replyRewriteHandler=dwr.engine._defaultInterceptor;dwr.engine._nextBatchId=0;dwr.engine._propnames=["rpcType","httpMethod","async","timeout","errorHandler","warningHandler","textHtmlHandler","timeoutFunc"];dwr.engine._partialResponseNo=0;dwr.engine._partialResponseYes=1;dwr.engine._partialResponseFlush=2;dwr.engine.abortAll=function(){for(i in dwr.engine._batches){try{var c=dwr.engine._batches[i];if(c&&!c.completed){clearInterval(c.interval);dwr.engine._clearUp(c);if(c.req){c.req.abort()}}}catch(d){}}};dwr.engine._execute=function(o,d,m,l){var g=false;if(dwr.engine._batch==null){dwr.engine.beginBatch();g=true}var f=dwr.engine._batch;var j=[];for(var e=0;e<arguments.length-3;e++){j[e]=arguments[e+3]}if(f.path==null){f.path=o}else{if(f.path!=o){dwr.engine._handleError(f,{name:"dwr.engine.multipleServlets",message:"Can't batch requests to multiple DWR Servlets."});return}}var c;var n=j[j.length-1];if(typeof n=="function"||n==null){c={callback:j.pop()}}else{c=j.pop()}dwr.engine._mergeBatch(f,c);f.handlers[f.map.callCount]={exceptionHandler:c.exceptionHandler,callback:c.callback};var h="c"+f.map.callCount+"-";f.map[h+"scriptName"]=d;f.map[h+"methodName"]=m;f.map[h+"id"]=f.map.callCount;for(e=0;e<j.length;e++){dwr.engine._serializeAll(f,[],j[e],h+"param"+e)}f.map.callCount++;if(g){dwr.engine.endBatch()}};dwr.engine._poll=function(d){if(!dwr.engine._activeReverseAjax){return}var c=dwr.engine._createBatch();c.map.id=0;c.map.callCount=1;c.isPoll=true;if(navigator.userAgent.indexOf("Gecko/")!=-1){c.rpcType=dwr.engine._pollType;c.map.partialResponse=dwr.engine._partialResponseYes}else{if(document.all){c.rpcType=dwr.engine.IFrame;c.map.partialResponse=dwr.engine._partialResponseFlush}else{c.rpcType=dwr.engine._pollType;c.map.partialResponse=dwr.engine._partialResponseNo}}c.httpMethod="POST";c.async=true;c.timeout=0;c.path=(d)?d:dwr.engine._defaultPath;c.preHooks=[];c.postHooks=[];c.errorHandler=dwr.engine._pollErrorHandler;c.warningHandler=dwr.engine._pollErrorHandler;c.handlers[0]={callback:function(e){dwr.engine._pollRetries=0;setTimeout("dwr.engine._poll()",e)}};dwr.engine._sendData(c);if(c.rpcType==dwr.engine.XMLHttpRequest){dwr.engine._checkCometPoll()}};dwr.engine._pollErrorHandler=function(d,c){dwr.engine._pollRetries++;dwr.engine._debug("Reverse Ajax poll failed (pollRetries="+dwr.engine._pollRetries+"): "+c.name+" : "+c.message);if(dwr.engine._pollRetries<dwr.engine._maxPollRetries){setTimeout("dwr.engine._poll()",10000)}else{dwr.engine._debug("Giving up.")}};dwr.engine._createBatch=function(){var c={map:{callCount:0,page:window.location.pathname+window.location.search,httpSessionId:dwr.engine._getJSessionId(),scriptSessionId:dwr.engine._getScriptSessionId()},charsProcessed:0,paramCount:0,headers:[],parameters:[],isPoll:false,headers:{},handlers:{},preHooks:[],postHooks:[],rpcType:dwr.engine._rpcType,httpMethod:dwr.engine._httpMethod,async:dwr.engine._async,timeout:dwr.engine._timeout,timeoutFunc:dwr.engine._timeoutFunc,errorHandler:dwr.engine._errorHandler,warningHandler:dwr.engine._warningHandler,textHtmlHandler:dwr.engine._textHtmlHandler};if(dwr.engine._preHook){c.preHooks.push(dwr.engine._preHook)}if(dwr.engine._postHook){c.postHooks.push(dwr.engine._postHook)}var e,d;if(dwr.engine._headers){for(e in dwr.engine._headers){d=dwr.engine._headers[e];if(typeof d!="function"){c.headers[e]=d}}}if(dwr.engine._parameters){for(e in dwr.engine._parameters){d=dwr.engine._parameters[e];if(typeof d!="function"){c.parameters[e]=d}}}return c};dwr.engine._mergeBatch=function(c,f){var g,e;for(var d=0;d<dwr.engine._propnames.length;d++){g=dwr.engine._propnames[d];if(f[g]!=null){c[g]=f[g]}}if(f.preHook!=null){c.preHooks.unshift(f.preHook)}if(f.postHook!=null){c.postHooks.push(f.postHook)}if(f.headers){for(g in f.headers){e=f.headers[g];if(typeof e!="function"){c.headers[g]=e}}}if(f.parameters){for(g in f.parameters){e=f.parameters[g];if(typeof e!="function"){c.map["p-"+g]=""+e}}}};dwr.engine._getJSessionId=function(){var e=document.cookie.split(";");for(var d=0;d<e.length;d++){var c=e[d];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(dwr.engine._sessionCookieName+"=")==0){return c.substring(11,c.length)}}return""};dwr.engine._checkCometPoll=function(){for(var d=0;d<dwr.engine._outstandingIFrames.length;d++){var g="";var e=dwr.engine._outstandingIFrames[d];try{g=dwr.engine._getTextFromCometIFrame(e)}catch(c){dwr.engine._handleWarning(e.batch,c)}if(g!=""){dwr.engine._processCometResponse(g,e.batch)}}if(dwr.engine._pollReq){var f=dwr.engine._pollReq;var g=f.responseText;dwr.engine._processCometResponse(g,f.batch)}if(dwr.engine._outstandingIFrames.length>0||dwr.engine._pollReq){setTimeout("dwr.engine._checkCometPoll()",dwr.engine._pollCometInterval)}};dwr.engine._getTextFromCometIFrame=function(d){var c=d.contentWindow.document.body;if(c==null){return""}var e=c.innerHTML;if(e.indexOf("<PRE>")==0||e.indexOf("<pre>")==0){e=e.substring(5,e.length-7)}return e};dwr.engine._processCometResponse=function(f,g){if(g.charsProcessed==f.length){return}if(f.length==0){g.charsProcessed=0;return}var d=f.indexOf("//#DWR-START#",g.charsProcessed);if(d==-1){g.charsProcessed=f.length;return}var c=f.lastIndexOf("//#DWR-END#");if(c==-1){return}if(f.charCodeAt(c+11)==13&&f.charCodeAt(c+12)==10){g.charsProcessed=c+13}else{g.charsProcessed=c+11}var e=f.substring(d+13,c);dwr.engine._receivedBatch=g;dwr.engine._eval(e);dwr.engine._receivedBatch=null};dwr.engine._sendData=function(g){g.map.batchId=dwr.engine._nextBatchId++;dwr.engine._batches[g.map.batchId]=g;dwr.engine._batchesLength++;g.completed=false;for(var f=0;f<g.preHooks.length;f++){g.preHooks[f]()}g.preHooks=null;if(g.timeout&&g.timeout!=0){if(g.timeoutFunc){g.interval=setInterval(function(){g.timeoutFunc(g)},g.timeout)}else{g.interval=setInterval(function(){dwr.engine._abortRequest(g)},g.timeout)}}if(g.rpcType==dwr.engine.XMLHttpRequest){if(window.XMLHttpRequest){g.req=new XMLHttpRequest()}else{if(window.ActiveXObject&&!(navigator.userAgent.indexOf("Mac")>=0&&navigator.userAgent.indexOf("MSIE")>=0)){g.req=dwr.engine._newActiveXObject(dwr.engine._XMLHTTP)}}}var c,e;if(g.req){if(g.async){g.req.onreadystatechange=function(){dwr.engine._stateChange(g)}}if(g.isPoll){dwr.engine._pollReq=g.req;g.req.batch=g}var d=navigator.userAgent.indexOf("Safari/");if(d>=0){var j=navigator.userAgent.substring(d+7);if(parseInt(j,10)<400){if(dwr.engine._allowGetForSafariButMakeForgeryEasier=="true"){g.httpMethod="GET"}else{dwr.engine._handleWarning(g,{name:"dwr.engine.oldSafari",message:"Safari GET support disabled. See getahead.org/dwr/server/servlet and allowGetForSafariButMakeForgeryEasier."})}}}g.mode=g.isPoll?dwr.engine._ModePlainPoll:dwr.engine._ModePlainCall;e=dwr.engine._constructRequest(g);try{g.req.open(g.httpMethod,e.url,g.async);try{for(c in g.headers){var m=g.headers[c];if(typeof m=="string"){g.req.setRequestHeader(c,m)}}if(!g.headers["Content-Type"]){g.req.setRequestHeader("Content-Type","text/plain")}}catch(l){dwr.engine._handleWarning(g,l)}g.req.send(e.body);if(!g.async){dwr.engine._stateChange(g)}}catch(l){dwr.engine._handleError(g,l)}}else{if(g.rpcType!=dwr.engine.ScriptTag){var h=g.isPoll?"dwr-if-poll-"+g.map.batchId:"dwr-if-"+g.map["c0-id"];g.div=document.createElement("div");g.div.innerHTML="<iframe src='javascript:void(0)' frameborder='0' style='width:0px;height:0px;border:0;' id='"+h+"' name='"+h+"'></iframe>";document.body.appendChild(g.div);g.iframe=document.getElementById(h);g.iframe.batch=g;g.mode=g.isPoll?dwr.engine._ModeHtmlPoll:dwr.engine._ModeHtmlCall;if(g.isPoll){dwr.engine._outstandingIFrames.push(g.iframe)}e=dwr.engine._constructRequest(g);if(g.httpMethod=="GET"){g.iframe.setAttribute("src",e.url)}else{g.form=document.createElement("form");g.form.setAttribute("id","dwr-form");g.form.setAttribute("action",e.url);g.form.setAttribute("target",h);g.form.target=h;g.form.setAttribute("method",g.httpMethod);for(c in g.map){var m=g.map[c];if(typeof m!="function"){var n=document.createElement("input");n.setAttribute("type","hidden");n.setAttribute("name",c);n.setAttribute("value",m);g.form.appendChild(n)}}document.body.appendChild(g.form);g.form.submit()}}else{g.httpMethod="GET";g.mode=g.isPoll?dwr.engine._ModePlainPoll:dwr.engine._ModePlainCall;e=dwr.engine._constructRequest(g);g.script=document.createElement("script");g.script.id="dwr-st-"+g.map["c0-id"];g.script.src=e.url;document.body.appendChild(g.script)}}};dwr.engine._ModePlainCall="/call/plaincall/";dwr.engine._ModeHtmlCall="/call/htmlcall/";dwr.engine._ModePlainPoll="/call/plainpoll/";dwr.engine._ModeHtmlPoll="/call/htmlpoll/";dwr.engine._constructRequest=function(c){var d={url:c.path+c.mode,body:null};if(c.isPoll==true){d.url+="ReverseAjax.dwr"}else{if(c.map.callCount==1){d.url+=c.map["c0-scriptName"]+"."+c.map["c0-methodName"]+".dwr"}else{d.url+="Multiple."+c.map.callCount+".dwr"}}var f=location.href.match(/jsessionid=([^?]+)/);if(f!=null){d.url+=";jsessionid="+f[1]}var e;if(c.httpMethod=="GET"){c.map.callCount=""+c.map.callCount;d.url+="?";for(e in c.map){if(typeof c.map[e]!="function"){d.url+=encodeURIComponent(e)+"="+encodeURIComponent(c.map[e])+"&"}}d.url=d.url.substring(0,d.url.length-1)}else{d.body="";for(e in c.map){if(typeof c.map[e]!="function"){d.body+=e+"="+c.map[e]+dwr.engine._postSeperator}}d.body=dwr.engine._contentRewriteHandler(d.body)}d.url=dwr.engine._urlRewriteHandler(d.url);return d};dwr.engine._stateChange=function(e){var d;if(e.completed){dwr.engine._debug("Error: _stateChange() with batch.completed");return}var h=e.req;try{if(h.readyState!=4){return}}catch(f){dwr.engine._handleWarning(e,f);dwr.engine._clearUp(e);return}try{var g=h.responseText;g=dwr.engine._replyRewriteHandler(g);var c=h.status;if(g==null||g==""){dwr.engine._handleWarning(e,{name:"dwr.engine.missingData",message:"No data received from server"})}else{if(c!=200){dwr.engine._handleError(e,{name:"dwr.engine.http."+c,message:h.statusText})}else{var j=h.getResponseHeader("Content-Type");if(!j.match(/^text\/plain/)&&!j.match(/^text\/javascript/)){if(j.match(/^text\/html/)&&typeof e.textHtmlHandler=="function"){e.textHtmlHandler()}else{dwr.engine._handleWarning(e,{name:"dwr.engine.invalidMimeType",message:"Invalid content type: '"+j+"'"})}}else{if(e.isPoll&&e.map.partialResponse==dwr.engine._partialResponseYes){dwr.engine._processCometResponse(g,e)}else{if(g.search("//#DWR")==-1){dwr.engine._handleWarning(e,{name:"dwr.engine.invalidReply",message:"Invalid reply from server"})}else{d=g}}}}}}catch(f){dwr.engine._handleWarning(e,f)}dwr.engine._callPostHooks(e);dwr.engine._receivedBatch=e;if(d!=null){d=d.replace(dwr.engine._scriptTagProtection,"")}dwr.engine._eval(d);dwr.engine._receivedBatch=null;dwr.engine._clearUp(e)};dwr.engine._remoteHandleCallback=function(c,h,g){var e=dwr.engine._batches[c];if(e==null){dwr.engine._debug("Warning: batch == null in remoteHandleCallback for batchId="+c,true);return}try{var d=e.handlers[h];if(!d){dwr.engine._debug("Warning: Missing handlers. callId="+h,true)}else{if(typeof d.callback=="function"){d.callback(g)}}}catch(f){dwr.engine._handleError(e,f)}};dwr.engine._remoteHandleException=function(c,g,f){var e=dwr.engine._batches[c];if(e==null){dwr.engine._debug("Warning: null batch in remoteHandleException",true);return}var d=e.handlers[g];if(d==null){dwr.engine._debug("Warning: null handlers in remoteHandleException",true);return}if(f.message==undefined){f.message=""}if(typeof d.exceptionHandler=="function"){d.exceptionHandler(f.message,f)}else{if(typeof e.errorHandler=="function"){e.errorHandler(f.message,f)}}};dwr.engine._remoteHandleBatchException=function(e,c){var d=(dwr.engine._receivedBatch==null&&c!=null);if(d){dwr.engine._receivedBatch=dwr.engine._batches[c]}if(e.message==undefined){e.message=""}dwr.engine._handleError(dwr.engine._receivedBatch,e);if(d){dwr.engine._receivedBatch=null;dwr.engine._clearUp(dwr.engine._batches[c])}};dwr.engine._remotePollCometDisabled=function(e,c){dwr.engine.setActiveReverseAjax(false);var d=(dwr.engine._receivedBatch==null&&c!=null);if(d){dwr.engine._receivedBatch=dwr.engine._batches[c]}if(e.message==undefined){e.message=""}dwr.engine._handleError(dwr.engine._receivedBatch,e);if(d){dwr.engine._receivedBatch=null;dwr.engine._clearUp(dwr.engine._batches[c])}};dwr.engine._remoteBeginIFrameResponse=function(d,c){if(d!=null){dwr.engine._receivedBatch=d.batch}dwr.engine._callPostHooks(dwr.engine._receivedBatch)};dwr.engine._remoteEndIFrameResponse=function(c){dwr.engine._clearUp(dwr.engine._receivedBatch);dwr.engine._receivedBatch=null};dwr.engine._eval=function(script){if(script==null){return null}if(script==""){dwr.engine._debug("Warning: blank script",true);return null}return eval(script)};dwr.engine._abortRequest=function(c){if(c&&!c.completed){clearInterval(c.interval);dwr.engine._clearUp(c);if(c.req){c.req.abort()}dwr.engine._handleError(c,{name:"dwr.engine.timeout",message:"Timeout"})}};dwr.engine._callPostHooks=function(c){if(c.postHooks){for(var d=0;d<c.postHooks.length;d++){c.postHooks[d]()}c.postHooks=null}};dwr.engine._clearUp=function(d){if(!d){dwr.engine._debug("Warning: null batch in dwr.engine._clearUp()",true);return}if(d.completed=="true"){dwr.engine._debug("Warning: Double complete",true);return}if(d.div){d.div.parentNode.removeChild(d.div)}if(d.iframe){for(var e=0;e<dwr.engine._outstandingIFrames.length;e++){if(dwr.engine._outstandingIFrames[e]==d.iframe){dwr.engine._outstandingIFrames.splice(e,1)}}d.iframe.parentNode.removeChild(d.iframe)}if(d.form){d.form.parentNode.removeChild(d.form)}if(d.req){if(d.req==dwr.engine._pollReq){dwr.engine._pollReq=null}delete d.req}if(d.map&&d.map.batchId){delete dwr.engine._batches[d.map.batchId];dwr.engine._batchesLength--}d.completed=true;if(d.timeout&&d.timeout!=0){clearInterval(d.interval);var f=document.getElementById("timeoutBox");if(f!=null){f.style.visibility="hidden"}}if(dwr.engine._batchQueue.length!=0){var c=dwr.engine._batchQueue.shift();dwr.engine._sendData(c)}};dwr.engine._handleError=function(c,d){if(typeof d=="string"){d={name:"unknown",message:d}}if(d.message==null){d.message=""}if(d.name==null){d.name="unknown"}if(c&&typeof c.errorHandler=="function"){c.errorHandler(d.message,d)}else{if(dwr.engine._errorHandler){dwr.engine._errorHandler(d.message,d)}}dwr.engine._clearUp(c)};dwr.engine._handleWarning=function(c,d){if(typeof d=="string"){d={name:"unknown",message:d}}if(d.message==null){d.message=""}if(d.name==null){d.name="unknown"}if(c&&typeof c.warningHandler=="function"){c.warningHandler(d.message,d)}else{if(dwr.engine._warningHandler){dwr.engine._warningHandler(d.message,d)}}dwr.engine._clearUp(c)};dwr.engine._serializeAll=function(d,f,e,c){if(e==null){d.map[c]="null:null";return}switch(typeof e){case"boolean":d.map[c]="boolean:"+e;break;case"number":d.map[c]="number:"+e;break;case"string":d.map[c]="string:"+encodeURIComponent(e);break;case"object":if(e instanceof String){d.map[c]="String:"+encodeURIComponent(e)}else{if(e instanceof Boolean){d.map[c]="Boolean:"+e}else{if(e instanceof Number){d.map[c]="Number:"+e}else{if(e instanceof Date){d.map[c]="Date:"+e.getTime()}else{if(e&&e.join){d.map[c]=dwr.engine._serializeArray(d,f,e,c)}else{d.map[c]=dwr.engine._serializeObject(d,f,e,c)}}}}}break;case"function":break;default:dwr.engine._handleWarning(null,{name:"dwr.engine.unexpectedType",message:"Unexpected type: "+typeof e+", attempting default converter."});d.map[c]="default:"+e;break}};dwr.engine._lookup=function(g,e,c){var f;for(var d=0;d<g.length;d++){if(g[d].data==e){f=g[d];break}}if(f){return"reference:"+f.name}g.push({data:e,name:c});return null};dwr.engine._serializeObject=function(e,l,j,d){var h=dwr.engine._lookup(l,j,d);if(h){return h}if(j.nodeName&&j.nodeType){return dwr.engine._serializeXml(e,l,j,d)}var g="Object_"+dwr.engine._getObjectClassName(j)+":{";var f;for(f in j){if(typeof j[f]!="function"){e.paramCount++;var c="c"+dwr.engine._batch.map.callCount+"-e"+e.paramCount;dwr.engine._serializeAll(e,l,j[f],c);g+=encodeURIComponent(f)+":reference:"+c+", "}}if(g.substring(g.length-2)==", "){g=g.substring(0,g.length-2)}g+="}";return g};dwr.engine._errorClasses={Error:Error,EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError};dwr.engine._getObjectClassName=function(e){if(e&&e.constructor&&e.constructor.toString){var f=e.constructor.toString();var c=f.match(/function\s+(\w+)/);if(c&&c.length==2){return c[1]}}if(e&&e.constructor){for(var d in dwr.engine._errorClasses){if(e.constructor==dwr.engine._errorClasses[d]){return d}}}if(e){var f=Object.prototype.toString.call(e);var c=f.match(/\[object\s+(\w+)/);if(c&&c.length==2){return c[1]}}return"Object"};dwr.engine._serializeXml=function(e,h,g,d){var f=dwr.engine._lookup(h,g,d);if(f){return f}var c;if(window.XMLSerializer){c=new XMLSerializer().serializeToString(g)}else{if(g.toXml){c=g.toXml}else{c=g.innerHTML}}return"XML:"+encodeURIComponent(c)};dwr.engine._serializeArray=function(e,l,j,d){var h=dwr.engine._lookup(l,j,d);if(h){return h}var g="Array:[";for(var f=0;f<j.length;f++){if(f!=0){g+=","}e.paramCount++;var c="c"+dwr.engine._batch.map.callCount+"-e"+e.paramCount;dwr.engine._serializeAll(e,l,j[f],c);g+="reference:";g+=c}g+="]";return g};dwr.engine._unserializeDocument=function(c){var e;if(window.DOMParser){var g=new DOMParser();e=g.parseFromString(c,"text/xml");if(!e.documentElement||e.documentElement.tagName=="parsererror"){var d=e.documentElement.firstChild.data;d+="\n"+e.documentElement.firstChild.nextSibling.firstChild.data;throw d}return e}else{if(window.ActiveXObject){e=dwr.engine._newActiveXObject(dwr.engine._DOMDocument);e.loadXML(c);return e}else{var f=document.createElement("div");f.innerHTML=c;return f}}};dwr.engine._newActiveXObject=function(c){var f;for(var e=0;e<c.length;e++){try{f=new ActiveXObject(c[e]);break}catch(d){}}return f};dwr.engine._debug=function(h,f){var c=false;try{if(window.console){if(f&&window.console.trace){window.console.trace()}window.console.log(h);c=true}else{if(window.opera&&window.opera.postError){window.opera.postError(h);c=true}}}catch(e){}if(!c){var d=document.getElementById("dwr-debug");if(d){var g=h+"<br/>"+d.innerHTML;if(g.length>2048){g=g.substring(0,2048)}d.innerHTML=g}}};var _biInPrototype=false;function _biExtend(d,c,f){_biInPrototype=true;var e=d.prototype=new c();if(f){e._className=f}e.constructor=d;_biInPrototype=false;return e}Function.READ=1;Function.WRITE=2;Function.READ_WRITE=3;Function.EMPTY=function(){};Function.prototype.addProperty=function(e,c){var d=this.prototype;c=c||Function.READ_WRITE;var f=(e.charAt(0).toUpperCase()+e.substr(1));e="_"+e;if(c&Function.READ){d["get"+f]=function(){return this[e]}}if(c&Function.WRITE){d["set"+f]=function(g){this[e]=g}}};function BiObject(){}_p=_biExtend(BiObject,Object,"BiObject");_p._disposed=false;_p._id=null;BiObject.TYPE_FUNCTION="function";BiObject.TYPE_OBJECT="object";BiObject.TYPE_STRING="string";BiObject._hashCodeCounter=1;BiObject.isEmpty=function(d){for(var c in d){return false}return true};BiObject.toHashCode=function(c){if(c.hasOwnProperty("_hashCode")){return c._hashCode}return c._hashCode="_"+(BiObject._hashCodeCounter++).toString(32)};BiObject.addProperty("disposed",Function.READ);BiObject.addProperty("id",Function.READ_WRITE);BiObject.addProperty("userData",Function.READ_WRITE);_p.toHashCode=function(){return BiObject.toHashCode(this)};_p.dispose=function(){this._disposed=true;delete this._userData;delete this._id;this.dispose=Function.EMPTY};_p.disposeFields=function(g){var c=g instanceof Array?g:arguments;var l,h,f;for(var e=0;e<c.length;e++){l=c[e];if(this.hasOwnProperty(l)){h=this[l];if(h!=null){if(typeof h.dispose==BiObject.TYPE_FUNCTION){h.dispose()}else{if(h instanceof Array){for(var d=0;d<h.length;d++){f=h[d];if(f&&typeof f.dispose==BiObject.TYPE_FUNCTION){f.dispose()}}}}}delete this[l]}}};_p.toString=function(){if(this._className){return"[object "+this._className+"]"}return"[object Object]"};_p.getProperty=function(d){var c="get"+d.capitalize();if(typeof this[c]==BiObject.TYPE_FUNCTION){return this[c]()}throw new Error("No such property, "+d)};_p.setProperty=function(e,d){var c="set"+e.capitalize();if(typeof this[c]==BiObject.TYPE_FUNCTION){this[c](d)}else{throw new Error("No such property, "+e)}};_p.setProperties=function(c){for(var d in c){this.setProperty(d,c[d])}};_p.setAttribute=function(f,g,d){var c,e;if(g==String.BOOLEAN_TRUE){c=true}else{if(g==String.BOOLEAN_FALSE){c=false}else{if((e=parseFloat(g))==g){c=e}else{c=g}}}this.setProperty(f,c)};_p.getAttribute=function(c){return String(this.getProperty(c))};_p.addXmlNode=function(d,c){if(d.nodeType==1){c.fromNode(d)}};if(typeof BiObject=="undefined"){BiObject=new Function()}function BiEvent(c){if(_biInPrototype){return}BiObject.call(this);this._type=c}_p=_biExtend(BiEvent,BiObject,"BiEvent");_p._bubbles=false;_p._propagationStopped=true;_p._defaultPrevented=false;BiEvent.addProperty("type",Function.READ);BiEvent.addProperty("target",Function.READ);BiEvent.addProperty("currentTarget",Function.READ);BiEvent.addProperty("bubbles",Function.READ);_p.stopPropagation=function(){this._propagationStopped=true};BiEvent.addProperty("propagationStopped",Function.READ);_p.preventDefault=function(){this._defaultPrevented=true};BiEvent.addProperty("defaultPrevented",Function.READ);_p.dispose=function(){BiObject.prototype.dispose.call(this);delete this._target;delete this._currentTarget;delete this._bubbles;delete this._propagationStopped;delete this._defaultPrevented};_p.getDefaultPrevented=function(){return this._defaultPrevented};function BiEventTarget(){if(_biInPrototype){return}BiObject.call(this);this._listeners={};this._listenersCount=0}_p=_biExtend(BiEventTarget,BiObject,"BiEventTarget");_p.addEventListener=function(g,f,e){if(typeof f!=BiObject.TYPE_FUNCTION){throw new Error(this+" addEventListener: "+f+" is not a function ("+g+")")}var c=this._listeners[g];if(!c){c=this._listeners[g]={}}var d=BiObject.toHashCode(f)+(e?BiObject.toHashCode(e):String.EMPTY);if(!(d in c)){this._listenersCount++}c[d]={handler:f,object:e||this}};_p.removeEventListener=function(f,e,d){if(this._disposed||!(f in this._listeners)){return}var c=BiObject.toHashCode(e)+(d?BiObject.toHashCode(d):String.EMPTY);if(c in this._listeners[f]){--this._listenersCount}delete this._listeners[f][c];if(BiObject.isEmpty(this._listeners[f])){delete this._listeners[f]}};_p.dispatchEvent=function(c){if(this._disposed){return}if(typeof c==BiObject.TYPE_STRING){c=new BiEvent(c)}c._target=this;this._dispatchEvent(c);delete c._target;return !c._defaultPrevented};_p._dispatchEvent=function(f){f._currentTarget=this;if(this._listenersCount>0){var c=this._listeners[f.getType()];if(c){for(var g in c){var d=c[g];d.handler.call(d.object,f)}}}if(f._bubbles&&!f._propagationStopped&&this._parent&&!this._parent._disposed){this._parent._dispatchEvent(f)}delete f._currentTarget};_p.setAttribute=function(e,f,c){if(e.substring(0,2)=="on"){var d=e.substring(2);this.addEventListener(d,new Function("event",f),c)}else{BiObject.prototype.setAttribute.call(this,e,f,c)}};_p.dispose=function(){if(this._disposed){return}BiObject.prototype.dispose.call(this);for(var c in this._listeners){delete this._listeners[c]}delete this._listeners;delete this._listenersCount};_p.hasListeners=function(c){return this._listenersCount>0&&(c==null||c in this._listeners)};function BiApplication(){if(_biInPrototype){return}if(typeof application=="object"){return application}application=this;BiEventTarget.call(this)}var application;_p=_biExtend(BiApplication,BiEventTarget,"BiApplication");_p._version="2.55";BiApplication.prototype.getVersion=function(){return this._version};_p.start=function(){if(Prototype.Browser.IE){window.attachEvent("onunload",this._onunload)}else{window.addEventListener("unload",this._onunload,false)}};_p._onunload=function(){application.dispose()};_p.dispose=function(){if(this._disposed){return}this.dispatchEvent("dispose");if(Prototype.Browser.IE){window.detachEvent("onunload",this._onunload)}else{window.removeEventListener("unload",this._onunload,false)}BiEventTarget.prototype.dispose.call(this);application=null};_p.setAttribute=function(d,e,c){switch(d){case"defaultPackages":this.setProperty(d,e.split(/\s*,\s*/));break;default:BiEventTarget.prototype.setAttribute.apply(this,arguments)}};application=new BiApplication();function checkModifiedLine(c,d){if(c.value==undefined){if(d<c.length){c[d].checked=true}}else{if(d==0){c.checked=true}}}function unselectall(){if(document.getElementById("myCheckBoxAll").checked){document.getElementById("myCheckBoxAll").checked=document.getElementById("myCheckBoxAll").checked&0}}function selectall(f,d){document.getElementById("myCheckBoxAll").checked=document.getElementById("myCheckBoxAll").checked|0;if(d==0){return}if(d==1){f.selectedItemIdx.checked=document.getElementById("myCheckBoxAll").checked}if(d>1){for(var e=0;e<d;e++){f.selectedItemIdx[e].checked=document.getElementById("myCheckBoxAll").checked}}}function doSubmit(d,f,e){d.range.value=e;d.start.value=f;d.submit()}function setIndex(c,d){c.start.value=d;c.submit()}function changeControlValue(c,d){c.value=d}function reOrder(d,c){if(d.elements["order/columns"].value==c){if(d.elements["order/asc"].value=="true"){d.elements["order/asc"].value="false"}else{d.elements["order/asc"].value="true"}}else{d.elements["order/columns"].value=c}setIndex(d,1)}function createReport(c){changeControlValue(c.resulthandler,"/html/nds/reports/create_report.jsp");c.submit()}function checkModifiedLine(c,d){if(c.value==undefined){if(d<c.length){c[d].checked=true}}else{if(d==0){c.checked=true}}}function inputChanged(g,f){var h=g.split("_");if(h.length<3){alert("id()"+g+" has error!");return}var e=h[1];checkModifiedLine(document.sheet_item_modify.selectedItemIdx,e)}function checkboxChanged(c,d){document.getElementById(c).value=(document.getElementById("chk_"+c).checked?"Y":"N");alert(document.getElementById(c).value);inputChanged(c,d)}function changeFocusOnCell(h,f){var g="column_"+h+"_"+f;var j=document.getElementById([g]);try{if(j!=null){j.focus()}}catch(l){var j=document.getElementById(["chkn_"+g]);try{if(j!=null){j.focus()}}catch(l){}}}function move(j,n){var l=j.split("_");if(l.length<3){alert("id()"+j+" has error!");return}var m=l[1];var e=l[2];switch(n.keyCode){case 37:var h=document.getElementById(j);if(h.type=="text"&&h.value.length>0){return}e--;changeFocusOnCell(m,e);break;case 38:m--;changeFocusOnCell(m,e);break;case 39:var h=document.getElementById(j);if(h.value.length>0){return}e++;changeFocusOnCell(m,e);break;case 40:case 13:m++;changeFocusOnCell(m,e);break;default:if(n.keyCode!=9&&n.keyCode!=16){checkModifiedLine(document.sheet_item_modify.selectedItemIdx,m)}}}function refresh(c){c.submit()}function openScript(g){var f=420,e=500;var h=window.open(g,"FlinkWindow","width="+f+",height="+e+",dependent=yes,resizable=1,scrollbars=yes,menubar=no,status=yes");h.focus()}function addKeyCatcher(f,e){if(e.elements.length==0){return true}_Frame=f;_Form=e;for(var d=0;d<e.elements.length;d++){e.elements[d].onkeypress=keyCatcher}keyCatcher(true)}function keyCatcher(n){var o;var r;if(n){o=13;r=_Form.elements[_Form.elements.length-1]}else{o=_Frame.window.event.keyCode;r=_Frame.window.event.srcElement;if(isReservedKeycode(o)){return false}if(o==27){_Frame.window.event.srcElement.blur();_Frame.window.event.srcElement.focus();return true}if(_Frame.window.event.srcElement.type.toUpperCase()=="TEXTAREA"){return true}}if(o!=13){return true}for(var q=0,j=-1;;){if(_Form.elements[q]==r){if(j==q){return true}j=q}if(q==(_Form.elements.length-1)){q=0}else{q++}if(j==-1){continue}var p=_Form.elements[q];if(p.tagName.toUpperCase()=="FIELDSET"){continue}if(!isDisplay(p)){continue}var m=p.type.toUpperCase();if(m=="HIDDEN"||m=="BUTTON"||m=="SUBMIT"||m=="RESET"){continue}var l=(m=="TEXT"||m=="PASSWORD"||m=="TEXTAREA");if(l&&p.readOnly){continue}if(p.disabled){continue}if(p.name!="T8"){continue}if(l){p.select()}p.focus();return false}}function isDisplay(c){if(c.tagName=="INPUT"&&c.type=="hidden"){return false}while(c.tagName!="BODY"&&c.style.display!="none"){c=c.parentElement}if(c.tagName=="BODY"){return true}else{return false}}function isReservedKeycode(c){switch(c){case 39:case 94:case 96:case 124:return true}return false}function doAction(c){c.method="post";c.submit()}function makeArray(c){for(var d=1;d<=c;d++){this[d]=0}return this}function isEmpty(c){return((c==null)||(c.length==0))}function isWhitespace(c){var e;if(isEmpty(c)){return true}for(e=0;e<c.length;e++){var f=c.charAt(e);if(" ".indexOf(f)==-1){return false}}return true}function stripCharsInBag(l,j){var c;var g="";for(c=0;c<l.length;c++){var h=l.charAt(c);if(j.indexOf(h)==-1){g+=h}}return g}function stripCharsNotInBag(l,j){var c;var g="";for(c=0;c<l.length;c++){var h=l.charAt(c);if(j.indexOf(h)!=-1){g+=h}}return g}function stripWhitespace(c){return stripCharsInBag(c,whitespace)}function charInString(c,d){for(i=0;i<d.length;i++){if(d.charAt(i)==c){return true}}return false}function stripInitialWhitespace(c){var d=0;while((d<c.length)&&charInString(c.charAt(d),whitespace)){d++}return c.substring(d,c.length)}function isLetter(c){return(((c>="a")&&(c<="z"))||((c>="A")&&(c<="Z")))}function isDigit(c){return((c>="0")&&(c<="9"))}function isLetterOrDigit(c){return(isLetter(c)||isDigit(c))}function isInteger(c){var e;if(isEmpty(c)){if(isInteger.arguments.length==1){return defaultEmptyOK}else{return(isInteger.arguments[1]==true)}}for(e=0;e<c.length;e++){var f=c.charAt(e);if(!isDigit(f)){return false}}return true}function isSignedInteger(f){if(isEmpty(f)){if(isSignedInteger.arguments.length==1){return defaultEmptyOK}else{return(isSignedInteger.arguments[1]==true)}}else{var d=0;var e=defaultEmptyOK;if(isSignedInteger.arguments.length>1){e=isSignedInteger.arguments[1]}if((f.charAt(0)=="-")||(f.charAt(0)=="+")){d=1}return(isInteger(f.substring(d,f.length),e))}}function isPositiveInteger(c){var d=defaultEmptyOK;if(isPositiveInteger.arguments.length>1){d=isPositiveInteger.arguments[1]}return(isSignedInteger(c,d)&&((isEmpty(c)&&d)||(parseInt(c)>0)))}function isNonnegativeInteger(c){var d=defaultEmptyOK;if(isNonnegativeInteger.arguments.length>1){d=isNonnegativeInteger.arguments[1]}return(isSignedInteger(c,d)&&((isEmpty(c)&&d)||(parseInt(c)>=0)))}function isNegativeInteger(c){var d=defaultEmptyOK;if(isNegativeInteger.arguments.length>1){d=isNegativeInteger.arguments[1]}return(isSignedInteger(c,d)&&((isEmpty(c)&&d)||(parseInt(c)<0)))}function isNonpositiveInteger(c){var d=defaultEmptyOK;if(isNonpositiveInteger.arguments.length>1){d=isNonpositiveInteger.arguments[1]}return(isSignedInteger(c,d)&&((isEmpty(c)&&d)||(parseInt(c)<=0)))}function isFloat(h){var c;var f=false;if(isEmpty(h)){if(isFloat.arguments.length==1){return defaultEmptyOK}else{return(isFloat.arguments[1]==true)}}if(h==decimalPointDelimiter){return false}for(c=0;c<h.length;c++){var g=h.charAt(c);if((g==decimalPointDelimiter)&&!f){f=true}else{if(!isDigit(g)){return false}}}return true}function isSignedFloat(f){if(isEmpty(f)){if(isSignedFloat.arguments.length==1){return defaultEmptyOK}else{return(isSignedFloat.arguments[1]==true)}}else{var d=0;var e=defaultEmptyOK;if(isSignedFloat.arguments.length>1){e=isSignedFloat.arguments[1]}if((f.charAt(0)=="-")||(f.charAt(0)=="+")){d=1}return(isFloat(f.substring(d,f.length),e))}}function isAlphabetic(c){var e;if(isEmpty(c)){if(isAlphabetic.arguments.length==1){return defaultEmptyOK}else{return(isAlphabetic.arguments[1]==true)}}for(e=0;e<c.length;e++){var f=c.charAt(e);if(!isLetter(f)){return false}}return true}function isAlphanumeric(c){var e;if(isEmpty(c)){if(isAlphanumeric.arguments.length==1){return defaultEmptyOK}else{return(isAlphanumeric.arguments[1]==true)}}for(e=0;e<c.length;e++){var f=c.charAt(e);if(!(isLetter(f)||isDigit(f))){return false}}return true}function isEmail(d){if(isEmpty(d)){if(isEmail.arguments.length==1){return defaultEmptyOK}else{return(isEmail.arguments[1]==true)}}if(isWhitespace(d)){return false}var e=1;var f=d.length;while((e<f)&&(d.charAt(e)!="@")){e++}if((e>=f)||(d.charAt(e)!="@")){return false}else{e+=2}while((e<f)&&(d.charAt(e)!=".")){e++}if((e>=f-1)||(d.charAt(e)!=".")){return false}else{return true}}function isURL(c){if(isEmpty(c)){if(isURL.arguments.length==1){return defaultEmptyOK}else{return(isURL.arguments[1]==true)}}if(isWhitespace(c)){return false}c=c.toLowerCase();if(c.indexOf("http://www")==-1){return false}else{return true}}function isYear(c){if(isEmpty(c)){if(isYear.arguments.length==1){return defaultEmptyOK}else{return(isYear.arguments[1]==true)}}if(!isNonnegativeInteger(c)){return false}return((c.length==2)||(c.length==4))}function isIntegerInRange(g,j,l){if(isEmpty(g)){if(isIntegerInRange.arguments.length==1){return defaultEmptyOK}else{return(isIntegerInRange.arguments[1]==true)}}if(!isInteger(g,false)){return false}var h=parseInt(g,10);return((h>=j)&&(h<=l))}function isMonth(c){if(isEmpty(c)){if(isMonth.arguments.length==1){return defaultEmptyOK}else{return(isMonth.arguments[1]==true)}}return isIntegerInRange(c,1,12)}function isDay(c){if(isEmpty(c)){if(isDay.arguments.length==1){return defaultEmptyOK}else{return(isDay.arguments[1]==true)}}return isIntegerInRange(c,1,31)}function daysInFebruary(c){return(((c%4==0)&&((!(c%100==0))||(c%400==0)))?29:28)}function isDate(g,l,h){if(!(isYear(g,false)&&isMonth(l,false)&&isDay(h,false))){return false}var n=parseInt(g,10);var m=parseInt(l,10);var j=parseInt(h,10);if(j>daysInMonth[m]){return false}if((m==2)&&(j>daysInFebruary(n))){return false}return true}function checkEmail(d,c){if(checkEmail.arguments.length==1){c=defaultEmptyOK}if((c==true)&&(isEmpty(d.value))){return true}else{if(!isEmail(d.value,false)){return warnInvalid(d,iEmail)}else{return true}}}function checkYear(d,c){if(checkYear.arguments.length==1){c=defaultEmptyOK}if((c==true)&&(isEmpty(d.value))){return true}if(!isYear(d.value,false)){return warnInvalid(d,iYear)}else{return true}}function checkMonth(d,c){if(checkMonth.arguments.length==1){c=defaultEmptyOK}if((c==true)&&(isEmpty(d.value))){return true}if(!isMonth(d.value,false)){return warnInvalid(d,iMonth)}else{return true}}function checkDay(d,c){if(checkDay.arguments.length==1){c=defaultEmptyOK}if((c==true)&&(isEmpty(d.value))){return true}if(!isDay(d.value,false)){return warnInvalid(d,iDay)}else{return true}}function checkDate(g,l,h,f,j){if(checkDate.arguments.length==4){j=false}if(!isYear(g.value)){return warnInvalid(g,iYear)}if(!isMonth(l.value)){return warnInvalid(l,iMonth)}if((j==true)&&isEmpty(h.value)){return true}else{if(!isDay(h.value)){return warnInvalid(h,iDay)}}if(isDate(g.value,l.value,h.value)){return true}alert(iDatePrefix+f+iDateSuffix);return false}function LeapYear(c){if(c%100==0){if(c%400==0){return true}}else{if((c%4)==0){return true}}return false}var $dp,WdatePicker;(function(){var ah={$wdate:true,$dpPath:"My97DatePicker/",$crossFrame:true,doubleCalendar:false,position:{},lang:"auto",skin:"default",dateFmt:"yyyyMMdd",realDateFmt:"yyyyMMdd",realTimeFmt:"HH:mm:ss",realFullFmt:"yyyy/MM/dd HH:mm:ss",minDate:"1900/01/01 00:00:00",maxDate:"2099/12/31 23:59:59",startDate:"",alwaysUseStartDate:false,yearOffset:1911,firstDayOfWeek:0,isShowWeek:false,highLineWeekDay:true,isShowClear:true,isShowToday:true,isShowOthers:true,readOnly:false,errDealMode:0,autoPickDate:null,qsEnabled:true,specialDates:null,specialDays:null,disabledDates:null,disabledDays:null,opposite:false,onpicking:null,onpicked:null,onclearing:null,oncleared:null,ychanging:null,ychanged:null,Mchanging:null,Mchanged:null,dchanging:null,dchanged:null,Hchanging:null,Hchanged:null,mchanging:null,mchanged:null,schanging:null,schanged:null,eCont:null,vel:null,errMsg:"",quickSel:[],has:{}};WdatePicker=h;var e=window,q="document",v="documentElement",ac="getElementsByTagName",g,ae,j,w,af;switch(navigator.appName){case"Microsoft Internet Explorer":j=true;break;case"Opera":af=true;break;default:w=true;break}ae=t();if(ah.$wdate){s(ae+"skin/WdatePicker.css")}g=e;if(ah.$crossFrame){try{while(g.parent[q]!=g[q]&&g.parent[q][ac]("frameset").length==0){g=g.parent}}catch(p){}}if(!g.$dp){g.$dp={ff:w,ie:j,opera:af,el:null,win:e,status:0,defMinDate:ah.minDate,defMaxDate:ah.maxDate,flatCfgs:[]}}ad();if($dp.status==0){c(e,function(){h(null,true)})}if(!e[q].docMD){aa(e[q],"onmousedown",ab);e[q].docMD=true}if(!g[q].docMD){aa(g[q],"onmousedown",ab);g[q].docMD=true}aa(e,"onunload",function(){if($dp.dd){o($dp.dd,"none")}});function ad(){g.$dp=g.$dp||{};obj={$:function(B){return(typeof B=="string")?this.win[q].getElementById(B):B},$D:function(C,B){return this.$DV(this.$(C).value,B)},$DV:function(C,D){if(C!=""){this.dt=$dp.cal.splitDate(C,$dp.cal.dateFmt);if(D){for(var B in D){if(this.dt[B]===undefined){this.errMsg="invalid property:"+B}this.dt[B]+=D[B]}}if(this.dt.refresh()){return this.dt}}return""},show:function(){o(this.dd,"block")},hide:function(){o(this.dd,"none")},attachEvent:aa};for(var A in obj){g.$dp[A]=obj[A]}$dp=g.$dp}function aa(C,E,D){if(j){C.attachEvent(E,D)}else{var F=E.replace(/on/,"");D._ieEmuEventHandler=function(A){return D(A)};C.addEventListener(F,D._ieEmuEventHandler,false)}}function t(){var D,C,E=e[q][ac]("script");for(var F=0;F<E.length;F++){D=E[F].src.substring(0,E[F].src.toLowerCase().indexOf("wdatepicker.js"));C=D.lastIndexOf("/");if(C>0){D=D.substring(0,C+1)}if(D){break}}return D}function z(T){var U,L;if(T.substring(0,1)!="/"&&T.indexOf("://")==-1){U=g.location.href;L=location.href;if(U.indexOf("?")>-1){U=U.substring(0,U.indexOf("?"))}if(L.indexOf("?")>-1){L=L.substring(0,L.indexOf("?"))}var S,Q,O="",K="",N="",P,R,M="";for(P=0;P<Math.max(U.length,L.length);P++){S=U.charAt(P).toLowerCase();Q=L.charAt(P).toLowerCase();if(S==Q){if(S=="/"){R=P}}else{O=U.substring(R+1,U.length);O=O.substring(0,O.lastIndexOf("/"));K=L.substring(R+1,L.length);K=K.substring(0,K.lastIndexOf("/"));break}}if(O!=""){for(P=0;P<O.split("/").length;P++){M+="../"}}if(K!=""){M+=K+"/"}T=U.substring(0,U.lastIndexOf("/")+1)+M+T}ah.$dpPath=T}function s(C,F,H){var G=e[q][ac]("HEAD").item(0),E=e[q].createElement("link");if(G){E.href=C;E.rel="stylesheet";E.type="text/css";if(F){E.title=F}if(H){E.charset=H}G.appendChild(E)}}function c(B,A){aa(B,"onload",A)}function y(J){J=J||g;var C=0,G=0;while(J!=g){var K=J.parent[q][ac]("iframe");for(var H=0;H<K.length;H++){try{if(K[H].contentWindow==J){var I=f(K[H]);C+=I.left;G+=I.top;break}}catch(L){}}J=J.parent}return{leftM:C,topM:G}}function f(P){if(j){return P.getBoundingClientRect()}else{var K={ROOT_TAG:/^body|html$/i,OP_SCROLL:/^(?:inline|table-row)$/i},N=null,M=P.offsetTop,O=P.offsetLeft,H=P.offsetWidth,J=P.offsetHeight,I=P.offsetParent;if(I!=P){while(I){O+=I.offsetLeft;M+=I.offsetTop;if(I.tagName.toLowerCase()=="body"){N=I.ownerDocument.defaultView}I=I.offsetParent}}I=P.parentNode;while(I.tagName&&!K.ROOT_TAG.test(I.tagName)){if(I.scrollTop||I.scrollLeft){if(!K.OP_SCROLL.test(o(I))){if(!af||I.style.overflow!=="visible"){O-=I.scrollLeft;M-=I.scrollTop}}}I=I.parentNode}var L=ag(N);O-=L.left;M-=L.top;H+=O;J+=M;return{left:O,top:M,right:H,bottom:J}}}function r(B){B=B||g;var A=B[q];A=A[v]&&A[v].clientHeight&&A[v].clientHeight<=A.body.clientHeight?A[v]:A.body;return{width:A.clientWidth,height:A.clientHeight}}function ag(E){E=E||g;var F=E[q],C=F[v],D=F.body;F=(C&&C.scrollTop!=null&&(C.scrollTop>D.scrollLeft||C.scrollLeft>D.scrollLeft))?C:D;return{top:F.scrollTop,left:F.scrollLeft}}function ab(A){src=A?(A.srcElement||A.target):null;if($dp&&$dp.cal&&!$dp.eCont&&$dp.dd&&o($dp.dd)=="block"&src!=$dp.el){$dp.cal.close()}}function d(){$dp.status=2;x()}function x(){if($dp.flatCfgs.length>0){var A=$dp.flatCfgs.shift();A.el={innerHTML:""};A.autoPickDate=true;A.qsEnabled=false;u(A)}}var n,m;function h(G,F){$dp.win=e;ad();G=G||{};if(F){if(!H()){m=m||setInterval(function(){if(g[q].readyState=="complete"){clearInterval(m)}h(null,true)},50);return}if($dp.status==0){$dp.status=1;u({el:{innerHTML:""}},true)}else{return}}else{if(G.eCont){G.eCont=$dp.$(G.eCont);$dp.flatCfgs.push(G);if($dp.status==2){x()}}else{if($dp.status==0){h(null,true);return}if($dp.status!=2){return}var I=B();if(I){$dp.srcEl=I.srcElement||I.target;I.cancelBubble=true}G.el=$dp.$(G.el||$dp.srcEl);if(!G.el||G.el.disabled||(G.el==$dp.el&&o($dp.dd)!="none"&&$dp.dd.style.left!="-1970px")){return}u(G)}}function H(){if(j&&g!=e&&g[q].readyState!="complete"){return false}return true}function B(){if(w){func=B.caller;while(func!=null){var A=func.arguments[0];if(A&&(A+"").indexOf("Event")>=0){return A}func=func.caller}return null}return event}}function l(A,B){return A.currentStyle?A.currentStyle[B]:document.defaultView.getComputedStyle(A,false)[B]}function o(A,B){if(A){if(B!=null){A.style.display=B}else{return l(A,"display")}}}function u(A,G){for(var I in ah){if(I.substring(0,1)!="$"){$dp[I]=ah[I]}}for(I in A){if($dp[I]!==undefined){$dp[I]=A[I]}}var F=$dp.el?$dp.el.nodeName:"INPUT";if(G||$dp.eCont||new RegExp(/input|textarea|div|span|p|a/ig).test(F)){$dp.elProp=F=="INPUT"?"value":"innerHTML"}else{return}if($dp.lang=="auto"){$dp.lang=j?navigator.browserLanguage.toLowerCase():navigator.language.toLowerCase()}if(!$dp.dd||$dp.eCont||($dp.lang&&$dp.realLang&&$dp.realLang.name!=$dp.lang&&$dp.getLangIndex&&$dp.getLangIndex($dp.lang)>=0)){if($dp.dd&&!$dp.eCont){g[q].body.removeChild($dp.dd)}if(ah.$dpPath==""){z(ae)}var K='<iframe src="'+ah.$dpPath+'My97DatePicker.htm" frameborder="0" border="0" scrolling="no"></iframe>';if($dp.eCont){$dp.eCont.innerHTML=K;c($dp.eCont.childNodes[0],d)}else{$dp.dd=g[q].createElement("DIV");$dp.dd.style.cssText="position:absolute;z-index:19700";$dp.dd.innerHTML=K;g[q].body.insertBefore($dp.dd,g[q].body.firstChild);c($dp.dd.childNodes[0],d);if(G){$dp.dd.style.left=$dp.dd.style.top="-1970px"}else{$dp.show();J()}}}else{if($dp.cal){$dp.show();$dp.cal.init();if(!$dp.eCont){J()}}}function J(){var S=$dp.position.left,N=$dp.position.top,M=$dp.el;if(M!=$dp.srcEl&&(o(M)=="none"||M.type=="hidden")){M=$dp.srcEl}var R=f(M),P=y(e),L=r(g),O=ag(g),T=$dp.dd.offsetHeight,Q=$dp.dd.offsetWidth;if(isNaN(N)){if(N=="above"||(N!="under"&&((P.topM+R.bottom+T>L.height)&&(P.topM+R.top-T>0)))){N=O.top+P.topM+R.top-T-3}else{N=O.top+P.topM+R.bottom}N+=j?-1:1}else{N+=O.top+P.topM}if(isNaN(S)){S=O.left+Math.min(P.leftM+R.left,L.width-Q-5)-(j?2:0)}else{S+=O.left+P.leftM}$dp.dd.style.top=N+"px";$dp.dd.style.left=S+"px"}}})();jQuery(document).ready(function(){function accAdd(arg1,arg2){var r1,r2,m;r1=arg1.toString().split(".");if(r1[1]){r1=r1[1].length}else{r1=0}r2=arg2.toString().split(".");if(r2[1]){r2=r2[1].length}else{r2=0}m=Math.pow(10,Math.max(r1,r2));return(arg1*m+arg2*m)/m}Number.prototype.add=function(arg){return accAdd(arg,this)};function accSub(arg1,arg2){return accAdd(arg1,-arg2)}Number.prototype.sub=function(arg){return accSub(this,arg)};function accMul(arg1,arg2){var m=0,s1=arg1.toString(),s2=arg2.toString();if(s1.split(".")[1]){m+=s1.split(".")[1].length}if(s2.split(".")[1]){m+=s2.split(".")[1].length}return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)}Number.prototype.mul=function(arg){return accMul(arg,this)};function accDiv(arg1,arg2){var t1=0,t2=0,r1,r2;if(arg1.toString().split(".")[1]){t1=arg1.toString().split(".")[1].length}if(arg2.toString().split(".")[1]){t2=arg2.toString().split(".")[1].length}with(Math){r1=Number(arg1.toString().replace(".",""));r2=Number(arg2.toString().replace(".",""));return(r1/r2)*pow(10,t2-t1)}}Number.prototype.div=function(arg){if(arg==0){return 0}return accDiv(this,arg)}});function hasAttr(e,d){var c=e.getAttributeNode&&e.getAttributeNode(d);return c?c.specified:false}function addEvent(d,c,e){if(d.addEventListener){d.addEventListener(c,e,false)}else{if(d.attachEvent){d.attachEvent("on"+c,e)}}}function getfocus(d,c){if(!hasAttr(d,"tabindex")){d.tabIndex=-1}addEvent(d,"focus",function(f){if(c){c.call(d,(f||window.event))}})}function AjaxRequest(t,e){var r;var u=e;var p=u.returnArgs;var v=u.method;var n=u.ajaxId;if(window.XMLHttpRequest){r=new XMLHttpRequest();if(r.overrideMimeType){r.overrideMimeType("text/html")}}else{if(window.ActiveXObject){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(o){try{r=new XMLHttpRequest()}catch(o){}}}}}var s=u.onComplete;var m=function(){if(r.readyState==4){try{if(r.status==200){var c;try{c=r.getResponseHeader("Ajax-ID")}catch(d){c=""}if(s){s(r,p)}if(c&&c!=""){AjaxUtil.remove(parseInt(c))}}}catch(d){}}};var q=function(h){var c=h.split("?");var d=c[0];var g=c[1];try{if(v=="get"){r.open("GET",h,true);r.onreadystatechange=m;r.send("")}else{r.open("POST",d,true);r.setRequestHeader("Method","POST "+d+" HTTP/1.1");r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.setRequestHeader("Ajax-ID",n);r.onreadystatechange=m;r.send(g)}}catch(f){}};q(t);this.resend=function(c,d){u=d;s=u.onComplete;q(c)};this.getId=function(){return n};this.cleanUp=function(){r.onreadystatechange=function(){};m=null;p=null;r=null}}var AjaxUtil={counter:1,requests:new Array(),request:function(l,f){var h=(f==null)?(new Object()):f;var g=(h.reverseAjax)?0:AjaxUtil.getNextId();h.ajaxId=g;var j;if(g==0&&AjaxUtil.requests[0]){j=AjaxUtil.requests[0];j.resend(l,h)}else{j=new AjaxRequest(l,h);AjaxUtil.requests[g]=j}if(!h.onComplete){AjaxUtil.remove(g)}},update:function(f,h,g){var l=$(h);if(l){if(g==null){g=new Object()}var j=g.onComplete;g.onComplete=function(c,d){l.innerHTML=c.responseText;executeLoadedScript(l);if(j){j()}};AjaxUtil.request(f,g)}},getNextId:function(){var c=AjaxUtil.counter++;if(AjaxUtil.counter>20){AjaxUtil.counter=1}return c},remove:function(c){if(c){var d=AjaxUtil.requests[c];if(d){d.cleanUp();d=null}}}};var ReverseAjax={initialize:function(){Event.observe(window,"unload",function(){ReverseAjax.release()});ReverseAjax.request()},request:function(){AjaxUtil.request(themeDisplay.getPathMain()+"/portal/reverse_ajax",{onComplete:ReverseAjax.response,reverseAjax:true})},response:function(f){var d=$J(f.responseText);var e=d.status;if(e&&e!="failure"){if(e=="success"){if(d.chatMessages){Messaging.getChatsReturn(d.chatMessages)}if(d.chatRoster){MessagingRoster.getEntriesReturn(d.chatRoster)}}ReverseAjax.request()}},release:function(){AjaxUtil.request(themeDisplay.getPathMain()+"/portal/reverse_ajax?release=1",{reverseAjax:true})}};function $J(JSONText){return eval("("+JSONText+")")}function executeLoadedScript(el){var scripts=el.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){if(scripts[i].src){var head=document.getElementsByTagName("head")[0];var scriptObj=document.createElement("script");scriptObj.setAttribute("type","text/javascript");scriptObj.setAttribute("src",scripts[i].src);head.appendChild(scriptObj)}else{try{if(is_safari){eval(scripts[i].innerHTML)}else{if(is_mozilla){eval(scripts[i].textContent)}else{var dj_global=this;if(window.execScript){window.execScript(scripts[i].text)}else{if(dj_global.eval){dj_global.eval(scripts[i].text)}else{eval(scripts[i].text)}}}}}catch(e){if(console!=undefined){console.log(e);console.log(scripts[i].textContent)}alert("error executeLoadedScript:"+e)}}}}function loadForm(r,q,p,l){var m=q.indexOf("?");var e=q;var s="";if(m!=-1){e=q.substring(0,m);s=q.substring(m+1,q.length)}if(!endsWith(s,"&")){s+="&"}for(var o=0;o<r.elements.length;o++){var n=r.elements[o];if((n.name!=null)&&(n.value!=null)){s+=n.name+"="+encodeURIComponent(n.value)+"&"}}if(p!=null){document.body.style.cursor="wait";m=e.indexOf("/portal/layout");e=e.substring(0,m)+"/portal/render_portlet";l=function(c){document.getElementById(p).innerHTML=c.responseText;document.body.style.cursor="default"}}loadPage(e,s,l)}function loadPage(h,g,e,f){AjaxUtil.request(h+"?"+g,{onComplete:e,returnArgs:f})}function printJSON(d){if(d&&d.id){var c=document.getElementById(d.id);if(c){c.innerHTML=d.toString()}}}var Alerts={background:null,message:null,messageArray:new Array(),fadeTimer:0,OPACITY:51,STEPS:3,bgFadeIn:function(f,e,h){var g=Alerts.background;Element.changeOpacity(g,f)},bgFadeOut:function(f,e,h){var g=Alerts.background;if(g){g.parentNode.removeChild(g);setSelectVisibility("visible",Alerts.message);Alerts.background=null}},createWrapper:function(p,v,o){var s=document.createElement("div");var n=document.createElement("div");var q=document.createElement("table");if(!o){o=new Object()}var x=o.maxButton;var y=o.maxURL;s.className="pop-up-outer";if(o.queryindex!=undefined){s.id="pop-up-outer_"+o.queryindex}s.align="center";n.className="pop-up-inner";q.className="pop-up-header";q.border=0;q.width="100%";q.cellSpacing=0;q.cellPadding=0;q.insertRow(0);var r=q.rows[0];r.insertCell(0);r.insertCell(1);var t=r.cells[0];var u=r.cells[1];t.className="pop-up-title";t.id="pop-up-title-"+(Alerts.messageArray.length);t.width="99%";if(v){t.innerHTML=v}var z=o.closeButton;if(z==null||z==undefined){z=true}u.className="pop-up-close";u.width="1%";if(z){u.innerHTML='<a href="javascript:void(0)" title=\'Close\' onclick="Alerts.killAlert(this)"><img border="0" src="/html/nds/images/close.gif"/></a>'}if(x){t.width="98%";r.insertCell(1);var w=r.cells[1];u.id="pop-up-close-x";w.className="pop-up-close";w.width="1%";w.innerHTML="<a href=\"javascript:void(0)\" title='Single window' onclick=\"Alerts.killAlert(this);popup_window('"+y+'\',\'_blank\');"><img border="0" src="/html/nds/images/maxbutton.gif"/></a>'}n.appendChild(q);n.appendChild(p);s.appendChild(n);p.wrapper=s;return s},killAlert:function(l){if(l){var j=l;while(j.parentNode){if(j.className&&j.className.match("pop-up-outer")){break}j=j.parentNode}var h=document.getElementsByTagName("body")[0];var g=j.options;var n=null;var m=false;if(g.queryindex!=undefined){j=$("pop-up-outer_"+g.queryindex)}Alerts.remove(j);h.removeChild(j);if(Alerts.messageArray.length>0){Alerts.message=Alerts.messageArray[Alerts.messageArray.length-1];Alerts.message.style.zIndex=ZINDEX.ALERT+1;setSelectVisibility("visible",Alerts.message);n=j.background}else{Alerts.message=null;n=Alerts.background}if(n){Alerts.bgFadeOut(Alerts.OPACITY,Alerts.STEPS)}if(g&&g.onClose){g.onClose()}}},fireMessageBox:function(n){var t=document.body;if(!n){n=new Object()}var q=n.modal;var o=n.message;var u=n.height;var w=n.width;var s=n.noCenter;var r=n.title;var v=n.options;var p=document.createElement("div");p.align="left";var y=Alerts.createWrapper(p,r,n);y.style.position="absolute";y.style.top=0;y.style.left=0;y.style.zIndex=ZINDEX.ALERT+1;y.options=n;if(o){p.innerHTML=o}else{p.innerHTML='<div class="portlet-loading"></div>'}if(u){if(is_ie){p.style.height=u+"px"}else{p.style.minHeight=u+"px"}}if(w){y.style.width=w+"px"}if(!Alerts.background&&q){var z=document.createElement("div");z.id="alert-message";z.style.position="absolute";z.style.top="0";z.style.left="0";z.style.zIndex=ZINDEX.ALERT;Alerts.background=z;y.background=z;z.style.backgroundColor="#000000";Element.changeOpacity(z,0);t.appendChild(z);Alerts.bgFadeIn(Alerts.OPACITY,Alerts.STEPS)}setSelectVisibility("hidden");if(Alerts.messageArray.length>0){var x=Alerts.messageArray[Alerts.messageArray.length-1];x.style.zIndex=ZINDEX.ALERT-1;setSelectVisibility("hidden",x)}setSelectVisibility("visibile",p);Alerts.message=p;Alerts.messageArray.push(y);Alerts.resize();Event.observe(window,"resize",Alerts.resize);if(s){Alerts.center()}else{Alerts.center(u,w)}Event.observe(window,"resize",Alerts.center);t.appendChild(y);window.focus();return p},popupIframe:function(g,h){if(h.maxButton){h.maxURL=g}var j=h.height;var l=h.width;var m=Alerts.fireMessageBox(h);var n=document.createElement("iframe");n.className="popup-iframe";n.id="popup-iframe-"+(Alerts.messageArray.length-1);m.height="";n.frameBorder=0;if(l){n.style.width="100%"}m.appendChild(n);n.src=g;if(!h.noCenter){Alerts.center(j,l)}return m},center:function(j,r,o){if(Alerts.message){var q=Alerts.message.wrapper;var l=document.getElementsByTagName("body")[0];var m=q.options.centerMode;if(!m){if(j&&r){m=q.options.centerMode="xy"}else{if(j&&!r){m=q.options.centerMode="y"}else{if(!j&&r){m=q.options.centerMode="x"}else{if(j&&r&&o){m=q.options.centerMode="abs"}else{m=q.options.centerMode="none"}}}}}if(isNaN(r)){r=q.offsetWidth}if(isNaN(j)){j=q.offsetHeight}var n;var p;if(!is_safari){var n=(l.clientWidth-r)/2;var p=l.scrollTop+((l.clientHeight-j)/2)}else{var n=(l.offsetWidth-r)/2;var p=(l.offsetHeight-j)/2}if(m=="abs"){if(o){q.style.top=o+"px";q.style.left=n+"px"}return}if(m=="xy"||m=="y"){q.style.top=p+"px"}else{q.style.top=(l.scrollTop+10)+"px"}if(m=="xy"||m=="x"){q.style.left=n+"px"}else{q.style.left="20px"}}},resize:function(){if(Alerts.background){var h=Alerts.background;var f=document.getElementsByTagName("body")[0];if(!is_safari){var g=f.scrollHeight;var e=f.clientHeight;h.style.height=(g>e?g:e)+"px";h.style.width="100%"}else{h.style.height=f.offsetHeight+"px";h.style.width=f.offsetWidth+"px"}}},resizeIframe:function(e){if(Alerts.message&&e){var d=Alerts.message.getElementsByTagName("iframe")[0];var f=document.getElementsByClassName("portlet-loading",Alerts.message);if(f.length>0){f[0].parentNode.removeChild(f[0])}if(d){if(e.height){d.height=e.height}if(e.width){d.width=e.width}}}Alerts.resize()},remove:function(f){var e=Alerts.messageArray;for(var d=0;d<e.length;d++){if(e[d]==f){e.splice(d,1);break}}}};document.onclick=hideCalendar;function showCalendar(D,G,H,I,J,A){var p,t;var z=document.getElementById("CalFrame");if(z==null){return}var F=window.frames.CalFrame;var v=document.getElementById(D);if(!v){alert(D+" does not exists");return}if(!H){alert("Not set input object");return}p=document.getElementById(H);if(!p){alert("Input object does not exists");return}if(p.tagName!="INPUT"||p.type!="text"){alert("Wrong input object");return}if(I){t=document.getElementById(I);if(!t){alert("Ref input object does not exists");return}if(t.tagName!="INPUT"||t.type!="text"){alert("Ref object type error");return}}if(!F.bCalLoaded){alert("Calendar control not loaded, please refresh page");return}if(z.style.display=="block"){z.style.display="none";return}var y=0,w=0,x=p;var E=document.body.scrollTop,B=document.body.scrollLeft;var u=v.height,C=v.width;while(x&&x.tagName!="BODY"){y+=x.offsetTop;w+=x.offsetLeft;x=x.offsetParent}z.style.top=((document.body.clientHeight-(y-E)-u>=z.height)?y+u:(y-z.Height))+"px";z.style.left=((document.body.clientWidth-(w-B)>=z.width)?w:w+C-z.width)+"px";z.style.display="block";F.openbound=G;F.fld1=p;F.fld2=t;F.callback=J;F.initCalendar(A)}function hideCalendar(){var c=document.getElementById("CalFrame");if(c==null){return}c.style.display="none"}var Cookies={};Cookies.set=function(e,g){var c=arguments;var l=arguments.length;var d=(l>2)?c[2]:null;var j=(l>3)?c[3]:"/";var f=(l>4)?c[4]:null;var h=(l>5)?c[5]:false;document.cookie=e+"="+escape(g)+((d==null)?"":("; expires="+d.toGMTString()))+((j==null)?"":("; path="+j))+((f==null)?"":("; domain="+f))+((h==true)?"; secure":"")};Cookies.get=function(f){var d=f+"=";var h=d.length;var c=document.cookie.length;var g=0;var e=0;while(g<c){e=g+h;if(document.cookie.substring(g,e)==d){return Cookies.getCookieVal(e)}g=document.cookie.indexOf(" ",g)+1;if(g==0){break}}return null};Cookies.clear=function(c){if(Cookies.get(c)){var d=new Date();d.setTime(d.getTime()-(86400*1000*1));Cookies.set(c,"",d)}};Cookies.getCookieVal=function(d){var c=document.cookie.indexOf(";",d);if(c==-1){c=document.cookie.length}return unescape(document.cookie.substring(d,c))};var NDS_PATH="/html/nds";var gMessageHolder={INTERNAL_ERROR:"\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u65f6\u9047\u5230\u5f02\u5e38",LOADING:"\u670d\u52a1\u5668\u5904\u7406\u4e2d",CATEGORY_GUIDE:"\u5206\u7c7b\u5bfc\u822a",MAINTAIN_BY_SYS:"\u7cfb\u7edf\u7ef4\u62a4",TIME_OUT:"\u64cd\u4f5c\u8d85\u65f6",DO_YOU_CONFIRM_DELETE:"\u4f60\u786e\u8ba4\u8981\u5220\u9664\u6574\u4e2a0(\u82e5\u6709\u660e\u7ec6\u4e5f\u4e00\u5e76\u5220\u9664)\uff1f",DO_YOU_CONFIRM_UNSUBMIT:"\u4f60\u786e\u8ba4\u8981\u53d6\u6d88\u63d0\u4ea4\u5417?",DO_YOU_CONFIRM_SUBMIT:"\u4f60\u786e\u8ba4\u8981\u6267\u884c\u63d0\u4ea4\u52a8\u4f5c\u5417?",DO_YOU_CONFIRM_GROUPSUBMIT:"\u5f53\u524d\u7c7b\u578b\u5bf9\u8c61\u7684\u591a\u884c\u540c\u65f6\u63d0\u4ea4\u5c06\u4ea7\u751f\u6570\u636e\u201c\u5408\u5e76\u201d\u7684\u7279\u6b8a\u529f\u80fd\u3002\\n\\n\u60a8\u786e\u8ba4\u8981\u6267\u884c\u6b64\u7279\u6b8a\u529f\u80fd?\\n\\n\uff08\u9009\u62e9\u201c\u53d6\u6d88\u201d\u5982\u679c\u60a8\u5c1a\u4e0d\u4e86\u89e3\u6240\u8c13\u201c\u5408\u5e76\u201d\u7684\u610f\u4e49\uff0c\u5e76\u67e5\u770b\u6709\u5173\u5e2e\u52a9\u4ee5\u660e\u786e\uff09",NO_PERMISSION:"\u6ca1\u6709\u6743\u9650",EXCEPTION:"\u5f02\u5e38",PLEASE_CHECK_SELECTED_LINES:"\u8bf7\u5728\u8981\u9009\u62e9\u7684\u884c\u9996\u6253\u52fe\u786e\u8ba4\uff01",PLEASE_SELECT_LINES_LESS_THAN:"\u8bf7\u9009\u62e9\u5c11\u4e8e20\u884c\u7684\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u5ba2\u6237\u7aef\u54cd\u5e94\u901f\u5ea6\uff01",MORE_COMMANDS:"\u66f4\u591a",CONFIRM_DELETE_CHECKED:"\u4f60\u786e\u8ba4\u8981\u5220\u9664\u9009\u4e2d\u7684\u884c\uff1f",NO_DATA_TO_PROCESS:"\u6ca1\u6709\u9700\u8981\u5904\u7406\u7684\u6570\u636e",CAN_NOT_BE_NULL:"\u4e0d\u80fd\u4e3a\u7a7a",MUST_BE_DATE_TYPE:"\u5fc5\u987b\u662f\u65e5\u671f\u578b",MUST_BE_NUMBER_TYPE:"\u5fc5\u987b\u662f\u6570\u5b57\u578b",PLEASE_SELECT:"\u8bf7\u9009\u62e9",MAINTAIN_BY_SYS:"\u7cfb\u7edf\u7ef4\u62a4",NO_PERMISSION:"\u6ca1\u6709\u8db3\u591f\u7684\u6743\u9650",CMD_ADD:"\u65b0\u589e",CMD_MODIFY:"\u4fee\u6539",CMD_DELETE:"\u5220\u9664",CMD_SUBMIT:"\u63d0\u4ea4",CMD_REFRESH:"\u5237\u65b0",CMD_CXTAB:"\u7edf\u8ba1",CMD_LISTADD:"\u6279\u91cf\u65b0\u589e",CMD_IMPORT:"\u5bfc\u5165",CMD_LISTCOPYTO:"\u590d\u5236",CMD_UPDATE_SELECTION:"\u4fee\u6539\u9009\u4e2d\u884c",CMD_UPDATE_RESULTSET:"\u4fee\u6539\u7ed3\u679c\u96c6",CMD_PRINT_LIST:"\u6253\u5370",CMD_EXPORT_LIST:"\u5bfc\u51fa",CMD_SMS_LIST:"\u77ed\u4fe1",CAN_NOT_QUICK_SEARCH:"\u67e5\u8be2\u5f02\u5e38\uff0c\u8bf7\u5237\u65b0\u5f53\u524d\u7f51\u9875\u540e\u518d\u8bd5",CONFIRM_DELETE_CHECKED:"\u4f60\u786e\u8ba4\u5220\u9664\u9009\u62e9\u7684\u884c?",NO_DATA_TO_PROCESS:"\u6ca1\u6709\u6570\u636e\u9700\u8981\u5904\u7406",CONFIRM_DISCARD_CHANGE:"\u5c1a\u672a\u4fdd\u5b58\u66f4\u6539\uff0c\u4f60\u786e\u8ba4\u8981\u653e\u5f03?",DENY_AS_NEW_OBJ:"\u8bf7\u5148\u4fdd\u5b58\uff0c\u7136\u540e\u6267\u884c\u6b64\u64cd\u4f5c",SET_PRODUCT_ATTRIBUTE:"\u8bbe\u7f6e\u5c5e\u6027",SHOW_ATTRIBUTE:"\u8be6\u7ec6",LOAD_ATTRIBUTE:"\u67e5",ATTRIBUTE_MATRIX_SPLITTED:"\u5c5e\u6027\u77e9\u9635\u88ab\u62c6\u5206\u4e3a\u591a\u884c\u4fdd\u5b58",RELOAD_SINCE_ATTRIBUTE_MATRIX_SPLITTED:"\u6709\u5c5e\u6027\u77e9\u9635\u88ab\u62c6\u5206\u6210\u591a\u884c\uff0c\u662f\u5426\u5237\u65b0\u9875\u9762?",NEW_LINE:"\u65b0\u589e\u884c",EDIT_LINE:"\u7f16\u8f91\u884c",INFORMATION:"\u4fe1\u606f",CLOSE_DIALOG:"\u5173\u95ed",FINISH_TIME:"\u5b8c\u6210\u65f6\u95f4",IFRAME_TITLE:"\u5bf9\u8bdd\u6846 ",SEARCH:"\u67e5\u627e",NO_DATA:"\u6ca1\u6709\u6570\u636e",INPUT_FIELD:"\u8bf7\u9996\u5148\u8f93\u51650\u4fe1\u606f",CONTAINS:"\u5305\u542b",NOT_ALLOW_TO_POPUP_AS_NOT_MENUOBJ:"\u5f53\u524d\u660e\u7ec6\u884c\u7981\u6b62\u5f39\u51fa\u7a97\u53e3\u663e\u793a",CLOSE_DIALOG:"\u5173\u95ed",EXCLUDE_CHOOSED_ROWS:"\u6392\u9664\u9009\u4e2d\u884c",EXCLUDE_ALL:"\u6392\u9664\u5168\u90e8",ADD_CHOOSE_ROWS:"\u6dfb\u52a0\u9009\u4e2d\u884c",ADD_ALL:"\u6dfb\u52a0\u5168\u90e8",ALREADY_CHOOSED:"\u5df2\u88ab\u9009\u62e9",ALREADY_EXCLUDE:"\u5df2\u88ab\u6392\u9664",SET_ALREADY_CHOOSED:"\u8be5\u96c6\u5408\u5df2\u88ab\u9009\u62e9",SET_ALREADY_EXCLUDE:"\u8be5\u96c6\u5408\u5df2\u88ab\u6392\u9664",CONFIRM_SAVE_FIRST:"\u6709\u6570\u636e\u6539\u52a8\uff0c\u5148\u4fdd\u5b58\u6539\u52a8?",AVAILABLE:"(\u53ef\u7528 = Y)",CLOSE_AFTER_PRINT:"\u8bf7\u5728\u6253\u5370\u5b8c\u6210\u540e\uff0c\u70b9\u51fb'\u786e\u5b9a'\u6309\u94ae\u5173\u95ed\u5f53\u524d\u7a97\u53e3",NOT_INTEGER:"\u60a8\u8f93\u5165\u7684\u6570\u5b57\u4e0d\u662f\u6574\u6570",PRODUCT_NMNER_ZORE:"\u5546\u54c1\u7684\u6570\u91cf\u4e3a0!",LINE:"\u884c",TURBO_SCAN:"\u6025\u901f\u626b\u63cf",SCAN_ERROR:"\u626b\u63cf\u6761\u7801\u65f6\u53d1\u73b0\u5f02\u5e38:x\u3002\u8bf7\u8f93\u51650\u5173\u95ed\u5f53\u524d\u63d0\u793a(\u5df2\u7d2f\u8ba1\u9519\u8befy\u6b21)",PROCESS_ING:"\u8bf7\u5728\u670d\u52a1\u5668\u5904\u7406\u5b8c\u6210\u540e\u518d\u8f93\u5165",DO_YOU_CONFIRM_UNVOID:"\u786e\u8ba4\u8981\u53d6\u6d88\u4f5c\u5e9f\u5f53\u524d\u5bf9\u8c61\u5417\uff1f",DO_YOU_CONFIRM_VOID:"\u786e\u8ba4\u8981\u4f5c\u5e9f\u5f53\u524d\u5bf9\u8c61\u5417\uff1f"};var jc=null;var JC=Class.create();JC.prototype={initialize:function(){this.docMsg={};this.eleMsg={};this.objInterval=null;this.refreshDocMsg()},refreshDocMsg:function(){this.docMsg.width=parseInt(document.body.clientWidth,10);this.docMsg.height=parseInt(document.body.clientHeight,10);this.docMsg.scrollTop=parseInt(document.body.scrollTop,10);this.docMsg.scrollLeft=parseInt(document.body.scrollLeft,10)},refreshEleMsg:function(c){var d={};d.top=parseInt(c.style.top,10);d.left=parseInt(c.style.left,10);d.offsetHeight=parseInt(c.offsetHeight,10);d.offsetWidth=parseInt(c.offsetWidth,10);this.eleMsg=d},updateEleMsg:function(c,d){if(d.top){c.style.top=d.top}if(d.left){c.style.left=d.left}if(d.offsetHeight){c.style.offsetHeight=d.offsetHeight}if(d.offsetWidth){c.style.offsetWidth=d.offsetWidth}if(d.visibility){c.style.visibility=d.visibility}},popUpEffectLikeMsn:function(d){this.refreshEleMsg(d);var c={};c.top=this.docMsg.scrollTop+this.docMsg.height+10;c.left=this.docMsg.scrollLeft+this.docMsg.width-this.eleMsg.offsetWidth;c.visibility="visible";this.updateEleMsg(d,c);this.objInterval=window.setInterval(function(){jc.moveLikeMsn(d)},10)},clearTnterval:function(){if(this.objInterval){window.clearInterval(this.objInterval)}},moveLikeMsn:function(d){if(parseInt(d.style.top,10)<=(this.docMsg.height-this.eleMsg.offsetHeight+this.docMsg.scrollTop)){this.clearTnterval();window.setTimeout(function(){jc.resizeElement(d)},1)}this.refreshEleMsg(d);var c={};c.top=this.eleMsg.top-1;this.updateEleMsg(d,c)},resizeElement:function(d){this.refreshEleMsg(d);var c={};c.top=this.docMsg.height-this.eleMsg.offsetHeight+this.docMsg.scrollTop;c.left=this.docMsg.width-this.eleMsg.offsetWidth+this.docMsg.scrollLeft;this.updateEleMsg(d,c)},hideElementAndClearInterval:function(d){this.clearTnterval();var c={};c.visibility="hidden";this.updateEleMsg(d,c)}};JC.main=function(){jc=new JC()};jQuery(document).ready(JC.main);var dqComboboxQueries=null;var dqComboboxes=null;var dq=null;var oq=null;var dcq=null;var DynamicQuery=Class.create();var DropdownQuery=Class.create();var ObjectQuery=Class.create();ObjectQuery.prototype={initialize:function(){this._gridQuery=[];this._accepter_id=[];this._mainobjurl=[];this._returnType=[];this._partialData=null;this.multi_result=[];this._queryindex=-1;this._xmlid=[];this.condition="IN";application.addEventListener("QueryObject",this._onQueryObject,this);application.addEventListener("ReturnSQL",this._onReturnSQL,this);application.addEventListener("ReturnSET",this._onReturnSET,this);application.addEventListener("Return_Result",this._onReturn_Result,this)},toggle:function(m,j,n){var g=$(j+"_link");if(g==null||(g!=null&&g.title=="popup")){m=reconstructQueryURL(m,n,j);if(m==null){return}this._queryindex=this._queryindex+1;this.multi_result[this._queryindex]=new Array();this._accepter_id[this._queryindex]=j;var h=Alerts.fireMessageBox({width:610,modal:true,noCenter:true,title:gMessageHolder.SEARCH,queryindex:this._queryindex,onClose:function(){oq.close_query()}});new Ajax.Request(m,{method:"get",onSuccess:function(c){var d=$(h);d.innerHTML=c.responseText;executeLoadedScript(d)},onFailure:function(c){if(c.getResponseHeader("nds.code")=="1"){window.location="/c/portal/login";return}var e=c.getResponseHeader("nds.exception");if(e!=null&&e.length>0){alert(decodeURIComponent(e))}else{var d=$(h);d.innerHTML=c.responseText;executeLoadedScript(d)}}})}else{$(j+"_link").title="popup";$(j+"_img").alt="";$(j).value="";$(j+"_img").src="/html/nds/images/filterobj.gif";if($(j+"_fd")!=null){$(j+"_fd").value="";$(j+"_fd").readOnly=false}if($(j+"_sql")!=null){$(j+"_sql").value="";$(j).readOnly=false}var l=$(j+"_expr");if(l!=null){l.value=""}}},toggle_m:function(m,j,n){var g=$(j+"_link");if(g==null||(g!=null&&g.title=="popup")){m=reconstructQueryURL(m,n,j);if(m==null){return}this._queryindex=this._queryindex+1;this.multi_result[this._queryindex]=new Array();this._accepter_id[this._queryindex]=j;var h=Alerts.fireMessageBox({width:790,modal:true,noCenter:true,title:gMessageHolder.SEARCH,queryindex:this._queryindex,onClose:function(){oq.close_query()}});new Ajax.Request(m,{method:"get",onSuccess:function(c){var d=$(h);d.innerHTML=c.responseText;executeLoadedScript(d)},onFailure:function(c){if(c.getResponseHeader("nds.code")=="1"){window.location="/c/portal/login";return}var e=c.getResponseHeader("nds.exception");if(e!=null&&e.length>0){alert(decodeURIComponent(e))}else{var d=$(h);d.innerHTML=c.responseText;executeLoadedScript(d)}}})}else{$(j+"_link").title="popup";$(j+"_img").alt="";$(j).value="";if(this._returnType[this._queryindex]=="a"){$(j+"_img").src="/html/nds/images/add_filter.gif";if($("tab_"+j)!=null){$("tab_"+j).innerHTML=""}}else{$(j+"_img").src="/html/nds/images/filterobj.gif"}if($(j+"_fd")!=null){$(j+"_fd").value="";$(j+"_fd").readOnly=false}if($(j+"_sql")!=null){$(j+"_sql").value="";$(j).readOnly=false}var l=$(j+"_expr");if(l!=null){l.value=""}}},setQueryObject:function(h,e,g){this._gridQuery[this._queryindex]=h;this._gridQuery[this._queryindex].callbackEvent="QueryObject";this._gridQuery[this._queryindex].returnType=g;this._returnType[this._queryindex]=g;this._xmlid[this._queryindex]=0;this._initGridSelectionControl();this._mainobjurl[this._queryindex]=e;var j=$("pop-up-title-"+this._queryindex);if(j){j.innerHTML=gMessageHolder.SEARCH+" - "+h.table_desc}if(g=="s"){var l=$("btn-rsql");if(l){l.hide()}l=$("btn-sql");if(l){l.hide()}l=$("qcsa");if(l){l.hide()}}},search:function(){this._partialData=null;if($("mulit-info_"+this._queryindex)!=null){$("mulit-info_"+this._queryindex).remove()}var c=$("q_form_"+this._queryindex);this._gridQuery[this._queryindex].param_str=c.serialize();this._gridQuery[this._queryindex].start=0;var d=$("q_form_param_expr_"+this._queryindex);if(d!=null){this._gridQuery[this._queryindex].param_expr=d.value}this._executeQuery(this._gridQuery[this._queryindex])},returnSQL:function(){var d=$("q_form_"+this._queryindex);var c=Object.clone(this._gridQuery[this._queryindex]);c.param_str=d.serialize();c.callbackEvent="ReturnSQL";c.noresult=true;if(this._returnType[this._queryindex]=="f"){c.resulthandler="/html/nds/query/search_result_filter_dropdown.jsp"}else{c.resulthandler="/html/nds/query/search_result_sql.jsp"}this._executeQuery(c)},returnRow:function(j){var g=$(this._accepter_id[this._queryindex]);if(g==null){this.close();return}g.value=j.alt;fireEvent(g,"change");var h=$("fk_"+this._accepter_id[this._queryindex]);if(h!=null){h.value=j.id.replace(/chk_obj_/i,"")}try{g.focus()}catch(f){}if(this._partialData!=null&&g.onaction){var l=Number(j.title);if(l>=0&&l<this._partialData.length){g.onaction(this._partialData[l])}}this.close()},returnValue:function(){var m=Array();var n=Array();var q;var r=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");if(r==null||r.length==0){this.close();return}for(var p=0;p<r.length;p++){if(r[p].checked){m.push(r[p].value);n.push(r[p].id)}}if(m.length==0){alert(gMessageHolder.PLEASE_CHECK_SELECTED_LINES);return}var j=" IN ("+m.join(",")+")";var l=gMessageHolder.CONTAINS+" ("+n.join(",")+")";var o=null;if(this._returnType[this._queryindex]=="f"){var q={expr:{desc:l,clink:this._gridQuery[this._queryindex].table+".ID",condition:j}};var s={filter:{desc:l,sql:j,expr:q}};o=json2xml(s,false);this.returnFilterObj_dropdown(l,o)}else{this.returnQuery(j,l,o)}},returnFilterObj_dropdown:function(c,d){if(c==""){$(this._accepter_id[this._queryindex]+"_fd").value=gMessageHolder.AVAILABLE}else{$(this._accepter_id[this._queryindex]+"_fd").value=c}fireEvent($(this._accepter_id[this._queryindex]+"_fd"),"change");$(this._accepter_id[this._queryindex]).value=d;$(this._accepter_id[this._queryindex]+"_fd").readOnly=true;$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;this.close()},returnFilterObj:function(l,p){var m=this._xmlid[this._queryindex]+"_xml";var j=true;if(l==""){l=gMessageHolder.AVAILABLE}var n={id:l,condition:this.condition,value:m,set:p};var h=this.multi_result[this._queryindex].length;for(var o=0;o<h;o++){if(this.multi_result[this._queryindex][o].id==n.id){j=false;if(this.multi_result[this._queryindex][o].condition!=this.condition){if(this.multi_result[this._queryindex][o].condition=="IN"){alert(gMessageHolder.SET_ALREADY_CHOOSED)}else{alert(gMessageHolder.SET_ALREADY_EXCLUDE)}}break}}if(j){this.multi_result[this._queryindex][h]=n;dwr.util.cloneNode("m_multiple_row_"+this._queryindex,{idPrefix:this.multi_result[this._queryindex][h].value+"_"});$(this.multi_result[this._queryindex][h].value+"_m_multiple_"+this._queryindex).innerHTML='<input type="checkbox" name="m_multiple_'+this._queryindex+'"  value='+this.multi_result[this._queryindex][h].value+">";dwr.util.setValue(this.multi_result[this._queryindex][h].value+"_m_multiple_value_"+this._queryindex,this.multi_result[this._queryindex][h].id);$(this.multi_result[this._queryindex][h].value+"_m_multiple_row_"+this._queryindex).style.display="";this._xmlid[this._queryindex]++}},returnQuery:function(h,f,g){$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;$(this._accepter_id[this._queryindex]).value=f;$(this._accepter_id[this._queryindex]).readOnly=true;fireEvent($(this._accepter_id[this._queryindex]),"change");$(this._accepter_id[this._queryindex]+"_sql").value=h;var e=$(this._accepter_id[this._queryindex]+"_expr");if(e!=null){e.value=g}this.close()},isEmpty:function(c){var d=$(c);return((d!=null&&dwr.util.getValue(d).empty())||d==null)},close:function(){window.setTimeout("Alerts.killAlert(document.getElementById('pop-up-title-"+this._queryindex+"'))",1)},close_query:function(){this.multi_result[this._queryindex]=null;this.condition="IN";this._xmlid[this._queryindex]=0;this._queryindex=this._queryindex-1;if(this._queryindex==-1){this._gridQuery=[]}},onSearchReturn:function(c){if(!c){c=window.event}if(c&&c.keyCode&&c.keyCode==13){this.search()}},_onReturnSQL:function(e){var qr=e.getUserData().data;if(qr.pagecontent!=null){eval(qr.pagecontent)}},_toggleButtons:function(c){if(c){$("btn-search").disable();if($("btn-value")!=null){$("btn-value").disable()}if($("btn-search")!=null){$("btn-search").disable()}if($("btn-sql")!=null){$("btn-sql").disable()}}else{$("btn-search").enable();if($("btn-value")!=null){$("btn-value").enable()}if($("btn-search")!=null){$("btn-search").enable()}if($("btn-sql")!=null){$("btn-sql").enable()}}},_onQueryObject:function(o){var e=o.getUserData().data;if(e.pagecontent!=null){if(Prototype.Browser.IE){var u=$("q_embed_lines_"+this._queryindex);var s=u.innerHTML;var t=s.indexOf("<!--$QGRIDTABLE_START-->");var m=s.indexOf("<!--$QGRIDTABLE_END-->");var q=s.substring(0,t+"<!--$QGRIDTABLE_START-->".length);var n=s.substr(m);var v=q.concat("<tbody id='q_grid_table_"+this._queryindex+"'>",e.pagecontent,"</tbody>",n);u.innerHTML=v;executeLoadedScript(u);this._initGridSelectionControl()}else{var r=$("q_grid_table_"+this._queryindex);dwr.util.removeAllRows(r);r.innerHTML=e.pagecontent;executeLoadedScript(r)}}if(e.rows!=null){this._partialData=e.rows;e.rows=null}else{this._partialData=null}this._syncGridControl(e);var p=e.queryDesc;if(e.message!=undefined&&e.message!=null){p+="<br><blink><span class='err'>***"+e.message+"</blink>"}$("q_filter_setting_"+this._queryindex).innerHTML=p;dwr.util.setValue($("q_chk_select_all_"+this._queryindex),false);$("query-data_"+this._queryindex).show()},_syncGridControl:function(d){this._gridQuery[this._queryindex].totalRowCount=d.totalRowCount;this._gridQuery[this._queryindex].start=d.start;if(this._gridQuery[this._queryindex].order_columns!=null){var c=$("q_title_"+this._gridQuery[this._queryindex].order_columns);if(c!=null){c.innerHTML="<img src='/html/nds/images/"+(this._gridQuery[this._queryindex].order_asc?"up":"down")+"simple.png'>"}}if($("q_txtRange_"+this._queryindex)!=null){$("q_txtRange_"+this._queryindex).innerHTML=((d.start+1)+"-"+(d.start+d.rowCount)+"/"+d.totalRowCount);if(d.start>0){$("q_begin_btn_"+this._queryindex).setEnabled(true);$("q_prev_btn_"+this._queryindex).setEnabled(true)}else{$("q_begin_btn_"+this._queryindex).setEnabled(false);$("q_prev_btn_"+this._queryindex).setEnabled(false)}if((d.start+d.rowCount)<d.totalRowCount){$("q_next_btn_"+this._queryindex).setEnabled(true);$("q_end_btn_"+this._queryindex).setEnabled(true)}else{$("q_next_btn_"+this._queryindex).setEnabled(false);$("q_end_btn_"+this._queryindex).setEnabled(false)}}},_executeQuery:function(c){$("q_progress_"+this._queryindex).show();this._toggleButtons(true);var d=Object.toJSON(c);Controller.query(d,function(f){var h=f.evalJSON();if(h.code!=0){oq._toggleButtons(false);msgbox(h.message)}else{var g=new BiEvent(h.callbackEvent);g.setUserData(h);application.dispatchEvent(g);oq._toggleButtons(false)}});$("q_progress_"+this._queryindex).hide()},_initGridSelectionControl:function(){var c=new SelectableTableRows(document.getElementById("q_inc_table"),false);if(this._returnType[this._queryindex]!="s"){c.ondoubleclick=function(d){oq.mo(d.id.replace(/_qtemplaterow/i,""))}}else{c.ondoubleclick=function(h){var l=$("chk_obj_"+h.id.replace(/_qtemplaterow/i,""));var g=$(oq._accepter_id[this._queryindex]);g.value=l.alt;var j=$("fk_"+oq._accepter_id[this._queryindex]);if(j!=null){j.value=l.id.replace(/chk_obj_/i,"")}if(oq._partialData!=null&&g.onaction){var m=Number(l.title);if(m>=0&&m<oq._partialData.length){g.onaction(oq._partialData[m])}}oq.close()}}},fk:function(c,d){popup_window("/html/nds/object/object.jsp?table="+c+"&id="+d)},mo:function(c){popup_window(this._mainobjurl[this._queryindex]+c)},refreshGrid:function(){this._executeQuery(this._gridQuery[this._queryindex])},orderGrid:function(e){var h=this._gridQuery[this._queryindex].order_columns;var g=this._gridQuery[this._queryindex].order_asc;if(h==e){this._gridQuery[this._queryindex].order_asc=!g}else{var f=$("q_title_"+h+"_"+this._queryindex);if(f!=null){f.innerHTML=""}this._gridQuery[this._queryindex].order_columns=e;this._gridQuery[this._queryindex].order_asc=true}this._executeQuery(this._gridQuery[this._queryindex])},scrollPage:function(m){var l;var n=Object.clone(this._gridQuery[this._queryindex]);var h=n.start;var g=parseInt($("q_range_select_"+this._queryindex).value,10);var j=n.totalRowCount;if(m=="q_begin_btn_"+this._queryindex){l=0}else{if(m=="q_prev_btn_"+this._queryindex){l=h-g}else{if(m=="q_next_btn_"+this._queryindex){l=h+g}else{if(m=="q_end_btn_"+this._queryindex){l=j-g}else{l=h}}}}n.start=l;n.range=g;this._gridQuery[this._queryindex].range=g;this._executeQuery(n)},selectAll:function(){var f=$("q_chk_select_all_"+this._queryindex);f.checked=f.checked|0;var e=f.checked;var g=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");for(var h=0;h<g.length;h++){g[h].checked=e;this.dynamic_add(g[h].id)}},return_content:function(y){var A=null;var z=this.multi_result[this._queryindex].length;var s=this.multi_result[this._queryindex].length;var r=false;var u=false;var w=null;var j=null;var q=null;var x=$("q_fm_list_"+this._queryindex).getInputs("checkbox","itemid");for(var t=0;t<x.length;t++){r=false;if(x[t].id==y){j=this.condition+"("+x[t].value+")";A={id:x[t].id,value:x[t].value,condition:this.condition,clkstr:this._gridQuery[this._queryindex].table+".ID"};for(var v=0;v<z;v++){if(this.multi_result[this._queryindex][v].value==x[t].value){r=true;if(this.multi_result[this._queryindex][v].condition!=this.condition){if(this.multi_result[this._queryindex][v].condition=="IN"){alert(this.multi_result[this._queryindex][v].id+gMessageHolder.ALREADY_CHOOSED)}else{alert(this.multi_result[this._queryindex][v].id+gMessageHolder.ALREADY_EXCLUDE)}u=true}break}}if(!r){this.multi_result[this._queryindex][s]=A;s++}}}for(var p=z;p<this.multi_result[this._queryindex].length;p++){dwr.util.cloneNode("m_multiple_row_"+this._queryindex,{idPrefix:this.multi_result[this._queryindex][p].value+"_"});$(this.multi_result[this._queryindex][p].value+"_m_multiple_"+this._queryindex).innerHTML='<input type="checkbox" name="m_multiple_'+this._queryindex+'"  value='+this.multi_result[this._queryindex][p].id+">";if(this.multi_result[this._queryindex][p].condition!="IN"){dwr.util.setValue(this.multi_result[this._queryindex][p].value+"_m_multiple_value_"+this._queryindex,gMessageHolder.NOTCONTAINS+"("+this.multi_result[this._queryindex][p].id+")")}else{dwr.util.setValue(this.multi_result[this._queryindex][p].value+"_m_multiple_value_"+this._queryindex,gMessageHolder.CONTAINS+"("+this.multi_result[this._queryindex][p].id+")")}$(this.multi_result[this._queryindex][p].value+"_m_multiple_row_"+this._queryindex).style.display=""}},remove_choosed_rows:function(){var g=false;var j=this._queryindex;var h=document.getElementsByName("m_multiple_"+j);for(var l=h.length-1;l>=0;l--){if(h[l].checked){g=true;var f=this.multi_result[this._queryindex][l].value;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(c){return(c.id==f+"_m_multiple_row_"+j)}});this.multi_result[this._queryindex].splice(l,1)}}if(!g){alert(gMessageHolder.PLEASE_CHECK_SELECTED_LINES)}},remove_all:function(){var c=this._queryindex;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(d){return(d.id!="m_multiple_row_"+c)}});this.multi_result[this._queryindex]=null;this.multi_result[this._queryindex]=new Array();this.condition="IN"},return_set:function(){var d=$("q_form_"+this._queryindex);var c=Object.clone(this._gridQuery[this._queryindex]);c.param_str=d.serialize();c.callbackEvent="ReturnSET";c.noresult=true;c.condition=this.condition;c.returnType=this._returnType[this._queryindex];c.resulthandler="/html/nds/query/search_result_filter.jsp";this._executeQuery(c)},return_result:function(){if(this.multi_result[this._queryindex].length==0){alert(gMessageHolder.NO_DATA_TO_PROCESS)}else{var c={};c.command="Return_Result";c.params=this.multi_result[this._queryindex];c.table=this._gridQuery[this._queryindex].table;c.returnType=this._returnType[this._queryindex];c.callbackEvent="Return_Result";this._executeCommandEvent(c)}},_onReturn_Result:function(f){var d=f.getUserData();var e=d.data;if(this._returnType[this._queryindex]=="f"){if(e.desc==""){$(this._accepter_id[this._queryindex]+"_fd").value=gMessageHolder.AVAILABLE}else{$(this._accepter_id[this._queryindex]+"_fd").value=e.desc}$(this._accepter_id[this._queryindex]).value=e.filterxml;$(this._accepter_id[this._queryindex]+"_fd").readOnly=true;$(this._accepter_id[this._queryindex]+"_fd").title=$(this._accepter_id[this._queryindex]+"_fd").value}else{if(this._returnType[this._queryindex]=="a"){$(this._accepter_id[this._queryindex]).value=e.desc;if($("tab_"+this._accepter_id[this._queryindex])!=null){$("tab_"+this._accepter_id[this._queryindex]).innerHTML=e.desc}$(this._accepter_id[this._queryindex]+"_expr").value=e.filterxml;$(this._accepter_id[this._queryindex]+"_sql").value=e.sql;$(this._accepter_id[this._queryindex]).readOnly=true;$(this._accepter_id[this._queryindex]).title=e.desc}else{$(this._accepter_id[this._queryindex]).value=e.desc;$(this._accepter_id[this._queryindex]+"_filter").value=e.filterxml;$(this._accepter_id[this._queryindex]+"_sql").value=e.sql;$(this._accepter_id[this._queryindex]).readOnly=true;$(this._accepter_id[this._queryindex]).title=e.desc}}$(this._accepter_id[this._queryindex]+"_img").src="/html/nds/images/clear.gif";$(this._accepter_id[this._queryindex]+"_link").title="clear";$(this._accepter_id[this._queryindex]+"_img").alt=gMessageHolder.CLEAR_CONDITION;this.close()},reverse_condition:function(){if($("condition_"+this._queryindex).checked){$("btn-choose-set_"+this._queryindex).value=gMessageHolder.EXCLUDE_ALL;this.condition="NOT IN"}else{$("btn-choose-set_"+this._queryindex).value=gMessageHolder.ADD_ALL;this.condition="IN"}},_executeCommandEvent:function(c){Controller.handle(Object.toJSON(c),function(f){var e=f.evalJSON();var g=new BiEvent(e.callbackEvent);g.setUserData(e);application.dispatchEvent(g)})},_onReturnSET:function(e){var qr=e.getUserData().data;if(qr.pagecontent!=null){eval(qr.pagecontent)}},dynamic_add:function(c){if($("multi-list_"+this._queryindex)!=null){if($(c).checked){this.return_content(c)}else{this.dyn_remove_choosed_rows(c)}}},dyn_remove_choosed_rows:function(g){var j=this._queryindex;var h=document.getElementsByName("m_multiple_"+j);for(var l=h.length-1;l>=0;l--){if(h[l].value==g){if(this.multi_result[this._queryindex][l].condition==this.condition){var f=this.multi_result[this._queryindex][l].value;dwr.util.removeAllRows("content_"+this._queryindex,{filter:function(c){return(c.id==f+"_m_multiple_row_"+j)}});this.multi_result[this._queryindex].splice(l,1)}else{if(this.multi_result[this._queryindex][l].condition=="IN"){alert(this.multi_result[this._queryindex][l].id+gMessageHolder.ALREADY_CHOOSED)}else{alert(this.multi_result[this._queryindex][l].id+gMessageHolder.ALREADY_EXCLUDE)}}break}}},unselectall:function(){dwr.util.setValue($("q_chk_select_all_"+this._queryindex),false)}};ObjectQuery.main=function(){oq=new ObjectQuery()};jQuery(document).ready(ObjectQuery.main);DropdownQuery.prototype={initialize:function(){this._selTb=null;this._prevSelected=null;this._accepter_id=null;this._temp=null;application.addEventListener("DropdownQueryRefresh",this._refreshGrid,this)},toggle:function(p,q,f){if(q){this._accepter_id=q}var o,j,v,u;u="div_"+q;var w=document.getElementById(q);var x=document.getElementById(u);var s=document.getElementById("dwrloading_"+q);if(f!=undefined&&f!=null){p=reconstructQueryURL(p,f,q);if(p==null){return}if(x!=null){x.innerHTML="<div id='content_"+q+"' style='width:160;position: relative; z-index: 10;'><span id='dwrloading_"+q+"' style='width:160;height:20;'>"+gMessageHolder.LOADING+"</span></div><iframe id='json_"+q+"' frameborder='0' style='width:160px; height:20; position: absolute; top: 0; left: 0; z-index: 9;'></iframe>";s=document.getElementById("dwrloading_"+q)}}if(x==null||s!=null){if(x==null){x=document.createElement("div");x.id=u;x.className="comboBoxList";x.innerHTML="<div id='content_"+q+"' style='width:160;position: relative; z-index: 10;'><span id='dwrloading_"+q+"' style='width:160;height:20;'>"+gMessageHolder.LOADING+"</span></div><iframe id='json_"+q+"' frameborder='0' style='width:160px; height:20; position: absolute; top: 0; left: 0; z-index: 9;'></iframe>";document.body.appendChild(x)}this._resize(q);o=p.indexOf("?");j=p;v="";if(o!=-1){j=p.substring(0,o);v=p.substring(o+1,p.length)}loadPage(j,v,this._returnQuery,q);if(dqComboboxes==null){dqComboboxes=new Array();dqComboboxQueries={};dqtemps={};Event.observe(document.body,"mousedown",function(e){var c=$(Event.element(e)).up(".comboBoxList");var g,d;for(g=dqComboboxes.length-1;g>=0;g--){d=$(dqComboboxes[g]);if(d!=null&&d.style.display=="block"){if(c==null||c.id!=d.id){d.style.display="none"}}}})}var t,r=false;for(t=0;t<dqComboboxes.length;t++){if(dqComboboxes[t]==u){r=true;break}}if(r==false){dqComboboxes[dqComboboxes.length]=u}}else{if(x.style.display=="none"){this._repos(q)}}},_repos:function(g){var e=document.getElementById("div_"+g);var h=getOffsets(g);var f=document.getElementById(g);e.style.top=h.y+(f.offsetHeight?f.offsetHeight:22)+"px";e.style.left=h.x+"px";e.style.display="block"},_resize:function(g){var e=document.getElementById("div_"+g);var h=document.getElementById("content_"+g);var f=document.getElementById("tdv_"+g);if(f!=null){h.style.width=f.style.width}e.style.width=h.style.width;this._repos(g)},_returnQuery:function(d,f){var e=document.getElementById("content_"+f);e.innerHTML=d.responseText;executeLoadedScript(e);this._resize(f)},_refreshGrid:function(d){var f=d.getUserData().data.tag;var e=document.getElementById("content_"+f);e.innerHTML=d.getUserData().data.pagecontent;executeLoadedScript(e);this.syncGridControl(this._accepter_id)},syncGridControl:function(f){var h=dqComboboxQueries[f];var g=h.accepter_id;var e=$("begin_btn_"+g);if(h.start>1){$("begin_btn_"+g).setEnabled(true);$("prev_btn_"+g).setEnabled(true)}else{$("begin_btn_"+g).setEnabled(false);$("prev_btn_"+g).setEnabled(false)}if((h.start+h.rowcount)<h.totalCount){$("next_btn_"+g).setEnabled(true);$("end_btn_"+g).setEnabled(true)}else{$("next_btn_"+g).setEnabled(false);$("end_btn_"+g).setEnabled(false)}},scrollPage:function(o,h){var n;var l=Object.clone(dqComboboxQueries[h]);l.tag=h;var j=l.start;var p=l.range;var m=l.totalCount;if(o=="refresh_"+h){n=0}else{if(o=="begin_btn_"+h){n=0}else{if(o=="prev_btn_"+h){n=j-p-1}else{if(o=="next_btn_"+h){n=j+p-1}else{if(o=="end_btn_"+h){n=m-p-1}else{n=j}}}}}l.start=n;l.range=p;this._executeQuery(l)},_executeQuery:function(c){var d=Object.toJSON(c);Controller.query(d,function(f){var h=f.evalJSON();if(h.code!=0){msgbox(h.message)}else{var g=new BiEvent(h.callbackEvent);g.setUserData(h);application.dispatchEvent(g)}})},returnRow:function(g){var e=document.getElementById(this._accepter_id);if(e){e.value=g.title;var j=$("fk_"+this._accepter_id);if(j!=null){j.value=g.id.replace(/chk_obj_/i,"")}if(e.onaction){e.onaction(g.id.replace(/chk_obj_/i,""))}try{var h=this._accepter_id.split("_")[1];document.sheet_item_modify.selectedItemIdx[h].checked=true}catch(l){}fireEvent(e,"change")}this._hidePopupWindow()},_init_result:function(c){this._selTb=new SelectableTableRows(document.getElementById(c),false);this._selTb.ondoubleclick=function(g){var j=$("chk_obj_"+g.title);var f=$(dq._accepter_id);f.value=j.title;var h=$("fk_"+dq._accepter_id);if(h!=null){h.value=g.title}if(f.onaction){f.onaction(g.title)}dq._hidePopupWindow()}},_hidePopupWindow:function(){var c=document.getElementById("div_"+this._accepter_id);if(c==null){c=document.getElementById("object_query_content")}if(c!=null){c.style.display="none"}var d=document.getElementById(this._accepter_id);if(d){d.focus()}},drawTable:function(u,r){var z,w,x,q;var s=r.accepter_id;dqComboboxQueries[s]=r;var A=document.getElementById("tdv_"+s);var y=document.getElementById("content_"+s);var C=document.getElementById("div_"+s);if(u.length==0){t="<iframe id='json_"+s+"' frameborder='0' style='position: absolute; top: 0; left: 0; z-index: 9;'>";t='<table id="table_'+s+"\" style='width:140; overflow:hidden;'  border='0' cellspacing='0' cellpadding='0'  align='center'onselectstart='if(window.event.ctrlKey || window.event.shiftKey) return false;else return true;'>";t=t+"<tr>";t=t+'<td align="center">'+gMessageHolder.NO_DATA+"</td>";t=t+"</tr></table>"}else{var t="<iframe id='json_"+s+"' frameborder='0' style='width:160; position: absolute; top: 0; left: 0; z-index: 9;'>";t='<table id="table_'+s+"\"   border='0' cellspacing='0' cellpadding='0' align='center'onselectstart='if(window.event.ctrlKey || window.event.shiftKey) return false;else return true;'>";t=t+"<tbady>";var v=0;for(v=0;v<u.length;v++){z=u[v][0];w=u[v][1];x=u[v][2];t=t+"<tr height='20' class='"+(v%2==1?"odd-row":"even-row")+"' title='"+z+"'>";t=t+'<td id="td_obj_'+z+'"  align="center" width="1%"  nowrap height="20" title="'+w+'">';t=t+"<input type='hidden' name='itemid' value='"+z+"'>";t=t+"<input class='cbx' type='radio'  id='chk_obj_"+z+"' name='selectedItemIdx' value='"+v+"' onclick='dq.returnRow(this)' title='"+w+"'></td>";t=t+"<td nowrap>"+w+"</td>";t=t+"<td nowrap>"+x+"</td>";t=t+"</tr>"}t=t+"</tbody></table>"}t=t+"<table class='dq-scroll'><tr>";t=t+"<td id='refresh_"+s+"' onaction=\"dq.scrollPage('refresh_"+s+"','"+s+"')\"><img src=\"/html/nds/images/tb_refresh.gif\" align='absmiddle' border=0></td>";t=t+"<td id='pop_"+s+"' onaction=\"popup_window('"+r.poppath+"&action=input')\"><img src=\"/html/nds/images/tb_new.gif\" align='absmiddle' border=0></td>";t=t+"<td >-</td>";t=t+"<td id='begin_btn_"+s+"' onaction=\"dq.scrollPage('begin_btn_"+s+"','"+s+"')\"><img src=\"/html/nds/images/begin.gif\" width='16' height='16'></td>";t=t+"<td id='prev_btn_"+s+"' onaction=\"dq.scrollPage('prev_btn_"+s+"','"+s+"')\"><img src=\"/html/nds/images/back.gif\" width='16' height='16'></td>";t=t+"<td id='next_btn_"+s+"' onaction=\"dq.scrollPage('next_btn_"+s+"','"+s+"')\"><img src=\"/html/nds/images/next.gif\" width='16' height='16'></td>";t=t+"<td id='end_btn_"+s+"' onaction=\"dq.scrollPage('end_btn_"+s+"','"+s+"')\"><img src=\"/html/nds/images/end.gif\" width='16' height='16'></td>";t=t+"</tr></table></iframe>";A.innerHTML=t;var B=document.getElementById("table_"+s);var p=document.getElementById("json_"+s);if(B.offsetWidth!=0){y.style.width=B.offsetWidth+17;C.style.width=y.style.width;p.style.width=y.style.width;y.style.height=B.offsetHeight+26;C.style.height=y.style.height;p.style.height=y.style.height;if(u.length==0){y.style.width=160;C.style.width=y.style.width;p.style.width=y.style.width;y.style.height=40;C.style.height=y.style.height;p.style.height=y.style.height}}createButton($("refresh_"+s));createButton($("pop_"+s));createButton($("begin_btn_"+s));createButton($("prev_btn_"+s));createButton($("next_btn_"+s));createButton($("end_btn_"+s));dq.syncGridControl(s);this._init_result("table_"+s)}};DropdownQuery.main=function(){dq=new DropdownQuery()};jQuery(document).ready(DropdownQuery.main);DynamicQuery.prototype={initialize:function(){this._tr_cloosed_index=-1;this._dynshow_json=null;this._accepter_id=null;this._mouseOnSug=false;this._iskey=false;this._dynshowjson=null;this._dcqjsonlist=null},toggle:function(q){var s=false;var w=null;var y=null;var u="";var x="";if(this._dcqjsonlist!=null){this._accepter_id=this._dcqjsonlist[q].column_acc_Id;w=this._dcqjsonlist[q].tableId;y=this._dcqjsonlist[q].columnId;u=this._dcqjsonlist[q].newvalue;x=this._dcqjsonlist[q].oldvalue}if(this._dynshowjson!=null){for(var t=0;t<this._dynshowjson.length;t++){if(this._dynshowjson[t][0]==$(this._accepter_id).value){s=true;break}}}if(this._dynshow_json!=null){if(this._dynshow_json.qdata==$(this._accepter_id).value&&x!=""){s=true}}if(u==""&&$("div_dyn")!=null){$("div_dyn").style.display="none"}if(u!=""&&u!=x&&!s){var r="/html/nds/query/dynamicshow_result.jsp?table="+w+"&column="+y+"&accepter_id="+this._accepter_id+"&qdata="+u;var p,o,z,A;if($("div_dyn")!=null){$("div_dyn").style.display="";$("div_dyn").innerHTML="<div id='divcontent_dyn' style='z-index: 10;'></div>"}else{var A=document.createElement("div");A.id="div_dyn";A.style.display="";A.innerHTML="<div id='divcontent_dyn' style='z-index:10;'></div>";document.body.appendChild(A)}$("div_dyn").style.border="1px solid #ffffff";var v=getOffsets(this._accepter_id);p=r.indexOf("?");o=r;z="";if(p!=-1){o=r.substring(0,p);z=r.substring(p+1,r.length)}loadPage(o,z,this._returnQuery,this._accepter_id)}},closediv:function(){if(Prototype.Browser.IE){if($("sug_ie")!=null){$("sug_ie").style.display="none"}}$("div_dyn").style.display="none"},creattable:function(){var d=$("tb_"+dcq._accepter_id).rows;for(var c=0;c<d.length;c++){d[c].className="odd-row"}},clktr:function(c){return function(){$(dcq._accepter_id).blur();dcq.closediv();$(dcq._accepter_id).value=this.cells[0].innerHTML}},setdynamicdata:function(){$(this._accepter_id).onkeydown=this.keyboard;var isClkSug=false;$(this._accepter_id).onblur=function(e){if(!isClkSug){dcq.closediv()}isClkSug=false;time=0};if(typeof(this._dynshow_json.dynshowjson)!="object"||typeof(this._dynshow_json.qdata)=="undefined"||this._dynshow_json.qdata==""){return}var tab=document.createElement("table");with(tab){id="tb_"+this._accepter_id;style.width="100%";style.backgroundColor="#fff";cellspacing=0;cellpadding=0;style.cursor="default"}var tb=document.createElement("tbody");tab.appendChild(tb);for(var i=0;i<this._dynshow_json.dynshowjson.length;i++){var tr=tb.insertRow(-1);tr.onmouseover=function(){dcq.creattable;this.className="selected";this._mouseOnSug=true};tr.onmouseout=dcq.creattable;tr.onmousedown=function(e){$(dcq._accepter_id).blur();$(dcq._accepter_id).value=this.cells[0].innerHTML};tr.onclick=this.clktr(i);var td=tr.insertCell(-1);td.innerHTML=this._dynshow_json.dynshowjson[i][0];td=tr.insertCell(-1);td.innerHTML=this._dynshow_json.dynshowjson[i][1]}var th=tb.insertRow(-1);var td=th.insertCell(-1);td.innerHTML="";td=th.insertCell(-1);td.style.textAlign="right";td.innerHTML="<a href='javascript:void(0)'onclick='dcq.closediv();'>"+gMessageHolder.CLOSE_DIALOG+"</a>";var offsets=getOffsets(this._accepter_id);var div_top=offsets.y+(Prototype.Browser.Gecko?$(this._accepter_id).offsetHeight-3:$(this._accepter_id).offsetHeight);var dataheight=(this._dynshow_json.dynshowjson.length+1)*20;if(document.body.clientHeight-offsets.y-15<dataheight){div_top=div_top-dataheight-20}$("div_dyn").style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("div_dyn").style.top=div_top+"px";$("div_dyn").style.left=offsets.x;$("div_dyn").style.padding=0;$("div_dyn").style.position="absolute";$("div_dyn").style.zIndex=10;$("divcontent_dyn").style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("divcontent_dyn").style.top=div_top+"px";$("divcontent_dyn").style.left=offsets.x;$("tdiv_"+this._accepter_id).innerHTML="";$("tdiv_"+this._accepter_id).appendChild(tab);$("tdiv_"+this._accepter_id).style.width=(Prototype.Browser.IE?$(this._accepter_id).offsetWidth+20:$(this._accepter_id).offsetWidth+20);$("tdiv_"+this._accepter_id).style.top=div_top+"px";$("tdiv_"+this._accepter_id).style.left=offsets.x;$("tdiv_"+this._accepter_id).style.display="";if(Prototype.Browser.IE){var sug_ie=$("sug_ie");if(sug_ie==null){sug_ie=document.createElement("div");sug_ie.id="sug_ie";document.body.appendChild(sug_ie)}div_top=$(this._accepter_id).offsetHeight-14;if(document.body.clientHeight-div_top<dataheight){div_top=div_top-dataheight}with(sug_ie.style){display="";position="absolute";top=div_top+"px";left="0px";width=$("div_dyn").offsetWidth+"px";height=tab.offsetHeight+"px"}sug_ie.appendChild($("div_dyn"))}this._tr_cloosed_index=-1},keyboard:function(h){h=h||window.event;this._iskey=false;var j;if(h.keyCode==13){if(dcq._tr_cloosed_index>=0){dcq.closediv()}}if(h.keyCode==38||h.keyCode==40){this._mouseOnSug=false;if($("div_dyn").style.display!="none"){var g=$("tb_"+dcq._accepter_id).rows;var e=g.length-1;for(var l=0;l<e;l++){if(g[l].className=="selected"){dcq._tr_cloosed_index=l;break}}dcq.creattable();if(h.keyCode==38){if(dcq._tr_cloosed_index==0){$(dcq._accepter_id).value=dcq._dynshow_json.qdata;dcq._tr_cloosed_index=-1;this._iskey=true}else{if(dcq._tr_cloosed_index==-1){dcq._tr_cloosed_index=e}j=g[--dcq._tr_cloosed_index];j.className="selected";$(dcq._accepter_id).value=j.cells[0].innerHTML}}if(h.keyCode==40){if(dcq._tr_cloosed_index==e-1){$(dcq._accepter_id).value=dcq._dynshow_json.qdata;dcq._tr_cloosed_index=-1;this._iskey=true}else{j=g[++dcq._tr_cloosed_index];j.className="selected";$(dcq._accepter_id).value=j.cells[0].innerHTML}}}}},_returnQuery:function(h,g){var e=document.getElementById("divcontent_dyn");var f=h.responseText;e.innerHTML=h.responseText;executeLoadedScript(e);if(e.innerHTML!=""){$("div_dyn").style.border="1px solid #000000"}},createdynlist:function(f){if(this._dcqjsonlist==null){this._dcqjsonlist=f}else{var g=this._dcqjsonlist.length;var l=true;for(var h=0;h<f.length;h++){l=true;for(var j=0;j<g;j++){if(this._dcqjsonlist[j].column_acc_Id==f[h].column_acc_Id){l=false;break}}if(l){this._dcqjsonlist[g]=f[h];g++}}}},dynquery:function(){if(this._dcqjsonlist!=null){for(var c=0;c<this._dcqjsonlist.length;c++){if(this._dcqjsonlist[c].column_acc_Id==document.activeElement.id){if($(this._dcqjsonlist[c].column_acc_Id).value!=this._dcqjsonlist[c].newvalue){this._dcqjsonlist[c].oldvalue=this._dcqjsonlist[c].newvalue;this._dcqjsonlist[c].newvalue=$(this._dcqjsonlist[c].column_acc_Id).value;this.toggle(c);break}}}}},dynjson:function(c){this._dynshow_json=c;if(this._dynshow_json.dynshowjson.length>0){this._tr_cloosed_index=-1;this._dynshowjson=this._dynshow_json.dynshowjson;this.setdynamicdata()}}};DynamicQuery.main=function(){dcq=new DynamicQuery()};jQuery(document).ready(DynamicQuery.main);function reconstructQueryURL(o,m,r){var u=o;if(m!=undefined&&m!=null){var s,q,n,p,t;var w=(m.ta?m.rc:m.prc);var v=m.ta?[]:m.rc;for(s=0;s<w.length;s++){n=$("column_"+w[s]);t=oc.getColumnById(w[s]);if(n!=null){p=dwr.util.getValue(n);if(p==null||p.blank()){if(t!=null&&!t.isNullable){alert(gMessageHolder.INPUT_FIELD.replace("0",t.description));n.focus();return}}else{u+="&wfc_"+w[s]+"="+encodeURIComponent(p)}}}for(s=0;s<v.length;s++){t=gc.getColumnById(v[s]);if(t==null){continue}if(r.startsWith("eo_")){n=$("eo_"+t.name)}else{n=$(r.split("_",1)+"_"+t.name)}if(n!=null){p=dwr.util.getValue(n);if(p==null||p.blank()){if(!t.isNullable){alert(gMessageHolder.INPUT_FIELD.replace("0",t.description));n.focus();return}}else{u+="&wfc_"+v[s]+"="+encodeURIComponent(p)}}}}return u}function handleObjectInputKey(c,d){if(!c){c=window.event}if(c.altKey&&c.keyCode==191){oq.toggle(d,c.srcElement.id)}}function handleDropdownInputKey(c,d){if(!c){c=window.event}if(c.altKey&&c.keyCode==191){dq.toggle(d,c.srcElement.id)}}function getOffsets(d,c){if(!c){c=new Object();c.x=c.y=0}if(typeof d=="string"){d=document.getElementById(d)}c.x+=d.offsetLeft-d.scrollLeft;c.y+=d.offsetTop-d.scrollTop;do{d=d.offsetParent;if(!d){break}if(d.tagName.toUpperCase()!="BODY"){c.x+=d.offsetLeft-d.scrollLeft;c.y+=d.offsetTop-d.scrollTop}else{c.x+=d.offsetLeft;c.y+=d.offsetTop}}while(d.tagName.toUpperCase()!="BODY");return c}function json2xml(j,l){var h=function(n,e,s){var m="";if(n instanceof Array){for(var d=0,r=n.length;d<r;d++){m+=s+h(n[d],e,s+"\t")+"\n"}}else{if(typeof(n)=="object"){var c=false;m+=s+"<"+e;for(var q in n){if(q.charAt(0)=="@"){m+=" "+q.substr(1)+'="'+n[q].toString()+'"'}else{c=true}}m+=c?">":"/>";if(c){for(var q in n){if(q=="#text"){m+=n[q]}else{if(q=="#cdata"){m+="<![CDATA["+n[q]+"]]>"}else{if(q.charAt(0)!="@"){m+=h(n[q],q,s+"\t")}}}}m+=(m.charAt(m.length-1)=="\n"?s:"")+"</"+e+">"}}else{m+=s+"<"+e+">"+n.toString()+"</"+e+">"}}return m},f="";for(var g in j){f+=h(j[g],g,"")}return l?f.replace(/\t/g,l):f.replace(/\t|\n/g,"")}function fireEvent(d,f){if(document.createEventObject){var e=document.createEventObject();return d.fireEvent("on"+f,e)}else{var e=document.createEvent("HTMLEvents");e.initEvent(f,true,true);return !d.dispatchEvent(e)}}var agent=navigator.userAgent.toLowerCase();var is_ie=(agent.indexOf("msie")!=-1);var is_ie_4=(is_ie&&(agent.indexOf("msie 4")!=-1));var is_ie_5=(is_ie&&(agent.indexOf("msie 5.0")!=-1));var is_ie_5_up=(is_ie&&!is_ie_4);var is_ie_5_5=(is_ie&&(agent.indexOf("msie 5.5")!=-1));var is_ie_5_5_up=(is_ie&&!is_ie_4&&!is_ie_5);var is_ie_6=(is_ie&&(agent.indexOf("msie 6.0")!=-1));var is_ie_7=(is_ie&&(agent.indexOf("msie 7.0")!=-1));var is_mozilla=((agent.indexOf("mozilla")!=-1)&&(agent.indexOf("spoofer")==-1)&&(agent.indexOf("compatible")==-1)&&(agent.indexOf("opera")==-1)&&(agent.indexOf("webtv")==-1)&&(agent.indexOf("hotjava")==-1));var is_mozilla_1_3_up=(is_mozilla&&(navigator.productSub>20030210));var is_ns_4=(!is_ie&&(agent.indexOf("mozilla/4.")!=-1));var is_rtf=(is_ie_5_5_up||is_mozilla_1_3_up);var is_safari=(agent.indexOf("safari")!=-1);var submitCountdown=0;function check(j,g,l){for(var e=0;e<j.elements.length;e++){var h=j.elements[e];if((h.name==g)&&(h.type=="checkbox")){h.checked=l}}}function checkAll(l,n,h){if(checkIsArray(n)){for(var m=0;m<l.elements.length;m++){var j=l.elements[m];if(j.type=="checkbox"){for(var e=0;e<n.length;e++){if(j.name==n[e]){j.checked=h.checked}}}}}else{for(var m=0;m<l.elements.length;m++){var j=l.elements[m];if((j.name==n)&&(j.type=="checkbox")){j.checked=h.checked}}}}function checkAllBox(o,q,j){var l=0;var m=0;if(checkIsArray(q)){for(var p=0;p<o.elements.length;p++){var n=o.elements[p];if((n.name!=j.name)&&(n.type=="checkbox")){for(var e=0;e<q.length;e++){if(n.name==q[e]){l++;if(n.checked){m++}}}}}}else{for(var p=0;p<o.elements.length;p++){var n=o.elements[p];if((n.name!=j.name)&&(n.name==q)&&(n.type=="checkbox")){l++;if(n.checked){m++}}}}if(l==m){j.checked=true}else{j.checked=false}}function checkMaxLength(c,d){if((c.value.length)>=d){c.value=c.value.substring(0,d-1)}}function checkTab(c){if((document.all)&&(event.keyCode==9)){c.selection=document.selection.createRange();setTimeout('processTab("'+c.id+'")',0)}}function cloneObject(c,d){for(i in c){if(typeof c[i]=="object"&&d){this[i]=new cloneObject(c[i],true)}else{this[i]=c[i]}}}var Cookie={create:function(l,j,h){if(h){var f=new Date();f.setTime(f.getTime()+(h*24*60*60*1000));var g="; expires="+f.toGMTString()}else{var g=""}document.cookie=l+"="+j+g+"; path=/"},read:function(c){var j=c+"=";var g=document.cookie.split(";");for(var l=0;l<g.length;l++){var h=g[l];while(h.charAt(0)==" "){h=h.substring(1,h.length)}if(h.indexOf(j)==0){return h.substring(j.length,h.length)}}return null},erase:function(c){createCookie(c,"",-1)}};document.createInputElement=function(d){if(is_ie){var c=document.createElement("<input name='"+d+"'></input>")}else{var c=document.createElement("input");c.name=d}return c};function disableEsc(){if((document.all)&&(event.keyCode==27)){event.returnValue=false}}if(typeof(Element)=="undefined"){Element=new Object()}Element.disable=function(l){l=$(l);var g=l.getElementsByTagName("*");for(var f=0;f<g.length;f++){var j=g[f];var h=j.nodeName.toLowerCase();j.onclick=function(){};j.onmouseover=function(){};j.onmouseout=function(){};if(is_ie){j.onmouseenter=function(){};j.onmouseleave=function(){}}if(h=="a"){j.href="javascript: void(0)"}else{if(h=="input"||h=="select"||h=="script"){j.disabled="true"}else{if(h=="form"){j.action="";j.onsubmit=function(){return false}}}}j.style.cursor="default"}};Element.changeOpacity=function(c,d){d=(d>=100)?99.999:d;d=(d<0)?0:d;c.style.opacity=(d/100);c.style.MozOpacity=(d/100);c.style.KhtmlOpacity=(d/100);c.style.filter="alpha(opacity="+d+")"};if(typeof(Event)=="undefined"){Event=new Object()}Event.addHandler=function(g,e,h){if(e.indexOf("on")!=0){e="on"+e}var f=g[e];if(typeof g[e]!="function"){g[e]=h}else{g[e]=function(){if(f){f()}h()}}};Event.enterPressed=function(c){if(!c){c=window.event}var d=c.keyCode;if(d==13){return true}else{return false}};function getSelectedIndex(d){for(var c=0;c<d.length;c++){if(d[c].checked==true){return c}}return -1}function getSelectedRadioName(e){var d=getSelectedIndex(e);if(d==-1){var f=e.name;if(f==null){f=""}return f}else{return e[d].name}}function getSelectedRadioValue(d){var f=getSelectedIndex(d);if(f==-1){var e=d.value;if(e==null){e=""}return e}else{return d[f].value}}function checkIsArray(c){if(!window.Array){return false}else{return c.constructor==window.Array}}function LinkedList(){this.head=null;this.tail=null}LinkedList.prototype.add=function(f){f.listInfo=new Object();var e=this.tail;var d=this.head;if(this.head==null){this.head=f;this.tail=f}else{this.tail.listInfo.next=f;f.listInfo.prev=this.tail;this.tail=f}};LinkedList.prototype.remove=function(f){if(this.head){var e=f.listInfo.next;var d=f.listInfo.prev;if(e){e.listInfo.prev=d}if(d){d.listInfo.next=e}if(this.head=f){this.head=e}if(this.tail=f){this.tail=d}}};LinkedList.prototype.each=function(h){var g=this.head;var e=0;while(g){e++;var f=g.listInfo.next;if(h){h(g)}g=f}return e};LinkedList.prototype.size=function(){return this.each()};function listChecked(h){var e="";for(var f=0;f<h.elements.length;f++){var g=h.elements[f];if((g.type=="checkbox")&&(g.checked==true)&&(g.value>"")){e+=g.value+","}}return e}function listCheckedExcept(j,l){var e="";for(var g=0;g<j.elements.length;g++){var h=j.elements[g];if((h.type=="checkbox")&&(h.checked==true)&&(h.value>"")&&(h.name.indexOf(l)!=0)){e+=h.value+","}}return e}function listSelect(g,f){var h="";if(f==null){f=","}if(g==null){return""}for(var e=0;e<g.length;e++){if(g.options[e].value>""){h+=g.options[e].value+f}}if(h==".none,"){return""}else{return h}}function listUnchecked(h){var e="";for(var f=0;f<h.elements.length;f++){var g=h.elements[f];if((g.type=="checkbox")&&(g.checked==false)&&(g.value>"")){e+=g.value+","}}return e}function listUncheckedExcept(j,l){var e="";for(var g=0;g<j.elements.length;g++){var h=j.elements[g];if((h.type=="checkbox")&&(h.checked==false)&&(h.value>"")&&(h.name.indexOf(l)!=0)){e+=h.value+","}}return e}function moveItem(l,j,p){var n=null;var m=null;var o=null;if(l.selectedIndex>=0){for(var q=0;q<l.length;q++){if(l.options[q].selected){n=l.options[q].text;m=l.options[q].value;o=new Option(n,m);j[j.length]=o}}for(var q=0;q<j.length;q++){for(var r=0;r<l.length;r++){if(l[r].value==j[q].value){l[r]=null;break}}}}if(n!=null){if(p==true){sortBox(j)}}}function processTab(c){document.getElementById(c).selection.text=String.fromCharCode(9);document.getElementById(c).focus()}function reelHome(u,c,m,s,q,o){if(isNaN(c)||isNaN(m)){return}var r=document.getElementById(u);if(r==null){return}var n=parseInt(r.style.top,10);var t=parseInt(r.style.left,10);if(q==null){q=1}if(s==null){s==20}if(o==null){o=Math.PI/(2*s);r.style.zIndex=10}if(q<s){var p=1-Math.sin(q*o);r.style.left=(c*p)+"px";r.style.top=(m*p)+"px";setTimeout('reelHome("'+u+'",'+c+","+m+","+s+","+(++q)+","+o+")",16)}else{r.style.top="0px";r.style.left="0px";r.style.zIndex=0}}function removeItem(d,f){if(f==null){for(var e=d.length-1;e>=0;e--){if(d.options[e].selected){d[e]=null}}}else{for(var e=d.length-1;e>=0;e--){if(d.options[e].value==f){d[e]=null}}}}function reorder(j,h){var f=j.selectedIndex;if(f==-1){j.selectedIndex=0}else{sText=j.options[f].text;sValue=j.options[f].value;if((j.options[f].value>"")&&(f>0)&&(h==0)){j.options[f].text=j.options[f-1].text;j.options[f].value=j.options[f-1].value;j.options[f-1].text=sText;j.options[f-1].value=sValue;j.selectedIndex--}else{if((f<j.length-1)&&(j.options[f+1].value>"")&&(h==1)){j.options[f].text=j.options[f+1].text;j.options[f].value=j.options[f+1].value;j.options[f+1].text=sText;j.options[f+1].value=sValue;j.selectedIndex++}else{if(f==0){for(var l=0;l<(j.length-1);l++){j.options[l].text=j.options[l+1].text;j.options[l].value=j.options[l+1].value}j.options[j.length-1].text=sText;j.options[j.length-1].value=sValue;j.selectedIndex=j.length-1}else{if(f==(j.length-1)){for(var g=(j.length-1);g>0;g--){j.options[g].text=j.options[g-1].text;j.options[g].value=j.options[g-1].value}j.options[0].text=sText;j.options[0].value=sValue;j.selectedIndex=0}}}}}}function resubmitCountdown(e){if(submitCountdown>0){submitCountdown--;setTimeout("resubmitCountdown('"+e+"')",1000)}else{submitCountdown=0;if(!is_ns_4){document.body.style.cursor="auto"}var h=document.forms[e];for(var f=0;f<h.length;f++){var g=h.elements[f];if(g.type&&(g.type.toLowerCase()=="button"||g.type.toLowerCase()=="reset"||g.type.toLowerCase()=="submit")){g.disabled=false}}}}function selectAndCopy(d){d.focus();d.select();if(document.all){var c=d.createTextRange();c.execCommand("copy")}}function setBox(f,e){for(var d=f.length-1;d>-1;d--){f.options[d]=null}for(var d=0;d<e.length;d++){f.options[d]=new Option(e[d].value,d)}f.options[0].selected=true}function setCursorPosition(g,h,e){if(g.setSelectionRange){g.setSelectionRange(h,e)}else{if(g.createTextRange){var f=g.createTextRange();f.collapse(true);f.moveEnd("character",e);f.moveStart("character",h);f.select()}}}function setSelectedValue(e,f){for(var d=0;d<e.length;d++){if((e[d].value!="")&&(e[d].value==f)){e.selectedIndex=d;break}}}function setSelectVisibility(f,d){if(is_ie){if(d){d=$(d)}else{d=document.getElementsByTagName("body")[0]}selectList=d.getElementsByTagName("select");for(var e=0;e<selectList.length;e++){selectList[e].style.visibility=f}}}function slideMaximize(h,f,l){var j=document.getElementById(h);var g=j.getElementsByTagName("DIV")[0];f+=l;if(f<(g.offsetHeight)){j.style.height=f+"px";setTimeout('slideMaximize("'+h+'",'+f+","+l+")",10)}else{j.style.overflow="";j.style.height=""}}function slideMinimize(g,f,e){var h=document.getElementById(g);f-=e;if(f>0){h.style.height=f+"px";setTimeout('slideMinimize("'+g+'",'+f+","+e+")",10)}else{h.style.display="none"}}function sortBox(f){var e=new Array();for(var d=0;d<f.length;d++){e[d]=new Array(f[d].value,f[d].text)}e.sort(sortByAscending);for(var d=f.length-1;d>-1;d--){f.options[d]=null}for(var d=0;d<e.length;d++){f.options[f.length]=new Option(e[d][1],e[d][0])}}function sortByAscending(e,f){if(e[1].toLowerCase()>f[1].toLowerCase()){return 1}else{if(e[1].toLowerCase()<f[1].toLowerCase()){return -1}else{return 0}}}function sortByDescending(e,f){if(e[1].toLowerCase()>f[1].toLowerCase()){return -1}else{if(e[1].toLowerCase()<f[1].toLowerCase()){return 1}else{return 0}}}function submitForm(l,j,g){if(submitCountdown==0){submitCountdown=10;setTimeout("resubmitCountdown('"+l.name+"')",1000);if(g==null||g){submitCountdown++;for(var e=0;e<l.length;e++){var h=l.elements[e];if(h.type&&(h.type.toLowerCase()=="button"||h.type.toLowerCase()=="reset"||h.type.toLowerCase()=="submit")){h.disabled=true}}}if(j!=null){l.action=j}if(!is_ns_4){document.body.style.cursor="wait"}l.submit()}else{if(this.submitFormAlert!=null){submitFormAlert(submitCountdown)}}}if(is_ns_4){encodeURIComponent=new function(c){return escape(c)};decodeURIComponent=new function(c){return unescape(c)}}function startsWith(c,d){if(c.indexOf(d)==0){return true}else{return false}}function endsWith(c,d){if(c.lastIndexOf(d)==c.length-d.length){return true}else{return false}}function toHTML(c){c=c.replace(/\&/g,"&amp;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/\n/g,"<br>");c=c.replace(/  /g," &nbsp;");return c}function toText(c){c=c.replace(/\&nbsp;/gi," ");c=c.replace(/<br>/gi,"\n");c=c.replace(/&gt;/gi,">");c=c.replace(/\&lt;/gi,"<");c=c.replace(/\&amp;/gi,"&");return c}function toggleById(g,e,f){var h=document.getElementById(g);if(e){return toggleByObject(h,e,f)}else{toggleByObject(h,null,f)}}function toggleByIdSpan(h,g){var e=toggleById(g,true);var f=h.getElementsByTagName("span");if(e){f[0].style.display="none";f[1].style.display=""}else{f[0].style.display="";f[1].style.display="none"}}function toggleByObject(h,f,g){var l=false;var j="block";if(g!=null){j=g}if(h!=null){if(!h.style.display||!h.style.display.toLowerCase().match("none")){h.style.display="none"}else{h.style.display=j;l=true}}if(f){return l}}function trimString(c){c=c.replace(/^\s+/g,"").replace(/\s+$/g,"");var d=c.charCodeAt(0);while(d==160){c=c.substring(1,c.length);d=c.charCodeAt(0)}d=c.charCodeAt(c.length-1);while(d==160){c=c.substring(0,c.length-1);d=c.charCodeAt(c.length-1)}return c}String.prototype.trim=trimString;var Viewport={frame:function(){var d,c;if(self.innerHeight){d=self.innerWidth;c=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){d=document.documentElement.clientWidth;c=document.documentElement.clientHeight}else{if(document.body){d=document.body.clientWidth;c=document.body.clientHeight}}}return(new Coordinate(d,c))},scroll:function(){var d,c;if(self.pageYOffset){d=self.pageXOffset;c=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){d=document.documentElement.scrollLeft;c=document.documentElement.scrollTop}else{if(document.body){d=document.body.scrollLeft;c=document.body.scrollTop}}}return(new Coordinate(d,c))},page:function(){var f,g;var h=document.body.scrollHeight;var e=document.body.offsetHeight;if(h>e){f=document.body.scrollWidth;g=document.body.scrollHeight}else{f=document.body.offsetWidth;g=document.body.offsetHeight}return(new Coordinate(f,g))}};var ZINDEX={ALERT:100,CHAT_BOX:11,DRAG_ITEM:10,DRAG_ARROW:9};function zeroize(e,c){if(!c){c=2}e=String(e);for(var f=0,d="";f<(c-e.length);f++){d+="0"}return d+e}function hidePartOfWord(tar,len,start){if(null==tar||undefined==tar||""==tar){return tar}var sLen=tar.length;if(sLen<=len){return tar.replace(/./g,"*")}if(len+start>sLen){start=sLen-len}return tar.replace(eval("/(.{"+start+"})(.{"+len+"})(.*)/"),"$1"+tar.substr(start,len).replace(/./g,"*")+"$3")}(function(e){var d={dragStart:"start.draggable",drag:"drag.draggable",dragStop:"stop.draggable",maxHeight:"maxHeight.resizable",minHeight:"minHeight.resizable",maxWidth:"maxWidth.resizable",minWidth:"minWidth.resizable",resizeStart:"start.resizable",resize:"drag.resizable",resizeStop:"stop.resizable"},c="ui-dialog ui-widget ui-widget-content ui-corner-all ";e.widget("ui.dialog",{_init:function(){this.originalTitle=this.element.attr("title");var p=this,q=this.options,n=q.title||this.originalTitle||"&nbsp;",g=e.ui.dialog.getTitleId(this.element),o=(this.uiDialog=e("<div/>")).appendTo(document.body).hide().addClass(c+q.dialogClass).css({position:"absolute",overflow:"hidden",top:"425px",zIndex:q.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(r){(q.closeOnEscape&&r.keyCode&&r.keyCode==e.ui.keyCode.ESCAPE&&p.close(r))}).attr({role:"dialog","aria-labelledby":g}).mousedown(function(r){p.moveToTop(false,r)}),j=this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(o),h=(this.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(o),m=e('<a href="#"/>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){m.addClass("ui-state-hover")},function(){m.removeClass("ui-state-hover")}).focus(function(){m.addClass("ui-state-focus")}).blur(function(){m.removeClass("ui-state-focus")}).mousedown(function(r){r.stopPropagation()}).click(function(r){p.close(r);return false}).appendTo(h),l=(this.uiDialogTitlebarCloseText=e("<span/>")).addClass("ui-icon ui-icon-closethick").text(q.closeText).appendTo(m),f=e("<span/>").addClass("ui-dialog-title").attr("id",g).html(n).prependTo(h);h.find("*").add(h).disableSelection();(q.draggable&&e.fn.draggable&&this._makeDraggable());(q.resizable&&e.fn.resizable&&this._makeResizable());this._createButtons(q.buttons);this._isOpen=false;(q.bgiframe&&e.fn.bgiframe&&o.bgiframe());(q.autoOpen&&this.open())},destroy:function(){(this.overlay&&this.overlay.destroy());this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();(this.originalTitle&&this.element.attr("title",this.originalTitle))},close:function(h){var f=this;if(false===f._trigger("beforeclose",h)){jQuery("#dialog").dialog("destroy");return}(f.overlay&&f.overlay.destroy());f.uiDialog.unbind("keypress.ui-dialog");(f.options.hide?f.uiDialog.hide(f.options.hide,function(){f._trigger("close",h)}):f.uiDialog.hide()&&f._trigger("close",h));e.ui.dialog.overlay.resize();f._isOpen=false;if(f.options.modal){var g=0;e(".ui-dialog").each(function(){if(this!=f.uiDialog[0]){g=Math.max(g,e(this).css("z-index"))}});e.ui.dialog.maxZ=g}jQuery("#dialog").dialog("destroy")},isOpen:function(){return this._isOpen},moveToTop:function(h,g){if((this.options.modal&&!h)||(!this.options.stack&&!this.options.modal)){return this._trigger("focus",g)}if(this.options.zIndex>e.ui.dialog.maxZ){e.ui.dialog.maxZ=this.options.zIndex}(this.overlay&&this.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=++e.ui.dialog.maxZ));var f={scrollTop:this.element.attr("scrollTop"),scrollLeft:this.element.attr("scrollLeft")};this.uiDialog.css("z-index",++e.ui.dialog.maxZ);this.element.attr(f);this._trigger("focus",g)},open:function(){if(this._isOpen){return}var g=this.options,f=this.uiDialog;this.overlay=g.modal?new e.ui.dialog.overlay(this):null;(f.next().length&&f.appendTo("body"));this._size();this._position(g.position);f.show(g.show);this.moveToTop(true);(g.modal&&f.bind("keypress.ui-dialog",function(l){if(l.keyCode!=e.ui.keyCode.TAB){return}var j=e(":tabbable",this),m=j.filter(":first")[0],h=j.filter(":last")[0];if(l.target==h&&!l.shiftKey){setTimeout(function(){m.focus()},1)}else{if(l.target==m&&l.shiftKey){setTimeout(function(){h.focus()},1)}}}));e([]).add(f.find(".ui-dialog-content :tabbable:first")).add(f.find(".ui-dialog-buttonpane :tabbable:first")).add(f).filter(":first").focus();this._trigger("open");this._isOpen=true},_createButtons:function(j){var h=this,f=false,g=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");this.uiDialog.find(".ui-dialog-buttonpane").remove();(typeof j=="object"&&j!==null&&e.each(j,function(){return !(f=true)}));if(f){e.each(j,function(l,m){e('<button type="button"></button>').addClass("ui-state-default ui-corner-all").text(l).click(function(){m.apply(h.element[0],arguments)}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).focus(function(){e(this).addClass("ui-state-focus")}).blur(function(){e(this).removeClass("ui-state-focus")}).appendTo(g)});g.appendTo(this.uiDialog)}},_makeDraggable:function(){var f=this,h=this.options,g;this.uiDialog.draggable({cancel:".ui-dialog-content",handle:".ui-dialog-titlebar",containment:"document",start:function(){g=h.height;e(this).height(e(this).height()).addClass("ui-dialog-dragging");(h.dragStart&&h.dragStart.apply(f.element[0],arguments))},drag:function(){(h.drag&&h.drag.apply(f.element[0],arguments))},stop:function(){e(this).removeClass("ui-dialog-dragging").height(g);(h.dragStop&&h.dragStop.apply(f.element[0],arguments));e.ui.dialog.overlay.resize()}})},_makeResizable:function(j){j=(j===undefined?this.options.resizable:j);var f=this,h=this.options,g=typeof j=="string"?j:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",alsoResize:this.element,maxWidth:h.maxWidth,maxHeight:h.maxHeight,minWidth:h.minWidth,minHeight:h.minHeight,start:function(){e(this).addClass("ui-dialog-resizing");(h.resizeStart&&h.resizeStart.apply(f.element[0],arguments))},resize:function(){(h.resize&&h.resize.apply(f.element[0],arguments))},handles:g,stop:function(){e(this).removeClass("ui-dialog-resizing");h.height=e(this).height();h.width=e(this).width();(h.resizeStop&&h.resizeStop.apply(f.element[0],arguments));e.ui.dialog.overlay.resize()}}).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_position:function(m){var g=e(window),h=e(document),j=h.scrollTop(),f=h.scrollLeft(),l=j;if(e.inArray(m,["center","top","right","bottom","left"])>=0){m=[m=="right"||m=="left"?m:"center",m=="top"||m=="bottom"?m:"middle"]}if(m.constructor!=Array){m=["center","middle"]}if(m[0].constructor==Number){f+=m[0]}else{switch(m[0]){case"left":f+=0;break;case"right":f+=g.width()-this.uiDialog.outerWidth();break;default:case"center":f+=(g.width()-this.uiDialog.outerWidth())/2}}if(m[1].constructor==Number){j+=m[1]}else{switch(m[1]){case"top":j+=0;break;case"bottom":j+=g.height()-this.uiDialog.outerHeight();break;default:case"middle":j+=(g.height()-this.uiDialog.outerHeight())/2}}j=Math.max(j,l);this.uiDialog.css({top:j,left:f})},_setData:function(g,h){(d[g]&&this.uiDialog.data(d[g],h));switch(g){case"buttons":this._createButtons(h);break;case"closeText":this.uiDialogTitlebarCloseText.text(h);break;case"dialogClass":this.uiDialog.removeClass(this.options.dialogClass).addClass(c+h);break;case"draggable":(h?this._makeDraggable():this.uiDialog.draggable("destroy"));break;case"height":this.uiDialog.height(h);break;case"position":this._position(h);break;case"resizable":var f=this.uiDialog,j=this.uiDialog.is(":data(resizable)");(j&&!h&&f.resizable("destroy"));(j&&typeof h=="string"&&f.resizable("option","handles",h));(j||this._makeResizable(h));break;case"title":e(".ui-dialog-title",this.uiDialogTitlebar).html(h||"&nbsp;");break;case"width":this.uiDialog.width(h);break}e.widget.prototype._setData.apply(this,arguments)},_size:function(){var g=this.options;this.element.css({height:0,minHeight:0,width:"auto"});var f=this.uiDialog.css({height:"auto",width:g.width}).height();f=65;this.element.css({minHeight:Math.max(g.minHeight-f,0),height:g.height=="auto"?"auto":Math.max(g.height-f,0)})}});e.extend(e.ui.dialog,{version:"1.7.2",defaults:{autoOpen:true,bgiframe:false,buttons:{},closeOnEscape:true,closeText:"X",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:"center",resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},getter:"isOpen",uuid:0,maxZ:0,getTitleId:function(f){return"ui-dialog-title-"+(f.attr("id")||++this.uuid)},overlay:function(f){this.$el=e.ui.dialog.overlay.create(f)}});e.extend(e.ui.dialog.overlay,{instances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(f){return f+".dialog-overlay"}).join(" "),create:function(g){if(this.instances.length===0){setTimeout(function(){if(e.ui.dialog.overlay.instances.length){e(document).bind(e.ui.dialog.overlay.events,function(h){var j=e(h.target).parents(".ui-dialog").css("zIndex")||0;return(j>e.ui.dialog.overlay.maxZ)})}},1);e(document).bind("keydown.dialog-overlay",function(h){(g.options.closeOnEscape&&h.keyCode&&h.keyCode==e.ui.keyCode.ESCAPE&&g.close(h))});e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize)}var f=e("<div></div>").appendTo(document.body).addClass("ui-widget-overlay").css({width:this.width(),height:this.height()});(g.options.bgiframe&&e.fn.bgiframe&&f.bgiframe());this.instances.push(f);return f},destroy:function(f){this.instances.splice(e.inArray(this.instances,f),1);if(this.instances.length===0){e([document,window]).unbind(".dialog-overlay")}f.remove();var g=0;e.each(this.instances,function(){g=Math.max(g,this.css("z-index"))});this.maxZ=g},height:function(){if(e.browser.msie&&e.browser.version<7){var g=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);var f=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(g<f){return e(window).height()+"px"}else{return g+"px"}}else{return e(document).height()+"px"}},width:function(){if(e.browser.msie&&e.browser.version<7){var f=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);var g=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(f<g){return e(window).width()+"px"}else{return f+"px"}}else{return e(document).width()+"px"}},resize:function(){var f=e([]);e.each(e.ui.dialog.overlay.instances,function(){f=f.add(this)});f.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}});e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);jQuery.noConflict();var mc;var MC=Class.create();MC.prototype={initialize:function(){this.modal=null;this.URL="/bpos/getmessage.jsp";this.messages=[];this.title=null;this.timeoutId=null;this.mcount=null;jQuery(document.body).append('<div id="dialog" title="\u901a\u77e5" style="display:none;background-color:white;overflow:hidden;"><div id=\'dialog-dt\'  style="width:395px;"  ></div></div>')},load:function(d){var c=new Date();jQuery.ajax({url:mc.URL+"?t="+c.getTime(),success:function(h){var o=mc.analyseM(h,d);var j=o[7];jQuery("#posNews").html(j);if(o[6]==false){return}var f=o[0];var l=o[1];var e=o[2];var n=o[3];var g=o[4];var m=o[5];if(n==0){return}if(m==1){return}mc.showMessages();jQuery("#dialog-dt").html(f);jQuery("#ui-dialog-title-dialog").html(l);jQuery("#ui-dialog-title-dialog>input[type='button']").css("display","none");if(!mc.modal){mc.timeoutId=setTimeout("mc.fadeMessage();",8000);jQuery("#dialog").parent().mouseenter(function(){if(mc.timeoutId!=null){clearTimeout(mc.timeoutId)}})}},error:function(e){}})},refresh:function(){var c=new Date();jQuery.ajax({url:mc.URL+"?t="+c.getTime(),success:function(f){var d=mc.analyseM(f);var e=d[0];var m=d[1];var h=d[2];var l=d[3];var g=d[4];var j=d[5];if(l==0){e=""}jQuery("#dialog-dt").html(e);jQuery("#dialog-title").html(h);jQuery("#dialog-title").focus()},error:function(d){}})},analyseM:function(d,r){var n=d.documentElement;var h=mc.getChildren(n,"message");var q=mc.getChildren(n,"noshow");var l="<div style='height:130px;overflow-y:scroll;overflow-x:visible;'><table cellspacing='0' cellpadding='0' ><thead><tr><th></th><th>\u4f18\u5148\u7ea7</th><th>\u53d1\u9001\u65f6\u95f4</th><th>\u7f16\u53f7</th><th>\u6807\u9898</th></tr></thead><tbody>";var g=0;var p;var f=0;var m="";var j={};for(var e=0;e<h.length;e++){f++;j.temptitle=mc.getChildValue(h[e],"TITLE");j.tempdescription=mc.getChildValue(h[e],"DESCRIPTION");j.tempcretime=mc.getChildValue(h[e],"CREATIONDATE");j.tempid=mc.getChildValue(h[e],"ID");j.tempuname=mc.getChildValue(h[e],"TRUENAME");p=mc.getChildValue(h[e],"PRIORITYRULE");l+="<tr id='dialog-tbr"+e+"' "+(p=="1"?"style='background-color:#FFFFFF;'":"")+" onclick='javascript:bxl.dlgo4("+Object.toJSON(j)+")' ";l+=" onmouseover='mc.highlight(this);'";l+="><td style='border-bottom:1px dotted grey;'>"+f+"</td>";if(p=="1"){g++;l+="<td style='border-bottom:1px dotted grey;'><span style='color:red'>!!!</span></td>";if(r!=undefined){r=true}}else{if(p=="2"){l+="<td style='border-bottom:1px dotted grey;'><span style='color:red'>!!</font></td>"}else{l+="<td style='border-bottom:1px dotted grey;'>&nbsp;</td>"}}l+="<td style='border-bottom:1px dotted grey;'>"+mc.getChildValue(h[e],"CREATIONDATE").substr(0,10)+"</td>";l+="<td style='border-bottom:1px dotted grey;padding-left:5px;'>"+mc.getChildValue(h[e],"NO")+"</td>";l+="<td style='border-bottom:1px dotted grey;padding-left:5px;' title='"+mc.getChildValue(h[e],"DESCRIPTION")+"'>"+mc.getChildValue(h[e],"TITLE")+"</td>";l+="</tr>";m+="	&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#' onclick='javascript:bxl.dlgo4("+Object.toJSON(j)+")'>"+mc.getChildValue(h[e],"TITLE")+"</a>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  "}l+="</tbody></table></div>";if(mc.title==null){mc.title=jQuery("#dialog").attr("title")}var o=mc.title;var c="";if(g>0){o+="  &nbsp; &nbsp;<span id='dialog-title' style='color:red;'>"+"\u4f60\u6709$$\u6761\u7d27\u6025\u6d88\u606f\u5fc5\u9700\u9a6c\u4e0a\u5904\u7406".replace("$$",g)+"!!!</span>";c="\u4f60\u6709$$\u6761\u7d27\u6025\u6d88\u606f\u5fc5\u9700\u9a6c\u4e0a\u5904\u7406".replace("$$",g)+"!!!"}else{o+="  &nbsp; &nbsp;<span id='dialog-title'>"+"\u5171\u6709$$\u6761\u9700\u8981\u786e\u8ba4".replace("$$",h.length)+".</span>";c="\u5171\u6709$$\u6761\u9700\u8981\u786e\u8ba4".replace("$$",h.length)+"."}o+="&nbsp;<input type='button' value='\u5168\u90e8\u901a\u544a' style='vertical-align:middle;padding-top:4px;cusor:pointer;position:relative;left:"+((g>0)?"50":"120")+"px;' onclick='mc.go();'>";mc.modal=(g>0);mc.mcount=h.length;return[l,o,c,h.length,g,q.length,r,m]},highlight:function(d){for(var c=0;c<mc.mcount;c++){jQuery("#dialog-tbr"+c).css("background-color","#FFFFFF")}jQuery(d).css("background-color","#D2DFE9")},showMessages:function(d){var c={resizable:false,width:420,height:200,position:["right","bottom"]};if(mc.modal){c.modal=true}jQuery("#dialog").dialog(c)},fadeMessage:function(){jQuery("#dialog").parent().mouseenter(function(){if(mc.timeoutId!=null){clearTimeout(mc.timeoutId)}jQuery("#dialog").parent().stop();jQuery("#dialog").parent().css("opacity",1)});jQuery("#dialog").parent().fadeOut(3000,function(){jQuery("#dialog").dialog("close")})},go:function(c){if(c==null){jQuery("#dialog").dialog("close")}else{jQuery("#dialog").parent().css("z-index","90");if(mc.modal){jQuery("#dialog").parent().prev(".ui-widget-overlay ").css("z-index","1")}if(!mc.modal){jQuery("#dialog").parent().stop();jQuery("#dialog").parent().css("opacity",1)}var d={onClose:function(){return mc.refresh()}};bxl.dlgo3(c,d)}},xml2Str:function(c){try{return(new XMLSerializer()).serializeToString(c)}catch(d){try{return c.xml}catch(d){alert("Xmlserializer not supported")}}return false},getChildValue:function(e,c){var f="";for(var d=0;d<e.childNodes.length;d++){if(e.childNodes[d].tagName==c){f=e.childNodes[d].childNodes[0].nodeValue}}return f},getChildren:function(e,c){var f=[];for(var d=0;d<e.childNodes.length;d++){if(e.childNodes[d].tagName==c){f.push(e.childNodes[d])}}return f}};MC.main=function(){mc=new MC();mc.load()},jQuery(document).ready(MC.main);var du=null;var DU=Class.create();DU.prototype={initialize:function(){},multiQuery:function(d,w,u,q,e,m){var f='<table width="580" border="0" align="center" cellpadding="0" cellspacing="0">';for(var t=0;t<d.length;t++){var x=d[t];var r=x.name+"：";if(x.btn){r='<input type="button" class="btn-ka" value="'+x.btn.name+'" id="'+x.btn.key+'" />'+x.name+"："}f+='<tr><td width="200" height="25" align="right"><div class="VIP-txt">'+r+'</div></td><td width="120"><input '+(x.upperCase?" onkeyup=\"$('"+x.key+"').value=($('"+x.key+"').value).toUpperCase()\" ":"")+' name="text" id="'+x.key+'" type="text" class="VIP_input_110" '+(x.disabled?"disabled='true'":"")+"/></td>";if(t==0){f+='<td width="260" rowspan="'+d.length+'" align="left" valign="top"><div id="showmultivip" style="display:none" class="VIP-table"><div class="VIP-table-head"><div class="VIP-span-1">'+m[0]+'</div><div class="VIP-span-2">'+m[1]+'</div><div class="VIP-span-3">'+m[2]+'</div></div><div id="VIP-main" class="VIP-sidebar" style="height: 60px; width: 260px; visibility: visible; opacity: 1;"></div></td>'}f+="</tr>"}f+="</table>";var l='<table width="585" border="1" align="center" cellpadding="1" cellspacing="1" bgcolor="#486489" id="modify_table">';var g=Math.ceil((w.length)/2);for(var s=0;s<g;s++){var n=(s*2<w.length)?'<td width="116" align="right">'+w[s*2].name+'：</td><td width="167"><span id="'+w[s*2].key+'"></span></td>':"<td></td><td></td>";var p=((s*2+1)<w.length)?'<td width="150" align="right">'+w[s*2+1].name+'：</td><td width="150"><span id="'+w[s*2+1].key+'"></span></td>':"<td></td><td></td>";l+='<tr class="'+(s%2==0?"emtb":"emtbts")+'">'+n+p+"</tr>"}l+=e+"</table></div></td></tr>";var y="";for(var v=0;v<u.length;v++){y+='<input type="button" value="'+u[v].name+'" id="'+u[v].key+'" class="qinput"/>&nbsp;'}var o=Alerts.fireMessageBox({width:600,modal:true,title:gMessageHolder.EDIT_MEASURE});o.innerHTML='<div id="query-search-content"><table width="600" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="treatment_td"><div id="treatment_text">'+q+'</div></div></td></tr><tr><td><div class="VIP_table">'+f+l+'<tr><td align="center"><div id="treatment_td" align="center"><div id="treatment_text">'+y+"</div></div></td></tr></table></div>";this.executeLoadedScript(o)},executeLoadedScript:function(c){executeLoadedScript(c);jQuery("td.pop-up-close>a").remove()}};DU.main=function(){du=new DU()};jQuery(document).ready(DU.main);var bxl=null;var BXL=Class.create();BXL.prototype={initialize:function(){dwr.util.useLoadingMessage(gMessageHolder.LOADING);dwr.util.setEscapeHtml(false);dwr.engine._errorHandler=function(d,c){while(c!=null&&c.cause!=null){c=c.cause}if(c!=null){d=c.message}if(d==null||d==""){alert("A server error has occured. More information may be available in the console.")}else{if(d.indexOf("0x80040111")!=-1){dwr.engine._debug(d)}else{alert(d)}}};application.addEventListener("BPOS_SEARCH",this._onsearch,this);application.addEventListener("U_Note_Read",this._noteread,this);application.addEventListener("BPOS_PWD",this._onpwd,this);this.lisense();this.init();this.checkServerTime()},init:function(){this.mutilines=new Array();this.items=new Array();this.employee="";this.pwd="";this.id="";this.name="";this.t="";this.type=1;this.button="";this.docdata="";this.d="";this.date=""},checkServerTime:function(){window.setInterval(function(){bxl.getServerTime()},900000)},getServerTime:function(){var c="F|D|1";try{c=bpos.master_data.params.timeVerify}catch(f){}var d=c.split("|");var j=d[0];var h=d[1];var g=d[2];jQuery.ajax({type:"POST",cache:false,url:bpos.URL+"getServerTime.jsp",timeout:10000,error:function(){},success:function(q){var p=new Date(q);var o=new Date();var s=o.getTime()-p.getTime();if(s<0){s=0-s}if(jQuery("#timeAlert").length>0){if(s<2000*60){bpos.killAlert("timeAlert")}return}if(h=="D"){var m=Math.round(s/(1000*3600*24));if(j=="P"){(m>parseInt(g,10))?jQuery("#dateIsNotCorrect").css("display","block"):jQuery("#dateIsNotCorrect").css("display","none")}else{jQuery("#dateIsNotCorrect").css("display","none");if(bpos.noAlert&&m>parseInt(g,10)){bxl.timeAlert()}if(m<=parseInt(g,10)){try{bpos.killAlert("timeAlert")}catch(r){}}}}else{if(h=="H"){var l=Math.round(s/(1000*3600));if(j=="P"){l>parseInt(g,10)?jQuery("#dateIsNotCorrect").css("display","block"):jQuery("#dateIsNotCorrect").css("display","none")}else{jQuery("#dateIsNotCorrect").css("display","none");if(bpos.noAlert&&l>parseInt(g,10)){bxl.timeAlert()}if(l<=parseInt(g,10)){try{bpos.killAlert("timeAlert")}catch(r){}}}}else{if(h=="M"){var n=Math.round(s/(1000*60));if(j=="P"){n>parseInt(g,10)?jQuery("#dateIsNotCorrect").css("display","block"):jQuery("#dateIsNotCorrect").css("display","none")}else{jQuery("#dateIsNotCorrect").css("display","none");if(bpos.noAlert&&n>parseInt(g,10)){bxl.timeAlert()}if(n<=parseInt(g,10)){try{bpos.killAlert("timeAlert")}catch(r){}}}}}}}})},timeAlert:function(){var c=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});var d='<div id="timeAlert" style="height:50px;padding-top:20px;padding-left:20px;"><font style="font-size:20px;color:red;padding-top:50px;" >本地时间与服务器时间不一致，请修改！</font></div>';c.innerHTML=d;bpos.executeLoadedScript(c);bpos.noAlert=false},newsQuery:function(){mc.load(false)},dlgo4:function(c){jQuery("#dialog").parent().css("z-index","90");if(mc.modal){jQuery("#dialog").parent().prev(".ui-widget-overlay ").css("z-index","1")}jQuery("#cmdmsguname").html(c.tempuname+":");jQuery("#cmdmsgtime").html(c.tempcretime.substr(0,c.tempcretime.length-2));jQuery("#cmdmsgcontent").html(c.temptitle+"<p>"+c.tempdescription+"</p>");jQuery("#cmdhref").html('<a href="#"  onclick=javascript:bxl.dlgo3('+c.tempid+") >查看通知明细</a>");jQuery("#cmdbtns").html('<input type="button" onClick="javascript:bxl.makesurereadmsg(\''+c.tempid+'\')"  value="&nbsp;&nbsp;确认已读&nbsp;&nbsp;">');jQuery("#cmdmsg").css("display","block")},makesurereadmsg:function(d){if(d!=null&&!isNaN(d)){var c={};c.command="DBJSON";c.callbackEvent="U_Note_Read";var e={unoteid:parseInt(d,10)};c.param=Object.toJSON(e);c.table="U_NOTE";c.action="CONFIRMREAD";c.permission="W";this._executeCommandEvent(c)}},_noteread:function(c){mc.refresh();jQuery("#cmdmsg").css("display","none")},executeCommandEvent:function(c){this._lastAccessTime=(new Date()).getTime();Controller.handle(Object.toJSON(c),function(f){var d=f.evalJSON();if(d.code!=0){msgbox(d.message);if($("list_query_form")!=null){toggleButtons($("list_query_form"),false)}}else{var e=new BiEvent(d.callbackEvent);e.setUserData(d);application.dispatchEvent(e)}})},dlgo3:function(c,d){bxl.showObject2("/html/nds/object/object.jsp?table=U_NOTE&&fixedcolumns=&id="+c,956,570,d)},dlgo2:function(c){bxl.showObject2("/html/nds/object/object.jsp?table=U_NOTE&id="+c)},showObject2:function(e,g,c,f){if(g==undefined){g=956}if(c==undefined){c=570}if(g==-1){g=screen.availWidth;c=screen.availHeight}var d=$H({width:g,height:c,title:"",modal:true,centerMode:"x",noCenter:true,maxButton:true,style:"z-index:9999"});if(d!=undefined){d.merge(f)}if(d.iswindow==true){popup_window(e,d.target,d.width,d.height);jQuery("#MainApp").hide()}else{Alerts.popupIframe(e,d);Alerts.resizeIframe(d);Alerts.center();jQuery("#MainApp").hide()}bxl.closeDialog()},closeDialog:function(){if(!jQuery("#alert-message")){return}if(jQuery("#alert-message").attr("id")==undefined){bpos.noAlert=true;jQuery("#MainApp").show();clearInterval(c)}var c=setTimeout("bxl.closeDialog()",1000)},stopDefault:function(c){if(document.all){window.event.keyCode=0;window.event.cancelBubble=true}},lisense:function(){jQuery(document).bind("keydown",function(c){if(!bpos.noAlert){return}if(c.which==112){bxl.stopDefault();return false}if(c.which==113){bpos._editvip("f2newretail");bxl.stopDefault();return false}if(c.which==114){if(bpos.checkButtonShowPer("SALER")){bxl.sales()}bxl.stopDefault();return false}if(c.which==115){if(bpos.checkButtonShowPer("PENDING")){zody.guaDanOrChuli()}bxl.stopDefault();return false}if(c.which==116){bpos.payprice();bxl.stopDefault();return false}if(c.which==117){if(bpos.checkButtonShowPer("CHANGESTATE")){bpos.changeretailtype()}bxl.stopDefault();return false}if(c.which==118){if(bpos.checkButtonShowPer("CHANGENUM")){bpos.changnumber()}bxl.stopDefault();return false}if(c.which==119){if(bpos.checkButtonShowPer("CHANGEAMT")){bpos.changprice()}bxl.stopDefault();return false}if(c.which==120){if(bpos.checkButtonShowPer("CHANGETOTAMT")){zody.discount()}bxl.stopDefault();return false}if(c.which==121){zody.ope();bxl.stopDefault();return false}if(c.which==122){if(bpos.checkButtonShowPer("BATCH")){bxl.insertnum()}bxl.stopDefault();return false}if(c.which==123){bxl.stopDefault();return false}if(c.ctrlKey==true&&c.which==85){if(bpos.checkButtonShowPer("UPLOAD")){bpos.uploadOrder()}bxl.stopDefault();return false}if(c.ctrlKey==true&&c.which==70){if(bpos.checkButtonShowPer("SEARCH")){bxl.searchdocNo()}bxl.stopDefault();return false}if(c.ctrlKey==true&&c.which==80){if(bpos.master_data.params.showVIPAlertOnNewOrder=="false"){bpos.showvip()}bxl.stopDefault();return false}})},pay:function(){if(jQuery("#VIP").is(":visible")){jQuery("#VIP").hide();jQuery("#qtab1").show();jQuery("#query-search-tab .ui-tabs-nav li").toggleClass("ui-tabs-selected");dwr.util.selectRange($("currpay"),0,25)}},vip:function(){if(jQuery("#qtab1").is(":visible")){jQuery("#qtab1").hide();jQuery("#VIP").show();jQuery("#query-search-tab .ui-tabs-nav li").toggleClass("ui-tabs-selected");dwr.util.selectRange($("vip_currpay"),0,25)}},searchnum:function(){var d={};d.command="DBJSON";d.callbackEvent="BPOS_SEARCH";var g=jQuery.trim($("styles").value);var c=jQuery.trim($("color").value);var f=jQuery.trim($("size").value);var j={m_pdt:g,m_col:c,m_size:f};if(bpos.offline==true&&isIE()){var h={};h.param=j;var e=bpos.getskus(Object.toJSON(h));e=e.evalJSON();e=e.NewDataSet.Table;if(e==null){alert("没有您要查询的内容");return}this.searchaction(e);return}d.param=Object.toJSON(j);d.table="m_retail";d.action="bulk_insert";d.permission="w";d.isclob=true;this._executeCommandEvent(d)},_appSecret:function(c){return hex_md5(c)},gettime:function(){jQuery.post("time.jsp",function(c){bxl.t=jQuery.trim(c);bxl.getpassword()})},getpassword:function(){var d={};d.command="DBJSON";d.callbackEvent="BPOS_PWD";var e=this.employee;var g=this.t+".111";var f=jQuery("#empwd").val();var c=hex_md5(e+g+this._appSecret(f));var h={user_name:e,pwd:c,c_store_id:bpos.master_data.c_store_id};d.param=Object.toJSON(h);d.table="m_retail";d.action="check_pwd";d.permission="w";bpos._executeCommandEvent(d)},_onpwd:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();if(c.rest=="ok"){bxl.getEm();bxl.closeEmp()}else{document.getElementById("empwd").value="";document.getElementById("empwd").focus();alert("密码错误，请重新输入")}},_executeCommandEvent:function(c){Controller.handle(Object.toJSON(c),function(f){var d=f.evalJSON();if(d.code!=0){alert(d.message)}else{var e=new BiEvent(d.callbackEvent);e.setUserData(d.data);application.dispatchEvent(e)}})},getIndexByValue:function(d,e){for(var c=0;c<d.length;c++){if(d[c]==e){return c}}return -1},matrixStyle:function(g,d,n,m){var j=bxl.searchByPropety(g,["NAME"])[0]["NAME"];var h="",c,f;for(var e=0;e<j.length;e++){h+="<option value='"+j[e]+"'>"+j[e]+"</option>"}var l=bxl.splictRetByPropety(g,"NAME",j);bxl.sortSizeGroup(l[j[0]],d,n,m,j[0]);jQuery("#color-size-show").html(j[0]);jQuery("#styleM").html(h).bind("change",function(){c=jQuery("#styleM").find("option:selected").text();bxl.sortSizeGroup(l[c],d,n,m,c);jQuery("#color-size-show").html(jQuery("#styleM option:selected").text())})},splictRetByPropety:function(e,l,m){var h={};var g=bpos.change2array(e);for(var f=0;f<m.length;f++){var c=[];for(var d=0;d<g.length;d++){if(m[f]==g[d][l]){c.push(g[d])}}h[m[f]]=c}return h},searchretByName:function(d,c){var g=[];var f=bpos.change2array(d);for(var e=0;e<f.length;e++){if(f[e].NAME==c){g.push(f[e])}}return g},browserType:function(){if(navigator.userAgent.indexOf("Android")>-1){return"AD"}else{if(navigator.userAgent.indexOf("MSIE")>0){return"IE"}else{if(navigator.userAgent.indexOf("Firefox")>0){return"FF"}else{if(navigator.userAgent.indexOf("Safari")>0&&navigator.userAgent.indexOf("Chrome")<0){return"SF"}else{if(navigator.userAgent.indexOf("Chrome")>-1){return"CR"}}}}}},matrixSearchaction:function(J,C,x,H,o,I){this.single=H;this.mutilines=new Array();var u=bxl.searchByPropety(J,["MSIZE","SIZE_CODE"]);var s=bxl.searchByPropety(J,["COL","COL_CODE"]);var h,m,t,r,l,e;var G=false;var v=false;switch(C){case"NAME":r=s[0]["COL"];e="COL";break;case"VALUE":r=s[1]["COL_CODE"];e="COL_CODE";break;case"VALUENAME":r=s[0]["COL"];v=true;e="COL";break;default:r=s[0]["COL"];e="COL"}switch(x){case"NAME":t=u[0]["MSIZE"];l="MSIZE";break;case"VALUE":t=u[1]["SIZE_CODE"];l="SIZE_CODE";break;case"VALUENAME":t=u[0]["MSIZE"];G=true;l="MSIZE";break;default:t=u[0]["MSIZE"];l="MSIZE"}m=r.concat().sort();h=t.concat().sort();var y="";var r="";var t="";var w=-1;if(h.length&&m.length){bpos.gh_rows=m.length;var A=-1;y+="<table id='matrix' width=\""+(h.length*50+100-200)+'px" height="'+(m.length*28.5)+"px\" border='0' cellpadding='0' cellspacing='1' style='table-layout:fixed;'>";r+="<table id='rowtable' width=\""+(h.length*50+100-200)+"px\" border='0' cellpadding='0' cellspacing='1' style='table-layout:fixed;top:"+(-28.5-bpos.gh_rows*28.5)+"px;'>";t+='<table id=\'coltable\' width="90px" height="'+(m.length*28.5+bpos.gh_rows-1)+"px\" border='0' cellpadding='0' cellspacing='1' style='table-layout:fixed;'><tr>";y+='<tr><td class=\'td_bg_center\' width="90px"style="text-align:center;" height="28.5px"><div id="color-size-show">颜色尺寸</div></td>';r+='<tr><td width="90px" height="28.5px">&nbsp;</td>';var d=new Array();d.length=0;if(o!=undefined){for(var E=0;E<o.length;E++){for(var D=0;D<h.length;D++){if(o[E][1]==h[D]){d.push(o[E][1])}}}if(d.length!=h.length){for(var z=0;z<h.length;z++){if(!d.contains(h[z])){d.push(h[z])}}}h=d}for(var E=0;E<h.length;E++){if(G){w=this.getIndexByValue(u[0]["MSIZE"],h[E])}y+='<td class=\'td_bg\' width="60px" height="28.5px">'+h[E]+(G?(w==-1?"":"("+u[1]["SIZE_CODE"][w]+")"):"")+"</td>";r+='<td class=\'td_bg\' width="60px" height="28.5px">'+h[E]+(G?(w==-1?"":"("+u[1]["SIZE_CODE"][w]+")"):"")+"</td>"}y+="</tr>";r+="</tr></table>";var B=0;for(var E=0;E<m.length;E++){if(v){w=this.getIndexByValue(s[0]["COL"],m[E])}y+='<tr><td class=\'td_bg\' width="90px" height="28.5px">'+m[E]+(v?(w==-1?"":"("+s[1]["COL_CODE"][w]+")"):"")+"</td>";t+=(E==0)?"":"</tr><tr>";t+='<td class=\'td_bg\' width="90px" height="28.5px">'+m[E]+(v?(w==-1?"":"("+s[1]["COL_CODE"][w]+")"):"")+"</td>";for(var D=0;D<h.length;D++){A=this.searchretBySC(h[D],m[E],J,l,e);y+='<td class=\'td_bg_center\' width="60px" height="28.5px" '+(H?"":"align='center'")+">"+(A==-1?"</td>":"<input   "+(H?"type='radio' onkeydown='return false'":"")+" x="+D+" y="+E+" size='5' style='text-align:center;display:inline;' id=TMPnum"+(B++)+" name='TMPnum'>"+(H?"<div style=\"display:inline;\" class='aqty' id="+A.ID+">"+0+'</div><span id="barcode" style="display:none;">'+A.NO+"</span>":"<div style=\"display:inline;\" class='aqty' id="+A.ID+">0</div>")+"</td>")}y+="</tr>"}y+="</table>";t+="</tr></table>";y=y+"<div id='divTitle' style='z-index:101;position:relative;top:"+(-28.5-bpos.gh_rows*31)+"px;'>"+r+"</div>";y=y+"<div id='divLabel' style='z-index:101;position:relative;top:"+(-(this.browserType()=="IE"?(34.5+bpos.gh_rows-1):35.5)-bpos.gh_rows*30)+"px;'></div>";jQuery("#style-body").html(y);jQuery("#divLabel").html(t);if(!H){jQuery("#style-title").html('数量批量设置<span id="TMPstyle"></span>:<input class="q_input_80" id="unite">&nbsp;<input class="qinput" type="button" value="修改" onclick="bxl.unite();"><input class="qinput" type="button" value="清空所有输入" onclick="bxl.rewrite();">');jQuery("#sumnum").html(' 输入总合计：<span id="TMPsum"></span>');jQuery("#TMPstyle").html(bpos.change2array(J)[0].NAME)}H?jQuery("#TMPnum0").attr("checked",true):dwr.util.selectRange(jQuery("#TMPnum0"),0,10);jQuery("#TMPnum0").focus();this.queryQtycan(I);if(!H){jQuery("#style-body input").bind("blur",function(j){if(this.value&&j.target==this){if(!(this.value==parseInt(this.value)&&parseInt(this.value)>0)){alert("数量输入有误!");dwr.util.selectRange(this,0,100);return}}bxl.sumNum()})}jQuery("#avaqty").click(function(){bxl.queryQtycan(I)})}else{this.tryCancleM();alert("没有您要查的内容，请重新输入条件...")}function c(n,L){var K=++n;var j;do{j=jQuery("#style-body input[x="+K+"][y="+L+"]");if(!j.length){K++}}while(!j.length&&K<h.length);if(bxl.single){j.attr("checked",true);j.focus()}else{dwr.util.selectRange(j[0],0,100)}}function F(n,L){var K=--n;var j;do{j=jQuery("#style-body input[x="+K+"][=y="+L+"]");if(!j.length){K--}}while(!j.length&&K>=0);if(bxl.single){j.attr("checked",true);j.focus()}else{dwr.util.selectRange(j[0],0,100)}}function f(n,L){var K=++L;var j;do{j=jQuery("#style-body input[x="+n+"][y="+K+"]");if(!j.length){K++}}while(!j.length&&K<m.length);if(bxl.single){j.attr("checked",true);j.focus()}else{dwr.util.selectRange(j[0],0,100)}}function q(n,L){var K=--L;var j;do{j=jQuery("#style-body input[x="+n+"][y="+K+"]");if(!j.length){K--}}while(!j.length&&K>=0);if(bxl.single){j.attr("checked",true);j.focus()}else{dwr.util.selectRange(j[0],0,100)}}var g=jQuery("#save,#cancel",$("styleMatrix-content"));var p=$("save");jQuery("#styleMatrix-content").bind("keydown",function(n){var K=Event.element(n);var j=parseInt(jQuery(K).attr("x"));var L=parseInt(jQuery(K).attr("y"));if(n.which==13){if((bxl.isnum()||bxl.single)&&(K.id.indexOf("TMPnum")!=-1)){jQuery("#save").click()}}else{if(n.which==37){F(j,L)}else{if(n.which==38){q(j,L)}else{if(n.which==39){c(j,L)}else{if(n.which==40){f(j,L)}else{if(n.which==9){n.stopPropagation();n.preventDefault();p=bpos.tabKeydown(g,p)}}}}}}})},sortSizeGroup:function(ret,color,size,single,tempstyle){jQuery.ajax({type:"POST",cache:false,url:bpos.URL+"getBarcodeQtyCanByUserId.jsp?styles="+encodeURI(bpos.change2array(ret)[0].NAME)+(bpos.URL?("&storeid="+bpos.master_data.c_store_id):""),timeout:60000,error:function(){bxl.matrixSearchaction(ret,color,size,single)},success:function(data){eval("var qc="+bpos.change2array(data));bxl.matrixSearchaction(ret,color,size,single,qc[0],qc[1])}})},queryQtycan:function(d){if(d==undefined){return}for(var c=0;c<d.length;c++){jQuery("#"+d[c][0]).html(d[c][1])}},searchretBySC:function(g,c,e,d,j){var h=bpos.change2array(e);for(var f=0;f<h.length;f++){if(h[f][d]==g&&h[f][j]==c){this.mutilines.push(h[f]);return h[f]}}return -1},searchByPropety:function(l,c){var o=[];var e=1;var n=bpos.change2array(l);for(var h=0;h<c.length;h++){var d={};d[c[h]]=[];for(var g=0;g<n.length;g++){e=1;for(var f=0;f<d[c[h]].length;f++){if(n[g][c[h]]==d[c[h]][f]){e=0;break}}if(e){d[c[h]].push(n[g][c[h]])}}o.push(d)}return o},searchaction:function(e){var h="";var c=bpos.change2array(e);this.mutilines=c;if(e==null){alert("没有您要查询的内容")}else{for(var f=0;f<c.length;f++){var j=c[f].VALUE?c[f].VALUE:"";var g=c[f].m_dim5?c[f].m_dim5:"";var d=c[f].m_dim9?c[f].m_dim9:"";if(f%2==1){if(bpos.master_data.params.pageStyle=="redearth"){h+='<div class="treatment-row"><div class="treatment-row-line"><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+c[f].COL_CODE+'</div><div class="treatment-span-6">'+c[f].SIZE_CODE+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}else{if(bpos.master_data.params.pageStyle=="tommy"){h+='<div class="treatment-row"><div class="treatment-row-line"><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+g+'</div><div class="treatment-span-6">'+d+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}else{h+='<div class="treatment-row"><div class="treatment-row-line"><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+c[f].COL_CODE+'</div><div class="treatment-span-6">'+c[f].SIZE_CODE+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}}}else{if(bpos.master_data.params.pageStyle=="redearth"){h+='<div class="treatment-conduct"><div class="treatment-conduct-line"><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+c[f].COL_CODE+'</div><div class="treatment-span-6">'+c[f].SIZE_CODE+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}else{if(bpos.master_data.params.pageStyle=="tommy"){h+='<div class="treatment-conduct"><div class="treatment-conduct-line"><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+g+'</div><div class="treatment-span-6">'+d+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}else{h+='<div class="treatment-conduct"><div class="treatment-conduct-line"><div class="treatment-span-7">'+c[f].NO+'</div><div class="treatment-span-10">'+c[f].NAME+'</div><div class="treatment-span-10" >'+j+'</div><div class="treatment-span-6">'+c[f].COL+'</div><div class="treatment-span-6">'+c[f].MSIZE+'</div><div class="treatment-span-6">'+c[f].COL_CODE+'</div><div class="treatment-span-6">'+c[f].SIZE_CODE+'</div><div class="treatment-span-8">'+c[f].PRICELIST+'</div><div class="treatment-span-9"><input id="TMPnum'+f+'" name="TMPnum" type="text" class="bluk-input"></div></div></div>'}}}}}jQuery("#treatment-main").html(h);jQuery("#TMPnum0").focus();$("s").disabled=false;jQuery("#treatment-main input").bind("blur",function(l){if(this.value&&l.target==this){if(!(this.value==parseInt(this.value)&&parseInt(this.value)>0)){alert("数量输入有误!");this.focus();bxl.button=this;return}}})},_onsearch:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.searchaction(c)},tryCancle:function(){bpos.killAlert("insert_num_content")},tryCancleM:function(c){bpos.killAlert("styleMatrix-content",c)},matrixInsertnum:function(){if((bpos.MODEL&bpos.INSERTLINE)!=bpos.INSERTLINE){alert("该单据不可新增");return}if(bpos.nosalererror()){return}var c=Alerts.fireMessageBox({width:610,modal:true,title:gMessageHolder.EDIT_MEASURE});c.innerHTML='<div id="styleMatrix-content" class="txt-white"><div id="style-head">店仓：<span id="store"></span> &nbsp;&nbsp;&nbsp;款号：<select id="styleM" style="width:atuo;min-width:100px;"></select>  &nbsp;&nbsp;&nbsp; <input type="button" class="qinput" id="avaqty" value="可用量"><div id="style-title"></div></div><div class="style-body" id="style-body" onscroll="javascript:bxl.scrollData();"></div><div><table width="580" border="0" cellspacing="0" cellpadding="0"><tr><td><div class="txt-white" id="sumnum"></div></td><td align="right"><input type="button" id="save" class="qinput" value="保存" onclick="javascript:bxl.handlesingledisM();"> &nbsp;<input type="button" id="cancel" class="qinput" value="取消" onclick="javascript:bxl.tryCancleM();"></td></tr></table></div></div>';bpos.executeLoadedScript(c);bpos.noAlert=false;jQuery("#store").html(bpos.master_data.c_store_name)},scrollData:function(){document.getElementById("divTitle").style.display="";document.getElementById("divLabel").style.display="";document.getElementById("divTitle").style.top=((-38.5-bpos.gh_rows*30.5)+document.getElementById("style-body").scrollTop)+"px";document.getElementById("divLabel").style.left=(document.getElementById("style-body").scrollLeft)+"px"},insertnum:function(){if((bpos.MODEL&bpos.INSERTLINE)!=bpos.INSERTLINE){alert("该单据不可新增");return}if(bpos.nosalererror()){return}if(bpos.itemtype==2&&bpos.master_data.params.needorgno){alert("错误：退货不能使用批量录入功能！");return}var e=Alerts.fireMessageBox({width:728,modal:true,title:gMessageHolder.EDIT_MEASURE});e.innerHTML=$("insert_num").innerHTML.replace(/TMP/g,"");bpos.executeLoadedScript(e);bpos.noAlert=false;jQuery("#styles").focus();var c=jQuery("#search_num,#unite,#united,#re,#s,#cancle",$("insert_num_content"));var f=$("unite");var d=jQuery("#styles,#color,#size");jQuery("#insert_num_content").bind("keydown",function(m){var h=jQuery("#treatment-main input");if(m.which==9){m.stopPropagation();m.preventDefault();f=bpos.tabKeydown(c,f)}else{if(m.which==13){if(d.index(m.target)!=-1){bxl.styles()}else{if(h.index(m.target)!=-1){if(bxl.isnum()){jQuery("#s").click()}else{jQuery("#s").focus()}}else{var l=c[j];jQuery(l).click()}}}else{if(m.which==39){var j=0;if(!bxl.button){j=d.index(bxl.button)+2}else{j=d.index(bxl.button)+1}if(!d[j]){j=0}bxl.button=d[j];dwr.util.selectRange(d[j],0,100)}else{if(m.which==37){var g=d.length;var j=0;j=d.index(bxl.button)-1;if(j<0){j=g-1}bxl.button=d[j];dwr.util.selectRange(d[j],0,100)}else{if(m.which==40){var j=0;if(!bxl.button){j=h.index(bxl.button)+2}else{j=h.index(bxl.button)+1}if(!h[j]){j=0}bxl.button=h[j];dwr.util.selectRange(h[j],0,100)}else{if(m.which==38){var g=h.length;var j=0;j=h.index(bxl.button)-1;if(j<0){j=g-1}bxl.button=h[j];dwr.util.selectRange(h[j],0,100)}}}}}}})},styles:function(){var d="";jQuery("#treatment-main").html(d);var c=jQuery.trim($("styles").value);bxl.searchnum()},isnum:function(){var c;var e=document.getElementsByName("TMPnum");for(var d=0;d<e.length;d++){if(!(e[d].value==parseInt(e[d].value)&&parseInt(e[d].value)>0)){if(e[d].value!=null&&e[d].value!=""){c=e[d].value}}}if(c!=null&&c!=""){return false}else{return true}},Singledis:function(c){return(MainApp.SingleDis(c)).evalJSON()},doSingledis:function(d){var c=new Array();var n={};var l=[];if(d){l=jQuery("#style-body input[value!='']")}else{l=jQuery("#treatment-main input[value!='']")}if(l.length==0){alert("录入信息为空")}else{var f=document.getElementsByName("TMPnum");for(var h=0;h<f.length;h++){if(f[h].value!=""){var e={};e.cardno=bpos.vip.cardno||"1";e.c_store_id=bpos.master_data.c_store_id;e.billdate=$("sys_date").value;e.m_retail_productno=bxl.mutilines[h].NO;e.m_retail_qty=isNaN(parseInt(f[h].value,10))?0:parseInt(f[h].value,10);e.m_retail_type=bpos.itemtype+"";e.m_retail_orgdocno="-1";e.m_retail_priceactual=isNaN(parseFloat(bxl.mutilines[h].PRICELIST*e.discount))?0:parseFloat(bxl.mutilines[h].PRICELIST*e.discount);e.discount=isNaN(parseFloat(1))?0:parseFloat(1);e.vipexp=bpos.vip.vipexp||"1";e.vipbir=bpos.vip.birthday||"";c.push(e)}}n.Table=c;var g={};g.param=n;return bxl.Singledis(Object.toJSON(g))}},handlesingledisM:function(){if(this.single){$("m_retail_idx").value=jQuery("#style-body input[checked] ~ span").text();this.tryCancleM(true);bpos.insertLine()}else{this.handlesingledis("m");this.tryCancleM()}},handlesingledis:function(m){var data=this.doSingledis(m);if(data.NewDataSet&&data.NewDataSet.Table){var arr=bpos.change2array(data.NewDataSet.Table);if(arr.length>0){for(var i=0;i<arr.length;i++){var line={};line.productno=arr[i].m_retail_productno;line.productname=arr[i].m_retail_productname;line.colorname=arr[i].m_retail_colorname;line.sizename=arr[i].m_retail_sizename;line.color=arr[i].m_retail_color;line.size=arr[i].m_retail_size;line.mdim11=arr[i].m_retail_mdim11;line.productvalue=arr[i].m_retail_productvalue;line.pricelist=parseFloat(arr[i].m_retail_pricelist);line.discount=parseFloat(arr[i].m_retail_discount);line.discription=arr[i].m_retail_discription;line.priceactual=parseFloat(arr[i].m_retail_priceactual);line.priceactual=bpos.alg(line.priceactual);line.qty=parseInt(arr[i].m_retail_qty);line.price=parseFloat(arr[i].m_retail_price);line.price=bpos.alg(line.price);line.salerid=bpos.master_data.saler.id;line.saler=bpos.master_data.saler.name;line.multisalers=bpos.master_data.multisalers||[];line.type=arr[i].m_retail_type;line.orgdocno=arr[i].m_retail_orgdocno;line.lineno=-1;line.pda_id=arr[i].m_pda_id;line.locked=arr[i].locked||0;line.lowest_discount=arr[i].lowest_discount||0;line.sin_disid=parseInt(arr[i].sin_disid,10)||-1;line.sin_disname=arr[i].sin_disname||-1;line.com_disid=parseInt(arr[i].com_disid,10)||-1;line.com_disname=arr[i].com_disname||-1;line.add_disid=parseInt(arr[i].add_disid,10)||-1;line.add_disname=arr[i].add_disname||-1;for(var p=1;p<=20;p++){eval("line.m_dim"+p+"=arr["+i+"].m_dim"+p+"?arr["+i+"].m_dim"+p+':"";')}bpos.updateitems_data2(line)}}this.tryCancle();$("m_retail_idx").value="";var m_retail_idx=$("m_retail_idx");m_retail_idx.focus()}},validateEmployee:function(h,g){var f=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});f.innerHTML='<div id="login_content"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="treatment_td"><div id="treatment_text">校验权限：</div></div></td></tr><tr><td><div id="user_botder"><ul><li><div class="user-left">用户名：</div><div class="user-right"><input value="当前用户" id="emname" name="emname" type="text" class="user-input"></div></li><li><div class="user-left">密&nbsp;&nbsp;&nbsp;&nbsp;码：</div><div class="user-right"><input id="empwd" name="empwd" type="password" class="user-input" /></div></li></ul></div></div></td></tr> <tr><td><div id="treatment_td" align="center"><div id="treatment_text">&nbsp;<input type="button" value="确定" class="qinput" id="btn-oks" onclick="bxl.validate(\''+h+"',"+g+')"/>&nbsp;<input name="cancle" id="btn-c" type="button" class="qinput" value="取消" onclick="javascript:bxl.closeEmp(\'Q\')" /></div></td></tr></table></div>';bpos.executeLoadedScript(f);bpos.noAlert=false;jQuery("#empwd").focus();var e=bpos.master_data.operator.email||"";if(e&&e!=""){jQuery("#emname").val(bpos.master_data.operator.email)}var c=jQuery("#emname,#empwd,#btn-oks,#btn-c");jQuery("#login_content").bind("keydown",function(l){l.stopPropagation();var j=l.target;var d=c.index(j);if(l.which==13){switch(d){case 1:if(j.value){jQuery(c[2]).click()}break;case 0:if(j.value){jQuery(c[1]).focus()}break;default:if(c[0].value&&c[1].value){jQuery(c[2]).click()}else{jQuery(c[0]).focus()}}}else{if(l.which==40){switch(d){case 0:jQuery(c[1]).focus();break;case 1:jQuery(c[0]).focus();break;default:jQuery(c[1]).focus()}}else{if(l.which==38){switch(d){case 0:jQuery(c[1]).focus();break;case 1:jQuery(c[0]).focus();break;default:jQuery(c[0]).focus()}}else{if(l.which==9){l.preventDefault();if(c[d+1]){jQuery(c[d+1]).focus()}else{jQuery(c[0]).focus()}}}}}})},validate:function(f,c){$("btn-oks").disabled=true;var e=c?"validateUserWebposPer.jsp":"validateLogin.jsp";jQuery.ajax({type:"POST",url:bpos.URL+e,timeout:30000,data:{email:document.getElementById("emname").value,pwd:document.getElementById("empwd").value,storeid:bpos.offlineUserinfo?bpos.offlineUserinfo.storeid:""},error:function(){$("btn-oks").disabled=false;alert("网络不畅,请稍后再试！")},success:function(l){$("btn-oks").disabled=false;if(jQuery.trim(l)!="error"){var j=l.substring(0,l.indexOf("+"));var g=l.substring(l.indexOf("+")+1).toString();var h=jQuery.trim(g);bpos.master_data.discountlimit=parseFloat(j);bxl.closeEmp();if(f=="price"){setTimeout("bpos.updateprice()",100)}else{if(f=="discount"){setTimeout("zody.amount()",100)}else{if(f=="Q"){if(h=="N"){alert("您没有退货权限");return}setTimeout("bpos._editretailno()",100)}else{if(f=="V"){if(h=="N"){alert("您没有退货权限");return}bxl.closeEmp(f);setTimeout('bpos.checkretailno("")',100)}else{if(f=="changeTime"){var m=l.substring(0,l.indexOf("+"));var d=l.substring(l.indexOf("+")+1).toString();if((parseInt(d,2)&bpos.CHANGEBILLDATE)==bpos.CHANGEBILLDATE){bpos.changeTimeValidate(bpos.selectDate,m);return}else{bpos.changeTimeValidate(new Date());alert("无权限")}}}}}}}else{alert("用户名或密码错误！")}}})},closeEmp:function(c){bpos.killAlert("login_content",true);if(c&&c=="V"){bpos.killAlert("r_retail_no_content",true)}else{if(c&&c=="Q"){bpos.changeTimeValidate(new Date());bpos.killAlert("r_retail_no_content",true);bpos.selectFirstType();$("m_retail_idx").value=""}}},sales:function(){this.linenoes=bpos.getcheckedlinenoes();var c=this.linenoes.length||-1;if(c>0){if(!confirm("您选择了序号"+this.linenoes+"，确认更改营业员？")){return}}var g=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});var j="";if(bpos.master_data.params.pageStyle=="redearth"){j='<div id="sales_content" class="salesperson_content"><div id="treatment_td"><div id="treatment_text">'+(c>0?"请选择更改员工：":"请选择当前员工：")+'<input type="text"  id="search" name="search"/></div></div><div id="salesperson_botder"><ul style="height: 150px; visibility: visible; opacity: 1;">'}else{j='<div id="sales_content" class="salesperson_content"><div id="treatment_td"><div id="treatment_text">'+(c>0?"请选择更改营业员":"请选择当前营业员：")+'<input type="text"  id="search" name="search"/></div></div><div id="salesperson_botder"><ul style="height: 150px; visibility: visible; opacity: 1;">'}var h=false;if(bpos.master_data.params.multiSalers=="true"){h=true}if(bpos.master_data.salers.length<=1){j+='<tr><td height="30"><div class="desc-txt">当前店铺没有营业员</div></td></tr>'}else{for(var e=0;e<bpos.master_data.salers.length;e++){if(bpos.master_data.salers[e].id!=-1){j+='<li><input name="employee" id=\'employee-'+e+"' "+(h?'type="checkbox"':'onclick="javascript:bxl.getEmployee();" type="radio"')+' value="" class="salesperson_input" />'+bpos.master_data.salers[e].name+"("+bpos.master_data.salers[e].truename+")</li>"}}}j+='</ul></div><div id="treatment_td" align="center"><div id="treatment_text">'+(h?'<input type="button" class="qinput" id="identify" onclick="bxl.getEmployee()" value="确定">':"")+'<input type="button" class="qinput" id="close" onclick="bxl.closeEmployee()" value="取消"></div></div></div>';g.innerHTML=j;bpos.executeLoadedScript(g);bpos.noAlert=false;jQuery("#search").focus();jQuery("#search").bind("keyup",function(o){var l=jQuery("#salesperson_botder li");var m=jQuery("#search").val();var p=m.toLowerCase();l.each(function(){var q=jQuery(this).text();var n=q.toLowerCase();if(n.indexOf(p)==-1){jQuery(this).hide()}else{jQuery(this).show()}});if(o.which==13&&jQuery.trim(m)!=""){jQuery("#salesperson_botder li:visible:first input[type='radio']").attr("checked",true);if(h){bxl.getEmployee()}dwr.util.selectRange($("search"),0,50)}});var f;var d=jQuery("#identify,#close");jQuery("#sales_content").bind("keydown",function(p){var m=jQuery("#sales_content li:visible input:radio,#sales_content li:visible input:checkbox");if(p.which==40){var n=0;if(f){n=m.index(f)+1}if(!m[n]){n=0}if(h){jQuery(m[n]).focus()}else{jQuery(m[n]).attr("checked",true)}f=m[n]}else{if(p.which==9){p.stopPropagation();p.preventDefault();if(!f||d.index(f)!=0){f=d[0]}else{f=d[1]||d[0]}jQuery(f).focus()}else{if(p.which==38){var l=m.length;var n=0;if(f){n=m.index(f)-1}if(n<0){n=l-1}if(h){jQuery(m[n]).focus()}else{jQuery(m[n]).attr("checked",true)}f=m[n]}else{if(p.which==13){var o=f;jQuery(o).attr("checked",true);bxl.getEmployee()}}}}})},closeEmployee:function(){bpos.killAlert("sales_content")},getEmployee:function(){var l;l=document.getElementsByName("employee");if(bpos.master_data.params.multiSalers=="true"){var h=new Array()}var e=false;for(var f=0;f<l.length;f++){if(l[f].checked){var d=parseInt(l[f].id.replace("employee-",""),10);if(bpos.master_data.params.multiSalers=="true"){h.push(bpos.master_data.salers[d])}else{bpos.master_data.saler.id=bpos.master_data.salers[d].id;bpos.master_data.saler.name=bpos.master_data.salers[d].name;bpos.master_data.saler.truename=bpos.master_data.salers[d].truename;bpos.master_data.saler.dicountlmt=bpos.master_data.salers[d].discountlmt}e=true}}bpos.master_data.multisalers=h;if(this.linenoes.length>0){for(var c=0;c<this.linenoes.length;c++){var g=bpos.getitembylinenofromitems_data(this.linenoes[c]);if(bpos.master_data.params.multiSalers=="true"){g.multisalers=h}else{g.salerid=bpos.master_data.salers[d].id;g.saler=bpos.master_data.salers[d].name}$("saler-"+this.linenoes[c]).innerHTML=bpos.getSalerTrueName(g.saler,g);bpos.clearchecked("from-main")}}else{$("emp_name").innerHTML=bpos.master_data.saler.name+"("+bpos.master_data.saler.truename+")";bpos.updateheaderhtml()}bxl.closeEmployee();if(e&&$("m_retail_idx").value){bpos.insertLine()}},unite:function(){var e=document.getElementById("unite").value;if(e==""||e==null){alert("数量为空");return}else{if(!isNaN(e)&&e==parseInt(e)&&parseInt(e)>0){var c=document.getElementsByName("TMPnum");for(var d=0;d<c.length;d++){c[d].value=e}}else{alert("填写格式不正确！")}}this.sumNum()},sumNum:function(){var c=document.getElementsByName("TMPnum");var f=0,e;for(var d=0;d<c.length;d++){e=parseInt(c[d].value);if(e==c[d].value&&e>0){f+=e}}jQuery("#TMPsum").html(f)},rewrite:function(){var c=document.getElementsByName("TMPnum");document.getElementById("unite").value="";for(var d=0;d<c.length;d++){c[d].value=""}this.sumNum()},searchdocNo:function(){if(bpos.items_data.length>0){alert("尚有单据未处理，无法查询！");return}var e=Alerts.fireMessageBox({width:800,modal:true,title:gMessageHolder.EDIT_MEASURE});e.innerHTML='<div id="searchdoc_content"><table width="800" border="0" cellspacing="0" cellpadding="0"> <tr><td><div id="treatment_td"><div id="treatment_text">单据查询：</div></div></td></tr><tr><td bgcolor="#2d476a" height="50"><table width="760" border="0" align="center" cellpadding="0" cellspacing="0"><tr><td width="80"><div class="desc-txt">单据号：</div></td><td width="135"><input name="text" id="docno" type="text" class="q_input_80" /></td><td width="80"><div class="desc-txt">开始时间：</div></td><td width="135"><input  name="text2" id="datebeg" type="text" class="q_input_80" value="" onfocus="WdatePicker()"/></td><td width="80"><div class="desc-txt">结束时间：</div></td><td width="135"><input name="text3" type="text" id="dateend" class="q_input_80" value="" onfocus="WdatePicker()"/></td><td width="80"><div class="desc-txt">上传状态：</div></td><td width="100"><select style="display:block" id="upload"><option value="1" selected="selected">上传</option><option value="0">未上传</option>&nbsp;</select></td><td width="50"><input name="button" type="button" class="qinput" id="searchdoc" onclick="bxl.docNO()" value="查询"/></td></tr></table></td></tr><tr bgcolor="#2d476a"><td><div bgcolor="#2d476a"  class="search-table"><table id="retaildoc" border="0" align="center" cellpadding="1" cellspacing="1" style="background-color:#A3BAD4;visibility:visible;margin:0 auto; opacity: 1; overflow:auto; table-layout: fixed; width:1000px;"><tr class="search-table-head"><td width="50" class="search-title">序号</td><td width="150" class="search-title">单据号</td> <td width="65" class="search-title">日期</td><td width="65" class="search-title">总数量</td> <td width="65" class="search-title">总金额</td><td width="50" class="search-title">VIP</td><td width="65" class="search-title">操作员</td> <td width="80" class="search-title">上传标记</td><td width="210" class="search-title">备注</td> <td width="200" class="search-title">失败原因</td> </tr></table></div></td></tr><tr bgcolor="#2d476a"><td bgcolor="#2d476a"><div bgcolor="#2d476a" id="treatment_td_class" align="center"><div bgcolor="#2d476a" id="treatment_text"><input type="button" value="打印" id="printdoc" onclick="javascript:bxl.print()" class="qinput" id="btn-search"/>&nbsp;<input type="button" id="showdoc" value="查看" onclick="javascript:bxl.showOrder()" class="qinput" id="btn-cancel"/>&nbsp;<input id="closeSearch" type="button" class="qinput" value="取消" onclick="bxl.closeSearch()"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span  width="150" class="desc-txt">金额合计:</span><span id="amt_total">0</span>元&nbsp;,&nbsp;<span  width="150" class="desc-txt">数量合计:</span><span id="qty_total">0</span>件</div></div></td></tr></td></tr></table></div>';bpos.executeLoadedScript(e);bpos.noAlert=false;jQuery("#docno").focus();var d;var c=jQuery("#docno,#datebeg,#dateend,#upload,#searchdoc,#printdoc,#showdoc,#closeSearch");jQuery("#searchdoc_content").bind("keydown",function(g){if(g.which==13){if(c.index(d)<4){bxl.docNO();jQuery("#docno").focus()}else{jQuery(d).dblclick()}}else{if(g.which==39){var f=0;if(c.index(d)==-1){f=c.index(d)+2}else{f=c.index(d)+1}if(!c[f]){f=0}d=c[f];jQuery(d).focus()}else{if(g.which==37){if(d){f=c.index(d)-1}if(!c[f]){f=c.length-1}d=c[f];jQuery(d).focus()}else{if(g.which==9){g.stopPropagation();g.preventDefault();var f=0;if(c.index(d)==-1){f=c.index(d)+2}else{f=c.index(d)+1}if(!c[f]){f=0}d=c[f];jQuery(d).focus()}}}}})},closeSearch:function(){bpos.killAlert("searchdoc_content")},checkIsDate:function(e,c,d){if(parseInt(e,10)>12||parseInt(e,10)<1||parseInt(c,10)>31||parseInt(c,10)<1||parseInt(d,10)<1980||parseInt(d,10)>3000){return false}return true},docNO:function(){var f=jQuery.trim($("docno").value);var c=jQuery.trim($("datebeg").value);var j=jQuery.trim($("dateend").value);var e=jQuery.trim($("upload").value);jQuery("#searchdoc_content .search-table").html("");var h={};h.refno=f;h.datebeg=c;h.dateend=j;h.upload_status=e;var g={};g.param=h;var d=bpos.searchOrder(Object.toJSON(g));d=d.evalJSON();this.d=d.NewDataSet;d=d.NewDataSet.Table;bxl.resultdoc(d)},resultdoc:function(o){var d=0;var p=0;var q='<table id="retaildoc"  border="0" cellpadding="1" cellspacing="1" style="margin:auto;table-layout:fixed;visibility: visible; opacity: 1; overflow:auto; width:1100;"><tr class="search-table-head"><td width="53" class="search-title">序号</td><td width="152" class="search-title">单据号</td> <td width="71" class="search-title">日期</td> <td width="50" class="search-title">总数量</td><td width="54" class="search-title">总金额</td> <td width="48" class="search-title">VIP</td><td width="60" class="search-title">操作员</td><td width="67" class="search-title">上传标记</td><td width="80" class="search-title">备注</td><td width="148" class="search-title">失败原因</td></tr>';if(this.d.toString()==""){alert("没有您要查询的内容")}else{var m=bpos.change2array(o);this.docdata=m;for(var f=0;f<m.length;f++){var c="";var g="";var r="";var l="";if(m[f].ERROR_INFO){g=m[f].ERROR_INFO}else{g="无记录"}if(m[f].UPLOAD_STATUS==0){c="未上传"}else{if(m[f].UPLOAD_STATUS==1){c="已上传"}}if(m[f].VIPID==-1){r="无"}else{r=(m[f].JSON).evalJSON().param.vip_cardno}if(m[f].RECORD==""){l="无记录"}else{l=m[f].RECORD}var e=f+1;d=d.add(parseFloat(m[f].TOTAMT));p+=parseInt(m[f].TOTQTY,0);q+="<tr "+(f%2==1?'class="search-conduct"':'class="search-row"')+'><td class="search-text"><input   type="radio" name="doc"  id='+f+" />"+e+'</td><td class="search-text">'+m[f].ORDERNO+'</td><td class="search-text">'+m[f].BILLDATE+'</td><td class="search-textR">'+m[f].TOTQTY+'</td><td class="search-textR">'+bpos.alg(parseFloat(m[f].TOTAMT),false)+'</td><td class="search-text">'+r+'</td><td class="search-text">'+m[f].operatorname+'</td><td class="search-text">'+c+'</td><td class="search-text">'+l+'</td><td class="search-text">'+g+"</td></tr>"}}q+="</table>";jQuery("#searchdoc_content .search-table").html(q);jQuery("#amt_total").html(d==0?"0":d);jQuery("#qty_total").html(p==0?"0":p);jQuery("#searchdoc_content .search-table tr input:radio:visible").eq(0).attr("checked",true);jQuery("#searchdoc_content  .search-table tr").eq(1).addClass("search_c");jQuery("#searchdoc_content .search-table tr").click(function(){jQuery("#searchdoc_content .search-table tr").removeClass("search_c");jQuery(this).addClass("search_c");jQuery(this).find(":radio").attr("checked",true)});jQuery("#searchdoc_content .search-table tr").dblclick(function(){bxl.showOrder()});var n=jQuery("#searchdoc_content .search-table tr input:radio:visible");var h=jQuery("#searchdoc_content  .search-table tr");jQuery("#searchdoc_content").bind("keyup",function(s){bxl.stopDefault();if(s.target==$("datebeg")||s.target==$("dateend")){return}if(s.which==38){for(var j=0;j<n.length;j++){if(n[j].checked==true){jQuery(h[j+1]).removeClass("search_c");if(j==0){n[n.length-1].checked=true;jQuery(h[n.length]).addClass("search_c")}else{n[j-1].checked=true;jQuery(h[j]).addClass("search_c")}return}}}else{if(s.which==40){for(var j=0;j<n.length;j++){if(n[j].checked==true){jQuery(h[j+1]).removeClass("search_c");if(j==n.length-1){n[0].checked=true;jQuery(h[1]).addClass("search_c")}else{n[j+1].checked=true;jQuery(h[j+2]).addClass("search_c")}return}}}}})},changeDetail:function(c){if(c=="retailDetail"){jQuery("#retailDetail").parent().addClass("ui-tabs-selected");jQuery("#payDetail").parent().removeClass();jQuery("#id_showOrder").show();jQuery("#id_payDetail").hide()}else{if(c=="payDetail"){jQuery("#payDetail").parent().addClass("ui-tabs-selected");jQuery("#retailDetail").parent().removeClass();jQuery("#id_payDetail").show();jQuery("#id_showOrder").hide()}}},showOrder:function(){jQuery("#MainApp").hide();var indx=0;var len=jQuery("#searchdoc_content .search-table input:checked");var drawDataHtml='<div id="whole_div">';var payDetailHtml="";if(len.length==0){alert("请选择需要查看的单据")}else{bpos.init();drawDataHtml+='<ul class="ui-tabs-nav"><li onclick="bxl.changeDetail(\'retailDetail\')" class="ui-tabs-selected"><a  style="cursor:pointer" id="retailDetail"><span>零售明细</span></a></li><li onclick="bxl.changeDetail(\'payDetail\')" class=""><a  id="payDetail" style="display:block;cursor:pointer"><span>付款明细</span></a></li></ul>';drawDataHtml+='<div id="id_showOrder" style="display:block"><div class="from-table"><div id="from-table" class="from-table-head">'+bpos.initItemHeaderFirst()+'</div></div><div id="from-main" class="from-sidebar" style="height: 292px; visibility: visible; opacity: 1;">';payDetailHtml+='<div id="id_payDetail" style="display:none"><div class="from-table"><div id="from-table" class="from-table-head"><div class="from-span-13" style="align:center">序号</div><div class="from-span-4" style="align:center">  付款方式</div><div class="from-span-4" style="align:center">付款金额</div><div class="from-span-4" style="align:center">实际付款</div><div class="from-span-41" style="align:center">备注</div></div></div><div id="from-main" class="from-sidebar" style="height: 292px; opacity: 1;">';var id=parseInt(len[0].id,10);var obj=this.docdata[id].JSON.evalJSON();var p=obj.param;for(var i=0;i<p.productno.length;i++){var lines={};lines.productno=p.productno[i].toString();lines.productvalue=p.productvalue[i]?p.productvalue[i]:"-";lines.colorname=p.colorname[i]?p.colorname[i].toString():"-";lines.sizename=p.sizename[i]?p.sizename[i].toString():"-";lines.color=p.color[i]?p.color[i].toString():"-";lines.size=p.size[i]?p.size[i].toString():"-";lines.mdim11=p.mdim11[i]?p.mdim11[i].toString():"-";lines.productname=p.productname[i]?p.productname[i].toString():"-";lines.pricelist=parseFloat(p.pricelist[i]);lines.discount=parseFloat(p.discount[i]);lines.discription=p.description1[i].toString();lines.priceactual=parseFloat(p.priceactual[i]);lines.qty=parseInt(p.qty[i]);lines.price=parseFloat(p.price[i]);lines.salerid=(p.salerid1[i])?p.salerid1[i].toString():"";lines.saler=(p.saler[i])?p.saler[i].toString():"";lines.type=p.type[i].toString();lines.orgdocno=p.orgdocno[i].toString();lines.lineno=-1;lines.locked=p.locked?p.locked[i]:0;lines.lowest_discount=p.lowest_discount?p.lowest_discount[i]:0;lines.pda_id=p.m_pda_id[i].toString();for(var j=1;j<=20;j++){eval("lines.m_dim"+j+"=p.m_dim"+j+"?p.m_dim"+j+':"";')}indx+=1;var cn=indx%2==0?"conduct":"row";var type="";switch(parseInt(lines.type,10)){case 1:type="正常";break;case 2:type="退货";break;case 3:type="赠品";break;case 4:type="全额";break}drawDataHtml+=bpos.ret_insertitem(indx,lines,type,cn,"showOrder")}var pp=obj.param;var index2=0;for(var w=0;w<pp.paywayid.length;w++){var cnn=w%2==1?"conduct":"row";index2++;payDetailHtml+=this.get_payDetail(pp.paywayid[w],cnn,index2)+'<div class="from-span-4">'+bpos.changenumber2yuan(pp.paymount[w])+'</div><div class="from-span-4">'+bpos.changenumber2yuan(pp.realpaymount[w])+'</div><div class="from-span-41">'+(pp.discription2[w].strip()==-1?"":pp.discription2[w])+"</div></div></div>"}var ele=Alerts.fireMessageBox({width:1014,modal:true,title:gMessageHolder.EDIT_MEASURE});drawDataHtml+="</div></div>";payDetailHtml+="</div></div>";drawDataHtml+=payDetailHtml+'</br><div align="center"><input type="button" id="btn_back" class="showOrder_back" value="返回" onclick="javascript:bpos.killAlert2(\'id_showOrder\')"/></br></br></div>';ele.innerHTML=drawDataHtml;bpos.executeLoadedScript(ele);bpos.noAlert=false;jQuery("#btn_back").focus();var input;var inputs=jQuery("#retailDetail,#payDetail");jQuery("#whole_div").bind("keydown",function(event){if(event.which==13){bpos.killAlert2("id_showOrder")}else{if(event.which==9){event.stopPropagation();event.preventDefault();var idx=0;if(inputs.index(input)==-1){idx=inputs.index(input)+2}else{idx=inputs.index(input)+1}if(!inputs[idx]){idx=0}input=inputs[idx];jQuery(input).focus();idx==0?bxl.changeDetail("retailDetail"):(idx==1?bxl.changeDetail("payDetail"):"")}else{return false}}})}},get_payDetail:function(d,h,g){var f=bpos.master_data.payways;var c='<div class="from-'+h+'"><div class="from-'+h+'-line"><div class="from-span-13">'+g+'</div><div class="from-span-4">  ';for(var e=0;e<f.length;e++){if(d==f[e].id){c+=f[e].name;break}}return c+="</div>"},print:function(){var c=jQuery("#searchdoc_content .search-table input:checked");if(c.length<1){alert("请选择需要打印的数据")}else{var h=parseInt(c[0].id);var e=this.docdata[h].JSON.evalJSON();var d=e.param.refno;var g={refno:d};var f={};f.param=g;bpos.posprint(Object.toJSON(f));bxl.closeSearch()}}};BXL.main=function(){bxl=new BXL()};jQuery(document).ready(BXL.main);Array.prototype.contains=function(d){var c=this.length;while(c--){if(this[c]===d){return true}}return false};var zody=null;var ZODY=Class.create();ZODY.prototype={initialize:function(){dwr.util.useLoadingMessage(gMessageHolder.LOADING);dwr.util.setEscapeHtml(false);dwr.engine._errorHandler=function(d,c){while(c!=null&&c.cause!=null){c=c.cause}if(c!=null){d=c.message}if(d==null||d==""){alert("A server error has occured. More information may be available in the console.")}else{if(d.indexOf("0x80040111")!=-1){dwr.engine._debug(d)}else{alert(d)}}};application.addEventListener("BPOS_GUADAN",this._guaDan,this);application.addEventListener("BPOS_DOGUADAN",this._doGuaDan,this);application.addEventListener("BPOS_GETGUADAN",this._callGetGuaDan,this);application.addEventListener("BPOS_CLOSEGUADAN",this._callCloseGuaDan,this);jQuery("#comment").attr("disabled",true);jQuery("#comment").val("按下F10键输入商品备注...");jQuery("#comment").blur(function(){if(jQuery("#comment").val()==""){jQuery("#comment").val("按下F10键输入商品备注...");jQuery("#comment").attr("disabled",true)}else{jQuery("#comment").attr("disabled",true)}});jQuery(document).keydown(function(c){if(c.which==121){if(bpos.nosalererror()){return}zody.ope()}})},ope:function(){var c="按下F10键输入商品备注...";jQuery("#comment").removeAttr("disabled");if(jQuery("#comment").val()==c){jQuery("#comment").val("");jQuery("#comment").focus()}else{jQuery("#comment").select()}},udone:function(c){var c=c?c:(window.event?window.event:null);if(c.keyCode==13){jQuery("#comment").attr("disabled",true);if(jQuery("#comment").val()==""){jQuery("#comment").val("按下F10键输入商品备注...")}jQuery("#m_retail_idx").focus()}},clear:function(){jQuery("#m_retail_idx").val("");jQuery("#comment").val("按下F10键输入商品备注...")},guaDanOrChuli:function(){if(!bpos.checkCanPendingOrder()){alert("该单据不可挂单！");return}if(bpos.items_data.length<=0){if(window.confirm("确认执行处理挂单操作？")){zody.doGuaDan();zody.clear();return false}}else{zody.guaDanTi();jQuery("#zody_textarea").focus()}},guaDan:function(print){var billdate1=0;billdate1=jQuery("#sys_date").val();var billdate=parseInt(billdate1);var evt={};var printed="N";var canModify=bpos.master_data.canModify;if(print!=""){printed="Y";canModify=0}evt.command="DBJSON";evt.callbackEvent="BPOS_GUADAN";var comment="";comment=$("comment").value;if(comment=="按下F10键输入商品备注..."){comment=""}var orgdocno=new Array();var m_pda_id=new Array();var m_retail_qty=new Array();var m_retail_priceactual=new Array();var description1=new Array();var m_retail_type=new Array();var productno=new Array();var productname=new Array();var pricelist=new Array();var discount=new Array();var priceactual=new Array();var price=new Array();var m_retail_salerid=new Array();var productvalue=new Array();var color=new Array();var colorname=new Array();var size=new Array();var sizename=new Array();var mdim11=new Array();var locked=new Array();var lowest_discount=new Array();var m_retail_saler=new Array();var multisalers=new Array();var m_retail_markbaltype_id=new Array();var m_retail_sin_disname=new Array();var m_retail_sin_disid=new Array();var m_retail_com_disname=new Array();var m_retail_com_disid=new Array();var m_retail_add_disname=new Array();var m_retail_add_disid=new Array();var m_retail_org_payways=new Array();var m_retail_org_payamounts=new Array();var m_retail_org_billdate=new Array();var m_retail_sysdate=new Array();for(var r=1;r<=20;r++){eval("var m_dim"+r+"=new Array();")}var vip=0;var record=jQuery.trim(jQuery("#zody_textarea").text());for(var i=0;i<bpos.items_data.length;i++){orgdocno[i]=bpos.items_data[i].orgdocno;m_retail_org_payways[i]=bpos.items_data[i].org_payways;m_retail_org_payamounts[i]=bpos.items_data[i].org_payamounts;m_retail_org_billdate[i]=bpos.items_data[i].org_billdate;m_retail_sysdate[i]=bpos.items_data[i].sysdate;m_pda_id[i]=bpos.items_data[i].pda_id;m_retail_qty[i]=bpos.items_data[i].qty;m_retail_priceactual[i]=bpos.items_data[i].priceactual;description1[i]=bpos.items_data[i].discription;productno[i]=bpos.items_data[i].productno;productname[i]=bpos.items_data[i].productname;pricelist[i]=bpos.items_data[i].pricelist;discount[i]=bpos.items_data[i].discount;priceactual[i]=bpos.items_data[i].priceactual;price[i]=bpos.items_data[i].price;m_retail_salerid[i]=bpos.items_data[i].salerid;m_retail_saler[i]=bpos.items_data[i].saler;multisalers[i]=bpos.items_data[i].multisalers;productvalue[i]=bpos.items_data[i].productvalue;color[i]=bpos.items_data[i].color;colorname[i]=bpos.items_data[i].colorname;size[i]=bpos.items_data[i].size;sizename[i]=bpos.items_data[i].sizename;mdim11[i]=bpos.items_data[i].mdim11;m_retail_type[i]=bpos.items_data[i].type;m_retail_markbaltype_id[i]=bpos.items_data[i].markbaltype;locked[i]=bpos.items_data[i].locked||0;lowest_discount[i]=bpos.items_data[i].lowest_discount||0;m_retail_sin_disname[i]=bpos.items_data[i].sin_disname;m_retail_sin_disid[i]=bpos.items_data[i].sin_disid;m_retail_com_disname[i]=bpos.items_data[i].com_disname;m_retail_com_disid[i]=bpos.items_data[i].com_disid;m_retail_add_disname[i]=bpos.items_data[i].add_disname;m_retail_add_disid[i]=bpos.items_data[i].add_disid;for(var rr=1;rr<=20;rr++){for(var p in bpos.items_data[i]){if(typeof(p)!="function"&&p=="m_dim"+rr){eval("m_dim"+rr+"["+i+"]=bpos.items_data["+i+"]."+p+";")}}}}var operatorname=bpos.master_data.saler.id;var vipdd=bpos.vip.vip_id||-1;var param={createtime:bpos.master_data.createTime,storeid:bpos.master_data.c_store_id,billdate:billdate,description:comment,vipid:vipdd,salerid:operatorname,salerid1:m_retail_salerid,saler:m_retail_saler,m_pda_id:m_pda_id,qty:m_retail_qty,priceactual:m_retail_priceactual,orgdocno:orgdocno||"-1",description1:description1,type:m_retail_type,ptype:"hook",amtchange:"",printmetrail:"",discription2:"",paymount:"",paywayid:"",productno:productno,productname:productname,m_retail_markbaltype_id:m_retail_markbaltype_id,pricelist:pricelist,discount:discount,priceactual:priceactual,price:price,productvalue:productvalue,color:color,colorname:colorname,size:size,sizename:sizename,mdim11:mdim11,record:record,operatorname:bpos.master_data.operator.name,refno:bpos.master_data.refno,vip_cardno:bpos.vip.cardno||"-1",bpos_vip:bpos.vip,locked:locked,lowest_discount:lowest_discount,canModify:canModify,printed:printed,sin_disid:m_retail_sin_disid,sin_disname:m_retail_sin_disname,com_disid:m_retail_com_disid,com_disname:m_retail_com_disname,add_disid:m_retail_add_disid,add_disname:m_retail_add_disname,multisalers:Object.toJSON(multisalers),m_retail_org_payways:Object.toJSON(m_retail_org_payways),m_retail_org_payamounts:Object.toJSON(m_retail_org_payamounts),m_retail_sysdate:m_retail_sysdate,m_retail_org_billdate:m_retail_org_billdate};for(var y=1;y<=20;y++){eval("param.m_dim"+y+"=m_dim"+y+";")}evt.param=Object.toJSON(param);if(bpos.offline==true&&isIE()){var info={};info.param=param;var ret=bpos.poshook(Object.toJSON(info));ret=ret.evalJSON();this.guadanaction(ret,print);return false}else{evt.table="m_retail";evt.action="insert_save";evt.permission="w";bpos._executeCommandEvent(evt)}jQuery("#comment").val("按下F10键输入商品备注...")},guaDanTi:function(){var e=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});var d="";d=d+'<div id="zody_div"><div class="treatment_text"><font color="red">挂单原因:</font><center><textarea  id="zody_textarea" class="zody_chatboxtextarea"></textarea></center></div>';d=d+'</div></div><div id="treatment_td" align="center"><div id="zody_treatment_text"><input type="button" value="确定" onclick="javascript:zody.doGuaDanTi()" class="qinput" id="btn-search"/>&nbsp;<input type="button" value="挂单并打印" onclick="javascript:zody.posPrint()" class="qinput" id="btn-search"/>&nbsp;<input name="Submit" type="button" class="qinput" value="取消" onclick="javascript:zody.killGuaDanTi()" /></div></div></div>';e.innerHTML=d;bpos.executeLoadedScript(e);bpos.noAlert=false;var c;jQuery("#zody_div").bind("keydown",function(g){var h=jQuery("#zody_treatment_text input[type='button']");if(g.which==9){g.stopPropagation();g.preventDefault();var f=0;if(c){f=h.index(c)+1}if(!h[f]){f=0}c=h[f];c.focus()}else{if(g.which==13){zody.preGuaDanTi()}}})},checkGuaDanTiShi:function(){var c="";if(jQuery.trim(jQuery("#zody_textarea").text())==""){alert("挂单提示不能为空!");jQuery("#zody_textarea").focus();return c}else{c="has";return c}},posPrint:function(){var c=this.checkGuaDanTiShi();if(c!=""){jQuery.ajax({type:"POST",cache:false,url:"testonline.jsp?r='+(new Date()).getTime()+'",timeout:3000,error:function(){zody.guaDan("print");zody.killGuaDanTi()},success:function(d){alert("在线状态不能进行打印操作!");return false}})}},preGuaDanTi:function(){var d=this.checkGuaDanTiShi();if(d!=""){var c="";zody.guaDan(c)}},doGuaDanTi:function(){var d=this.checkGuaDanTiShi();if(d!=""){var c="";zody.guaDan(c);zody.killGuaDanTi()}},killGuaDanTi:function(){bpos.killAlert("zody_div")},guadanaction:function(e,d){var c=e.refno||ref.docno;if(c!=""){zody.clear();zody.turnTime();if(d!=""){var g={refno:c};var f={};f.param=g;bpos.posprint(Object.toJSON(f));bpos.gethookcount()}else{bpos.gethookcount()}bpos.init();zody.killGuaDanTi();alert("挂单成功,挂单号为:"+c);bpos.updateSerialNumber();bpos._editvip()}else{alert("操作失败!");return false}},_guaDan:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.guadanaction(c)},doGuaDan:function(){var d=0;d=jQuery("#sys_date").val();var e=parseInt(d);var c={};c.command="DBJSON";c.callbackEvent="BPOS_DOGUADAN";var h={storeid:bpos.master_data.c_store_id,datebeg:"20100101",dateend:e};if(bpos.offline==true&&isIE()){var g={};g.param=h;h.datebeg=20100101;h.dateend=e;var f=bpos.getposhooks(Object.toJSON(g));f=f.evalJSON();if(f.NewDataSet.Table){f=f.NewDataSet.Table;f=bpos.change2array(f);this.doguadanaction(f)}else{alert("无记录！")}return false}c.param=Object.toJSON(h);c.table="m_retail";c.action="hook_load";c.permission="w";bpos._executeCommandEvent(c)},TNReturnFace:function(e,c,g,f,d){this.doguadanaction(e,c,g,f,d)},doguadanaction:function(x,w,j,o,r){var g=Alerts.fireMessageBox({width:w?500:854,modal:true,title:gMessageHolder.EDIT_MEASURE});if(!r){r=false}var d="";var e=x.length;var s=0;var u="";var h="";var t=0;if(e==0){d=d+'<div class="desc-txt"><font color="red"><center>当前店铺没有挂单记录!</center></font></div>'}else{if(w){d=d+'<div id="query-search-content"><div id="treatment_td"><div id="treatment_text">处理'+(w=="TNCX"?"撤销":"退货")+' ：</div><div class="treatmentLL-table"><div class="treatmentLL-table-head"><div class="treatmentLL-span-1">序号</div><div style="display:none;"></div><div class="treatmentLL-span-2">原单编号</div><div class="treatmentLL-span-5">单据时间</div><div class="treatmentLL-span-1">金额</div><div class="treatmentLL-span-11">条码明细</div></div></div><div id="treatmentLL-main" class="treatmentLL-sidebar" style="height: 130px; width: 500px; visibility: visible; opacity: 1;">'}else{d=d+'<div id="query-search-content"><div id="treatment_td"><div id="treatment_text">处理挂单（H）：</div><div class="treatmentLL-table"><div class="treatmentLL-table-head"><div class="treatmentLL-span-1">序号</div><div style="display:none;"></div><div class="treatmentLL-span-2">单据号</div><div class="treatmentLL-span-7">单据时间</div><div class="treatmentLL-span-3">总数量</div><div class="treatmentLL-span-3">总金额</div><div class="treatmentLL-span-4">VIP卡号</div><div class="treatmentLL-span-5">操作员</div><div class="treatmentLL-span-5">打印标记</div><div class="treatmentLL-span-10">备注</div></div></div><div id="treatmentLL-main" class="treatmentLL-sidebar" style="height: 130px; width: 854px; visibility: visible; opacity: 1;">'}var q=0;for(var v=0;v<e;v++){s=v+1;if(w&&(!x[v].status||r)&&x[v].payway==j&&(w!="TNCX"?true:bpos.revOrgOrder(o,x[v]))){s=++q;var m=bpos.findByOrgOrder(x[v].org_orderno,bpos.items_data);var l="";for(var n=0;n<m.length;n++){l+=m[n].productno+" | "}d=d+'<div class="treatmentLL-row"><div id="divrowline'+s+'" class="treatmentLL-row-line"><div id="divinputrowline'+s+'" class="treatmentLL-span-1"><input id="input'+s+'" h="'+e+'" value="'+s+'" name="zd" type="radio" />'+s+'</div><div id="id'+s+'" style="display:none;">'+v+'</div><div id="orderno'+s+'" class="treatmentLL-span-2">'+x[v].org_orderno+'</div><div id="billdate'+s+'" class="treatmentLL-span-5">'+bpos.string2Date(x[v].billdate)+'</div><div id="payamount'+s+'" class="treatmentLL-span-1">'+x[v].payamount+'</div><div class="treatmentLL-span-11">'+l+"</div></div></div>"}else{if(!w){if(x[v].PRINTED=="N"){u='<font color="red">已打印</font>'}else{u="未打印"}d=d+'<div class="treatmentLL-row"><div id="divrowline'+s+'" class="treatmentLL-row-line"><div id="divinputrowline'+s+'" class="treatmentLL-span-1"><input id="input'+s+'" j="'+x[v].RETAIL_ID+'" canmodify="'+x[v].PRINTED+'" h="'+e+'" value="'+s+'" name="zd" type="radio" />'+s+'</div><div style="display:none;">'+x[v].RETAIL_ID+'</div><div id="orderno'+s+'" class="treatmentLL-span-2">'+x[v].ORDERNO+'</div><div class="treatmentLL-span-7" id="zody_di">'+x[v].createtime+'</div><div class="treatmentLL-span-3">'+x[v].TOTQTY+'</div><div class="treatmentLL-span-3">'+x[v].TOTAMT+'</div><div class="treatmentLL-span-4">'+((x[v].vip_cardno==-1||x[v].vip_cardno==undefined)?"":x[v].vip_cardno)+'</div><div class="treatmentLL-span-5">'+(x[v].operatorname==""?"无":x[v].operatorname)+'</div><div class="treatmentLL-span-5">'+u+'</div><div class="treatmentLL-span-11">'+(x[v].RECORD==""?"无挂单原因":(x[v].RECORD+""))+"</div></div></div>"}}}d=d+'</div></div><div id="treatment_td" align="center"><div id="zody_treatment_text"><input type="button" tabindex=1 value="处理" onclick="'+(w?"javascript:zody.TNBank('"+w+"','"+j+"','"+o+"')":"javascript:zody.getGuaDan()")+'" class="qinput" id="zody_btn-search"/>&nbsp;'+(w?"":'<input type="button" tabindex=2 value="作废" onclick="javascript:zody.closeGuaDan()" class="qinput" id="zody_btn-cancel"/>&nbsp;')+'<input type="button" tabindex=3 id="zody_reset" type="reset" class="qinput" value="取消" onclick="'+(w?"javascript:zody.cancelTN('"+w+"','"+j+"','"+o+"')":"javascript:zody.killGuaDan()")+'" /></div></div></div>'}g.innerHTML=d;bpos.executeLoadedScript(g);bpos.noAlert=false;jQuery(".treatmentLL-row:odd").css("background","#A3BAD4");jQuery("#input1").attr("checked",true);jQuery("#input1").focus();var c;var f;jQuery("#query-search-content").bind("keydown",function(z){var y=jQuery("#query-search-content input[type='radio']");var A=jQuery("#zody_treatment_text input[type='button']");if(z.which==38){var p=0;if(f){p=y.index(f)+1}if(!y[p]){p=0}f=y[p];f.focus()}else{if(z.which==40){var p=0;if(f){p=y.index(f)+1}if(!y[p]){p=0}f=y[p];f.focus()}else{if(z.which==9){z.stopPropagation();z.preventDefault();var p=0;if(c){p=A.index(c)+1}if(!A[p]){p=0}c=A[p];c.focus()}else{if(z.which==13){if(z.target!=$("zody_btn-search")&&z.target!=$("zody_btn-cancel")&&z.target!=$("zody_reset")){w?zody.TNBank(w,j,o):zody.getGuaDan()}}}}}})},TNBank:function(f,e,h){jQuery("#re,#cancle").attr("disabled",true);if(jQuery("input[name='zd']:checked").length==0){alert("无可用原单项！");return}var c=jQuery("input[name='zd']:checked").attr("value");var m=jQuery("#orderno"+c).text();var g=-jQuery("#payamount"+c).text();g=parseFloat(g);h=parseFloat(h);var d=bpos.checkpayway(e);var l=jQuery("#payselect").find("option:selected").text();bpos.evaluatepayitem(bpos.payitem,bpos.temppayitem);var j=h<g?g:h;bpos.updatepayitem(d,j);if((f=="TNCX"&&bpos.TNChargebacks(-j,bpos.master_data.refno.substr(0,15)+"0"+bpos.mark).code=="1")||(f=="TNTH"&&bpos.TNRefund(bpos.date2String(jQuery("#billdate"+c).text()),-j,bpos.master_data.refno.substr(0,15)+"0"+bpos.mark).code=="1")){bpos.org_payitems[jQuery("#id"+c).text()].status=1;bpos.handlepaypricewhencheckisok(l,j);alert("单据"+m+"操作成功！");bpos.mark++}else{if(bpos.mark==0){jQuery("#re,#cancle").removeAttr("disabled")}bpos.evaluatepayitem(bpos.temppayitem,bpos.payitem);$("discription").value=""}Alerts.killAlert($("query-search-content"));$("payment_content").focus();if($("currpay").disabled!=true){dwr.util.selectRange($("currpay"),0,20)}},cancelTN:function(c,e,d){if(c=="TNTH"){Alerts.killAlert($("query-search-content"));$("payment_content").focus();if($("currpay").disabled!=true){dwr.util.selectRange($("currpay"),0,20)}return}this.killGuaDan();this.TNReturnFace(bpos.org_payitems,"TNTH",e,d)},_doGuaDan:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.doguadanaction(c)},killGuaDan:function(){bpos.killAlert("query-search-content")},turnTime:function(){jQuery("#zody_td").show();jQuery("#temp_sys_date").attr("id","sys_date");jQuery("#zody_td1").remove()},changeTime:function(d){jQuery("#zody_td").hide();jQuery("#sys_date").attr("id","temp_sys_date");var c='<td class="value" id="zody_td1" width="152" nowrap="nowrap" align="left" valign=\'top\' ><input type="text" id="zody_sys" class="q_input01" value="'+d+'" readonly="fdsa" /></td>';jQuery("#zody_t1").after(c);jQuery("#zody_sys").attr("id","sys_date")},getGuaDan:function(){var d=jQuery("input[name='zd']:checked").attr("id");var c=jQuery("#"+d).val();var p=jQuery("#orderno"+c).text();var h=jQuery("#input"+c).attr("j");var q={};q.command="DBJSON";q.callbackEvent="BPOS_GETGUADAN";var n=0;if(h>0){n=parseInt(h);var g={retail_id:n,action:"do"};if(bpos.offline==true&&isIE()){var f={};f.param=g;var m=bpos.getposhook(Object.toJSON(f));m=m.evalJSON();bpos.vip=m.param.bpos_vip;var l={};l.param=bpos.vip;bpos.setvip(Object.toJSON(l));if(m.param.salerid&&m.param.salerid!=-1){for(var e=0;e<bpos.master_data.salers.length;e++){if(m.param.salerid==bpos.master_data.salers[e].id){bpos.master_data.saler=bpos.copyJsonObject(bpos.master_data.salers[e])}}}bpos.master_data.docno=m.param.docno;bpos.master_data.createTime=m.param.createtime;bpos.master_data.canModify=m.param.canModify;if(m.param.canModify==0){bpos.changeModel("NOMODIFY")}zody.changeTime(m.param.billdate);this.getguadanaction(m,"offline");bpos.updateheaderhtml();return}q.param=Object.toJSON(g);q.table="m_retail";q.action="hook_action";q.permission="w";q.isclob=true;bpos._executeCommandEvent(q)}else{alert("没有选中任何单据,不能执行该操作!");return false}},getguadanaction:function(ret,offline){if(offline=="offline"){var items=ret.param;if(items.description!=""){jQuery("#comment").val(items.description+";"+items.record)}else{jQuery("#comment").val(items.record)}for(var i=0;i<items.qty.length;i++){var item={};item.productno=items.productno[i];item.productname=items.productname[i];item.qty=isNaN(parseInt(items.qty[i],10))?0:parseInt(items.qty[i],10);item.pricelist=isNaN(parseFloat(items.pricelist[i]))?0:parseFloat(items.pricelist[i]);item.discount=isNaN(parseFloat(items.discount[i]))?0:parseFloat(items.discount[i]);item.priceactual=isNaN(parseFloat(items.priceactual[i]))?0:parseFloat(items.priceactual[i]);item.priceactual=bpos.alg(item.priceactual);item.price=isNaN(parseFloat(items.price[i]))?0:parseFloat(items.price[i]);item.price=bpos.alg(item.price);item.saler=items.saler[i];item.type=items.type[i];item.productvalue=items.productvalue[i];item.color=items.color[i];item.colorname=items.colorname[i];item.size=items.size[i];item.sizename=items.sizename[i];item.salerid=items.salerid1[i];item.multisalers=((items.multisalers).evalJSON())[i];item.mdim11=items.mdim11[i];item.discription=items.description1[i];item.orgdocno=items.orgdocno[i];item.pda_id=items.m_pda_id[i];item.markbaltype=items.m_retail_markbaltype_id[i]?items.m_retail_markbaltype_id[i]:-1;item.lineno=-1;item.locked=items.locked[i];item.lowest_discount=items.lowest_discount[i];item.sin_disid=items.sin_disid[i];item.sin_disname=items.sin_disname[i];item.com_disid=items.com_disid[i];item.com_disname=items.com_disname[i];item.add_disid=items.add_disid[i];item.add_disname=items.add_disname[i];for(var p=1;p<=20;p++){eval("item.m_dim"+p+"=items.m_dim"+p+"["+i+"]?items.m_dim"+p+"["+i+']:"";')}item.org_payways=((items.m_retail_org_payways).evalJSON())[i];item.org_payamounts=((items.m_retail_org_payamounts).evalJSON())[i];item.sysdate=items.m_retail_sysdate[i];item.org_billdate=items.m_retail_org_billdate[i];bpos.updateitems_data2(item)}}else{var le=ret.length;for(var i=0;i<le;i++){var item={};item.productno=ret[i].NO;item.productname=ret[i].VALUE;item.qty=isNaN(parseInt(ret[i].QTY,10))?0:parseInt(ret[i].QTY,10);item.pricelist=isNaN(parseFloat(ret[i].PRICELIST))?0:parseFloat(ret[i].PRICELIST);item.discount=isNaN(parseFloat(ret[i].DISCOUNT))?0:parseFloat(ret[i].DISCOUNT);item.priceactual=isNaN(parseFloat(ret[i].PRICEACTUAL))?0:parseFloat(ret[i].PRICEACTUAL);item.priceactual=bpos.alg(item.priceactual);item.price=isNaN(parseFloat(ret[i].TOT_AMT_ACTUAL))?0:parseFloat(ret[i].TOT_AMT_ACTUAL);item.price=bpos.alg(item.price);item.saler=bpos.master_data.saler.name;item.type=ret[i].TYPE;item.productvalue=ret[i].NAME;item.color=ret[i].VALUE1;item.colorname=ret[i].VALUE1_CODE;item.size=ret[i].VALUE2;item.sizename=ret[i].VALUE2_CODE;item.salerid=bpos.master_data.saler.id;item.mdim11=ret[i].FORCODE;item.discription=ret[i].DESCRIPTION;item.orgdocno=ret[i].ORGDOCNO;item.pda_id=ret[i].M_PDA_ID;item.multisalers=ret[i].multisalers;item.lineno=-1;item.locked=ret[i].locked;item.lowest_discount=ret[i].lowest_discount;bpos.updateitems_data2(item)}bpos.master_data.docno=orderno;bpos.vip=ret.param.bpos_vip;var infov={};infov.param=bpos.vip;bpos.setvip(Object.toJSON(infov));bpos.master_data.docno=ret.param.docno;zody.changeTime(ret.param.billdate);bpos.updateheaderhtml();jQuery("#comment").val(ret.DESCRIPTION+";"+ret.RECORD)}zody.killGuaDan();bpos.gethookcount()},_callGetGuaDan:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.getguadanaction(c)},closeGuaDan:function(){var d=jQuery("input[name='zd']:checked").attr("id");var c=jQuery("#"+d).val();var n=jQuery("#input"+c).attr("canmodify");if(n=="N"){alert("已打印单据不可作废！");return}var g=jQuery("#input"+c).attr("j");var l=0;if(g>0){l=parseInt(g);if(window.confirm("确认作废此单据？")){var m={};m.command="DBJSON";m.callbackEvent="BPOS_CLOSEGUADAN";var f={retail_id:l,action:"del"};m.param=Object.toJSON(f);if(bpos.offline==true&&isIE()){var e={};e.param=f;var h=bpos.getposhook(Object.toJSON(e));h=h.evalJSON();this.closeGuaDanaction(h);return false}m.table="m_retail";m.action="hook_action";m.permission="w";m.isclob=true;bpos._executeCommandEvent(m)}}else{alert("没有选中任何单据,不能执行该操作!");return false}},closeGuaDanaction:function(e){var d=e.ORDERNO;if(d!=null){alert("作废的单据号为:"+d);var c=jQuery("input[name='zd']:checked").attr("id");var f=jQuery("#"+c).val();jQuery("#divrowline"+f).remove();bpos.gethookcount()}else{alert("删除单据失败!");return false}},_callCloseGuaDan:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.closeGuaDanaction(c)},getTotLowestPrice:function(e){if(!e){e=bpos.items_data}var d=0;for(var c=0;c<e.length;c++){if(e[c].type!=1){d=d.add(e[c].price)}else{if(e[c].lowest_discount>0){d=d.add(((e[c].pricelist).mul(e[c].lowest_discount)).mul(e[c].qty))}}}return bpos.alg(d)},amount:function(){var g=this.getTotLowestPrice();var d=zody.getTotal();var c=d.add(this.getTotalByType(false,false,1,"price"));var e=bpos.master_data.discountlimit;var h=c.sub(d.mul(1-e));if(h<g){e=g.div(d);e=(Math.round(e.mul(100))).div(100);h=g}var j=c.sub(h);var m=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});m.innerHTML='<div id="amount_content"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="treatment_td"><div id="treatment_text">总额折扣（S）：</div></div></td></tr><tr><td><div id="treatment_table"><div id="amount_botder"><table id="categoryTable" width="350" border="0" align="center" cellpadding="0" cellspacing="0"><tr id="tr1"><td width="69" height="20" align="right"><div class="desc-txt"><input id="r1" onclick="zody.r1r()" name="radiobutton" type="radio" value="1" /></div></td><td width="63" align="left"><span class="desc-txt">折&nbsp;&nbsp;&nbsp;扣&nbsp;&nbsp;&nbsp;率：</span></td><td width="218"><input onclick="zody.i1i()" id="in1" type="text" class="q_input" /></td></tr><tr id="discz1"style="display:none"><td height="30" colspan="2" align="right"><div class="desc-txt">最低折扣限制：</div></td><td><div class="desc-txt" id="discz">'+e+'</div></td></tr><tr id="tr2"><td height="20" align="right"><span class="desc-txt"><input id="r2" onclick="zody.r2r()" name="radiobutton" type="radio" value="2" /></span></td><td height="20" align="left"><span class="desc-txt">特&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：</span></td><td><input onclick="zody.i2i()" id="in2" type="text" class="q_input" /></td></tr><tr id="lowestpricez1"style="display:none"><td height="20" colspan="2" align="right"><div class="desc-txt">最低特价限制：</div></td><td><span class="desc-txt" id="lowestpricez">'+zody.changeTwoDecimal(h)+' 元</span></td></tr><tr id="tr3"><td height="20" align="right"><div class="desc-txt"><input id="r3" onclick="zody.r3r()" name="radiobutton" type="radio" value="3" /></div></td><td height="20" align="left"><div class="desc-txt">优&nbsp;惠&nbsp;金&nbsp;额：</div></td><td><span class="desc-txt"><input onclick="zody.i3i()" id="in3" type="text" class="q_input" /></span></td></tr><tr id="discountpricez1"style="display:none"><td height="20" colspan="2" align="right"><div class="desc-txt" >最高优惠金额限制：</div></td><td id="discountpricez">'+zody.changeTwoDecimal(j)+' 元</td></tr></table></div></div></td></tr><tr><td><div id="treatment_td" align="center"><div id="treatment_text">&nbsp;<input type="button" value="确定" onclick="javascript:zody.subAmount()" class="qinput" id="zody_btn_submit"/>&nbsp;<input name="Submit" type="button" class="qinput" value="取消" id="zody_btn_cancel" onclick="javascript:zody.closeAmount();" /><input name="showhidd" type="button" class="qinput" value="显示/隐藏" id="zody_btn_sOh" onclick="javascript:zody.show_Model();" /></div></div></td></tr></table></div>';bpos.executeLoadedScript(m);bpos.noAlert=false;jQuery("#r1").attr("checked",true);var f;var l=$("in1");l.focus();if(bpos.master_data.params.showLowestDisprice=="true"){jQuery("#discz1,#lowestpricez1,#discountpricez1").show();jQuery("#zody_btn_sOh").hide()}jQuery("#amount_content").bind("keydown",function(p){var o=jQuery("#in1,#in2,#in3");var q=jQuery("#amount_content input[type='button']");if(p.which==38){var n=o.length-1;if(l){n=o.index(l)-1}if(!o[n]){n=o.length-1}l=o[n];l.focus();if(n==0){jQuery("#r1").attr("checked",true);jQuery("#in2").val("");jQuery("#in3").val("")}else{if(n==1){jQuery("#r2").attr("checked",true);jQuery("#in1").val("");jQuery("#in3").val("")}else{if(n==2){jQuery("#r3").attr("checked",true);jQuery("#in2").val("");jQuery("#in1").val("")}}}}else{if(p.which==40){var n=0;if(l){n=o.index(l)+1}if(!o[n]){n=0}l=o[n];l.focus();if(n==0){jQuery("#r1").attr("checked",true);jQuery("#in2").val("");jQuery("#in3").val("")}else{if(n==1){jQuery("#r2").attr("checked",true);jQuery("#in1").val("");jQuery("#in3").val("")}else{if(n==2){jQuery("#r3").attr("checked",true);jQuery("#in2").val("");jQuery("#in1").val("")}}}}else{if(p.which==9){p.stopPropagation();p.preventDefault();var n=0;if(f){n=q.index(f)+1}if(!q[n]){n=0}f=q[n];f.focus()}else{if(p.which==13){if(p.target!=$("zody_btn_submit")&&p.target!=$("zody_btn_cancel")&&p.target!=$("zody_btn_sOh")){zody.subAmount()}}else{if(p.ctrlKey==true&&p.which==39){if(!bpos.master_data.params.showLowestDisprice=="true"){bpos.show_Model()}}}}}}})},show_Model:function(){jQuery("#discz1").toggle();jQuery("#lowestpricez1").toggle();jQuery("#discountpricez1").toggle()},discount:function(){if((bpos.MODEL&bpos.DISTOTAMOUNT)!=bpos.DISTOTAMOUNT){alert("该单不可总额折扣！");return}if(jQuery("#from-main >div").text()==""){alert("没有选择任何单据不能进行该操作!");return false}if(bpos.master_data.params.verifyPermission=="true"){bxl.validateEmployee("discount");return}else{this.amount()}},getTotalByType:function(e,g,c,f){if(!f){f="pricelist"}var h=0;if(!e){e=bpos.items_data}for(var d=0;d<e.length;d++){if(g&&e[d].type==g){switch(f){case"pricelist":h=h.add(e[d].pricelist.mul(e[d].qty));break;case"price":h=h.add(e[d].price);break}}else{if(c&&e[d].type!=c){switch(f){case"pricelist":h=h.add(e[d].pricelist.mul(e[d].qty));break;case"price":h=h.add(e[d].price);break}}}}return h},getTotal:function(c){return this.getTotalByType(c,1)},copyitems_data:function(e){var f=new Array();for(var d=0;d<e.length;d++){var c={};c.productno=e[d].productno;c.productname=e[d].productname;c.colorname=e[d].colorname;c.sizename=e[d].sizename;c.color=e[d].color;c.size=e[d].size;c.mdim11=e[d].mdim11;c.productvalue=e[d].productvalue;c.pricelist=e[d].pricelist;c.discount=e[d].discount;c.discription=e[d].discription;c.priceactual=e[d].priceactual;c.qty=e[d].qty;c.price=e[d].price;c.salerid=e[d].salerid;c.saler=e[d].saler;c.type=e[d].type;c.orgdocno=e[d].orgdocno;c.pda_id=e[d].pda_id;c.lineno=e[d].lineno;c.locked=e[d].locked;c.lowest_discount=e[d].lowest_discount;f.push(c)}return f},subAmount:function(){var t=jQuery("input[name='radiobutton']:checked").val();var d=parseInt(t);var s=parseFloat(jQuery("#tot_amt").text());var m=parseInt(jQuery("#sys_date").val());var u;var p;var c=bpos.gettotdata(bpos.items_data);switch(d){case 1:var h=jQuery.trim(jQuery("#in1").val());var r=parseFloat(h);var g=parseFloat(jQuery("#discz").html());if(h==""||isNaN(h)||r<g){alert("折扣不合法!");jQuery("#in1").val("");return false}if(r>1&&!bpos.discountCanLgOne){alert("折扣不得大于1");jQuery("#in1").val("");return false}u=bpos.discountalg(r);break;case 2:var f=parseFloat(jQuery.trim(jQuery("#in2").val()));var n;if(jQuery.trim(jQuery("#lowestpricez").html())){n=parseFloat(jQuery.trim(jQuery("#lowestpricez").html().replace("元","")))}else{n=0}if(f==""||isNaN(f)||f<n){alert("特价不合法!");jQuery("#in2").val("");return false}if(f>c&&!bpos.discountCanLgOne){alert("总额折扣不可大于1");jQuery("#in2").val("");return false}p=bpos.alg(f);break;case 3:var e=parseFloat(jQuery.trim(jQuery("#in3").val()));if(e==""){alert("最高优惠金额不能为空!");return false}if(isNaN(e)){alert("最高优惠金额必须为数字!");jQuery("#in3").val("");return false}var q=parseFloat(jQuery.trim(jQuery("#discountpricez").html().replace("元","")));if(e>q){alert("优惠金额过大！");jQuery("#in3").val("");return false}p=c.totpricelist.sub(bpos.alg(e));break}if(!(!u&&!p&&u!=0&&p!=0)){if(!u&&u!=0){u=Math.floor(p.div(c.totpricelist).mul(100)).div(100)}if(!p&&p!=0){p=bpos.alg(c.totpricelist.mul(u))}this.tempitems_data=this.copyitems_data(bpos.items_data);if(bpos.handlewholediscount(this.tempitems_data,u,p,c.totprice)){for(var l=0;l<this.tempitems_data.length;l++){var o=bpos.value2type(this.tempitems_data[l].type);if(o!="退货"){bpos.modifyitem(this.tempitems_data[l],l)}}zody.closeAmount()}}},r1r:function(){jQuery("#in1").focus();jQuery("#in2").val("");jQuery("#in3").val("")},r2r:function(){jQuery("#in2").focus();jQuery("#in1").val("");jQuery("#in3").val("")},r3r:function(){jQuery("#in3").focus();jQuery("#in1").val("");jQuery("#in2").val("")},i1i:function(){jQuery("#r1").attr("checked",true);jQuery("#in2").val("");jQuery("#in3").val("")},i2i:function(){jQuery("#r2").attr("checked",true);jQuery("#in1").val("");jQuery("#in3").val("")},i3i:function(){jQuery("#r3").attr("checked",true);jQuery("#in1").val("");jQuery("#in2").val("")},closeAmount:function(){bpos.killAlert("amount_content")},checkAmonut:function(){if(jQuery("#treatment_td").attr("done")=="done"){alert("你已经做过总额折扣了！");return false}},resetAmonut:function(){jQuery("#treatment_td").removeAttr("done")},changeTwoDecimal:function(c){var d=parseFloat(c);if(isNaN(d)){alert("参数异常!");return false}var d=Math.round(c*100)/100;return d},changeDecimal:function(c){var d=parseFloat(c);if(isNaN(d)){alert("参数异常!");return false}var d=Math.round(c*100)/100;return d},buLuVIP:function(){var d=Alerts.fireMessageBox({width:300,modal:true,title:gMessageHolder.EDIT_MEASURE});var c="";c=c+'<div id="xiao_content_88" class="xiao_content"><table width="300" border="0" cellspacing="0" cellpadding="0"><tr><td><div class="xiao_td"><div class="vip-text">补录VIP</div></div></td></tr><tr><td><div class="xiao_td"><div id="treatment_text">请输入VIP卡号：</div></div></td></tr><tr><td><div class="xiao_botder"><input name="vip_input" id="zody_vip_input"  type="text" class="VIP_input" /></div></td></tr><tr><td><div class="VIP-td" align="center">&nbsp;<input type="button" value="确定" onclick="bpos.checkaddvip()" class="qinput" id="zody_btn-search"/>&nbsp;<input name="Submit" onclick="zody.killBuLuVIP()" type="button" class="qinput" id="zody_btn-cancel" value="取消" /></div></td></tr></table></div>';d.innerHTML=c;bpos.executeLoadedScript(d);bpos.noAlert=false;jQuery("#zody_vip_input").focus()},killBuLuVIP:function(){bpos.killAlert("xiao_content_88");bpos.readypay()},doBuLuVIP:function(){if(jQuery("#zody_vip_input").val()!=""){this.discountType()}else{alert("VIP卡号不能为空!");return false}},discountType:function(){var d=Alerts.fireMessageBox({width:300,modal:true,title:gMessageHolder.EDIT_MEASURE});var c="";c=c+'<div id="zody_xo" class="xiao_content"><table width="300" border="0" cellspacing="0" cellpadding="0"><tr><td><div class="xiao_td"><div id="treatment_text">请选择折扣方式：</div></div></td></tr><tr><td><div class="xiao_botder"><ul><li><div class="xiaoLeft"><input id="input90" name="zd" type="radio"/></div><div class="xiaoRight">折上折：<span class="vip-text-red" id="zody-rediscount"></span></div></li><li><div class="xiaoLeft"><input name="zd" id="input99" type="radio" /></div><div class="xiaoRight">折&nbsp;&nbsp;&nbsp;扣：<span class="vip-text-red" id="zody-discount"></span></div></li></ul></div></td></tr><tr><td><div  class="VIP-td" align="center">&nbsp;<input type="button" value="确定" onclick="javascript:bpos.dealpaypriceforselectvipdiscount()" class="qinput" id="zody_btn-search_0"/>&nbsp;<input name="Submit" type="button" id="zody_btn-cancel_0" onclick="javascript:zody.killDiscountType()" class="qinput" value="取消" /></div></td></tr></table></div>';d.innerHTML=c;bpos.executeLoadedScript(d);bpos.noAlert=false;jQuery("#input90").attr("checked",true);jQuery("#input90").focus()},killDiscountType:function(){bpos.killAlert("zody_xo");this.killBuLuVIP()}};ZODY.main=function(){zody=new ZODY()};if(window.addEventListener){window.addEventListener("load",ZODY.main,false)}else{if(window.attachEvent){window.attachEvent("onload",ZODY.main)}else{window.onload=ZODY.main}}var bpos=null;var BPOS=Class.create();BPOS.prototype={initialize:function(){dwr.util.useLoadingMessage(gMessageHolder.LOADING);dwr.util.setEscapeHtml(false);this.types=[{value:1,type:"正常",color:"blue",active:1},{value:3,type:"赠品",color:"#ffff00",active:1},{value:2,type:"退货",color:"#ff0000",active:1},{value:4,type:"全额",color:"#000000",active:1}];this.noAlert=true;this.isOnLoad=true;this.locationConfig={};this.MODEL=1023;this.HOOKORDER=512;this.CHANGEBILLDATE=512;this.ADDITIONVIP=256;this.NEWODER=128;this.DELETE=64;this.CHANGEAMOUNT=32;this.CHANGENUM=16;this.DISTOTAMOUNT=8;this.PAYPRICE=4;this.WHOLEDIS=2;this.INSERTLINE=1;this.flag_num=0;this.SHOWMODEL=128;this.NOMODIFY=518;this.ALL=1023;this.URL="";this.isUploading=false;this.canUseTicketWhenWholeDis=false;this.discountCanLgOne=false;this.windowLocation=window.location;this.isOnline=true;this.hasCreditBankCard=false;this.orders=0;this.org_payitems=new Array();this.orgdocnos=new Array();this.hy_cardno=0;this.gh_rows=0;this.q_data=null;this.search_end=1;dwr.engine._errorHandler=function(d,c){while(c!=null&&c.cause!=null){c=c.cause}if(c!=null){d=c.message}if(d==null||d==""){alert("A server error has occured. More information may be available in the console.")}else{if(d.indexOf("0x80040111")!=-1){dwr.engine._debug(d)}else{alert(d)}}};application.addEventListener("BPOS_LOAD_MASTER",this._onloadMasterObject,this);application.addEventListener("BPOS_INSERT_LINE",this._onInsertLine,this);application.addEventListener("BPOS_CHECKVIP",this._oncheck,this);application.addEventListener("BPOS_CHECKADDVIP",this._oncheckaddvip,this);application.addEventListener("BPOS_SAVE_PRINT",this._onsave_print,this);application.addEventListener("BPOS_CHANGAMT",this._changamt,this);application.addEventListener("BPOS_RET_FUZZYQUERY",this._onInsertLine_q,this);application.addEventListener("BPOS_INSERT_LINE_Q",this._onInsertLine_q,this);application.addEventListener("BPOS_CHECKTICKET",this._ondealticket,this);application.addEventListener("BPOS_VIPACM",this._dovipacm,this);application.addEventListener("BPOS_VIP_BIRTHDAYDIS",this._onbirthdaymonthdis,this);application.addEventListener("VIP_SMS",this._onSmsVip,this);this.printInfo={};this.init();this.master_data={};this.initparams($("params").value.evalJSON());this.doSomeThingWhenInitparams();this.loadMasterObject();this._editvip();this.getServerUrl();window.onbeforeunload=function(){if(jQuery("#MainApp").css("display")=="none"){jQuery("#MainApp").show();return}var d="";var c=bpos.actionsWhenUnload();if(c>0){d+="有"+c+"张单据未成功上传！"}if(bpos.items_data.length>0&&bpos.master_data.canModify==0){d+="该单据属于挂单零售,请先处理！"}if(bpos.items_data.length>0){d+="单据明细未保存！"}if(d==""){return}return d}},changeIcon:function(c){alert("122");if(c){if(c.css("background-image").indexOf("collapsed.gif")>=0){c.css("background-image","url('images/expanded.gif')")}else{c.css("background-image","url('images/collapsed.gif')")}}},CacheData:function(c){MainApp.GetGroupDiscount(""+c)},getServerUrl:function(){if(!this.checkIsOnline()){this.URL=MainApp.GetHiddenConfigFile("URL")+"bpos/"}},lineShop:function(g,f,e){var d="";if(e){d="&qrpt="+e}var c={width:1000,height:660,title:f,modal:true,centerMode:"x",maxButton:false,onCenter:true};Alerts.popupIframe("/bpos/portal-min.jsp?ss=0&mm="+g+d,c);Alerts.resizeIframe(c);jQuery("#MainApp").hide()},initItemHeaderFirst:function(){var c="";if(this.checkNeedMarketBillWay()){if(this.master_data.params.pageStyle=="redearth"){c='<div class="from-span-2">序号</div><div class="from-span-4">型号</div><div class="from-span-7">结算类型</div><div class="from-span-4">品名</div><div class="from-span-4">条码</div><div class="from-span-16">零售价</div><div class="from-span-17">数量</div><div class="from-span-17">折扣</div><div class="from-span-16">实价</div><div class="from-span-16">金额</div><div class="from-span-18">员工</div>'}else{if(this.master_data.params.pageStyle=="tommy"){c='<div class="from-span-13">序号</div><div class="from-span-4">条码</div><div class="from-span-04">款号</div><div class="from-span-7">结算类型</div><div class="from-span-19">系列1</div><div class="from-span-19">小类</div><div class="from-span-13">颜色</div><div class="from-span-13">尺码</div><div class="from-span-2">数量</div><div class="from-span-16">原价</div><div class="from-span-13">折扣</div><div class="from-span-16">实价</div><div class="from-span-16">金额</div><div class="from-span-15">营业员</div>'}else{if(this.master_data.params.pageStyle=="busen"){c='<div class="from-span-13">序号</div><div class="from-span-4">条码</div><div class="from-span-5">结算类型</div><div class="from-span-12">品名</div><div class="from-span-2">数量</div><div class="from-span-14">原价</div><div class="from-span-13">折扣</div><div class="from-span-14">实价</div><div class="from-span-14">金额</div><div class="from-span-9">营业员</div><div class="from-span-13">状态</div><div class="from-span-014">款号</div><div class="from-span-13">颜色</div><div class="from-span-13">色名</div><div class="from-span-13">尺寸</div><div class="from-span-9">尺寸名</div>'}else{c='<div class="from-span-13">序号</div><div class="from-span-4">条码</div><div class="from-span-5">结算类型</div><div class="from-span-12">品名</div><div class="from-span-2">数量</div><div class="from-span-14">原价</div><div class="from-span-13">折扣</div><div class="from-span-14">实价</div><div class="from-span-14">金额</div><div class="from-span-9">营业员</div><div class="from-span-13">状态</div><div class="from-span-14">款号</div><div class="from-span-13">颜色</div><div class="from-span-13">色名</div><div class="from-span-13">尺寸</div><div class="from-span-9">尺寸名</div><div class="from-span-15">原厂编码</div>'}}}}else{if(this.master_data.params.pageStyle=="redearth"){c='<div class="from-span-6">序号</div><div class="from-span-4">型号</div><div class="from-span-4">品名</div><div class="from-span-4">条码</div><div class="from-span-5">零售价</div><div class="from-span-5">数量</div><div class="from-span-5">折扣</div><div class="from-span-16">实价</div><div class="from-span-16">金额</div><div class="from-span-6">员工</di>'}else{if(this.master_data.params.pageStyle=="tommy"){c='<div class="from-span-13">序号</div><div class="from-span-4">条码</div><div class="from-span-04">款号</div><div class="from-span-19">系列1</div><div class="from-span-19">小类</div><div class="from-span-14">颜色</div><div class="from-span-14">尺码</div><div class="from-span-2">数量</div><div class="from-span-16">原价</div><div class="from-span-13">折扣</div><div class="from-span-16">实价</div><div class="from-span-16">金额</div><div class="from-span-14">营业员</div>'}else{if(this.master_data.params.pageStyle=="busen"){c='<div class="from-span-13">序号</div><div class="from-span-4">条码</div><div class="from-span-012">款号</div><div class="from-span-2">数量</div><div class="from-span-014">原价</div><div class="from-span-13">折扣</div><div class="from-span-014">实价</div><div class="from-span-014">金额</div><div class="from-span-15">营业员</div><div class="from-span-13">状态</div><div class="from-span-014">品名</div><div class="from-span-13">颜色</div><div class="from-span-13">色名</div><div class="from-span-13">尺寸</div><div class="from-span-9">尺寸名</div>'}else{c='<div class="from-span-1">序号</div><div class="from-span-4">条码</div><div class="from-span-12">品名</div><div class="from-span-2">数量</div><div class="from-span-5">原价</div><div class="from-span-1">折扣</div><div class="from-span-5">实价</div><div class="from-span-5">金额</div><div class="from-span-9">营业员</div><div class="from-span-1">状态</div><div class="from-span-6">款号</div><div class="from-span-3">颜色</div><div class="from-span-1">色名</div><div class="from-span-1">尺寸</div><div class="from-span-9">尺寸名</div><div class="from-span-18">原厂编码</div>'}}}}return c},initItemsHeaderHtmlByParam:function(){var c=this.initItemHeaderFirst();jQuery("#from-table").html(c);var d="";if(this.master_data.params.pageStyle=="redearth"){jQuery("#f3button").val("F3：员工");jQuery("#currSaler").val("当前员工");jQuery("#mulbarcodescape").html('<div class="treatment-span-10">型号</div><div class="treatment-span-10">品名</div><div class="treatment-span-7">条码</div><div class="treatment-span-8">零售价</div><div class="treatment-span-6">颜色</div><div class="treatment-span-6">尺寸</div><div class="treatment-span-6">颜色号</div><div class="treatment-span-6">尺寸号</div><div class="treatment-span-8">数量</div>')}if(this.master_data.params.pageStyle=="tommy"){jQuery("#mulbarcodescape").html('	<div class="treatment-span-7">条码</div><div class="treatment-span-10">款号</div><div class="treatment-span-10" >品名</div><div class="treatment-span-6">颜色</div><div class="treatment-span-6">尺寸</div><div class="treatment-span-6">系列1</div><div class="treatment-span-6">小类</div><div class="treatment-span-8">标准价</div><div class="treatment-span-8">数量</div>')}},doSomeThingWhenInitparams:function(){this.vipTicketName=this.master_data.params.vipTicketName||"贵宾券";this.vipPayTypeName=this.master_data.params.vipPayTypeName||"VIP付款"},changeModel:function(c){switch(c){case"SHOWMODEL":this.MODEL=this.SHOWMODEL;break;case"NOMODIFY":this.MODEL=this.NOMODIFY;break;case"ALL":this.MODEL=this.ALL;break}},closeWindow:function(){var c=this.actionsWhenUnload();if(c>0){if(!confirm("有"+c+"张单据未成功上传！确认关闭页面？")){return}}if(bpos.items_data.length>0&&bpos.master_data.canModify==0){alert("该单据属于挂单零售,请先处理！")}else{if(bpos.items_data.length>0){if(confirm("单据明细未保存！确认关闭页面？")){window.close()}}else{window.close()}}},exportaxtivexparams:function(c){if(this.offline==true&&isIE()){var d={};d.param=this.master_data;if(!c){c=false}this.setparm(Object.toJSON(d),c)}},init:function(d){this.tdefposdis_id=-1;this.tdefposdis_name=-1;this.delLineindex=new Array();this.linenos=new Array();this.selectid=-1;this.items_data=new Array();this.maxlineno=0;this.vip={};this.vipret=new Array();this.vipdisinfo=new Array();this.tempvipdis=null;this.consumecards=new Array();if(this.master_data){this.master_data.docno="系统维护"}this.org_payitems=new Array();this.orgdocnos=new Array();this.offline=true;var c=this.getFirstIndexActiveType();if(!c&&c!=0){alert("零售状态全不可用，配置错误！请联系系统管理员");window.close();return}this.itemtype=this.types[c].value;this.tempvip;if(d&&d=="f2newretail"){}else{if(this.master_data){this.master_data.saler={};this.master_data.saler.id=-1;this.master_data.saler.name="-";this.master_data.saler.truename="-";this.master_data.canModify=1;this.master_data.multisalers=new Array()}}try{if(!this.isOnLoad){this.setvip("-1")}}catch(f){}jQuery("#m_retailtype").attr("val",this.types[c].value);jQuery("#m_retailtype").val(this.types[c].type);jQuery("#from-main").html("");this.updatehtml();this.updateheaderhtml(d);this.temp_items_data=new Array();this.initpayitem();this.temppayitem={};this.submititems={};this.hasWholeDis=false;this.hasCreditBankCard=false;if(this.master_data&&this.master_data.refno){this.initrefno()}this.vipaccount={};if(zody){zody.turnTime()}this.ticketnos=new Array();this.temppayitem={};this.payment=[];if(this.master_data){this.master_data.createTime=this.getformatcurrenttime()}this.change=0;this.tempretailid=0;this.viprecharge=0;this.tempAmount=0;this.changeModel("ALL");if(this.master_data&&this.master_data.c_store_id){this.updateBusinessIndicator()}this.tempvou={};this.vouinfo={}},updateBusinessIndicator:function(){jQuery.ajax({type:"POST",url:this.URL+"updateBusinessIndicator.jsp",data:"si="+this.master_data.c_store_id,error:function(){},success:function(d){d=jQuery.trim(d);if(d.indexOf("data:")!=-1){var c=d.replace("data:","").split(",");jQuery("#daycurrent").html(c[0]);jQuery("#monthcurrent").html(c[1]);jQuery("#numcurrent").html(c[2])}}})},getformatcurrenttime:function(){var f=new Date();var l=f.getYear();var c=f.getMonth()+1;if(c<10){c="0"+c}var n=f.getDate();if(n<10){n="0"+n}var j=f.getHours();if(j<10){j="0"+j}var e=f.getMinutes();if(e<10){e="0"+e}var g=f.getSeconds();if(g<10){g="0"+g}return l+"-"+c+"-"+n+" "+j+":"+e+":"+g},initpayitem:function(){this.payitem={TotalAmount:0,_totalNoCashNoCharge:0,_totalCashNoCharge:0,_totalVipCharge:0,_totalCashCharge:0};this.change=0},checkPayWayExists:function(c){if(!c||jQuery.trim(c)===""){return false}return true},initparams:function(c){if(c){var e={};for(var d=0;d<c.webpos.length;d++){switch(c.webpos[d].NAME){case"webpos.2005":e.vipcontroltype=c.webpos[d].VALUE;break;case"webpos.2004":e.needorgno=c.webpos[d].VALUE;break;case"webpos.2003":e.barcodediscart=c.webpos[d].VALUE;break;case"webpos.2002":e.billdaterange=c.webpos[d].VALUE;break;case"webpos.2001":e.loadcontrol=c.webpos[d].VALUE;break;case"webpos.6055":e.additionalvip=c.webpos[d].VALUE;break;case"webpos.2006":e.compelupdate=c.webpos[d].VALUE;break;case"webpos.PrintTemplates":if(jQuery.trim(c.webpos[d].VALUE)!="-1"){e.PrintTemplates=c.webpos[d].VALUE}break;case"webpos.limitBrand":e.limitBrand=c.webpos[d].VALUE;break;case"webpos.requiredSaler":e.requiredSaler=c.webpos[d].VALUE;break;case"webpos.pdtStyleModel":e.pdtStyleModel=c.webpos[d].VALUE;break;case"webpos.pageStyle":e.pageStyle=c.webpos[d].VALUE;break;case"webpos.3001":e.brandColumn=c.webpos[d].VALUE;break;case"webpos.verifyPermission":e.verifyPermission=c.webpos[d].VALUE;break;case"webpos.isIntlDis":e.isIntlDis=c.webpos[d].VALUE;break;case"webpos.offline":e.offline=c.webpos[d].VALUE;break;case"webpos.uploadTimeInterval":e.uploadTimeInterval=c.webpos[d].VALUE;break;case"webpos.ticketnodis":e.ticketnodis=c.webpos[d].VALUE;break;case"webpos.statusConf":e.statusConf=c.webpos[d].VALUE;break;case"webpos.needmarketbillway":e.needmarketbillway=c.webpos[d].VALUE;break;case"webpos.company":e.company=c.webpos[d].VALUE;break;case"webpos.disCanLgOne":e.disCanLgOne=c.webpos[d].VALUE;break;case"webpos.vipAreaRange":e.vipAreaRange=parseInt(c.webpos[d].VALUE,10);break;case"webpos.printCount":e.printCount=parseInt(c.webpos[d].VALUE,10);break;case"webpos.showVIPAlertOnNewOrder":e.showVIPAlertOnNewOrder=jQuery.trim(c.webpos[d].VALUE);break;case"webpos.noOrderNOnoPass":e.noOrderNOnoPass=c.webpos[d].VALUE;break;case"webpos.m_product.lowest_discount":e.lowest_discount=c.webpos[d].VALUE;break;case"webpos.vip.aum":e.vip_aum=c.webpos[d].VALUE;break;case"webpos.showLowestDisprice":e.showLowestDisprice=c.webpos[d].VALUE;break;case"webpos.buttonShowList":e.buttonShowList=c.webpos[d].VALUE;break;case"webpos.multiSalers":e.multiSalers=c.webpos[d].VALUE;break;case"webpos.vip.addRequiredCondition":e.vipAddRequiredCondition=c.webpos[d].VALUE;break;case"webpos.vipTicketName":e.vipTicketName=c.webpos[d].VALUE;break;case"webpos.vipPayTypeName":e.vipPayTypeName=c.webpos[d].VALUE;break;case"webpos.vip.integralDisBasePrice":e.integralDisBasePrice=isNaN(parseInt(c.webpos[d].VALUE,10))?1:parseInt(c.webpos[d].VALUE,10);break;case"webpos.returnPriceLimit":e.returnPriceLimit=c.webpos[d].VALUE;break;case"webpos.defaultSaler":e.defaultSaler=c.webpos[d].VALUE;break;case"webpos.showFinishedTarget":e.showFinishedTarget=c.webpos[d].VALUE;break;case"webpos.defaultPayway":e.defaultPayway=c.webpos[d].VALUE;break;case"webpos.defaultVipType":e.defaultVipType=c.webpos[d].VALUE;break;case"webpos.orgModifyPer":e.orgModifyPer=c.webpos[d].VALUE;break;case"webpos.canUseTicketWhenWholeDis":e.canUseTicketWhenWholeDis=c.webpos[d].VALUE;break;case"webpos.canImportInventory":e.canImportInventory=c.webpos[d].VALUE;break;case"webpos.useVipSms":e.useVipSms=c.webpos[d].VALUE;break;case"webpos.validateVipPw":e.validateVipPw=c.webpos[d].VALUE;break;case"webpos.QXAbsPath":e.QXAbsPath=c.webpos[d].VALUE;break;case"webpos.timeVerify":e.timeVerify=c.webpos[d].VALUE;break;case"webpos.onLineSkuMatche":e.onLineSkuMatche=c.webpos[d].VALUE;break;case"webpos.enableOffInventory":e.enableOffInventory=c.webpos[d].VALUE;break}}if(e.enableOffInventory==undefined){e.enableOffInventory="true"}if(e.onLineSkuMatche==undefined){e.onLineSkuMatche="false"}if(e.validateVipPw==undefined){e.validateVipPw="false"}if(e.useVipSms==undefined){e.useVipSms="false"}if(e.canImportInventory==undefined){e.canImportInventory="false"}if(e.canUseTicketWhenWholeDis==undefined){e.canUseTicketWhenWholeDis="false"}if(e.integralDisBasePrice==undefined){e.integralDisBasePrice=1}if(!e.vipAddRequiredCondition){e.vipAddRequiredCondition="111100"}if(!e.multiSalers){e.multiSalers="false"}if(!e.lowest_discount){e.lowest_discount="true"}if(!e.noOrderNOnoPass){e.noOrderNOnoPass="true"}if(!e.orgModifyPer){e.orgModifyPer="true"}if(!e.printCount){e.printCount=1}if(!e.showVIPAlertOnNewOrder){e.showVIPAlertOnNewOrder="true"}if(!e.vipAreaRange){e.vipAreaRange=0}if(!e.statusConf){e.statusConf="1111"}if(!e.vip_aum){e.vip_aum="111"}if(!e.showLowestDisprice){e.showLowestDisprice="true"}if(!e.buttonShowList){e.buttonShowList="1111111"}if(e.disCanLgOne&&jQuery.trim(e.disCanLgOne)=="true"){this.discountCanLgOne=true}if(c.brand&&c.brand!=-1){e.brand=c.brand}if(c.m_dim1_id&&c.m_dim1_id!=-1){e.m_dim1_id=c.m_dim1_id}if(!this.checkPayWayExists(e.defaultPayway)){e.defaultPayway="现金"}if(!e.defaultVipType){e.defaultVipType="NON"}if(!e.timeVerify){e.timeVerify="P|M|5"}this.master_data.params=e}},checkButtonShowPer:function(d){var c=parseInt(this.master_data.params.buttonShowList,2);switch(d){case"UPLOAD":return((256&c)==256);case"SEARCH":return((128&c)==128);case"SALER":return((64&c)==64);case"PENDING":return((32&c)==32);case"CHANGESTATE":return((16&c)==16);case"CHANGENUM":return((8&c)==8);case"CHANGEAMT":return((4&c)==4);case"CHANGETOTAMT":return((2&c)==2);case"BATCH":return((1&c)==1);default:return true}},checkIsOnline:function(){if(window.location.host){return true}return false},checkNeedMarketBillWay:function(){if(this.master_data.params.needmarketbillway&&this.master_data.params.needmarketbillway=="true"&&this.locationConfig.PosConfig&&this.locationConfig.PosConfig.StorePayType=="True"){return true}return false},loadMasterObject:function(){if(!this.checkIsOnline()){this._onLoadMasterObjectForOffline();return}var c={};c.command="DBJSON";c.callbackEvent="BPOS_LOAD_MASTER";var d={store:$("store_id").value};c.param=Object.toJSON(d);c.table="m_retail";c.action="load_master";c.permission="r";this._executeCommandEvent(c)},checkMultiSalers:function(e,d){if(e.length!=d.length){return false}for(var c=0;c<e.length;c++){if(e[c].id!=d[c].id){return false}}return true},checkisexistinitemsdata:function(d){for(var c=0;c<this.items_data.length;c++){if(d.productno==this.items_data[c].productno&&d.type==this.items_data[c].type&&d.discount==this.items_data[c].discount&&d.markbaltype==this.items_data[c].markbaltype){if(this.value2type(d.type)=="退货"&&d.org_docno!=this.items_data[c].org_docno){continue}if((d.saler==this.items_data[c].saler&&this.master_data.params.multiSalers=="false")||(this.master_data.params.multiSalers=="true"&&this.checkMultiSalers(d.multisalers,this.items_data[c].multisalers))){return this.items_data[c]}}}return -1},getitembylinenofromitems_data:function(d){for(var c=0;c<this.items_data.length;c++){if(d==this.items_data[c].lineno){return this.items_data[c]}}},modifyitem:function(e,d){if(parseInt(d,10)==d){var c=this.items_data[d];this.modifyitem2items_data(c,e);this.updatehtml()}},getitemindexbylineno:function(e){for(var c=0;c<this.items_data.length;c++){var d=this.items_data[c];if(d.lineno==e){return c}}return -1},manualupdateitem:function(e,d){var c=this.getitemindexbylineno(e);this.modifyitem(d,c)},modifyitem2items_data:function(c,e){if(e.discount||e.discount==0){c.discount=e.discount}if(e.qty||e.qty==0){var d=this.value2type(c.type);if(d=="退货"){c.qty=-e.qty}else{c.qty=e.qty}}if(e.priceactual||e.priceactual==0){c.priceactual=e.priceactual}else{c.priceactual=this.alg(c.discount.mul(c.pricelist))}if(e.price||e.price==0){c.price=e.price}else{c.price=this.alg(c.qty.mul(c.priceactual))}this.updateline(c.lineno,c)},updateitem2items_data:function(c,d){var e=1;if(d.discount||d.discount==0){e=c.discount>d.discount?d.discount:c.discount;c.discount=e}else{e=c.discount}if(d.pricelist||d.pricelist==0){c.pricelist=d.pricelist}c.priceactual=this.alg(e.mul(c.pricelist));if(d.qty||d.qty==0){c.qty+=d.qty}if(d.price||d.price==0){c.price=d.price.add(c.price)}else{c.price=this.alg(c.qty.mul(c.priceactual))}this.updateline(c.lineno,c)},items_datapushitem:function(d,c){if(!c){c=this.items_data}if(d.lineno==-1){this.maxlineno++;d.lineno=this.maxlineno}c.push(d)},additem2items_data:function(c){this.items_datapushitem(c);this.insertitem(this.maxlineno,c)},splitItem:function(d,e){if(d.qty<e||e<=0){return null}var c=Object.toJSON(d);c=c.evalJSON();c.qty=d.qty-e;c.lineno=-1;c.price=(c.priceactual).mul(c.qty);d.qty=e;d.price=(d.priceactual).mul(d.qty);return c},countVipBirDis:function(){var d=0;for(var c=0;c<this.items_data.length;c++){if(this.items_data[c].vipbirdisid&&this.items_data[c].vipbirdisid>0){d+=this.items_data[c].qty}}return d},refreshVipDisUseQty:function(){if(this.vip&&this.vip.vipdis){this.vip.vipdis.USEQTY=this.countVipBirDis();return this.vip.vipdis.USEQTY}return 0},getVipDisRemQty:function(){if(this.vip&&this.vip.vipdis){return this.vip.vipdis.REMQTY-this.refreshVipDisUseQty()}return 0},handleVipBirDis:function(e){var d=this.vip.vipdis.EXECONTENT;if(e.type==1&&e.priceactual>d&&e.qty>0&&this.vip.vipdis.LIMITTYPE==1){var c=this.getVipDisRemQty();if(c<e.qty){this.updateitems_data2(this.splitItem(e,c))}if(this.vip.vipdis.DISTYPE==1){e.priceactual=this.alg((e.priceactual).mul(d))}else{if(this.vip.vipdis.DISTYPE==3){e.priceactual=this.alg((e.priceactual).sub(d))}}e.discount=this.alg((e.priceactual).div(e.pricelist));e.price=this.alg((e.qty).mul(e.priceactual));this.vip.vipdis.USEQTY=this.vip.vipdis.USEQTY+e.qty;e.vipbirdisid=this.vip.vipdis.ID}},changeret2item:function(e,g){var f={};f.productno=e.m_retail_productno;f.productname=e.m_retail_productname;f.colorname=e.m_retail_colorname;f.sizename=e.m_retail_sizename;f.color=e.m_retail_color;f.size=e.m_retail_size;f.mdim11=e.m_retail_mdim11;f.productvalue=e.m_retail_productvalue;f.pricelist=isNaN(parseFloat(e.m_retail_pricelist))?0:parseFloat(e.m_retail_pricelist);f.discount=isNaN(parseFloat(e.m_retail_discount))?0:parseFloat(e.m_retail_discount);f.discription=e.m_retail_discription;f.priceactual=isNaN(parseFloat(e.m_retail_priceactual))?0:parseFloat(e.m_retail_priceactual);f.priceactual=this.alg(f.priceactual);f.qty=isNaN(parseInt(e.m_retail_qty,10))?0:parseInt(e.m_retail_qty,10);f.price=isNaN(parseFloat(e.m_retail_price))?0:parseFloat(e.m_retail_price);f.price=this.alg(f.price);f.salerid=this.master_data.saler.id;f.saler=this.master_data.saler.name;f.multisalers=this.master_data.multisalers||[];f.type=e.m_retail_type;f.orgdocno=e.m_retail_orgdocno;f.pda_id=parseInt(e.m_pda_id,10);f.org_payways=e.org_payways||-1;f.org_qty=e.org_qty?parseInt(e.org_qty,10):0;f.org_payamounts=e.org_payamounts||-1;f.org_billdate=e.org_billdate||-1;f.sysdate=e.sysdate||-1;f.org_docno=e.orgdocno||-1;f.lowest_discount=(e.lowest_discount)?parseFloat(e.lowest_discount):0;f.m_dim1=e.m_dim1?e.m_dim1:"";f.m_dim2=e.m_dim2?e.m_dim2:"";f.m_dim3=e.m_dim3?e.m_dim3:"";f.m_dim4=e.m_dim4?e.m_dim4:"";f.m_dim5=e.m_dim5?e.m_dim5:"";f.m_dim6=e.m_dim6?e.m_dim6:"";f.m_dim7=e.m_dim7?e.m_dim7:"";f.m_dim8=e.m_dim8?e.m_dim8:"";f.m_dim9=e.m_dim9?e.m_dim9:"";f.m_dim10=e.m_dim10?e.m_dim10:"";f.m_dim11=e.m_dim11?e.m_dim11:"";f.m_dim12=e.m_dim12?e.m_dim12:"";f.m_dim13=e.m_dim13?e.m_dim13:"";f.m_dim14=e.m_dim14?e.m_dim14:"";f.m_dim15=e.m_dim15?e.m_dim15:"";f.m_dim16=e.m_dim16?e.m_dim16:"";f.m_dim17=e.m_dim17?e.m_dim17:"";f.m_dim18=e.m_dim18?e.m_dim18:"";f.m_dim19=e.m_dim19?e.m_dim19:"";f.m_dim20=e.m_dim20?e.m_dim20:"";f.vipbirdis=e.vipbirdis||false;var d=true;if(g&&e.lineid!=-1){f.lineno=e.lineid;var c=this.getitembylinenofromitems_data(f.lineno);f.saler=c.saler;f.salerid=c.salerid;f.markbaltype=c.markbaltype;f.sin_disid=c.sin_disid;f.sin_disname=c.sin_disname;f.com_disid=c.com_disid;f.com_disname=c.com_disname;f.add_disid=c.add_disid;f.add_disname=c.add_disname;f.multisalers=c.multisalers;f.vipbirdis=c.vipbirdis;f.vipbirdisid=c.vipbirdisid;d=false}else{f.lineno=-1;f.markbaltype=-1;f.sin_disid=parseInt(e.sin_disid,10)||-1;f.sin_disname=e.sin_disname||-1;f.com_disid=parseInt(e.com_disid,10)||-1;f.com_disname=e.com_disname||-1;f.add_disid=parseInt(e.add_disid,10)||-1;f.add_disname=e.add_disname||-1}f.locked=e.locked?parseInt(e.locked,10):0;if(f.vipbirdis&&d){this.handleVipBirDis(f)}return f},getminvalueitem:function(f){var c={};var e;for(var d=0;d<this.items_data.length;d++){if(d==0){c=this.items_data[d];e=this.items_data[d][f]}else{if(e>=this.items_data[d][f]){e=this.items_data[d][f];c=this.items_data[d]}}}return c},getDateRangeStrArray:function(e,c){var j=new Date();this.nowDate=this.formatDate(j);this.selectDate=this.nowDate;var h="";for(var d=e;d<=c;d++){var g=new Date();g.setDate(j.getDate()+d);var f=this.formatDate(g);h+="<option "+((f==this.nowDate)?'selected="selected"':"")+' value="'+f+'">'+f+"</option>"}return h},formatDate:function(e){var g=e.getYear();var c=this.change2TwoD(e.getMonth()+1);var f=this.change2TwoD(e.getDate());return g+""+c+f},change2TwoD:function(c){var d=c;if(c<10){d="0"+c}return d},updatemasterdata:function(n){this.master_data.docno=n.docno;this.master_data.c_store_id=n.c_store_id;this.master_data.c_store_name=n.c_store_name;this.master_data.storecode=n.c_store_code;this.master_data.market=n.market||"";this.master_data.customer=n.customer||"";this.master_data.city=n.city||"";this.master_data.directstore=n.directstore||"YN";this.master_data.c_pricearea_id=n.c_store_priceareaid||-1;this.master_data.calculation=n.calculation;this.master_data.discountlimit=n.discountlimit;this.master_data.execSql=n.c_store_sql||"";this.master_data.orderLimitDate=(n.orderlimitdate||n.orderlimitdate==0)?n.orderlimitdate:7;this.master_data.comptype=parseInt(n.comptype,10)||0;this.master_data.retail_value=n.RETAIL_VALUE||"";this.master_data.retail_type=n.RETAIL_TYPE||"";var q=new Array();var t={};t.id=-1;t.name="-";t.truename="-";t.passwordhash="-";q.push(t);for(var h=0;h<n.emp_ids.length;h++){var r={};r.id=n.emp_ids[h];r.name=n.emp_names[h];r.truename=n.emp_truenames[h];r.passwordhash="";q.push(r)}this.master_data.salers=q;var o=new Array();for(var g=0;g<n.pids.length;g++){var d={};d.id=n.pids[g];d.name=n.pnames[g];d.iscash=n.iscashs[g];d.ischarge=n.ischarges[g];d.iscashcard=n.iscashcards[g];d.isticket=n.istickets[g];d.is_vou=n.is_vou[g];d.isconsumecard=n.isconsumecards[g]||"N";o.push(d)}var c=new Array();if(n.markdis_ids&&n.markdis_ids.length>0){for(var f=0;f<n.markdis_ids.length;f++){var m={};m.markdis_id=n.markdis_ids[f];m.markbaltype_id=n.markbaltype_ids[f];m.markbaltype_name=n.markbaltype_names[f];m.markbaltype_description=n.markbaltype_descriptions[f];c.push(m)}}this.master_data.markbaltypes=c;this.master_data.payways=o;var e={};e.id=n.emp_id;e.name=n.emp_name;e.truename=n.emp_truename;e.discountlmt=n.discountlimit;e.email=n.emp_email||"";e.passwordhash=n.emp_passwordhash||"";e.isret=n.isret||"Y";e.webpos_per=n.webpos_per!=0?(parseInt(n.webpos_per,2)||this.CHANGEBILLDATE):0;this.master_data.saler={};this.master_data.saler.id=-1;this.master_data.saler.name="-";this.master_data.saler.truename="-";this.master_data.operator=e;this.master_data.multisalers=new Array();var l={};l.daytarget=n.day_range;l.monthtarget=n.month_range;l.daycurrent=n.day_currect;l.monthcurrent=n.month_currect;l.numcurrent=n.num_current;l.vip_range=n.vip_range;l.vip_current=n.vip_current;this.master_data.target=l},bindVipDB:function(){if(this.master_data.params.vipAreaRange>0&&!this.checkIsOnline()){MainApp.bindVipDB()}},getConfig:function(){var c=MainApp.GetConfig();c=c.evalJSON();return c},updateBilldateRange:function(){var c=this.master_data.params.billdaterange.split(",");if(c.length>1){jQuery("#sys_date").html(this.getDateRangeStrArray(parseInt(c[0],10),parseInt(c[1],10))).bind("change",function(){bpos.changeTimeValidate()})}else{var d=new Date();d=this.formatDate(d);jQuery("#sys_date").html("<option selected='true' value='"+d+"' >"+d+"</option>")}},changeTimeValidate:function(d,c){if((bpos.master_data.operator.webpos_per&bpos.CHANGEBILLDATE)==bpos.CHANGEBILLDATE&&!d){return}else{if(d){if(d!=this.selectDate){jQuery("#sys_date option[text='"+this.selectDate+"']").attr("selected","true")}else{this.selectDate=jQuery("#sys_date").find("option:selected").text();if(c&&this.offlineUserinfo&&c==this.offlineUserinfo.ID){this.master_data.operator.webpos_per=bpos.CHANGEBILLDATE}}}else{bxl.validateEmployee("changeTime",true)}}},loadMasterAction:function(){this.updateBilldateRange();this.initrefno();this.gethookcount();this.compelupdate();this.deleteOrders();this.executeSql();this.bindVipDB();this.locationConfig=this.getConfig();if(this.master_data.params.canUseTicketWhenWholeDis=="true"){this.canUseTicketWhenWholeDis=true}var d=parseFloat(this.master_data.params.uploadTimeInterval);if(!isNaN(d)&&d>0){this.uploadOrderInterval(d)}var c=parseInt(this.master_data.params.statusConf,2);if((c&8)!=8){this.types[0].active=0}else{this.types[0].active=1}if((c&4)!=4){this.types[1].active=0}else{this.types[1].active=1}if((c&2)!=2){this.types[2].active=0}else{this.types[2].active=1}if((c&1)!=1){this.types[3].active=0}else{this.types[3].active=1}this.initItemsHeaderHtmlByParam();this.updateheaderhtml();this.ticketpayways=this.getticketpayway();this.cashcardpayways=this.getvipcardpayway();this.voupayways=this.getvoupayway();if(!this.voupayways){this.voupayways=[]}this.consumecardpayways=this.getconsumecardpayway();this.isOnLoad=false;this.CacheData(this.master_data.c_store_id)},initMasterHtml:function(){if(this.master_data.params.showFinishedTarget&&this.master_data.params.showFinishedTarget.strip().toLowerCase()=="false"){jQuery(".idTarget").hide();jQuery("#daycurrent").hide();jQuery("#monthcurrent").hide();jQuery("#numcurrent").hide();jQuery("#openVipCurrent").hide()}$("from_top_text").innerHTML=this.master_data.c_store_name+"";$("daycurrent").innerHTML=this.master_data.target.daycurrent+"";$("daytarget").innerHTML=this.master_data.target.daytarget+"";$("monthtarget").innerHTML=this.master_data.target.monthtarget+"";$("monthcurrent").innerHTML=this.master_data.target.monthcurrent+"";$("numcurrent").innerHTML=this.master_data.target.numcurrent+"";$("openVipCurrent").innerHTML=this.master_data.target.vip_current+"";$("openViptarget").innerHTML=this.master_data.target.vip_range+"";$("currentoperator").innerHTML=this.master_data.operator.name+"("+this.master_data.operator.truename+")";for(var d=0;d<this.master_data.retail_type.length;d++){var c=document.createElement("option");c.appendChild(document.createTextNode(this.master_data.retail_type[d]));c.setAttribute("value",this.master_data.retail_value[d]);if(this.master_data.retail_type[d].strip()=="正常零售"){c.setAttribute("selected","true")}$("retailType").appendChild(c);this.rememberSelectedValue()}if(!this.checkButtonShowPer("UPLOAD")){$("uploadbutton").disabled=true}if(!this.checkButtonShowPer("SEARCH")){$("searchbutton").disabled=true}if(!this.checkButtonShowPer("SALER")){$("f3button").disabled=true}if(!this.checkButtonShowPer("PENDING")){$("f4button").disabled=true}if(!this.checkButtonShowPer("CHANGESTATE")){$("f6button").disabled=true}if(!this.checkButtonShowPer("CHANGENUM")){$("f7button").disabled=true}if(!this.checkButtonShowPer("CHANGEAMT")){$("f8button").disabled=true}if(!this.checkButtonShowPer("CHANGETOTAMT")){$("f9button").disabled=true}if(!this.checkButtonShowPer("BATCH")){$("f11button").disabled=true}},getServiceUrl:function(){return this.URL?this.URL.replace("bpos/",""):"http://"+window.location.host+"/"},doSomeThingWhenLoadMaster:function(c){this.repairOfflineMaster(c);this.initMasterHtml();this.master_data.url=this.getServiceUrl();this.exportaxtivexparams(c);this.loadMasterAction();if(c){this.queryNotice()}},queryNotice:function(){mc.load();bxl.newsQuery();setInterval("bxl.newsQuery()",900000)},repairOfflineMaster:function(d){if(!d){var c={};c.id=this.offlineUserinfo.ID;c.name=this.offlineUserinfo.NAME;c.truename=this.offlineUserinfo.TRUENAME;c.email=this.offlineUserinfo.email;c.passwordhash=this.offlineUserinfo.PASSWORD;c.isret=this.offlineUserinfo.ISRET||"Y";c.discountlmt=1;c.webpos_per=0;this.master_data.operator=c}this.master_data.createTime=this.getformatcurrenttime();this.master_data.canModify=1},uploadOrderInterval:function(c){this.AUTOUploadRetailProcess(c,this.master_data.c_store_id,this.master_data.operator.id,'"'+this.getServiceUrl()+'"')},AUTOUploadRetailProcess:function(e,c,d,g){var f='{"param":{"uploadTimeInterval":'+e*60+',"storeId":'+c+',"userId":'+d+',"url":\''+g+"'}}";MainApp.UploadOrdersByFile(f)},checkHasUploadOrder:function(){var c=this.queryOrderStateCount();c=c?(c["0"]+c["2"]):0;if(this.isUploading||c<=0){return false}return true},queryOrderStateCount:function(){var c=MainApp.searchOrderNo();if(c){c=c.evalJSON();c["0"]=(c["0"])?parseInt(c["0"],10):0;c["1"]=(c["1"])?parseInt(c["1"],10):0;c["2"]=(c["2"])?parseInt(c["2"],10):0}return c},actionsWhenUnload:function(){var c=this.queryOrderStateCount();return c?(c["0"]+c["2"]):0},sava:function(){var c=this.actionsWhenUnload();if(c>0){if(!confirm("您还有"+c+"张单据未成功上传，确认要注销吗？")){return}}if(bpos.items_data.length>0){if(!confirm("您还有单据未保存，确定要注销吗？")){return}}location.href="/bpos/login.jsp"},autoUploadOrder:function(d){$("uploadbutton").disabled=true;if(this.checkHasUploadOrder()){this.isUploading=true;jc.popUpEffectLikeMsn($("eMeng"));jQuery("#tipMsgHead").html("正在上传数据....");jQuery("#tipMsgBody").html("上传间隔&nbsp;&nbsp;<font color=#FF0000>"+d+"</font>&nbsp;&nbsp;分钟");var c={};try{c=MainApp.AutoUploadOrder2(this.getServiceUrl());c=c.evalJSON()}catch(f){}if(c){jQuery("#tipMsgHead").html("上传完成！");jQuery("#tipMsgBody").html("成功：<font color=#FF0000>"+(c.isSuccess||0)+"</font>条；失败：<font color=#FF0000>"+(c.isLosing||0)+"</font>条")}this.isUploading=false;window.setTimeout(function(){jc.hideElementAndClearInterval($("eMeng"))},6000)}jQuery("#uploadbutton").removeAttr("disabled")},deleteOrders:function(c){var d={};var e={};e.orderLimitDate=this.master_data.orderLimitDate;d.param=e;MainApp.deleteOrders(Object.toJSON(d))},executeSql:function(e){if(jQuery.trim(this.master_data.execSql)!=""){var c={};var d={};d.sql=this.master_data.execSql;c.param=d;MainApp.ExecuteSql(Object.toJSON(c))}},getLoadInfo:function(){var d=(window.location).toString();d=d.substr((d.indexOf("?")+1));var f=d.split("&");var e={};for(var c=0;c<f.length;c++){if(f[c].indexOf("storeid=")!=-1){e.storeId=f[c].replace("storeid=","")}if(f[c].indexOf("storename=")!=-1){e.storeName=f[c].replace("storename=","")}if(f[c].indexOf("storecode=")!=-1){e.storeCode=f[c].replace("storecode=","")}if(f[c].indexOf("email=")!=-1){e.email=f[c].replace("email=","")}if(f[c].indexOf("md5=")!=-1){e.MD5=f[c].replace("md5=","")}if(f[c].indexOf("mins=")!=-1){e.mins=f[c].replace("mins=","")}}return e},validateUser:function(m,g,e,h){var j=new Date();var c=getMins(j);if((c>g)||c<g-3){alert("会话过期!");return false}this.offlineUserinfo=getUserInfoByStoreIdAndEmail(m,e);this.offlineUserinfo.storeid=m;this.offlineUserinfo.email=e;var f=this.offlineUserinfo.PASSWORD;if(!f){alert("没有选择店仓或登陆用户!");return false}var l=generateMd5(j.getDate(),g,m,e,f);if(l==h){return true}alert("错误：验证失败！请确认店仓、用户、密码是否正确");return false},getLocalMasterObjectOnOffline:function(c){try{var f=MainApp.GetHiddenConfigFile(c);f=f.evalJSON();this.master_data=f.param;return true}catch(d){alert("错误：获取店仓信息失败，使用离线前必须在线登陆一次！");return false}},_onLoadMasterObjectForOffline:function(){var d=this.getLoadInfo();var c=d.storeId;var e=d.storeName;if(!this.validateUser(c,d.mins,d.email,d.MD5)){return}if(!this.getLocalMasterObjectOnOffline("storeId"+c)){return}this.doSomeThingWhenLoadMaster(false)},_onloadMasterObject:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.updatemasterdata(c);if(this.offline==true&&isIE()){this.doSomeThingWhenLoadMaster(true)}},compelupdate:function(){try{if(this.offline==true&&isIE()){if(this.master_data.params.PrintTemplates){var f={};var c=this.master_data.params.PrintTemplates.split(",");f.params={files:c[0],pos:c[1]};MainApp.DownFile(Object.toJSON(f))}if(this.master_data.params.compelupdate=="true"){MainApp.Login()}}}catch(d){alert("系统参数 webpos.PrintTemplates设置不正确，请联系管理员！")}},uploadOrder:function(){if(this.offline==true&&isIE()){MainApp.uploadOrder("http://"+window.location.host+"/")}},nosalererror:function(){if(!this.master_data.multisalers){this.master_data.multisalers=[]}if(this.master_data.params.requiredSaler&&this.master_data.params.requiredSaler=="true"&&this.master_data.saler.id==-1&&this.master_data.multisalers.length==0){bxl.sales();return true}return false},insertLine:function(){if((this.MODEL&this.INSERTLINE)!=this.INSERTLINE){alert("该单据不可新增行！");return}if(this.nosalererror()){return}if(this.itemtype==2){if(bpos.master_data.operator.isret=="N"){bxl.validateEmployee("Q")}else{this._editretailno()}}else{var f=$("m_retail_idx").value.strip().toUpperCase();if(!f){this.selectFirstType();return}var d=this.itemtype+"";var c=1;var e=$("sys_date").value;this.insertline_action("BPOS_INSERT_LINE",f,c,d,"","","")}},getFirstIndexActiveType:function(){for(var c=0;c<this.types.length;c++){if(this.types[c].active==1){return c}}},formatint2float:function(c){var d=new String(c);if(d.lastIndexOf(".")>0){d+="00"}else{d+=".00"}return d.substring(0,d.lastIndexOf(".")+3)},mergeSameItem:function(c,d){c.qty=c.qty.add(d.qty);c.price=c.price.add(d.price);this.updateline(c.lineno,c)},updateitems_data2:function(d){if(null==d){return}var c=this.checkisexistinitemsdata(d);if(c!=-1){this.mergeSameItem(c,d)}else{this.additem2items_data(d)}this.updatehtml()},updateretdata2items_data:function(d,c){if(!c){c=this.items_data}var e=this.changeret2item(d,true);this.items_datapushitem(e,c)},updateitems_data:function(c){var d=this.changeret2item(c);this.updateitems_data2(d)},gettotdata:function(n,d){if(!n){n=this.items_data}var j={};var e=0;var m=0;var l=0;var g=0;var c=0;var h=0;for(var f=0;f<n.length;f++){if(d){switch(d){case"commonqty":if(this.value2type(n[f].type)=="正常"){e+=n[f].qty}break;case"qty":m+=n[f].qty;break;case"commonprice":if(this.value2type(n[f].type)=="正常"){c=c.add(n[f].price)}break;case"price":h=h.add(n[f].price);break;case"commonpricelist":if(this.value2type(n[f].type)=="正常"){l=l.add((n[f].qty).mul(n[f].pricelist))}break;case"pricelist":g=g.add((n[f].qty).mul(n[f].pricelist));break}}else{m+=n[f].qty;h=h.add(n[f].price);g=g.add((n[f].qty).mul(n[f].pricelist));if(this.value2type(n[f].type)=="正常"){e+=n[f].qty;c=c.add(n[f].price);l=l.add((n[f].qty).mul(n[f].pricelist))}}}j.totqty=m;j.totprice=h;j.totpricelist=g;j.totcommonqty=e;j.totcommonprice=c;j.totcommonpricelist=l;return j},pdtStyleModel:function(h){var g=jQuery.trim(h).split(" ");var d=[];for(var f=0;f<g.length;f++){if(jQuery.trim(g[f])!=""){d.push(g[f].toUpperCase())}}if(d[1]=="*"){d[1]=0}if(d[2]=="*"){d[2]=0}var l={m_pdt:d[0],m_col:d[1]?d[1]:"",m_size:d[2]?d[2]:""};var j={};j.param=l;var c=this.getskus(Object.toJSON(j));c=c.evalJSON();if(c!=null&&c.NewDataSet&&c.NewDataSet.Table){c=c.NewDataSet.Table;bxl.matrixInsertnum();bxl.matrixStyle(c,$("colorShow").value,$("sizeShow").value,true)}else{var e=$("m_retail_idx");if(this.master_data.params.onLineSkuMatche=="true"&&this.checkIsOnline()){jQuery.ajax({type:"POST",url:this.URL+"getMatchedSku.jsp",data:"si="+e.value,async:false,error:function(){alert("网络不畅,请稍后再试！")},success:function(n){n=jQuery.trim(n);var m=n.evalJSON();if(m.code<0){alert(m.msg)}else{if(m.code==0){e.value=m.msg;bpos.insertLine()}else{if(m.code==1){e.value="";bpos.selectFirstType()}}}}})}else{e.value="";this.selectFirstType()}e.focus()}},selectFirstType:function(){var c=this.getFirstIndexActiveType();if(c||c==0){this.changeretailtypeforspec(this.types[c].value)}},vipBirDisChain1:function(c,d){if(d&&c.m_retail_type==4){c.m_retail_type=d}c.vipbirdis=true},checkNeedDoVipBirDisWithNotFullPrice:function(e){var g=false;if(e.NewDataSet&&e.NewDataSet.Table){for(var f=0;f<e.NewDataSet.Table.length;f++){var h=e.NewDataSet.Table[f];if(h.m_retail_type==1&&h.m_retail_price>0){g=true}}}else{if(e.m_retail_type==1&&e.m_retail_price>0){g=true}}if(!g){return false}var c=this.getVipDisRemQty();if(this.vip&&this.vip.vipdis&&this.vip.vipdis.ISFULLPRICE=="N"&&this.vip.vipdis.LIMITTYPE==1&&c>0){if(confirm("您还剩余"+c+"件商品使用["+this.vip.vipdis.NAME+"]活动机会,是否使用？")){return true}}return false},insertlineaction:function(e,h){if(e.code&&e.code==-1){if(this.master_data.params.pdtStyleModel&&this.master_data.params.pdtStyleModel=="true"){this.pdtStyleModel(jQuery.trim($("m_retail_idx").value))}else{$("m_retail_idx").value="";var g=$("m_retail_idx");g.focus();this.selectFirstType()}return}var c=this.checkNeedDoVipBirDisWithNotFullPrice(e);if(e.NewDataSet&&e.NewDataSet.Table){for(var f=0;f<e.NewDataSet.Table.length;f++){var j=e.NewDataSet.Table[f];if(h||c){this.vipBirDisChain1(j,h)}this.updateitems_data(j)}}else{if(e){if(h||c){this.vipBirDisChain1(e,h)}this.updateitems_data(e)}}this.selectFirstType();$("m_retail_idx").value="";var g=$("m_retail_idx");g.focus()},_onInsertLine:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.insertlineaction(c)},rememberSelectedValue:function(){this.master_data.remember_retail_value=$("retailType").value.strip()},_executeCommandEvent:function(c){Controller.handle(Object.toJSON(c),function(f){var d=f.evalJSON();if(d.code!=0){alert(d.message);if($("next")&&$("next").disabled==true){jQuery("#next,#re,#cancle").removeAttr("disabled")}if(d.message=="无权限"){window.close()}}else{var e=new BiEvent(d.callbackEvent);e.setUserData(d.data);application.dispatchEvent(e)}})},loadVip:function(c){return MainApp.loadVip(c)},checkvip:function(h,c){var n={};n.command="DBJSON";n.callbackEvent="BPOS_CHECKVIP";var e={ptype:h,pvalue:c,storeid:this.master_data.c_store_id};if(!this.checkIsOnline()){if(this.master_data.params.vipAreaRange>0){if(h.length>1){var m=new Array();for(var f=0;f<h.length;f++){var j={};j.ptype=h[f];j.pvalue=c[f];j.storeid=this.master_data.c_store_id;m.push(j)}e=m}var d={};var l={};l.Table=e;d.param=l;var g=this.loadVip(Object.toJSON(d));g=g.evalJSON();if(g.NewDataSet&&g.NewDataSet.Table){g=g.NewDataSet.Table;g=this.change2array(g);this._oncheck(g,true)}else{alert("未查询到符合的VIP！")}}else{alert("离线状态，无法使用VIP！")}return}n.param=Object.toJSON(e);n.table="m_retail";n.action="load_vip";n.permission="r";this._executeCommandEvent(n)},updatevipinfohtml:function(c){if($("c_viptype")){$("c_viptype").innerHTML=c.c_viptype}if($("vipname")){$("vipname").innerHTML=c.vipname}if($("birthday")){$("birthday").innerHTML=(c.birthday==null?"":c.birthday)}if($("vipename")){$("vipename").innerHTML=c.vipename}if($("sex")){$("sex").innerHTML=c.sex}if($("idno")){$("idno").innerHTML=hidePartOfWord(c.idno,5,14)}if($("validdate")){$("validdate").innerHTML=c.validdate}if($("lastconsumption")){$("lastconsumption").innerHTML=c.lastconsumption}if($("integral")){$("integral").innerHTML=c.integrals}if($("tot_amt_actual")){$("tot_amt_actual").innerHTML=c.tot_amt_actuals}if($("telephone")){$("telephone").innerHTML=hidePartOfWord(c.mobil,4,3)||""}if($("toDealer")){$("toDealer").innerHTML=c.customer||""}if($("toStore")){$("toStore").innerHTML=c.store||""}},docheckvip:function(c){this.tempvip=this.changeret2vip(c);this.hy_cardno=this.tempvip.cardno;this.updatevipinfohtml(this.tempvip);if(c.V_CHANGING&&c.V_CHANGING==1){alert("该会员已升级请换卡");$("ok").disabled=true}else{$("ok").disabled=false}if($("retailupdate")){$("retailupdate").disabled=false}if($("retailchange")){$("retailchange").disabled=false}},doselectvip:function(){this.vip=this.tempvip;this.refreshVipDisIntl(this.vip);this.tempvip=null;this.updateheaderhtml();var c={};this.vip.insertSql="insert into C_VIPTYPE(ID,AD_CLIENT_ID,ISACTIVE) values("+this.vip.c_viptype_id+", 37, 'Y');insert into c_vip(id, ad_client_id, ISACTIVE, cardno, c_viptype_id, idno, vipname, vipename, sex, birthday, validdate, mobil, c_store_id, c_customer_id, c_customerup_id,C_CITY_ID,C_OPENCARDTYPE_ID,ENTERDATE,STORECARDNO,DESCRIPTION,DESCRIPTION2,C_SERVICEAREA_ID,AGE,OPENCARDDATE)  values("+this.vip.vip_id+", 37, 'Y', '"+this.vip.cardno+"', "+this.vip.c_viptype_id+", "+(this.vip.idno?"'"+this.vip.idno+"'":"null")+","+(this.vip.vipname?"'"+this.vip.vipname+"'":"null")+","+(this.vip.vipename?"'"+this.vip.vipename+"'":"null")+","+(this.vip.sex?"'"+this.vip.sex+"'":"null")+", "+(this.vip.birthday||"null")+", "+(this.vip.validdate||"null")+", "+(this.vip.mobil?"'"+this.vip.mobil+"'":"null")+", "+this.master_data.c_store_id+", "+(this.vip.c_customer_id||"null")+", "+(this.vip.c_customerup_id||"null")+","+(this.vip.c_city_id||"null")+","+(this.vip.c_opencardtype_id||"null")+","+(this.vip.enterdate||"null")+","+(this.vip.storecardno?"'"+this.vip.storecardno+"'":"null")+","+(this.vip.description?"'"+this.vip.description+"'":"null")+","+(this.vip.description2?"'"+this.vip.description2+"'":"null")+","+(this.vip.c_servicearea_id||"null")+","+(this.vip.age||"null")+","+(this.vip.opencarddate?this.vip.opencarddate:0)+");";this.vip.createTableSql="create table c_vip(ID int, AD_CLIENT_ID int, ISACTIVE text, CARDNO text,C_VIPTYPE_ID int, IDNO text,VIPNAME text, VIPENAME text, SEX text, BIRTHDAY int,VALIDDATE int,CREDITREMAIN text,COUNTRY text,C_CITY_ID int, C_OPENCARDTYPE_ID int,ADDRESS text,POST text, PHONE text,MOBIL text,EMAIL text, C_STORE_ID int,C_CUSTOMER_ID INT, C_CUSTOMERUP_ID INT, INTEGRAL INT, PASS_WORD TEXT,ENTERDATE INT, VIPSTATE TEXT, BEST_TIME TEXT, BUILDING TEXT, SALER TEXT,STORECARDNO TEXT, OPENCARD_STATUS INT, OPENCARDERID INT, OPENCARDTIME INT,DESCRIPTION text,DESCRIPTION2 text,C_SERVICEAREA_ID int,AGE int,OPENCARDDATE int,HR_EMPLOYEE_ID int)";c.param=this.vip;this.setvip(Object.toJSON(c))},handlermultivip:function(c){if(c.length>1){jQuery("#showmultivip").css("display","");var e="";for(var d=0;d<c.length;d++){e+='<div class="VIP-row" id="VIP-row-'+d+'"><div class="VIP-row-line"><div class="VIP-span-1">'+c[d].VIPNAME+'</div><div class="VIP-span-2">'+(c[d].MOBIL||"无")+'</div><div class="VIP-span-4">'+c[d].CARDNO+"</div></div></div>"}jQuery("#VIP-main").html(e);jQuery("#VIP-main>div").bind("click",function(f){jQuery("#VIP-main>div").css("background-color","");jQuery(this).css("background-color","#75A9D6")});jQuery("#VIP-main>div").bind("dblclick",function(g){var f=parseInt(this.id.replace("VIP-row-",""));bpos.docheckvip(c[f]);g.stopPropagation()})}else{this.docheckvip(c[0]);jQuery("#ok").focus()}},refreshVipDisIntl:function(c){c.isIntl=$("isIntl")?$("isIntl").value:"Y";c.isDis=$("isDis")?$("isDis").value:"Y";if(c.isDis=="N"){c.discount=1;c.vipexp=1}},downloadVipDB:function(c,d){MainApp.downloadVipDB(c,d)},downLoadVipDb:function(){jQuery("#downloadvip").attr("disabled","true");jQuery.ajax({type:"POST",url:this.URL+"generateVipDB.jsp",data:"si="+this.master_data.c_store_id,error:function(){alert("网络不畅,请稍后再试！");jQuery("#downloadvip").removeAttr("disabled")},success:function(d){jQuery("#downloadvip").removeAttr("disabled");d=jQuery.trim(d);if(d.indexOf("filename:")!=-1){var c=bpos.getServiceUrl();var e=d.replace("filename:","");bpos.downloadVipDB(c,e)}else{alert(d)}}})},changeret2vip:function(c){var d={};d.vip_id=parseInt(c.VIP_ID,10);d.vipname=c.VIPNAME||"";d.vipename=c.VIPENAME||"";d.c_viptype=c.R_VIPTYPE||"";d.c_viptype_id=parseInt(c.C_VIPTYPE_ID,10)||-1;d.discount=c.DISCOUNT||1;d.idno=c.IDNO||"";if(c.SEX=="W"||c.SEX=="M"){d.sex=c.SEX=="W"?"女":"男"}else{d.sex=c.SEX||""}d.mobil=c.MOBIL||"";d.birthday=c.BIRTHDAY||"";d.validdate=c.VALIDDATE||"";d.cardno=c.CARDNO||"";d.vipexp=c.REDISCOUNT||1;d.lastconsumption=c.BILLDATE||"";d.integral=c.INTEGRAL||0;d.integrals=isNaN(c.INTEGRAL)?"-":c.INTEGRAL;d.tot_amt_actual=c.TOT_AMT_ACTUAL||0;d.tot_amt_actuals=isNaN(c.TOT_AMT_ACTUAL)?"-":c.TOT_AMT_ACTUAL;d.ifcharge=c.IFCHARGE||"Y";d.city=c.CITY||"";d.customer=c.CUSTOMER||"";d.store=c.STORE||"";d.directstore=c.DIRECTSTORE||"YN";d.c_city_id=parseInt(c.C_CITY_ID)||-1;d.c_opencardtype_id=parseInt(c.C_OPENCARDTYPE_ID,10)||-1;d.enterdate=c.ENTERDATE||-1;d.storecardno=c.STORECARDNO||" ";d.description=c.description||" ";d.description2=c.DESCRIPTION2||" ";d.c_servicearea_id=parseInt(c.C_SERVICEAREA_ID)||-1;d.age=c.AGE||-1;d.opencarddate=c.OPENCARDDATE||"";d.c_customer_id=parseInt(c.C_CUSTOMER_ID)||-1;d.c_customerup_id=parseInt(c.C_CUSTMOERUP_ID)||-1;d.vipdis=c.vipdis||{};d.pass_word=c.PASS_WORD||"";this.refreshVipDisIntl(d);return d},_oncheck:function(g,c){if(!c){var f=g.getUserData();var d=f.jsonResult.evalJSON()}else{d=g}if(d.length==0){alert("没有VIP符合条件！")}else{if(jQuery("#VIP-main:visible").length>0){jQuery("#VIP-main").html("")}this.tempvip=null;this.handlermultivip(d)}},killAlert:function(c,d){if(jQuery("#"+c).length==0){return}Alerts.killAlert($(c));this.noAlert=true;if(!d){this.selectFirstType()}},killAlert2:function(c){jQuery("#MainApp").show();Alerts.killAlert($(c));this.noAlert=false},checkvip3:function(){if(!this.tempvip){return}jQuery("#vipno").val(this.tempvip.cardno);this.tempvip=null;this.killAlert2("query-search-content")},checkvip2:function(){if(!this.tempvip){alert("没有VIP符合条件");return}this.doselectvip();this.killAlert("query-search-content")},closeEmployee:function(){this.killAlert("employee_content")},getEm:function(){this.master_data.saler.id=bxl.id;this.master_data.saler.name=bxl.name;this.updateheaderhtml();alert("切换营业员成功!")},tryClose:function(){this.killAlert("query-search-content")},tryClose_add:function(){this.killAlert("query-add-content");jQuery("#query-search-content").hidden=false;this.noAlert=false},tryClose_update:function(){this.killAlert("query-update-content");jQuery("#query-search-content").hidden=false;this.noAlert=false},tryClose_change:function(){this.killAlert("query-change-content");jQuery("#query-search-content").hidden=false;this.noAlert=false},getbitinbinary:function(c,d){return(c&(1<<d))==(1<<d)},handleReadVip:function(){$("vip").value=bpos.readvip();this.combineConditionAndsearchVip()},aokangSwipeConsumeCard:function(){$("ticketno").value=bpos.readvip()},executeLoadedScript:function(c){executeLoadedScript(c);jQuery("td.pop-up-close>a").remove()},combineConditionAndsearchVip:function(){var c=new Array();var d=new Array();jQuery("#vip,#tele,#name,#vipidno").each(function(){if(this.value&&jQuery.trim(this.value)!=""){var e=this.id=="vipidno"?"idno":this.id;c.push(e);d.push(jQuery.trim(this.value))}});if(c.length>0&&d.length>0){bpos.checkvip(c,d)}else{alert("请输入查询条件！")}},showvip:function(){if(this.items_data.length>0){}else{this.showvip_alert()}},getVipType:function(g){var e=document.getElementById("vip_type").value;var d=e.evalJSON();var c="";if(g=="add"){c+='<select id="add_type">'}else{c+='<select id="update_type">'}for(var f=0;f<d.length;f++){c+='<option value="'+d[f].typeid+'">'+d[f].typename+"</option>"}c+="</select>";return c},retail_add:function(){var d=this.getVipType("add");var e=document.getElementById("addvipNo").value;if(this.master_data.params.company=="tommy"){d='<select id="add_type"><option value="0">会员</option></select>'}var c=Alerts.fireMessageBox({width:600,modal:true,title:gMessageHolder.EDIT_MEASURE});c.innerHTML='<div id="query-add-content"><table width="600" align="center" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="add_td"><div id="add_text">请输入VIP信息</div></div></td></tr><tr><td><div class="VIP_table"><table width="600" border="1" align="center" cellpadding="1" cellspacing="1" bgcolor="#486489" id="modify_table">'+((e&&e=="NOR")?'<tr><td width="210" height="25" align="right"><div >新增卡号：</div></td><td colspan="2" ><input name="text" id="add_vipNo" type="text" size="30"/></td></tr>':"")+'<tr><td width="210" height="25" align="right"><div >类型：</div></td><td colspan="2">'+d+'</td></tr><tr><td width="210" height="25" align="right"><div>性别：</div></td><td colspan="2" ><select id="add_sex"><option value="M" selected>男</option><option value="W">女</option></select></td></tr><tr><td width="210" height="25" align="right"><div >开卡店仓：</div></td><td colspan="2" ><input name="text" size="30" id="add_diancang" type="text" value="'+this.master_data.c_store_name+'"/></td></tr><tr><td width="210" height="25" align="right"><div >姓名：</div></td><td colspan="2" ><input name="text" size="30" id="add_vipname" type="text" /></td></tr><tr><td width="210" height="25" align="right"><div >生日：</div></td><td ><input name="text"size="30" id="add_vipbirth" type="text" onkeypress="var k=event.keyCode; return k>=48&&k<=57||k==45" onpaste="return !clipboardData.getData(\'text\').match(//D/)" ondragenter="return false" style="ime-mode:Disabled"/><font color="red" size="2">格式(1901-11-11)</font></td></tr><tr><td width="210" height="25" align="right"><div >身份证号：</div></td><td colspan="2" ><input name="text" size="30" id="add_IDnum" type="text" /></td></tr><tr><td width="210" height="25" align="right"><div >邮件：</div></td><td colspan="2" ><input name="text" size="30" id="add_email" type="text" /></td></tr><tr><td width="210" height="25" align="right"><div >手机号：</div></td><td colspan="2" ><input name="text" size="30" id="add_tele" type="text" onkeypress="var k=event.keyCode; return k>=48&&k<=57" onpaste="return !clipboardData.getData(\'text\').match(//D/)" ondragenter="return false" style="ime-mode:Disabled" /></td></tr></table></div></td></tr><tr><td align="center"><div id="treatment_td" align="center"><div id="addok_text">&nbsp;<input type="button" value="确定" id="add_ok" onclick="bpos.add_func();" class="qinput"/>&nbsp;<input name="cancle" id="add_nok" type="button" class="qinput" value="取消"  onclick="javascript:bpos.tryClose_add();"/></div></div></td></tr></table></div>';this.executeLoadedScript(c);jQuery("#query-search-content").hidden=true;if(e&&e=="NOR"){$("add_vipNo").focus()}else{$("add_vipname").focus()}if(this.master_data.params.defaultVipType!="NON"){jQuery("#add_type option[text="+this.master_data.params.defaultVipType+"]").attr("selected","true")}},retail_update:function(){var d=this.getVipType("update");if(this.master_data.params.company=="tommy"){d='<select id="update_type"><option value="1">VIP</option></select>'}var c=Alerts.fireMessageBox({width:600,modal:true,title:gMessageHolder.EDIT_MEASURE});c.innerHTML='<div id="query-update-content"><table width="600" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="update_td"><div id="update_text">请输入VIP信息</div></div></td></tr><tr><td><div class="VIP_table"><table width="585" border="1" align="center" cellpadding="1" cellspacing="1" bgcolor="#486489" id="modify_table"><tr><td width="200" height="25" align="right"><div>卡号：</div></td><td width="120"><input name="text" id="update_cardno" type="text" value="'+this.hy_cardno+'" /></td></tr><tr><td width="200" height="25" align="right"><div >类型：</div></td><td width="120">'+d+'</td></tr><tr><td width="200" height="25" align="right"><div >邮编：</div></td><td width="120"><input name="text" id="update_post" type="text" /></td></tr><tr><td width="200" height="25" align="right"><div >地址：</div></td><td width="120"><input name="text" id="update_address" type="text" /></td></tr></table></div></td></tr><tr><td align="center"><div id="update_td" align="center"><div id="updateok_text">&nbsp;<input type="button" value="确定" id="update_ok" onclick="bpos.update_func();" class="qinput"/>&nbsp;<input name="cancle" id="update_nok" type="button" class="qinput" value="取消"  onclick="javascript:bpos.tryClose_update();"/></div></div></td></tr></table></div>';this.executeLoadedScript(c);jQuery("#query-search-content").hidden=true;$("update_cardno").focus();if(this.master_data.params.defaultVipType!="NON"){jQuery("#update_type option[text="+this.master_data.params.defaultVipType+"]").attr("selected","true")}},retail_change:function(){var c=Alerts.fireMessageBox({width:600,modal:true,title:gMessageHolder.EDIT_MEASURE});c.innerHTML='<div id="query-change-content"><table width="600" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="update_td"><div id="change_text">请输入VIP信息</div></div></td></tr><tr><td><div class="VIP_table"><table width="585" border="1" align="center" cellpadding="1" cellspacing="1" bgcolor="#486489" id="modify_table"><tr><td width="200" height="25" align="right"><div>卡号：</div></td><td width="120"><input name="text" id="change_cardno" type="text" /></td></tr><tr><td width="200" height="25" align="right"><div >邮编：</div></td><td width="120"><input name="text" id="change_post" type="text" /></td></tr><tr><td width="200" height="25" align="right"><div >地址：</div></td><td width="120"><input name="text" id="change_address" type="text" /></td></tr></table></div></td></tr><tr><td align="center"><div id="treatment_td" align="center"><div id="changeok_text">&nbsp;<input type="button" value="确定" id="change_ok" onclick="bpos.change_func()" class="qinput"/>&nbsp;<input name="cancle" id="changenok" type="button" class="qinput" value="取消"  onclick="bpos.tryClose_change()"/></div></div></td></tr></table></div>';this.executeLoadedScript(c);jQuery("#query-search-content").hidden=true;$("change_cardno").focus()},add_func:function(){var p=jQuery.trim($("addvipNo").value);var t="";var B=parseInt(this.master_data.params.vipAddRequiredCondition,2);if(p&&p=="NOR"){t=jQuery.trim($("add_vipNo").value)}var C=jQuery.trim(jQuery("#add_sex").val());var A=jQuery.trim($("add_diancang").value);if((B&32)==32){if(!A&&A!==0){alert("请输入开卡店仓...");$("add_diancang").focus();return}}var y=jQuery.trim($("add_vipname").value);if((B&16)==16){if(!y&&y!==0){alert("请输入姓名...");$("add_vipname").focus();return}}var x=jQuery.trim($("add_tele").value);if((B&1)==1){if(!x&&x!==0){alert("请输入手机号码！");$("add_tele").focus();return}}var w=jQuery.trim($("add_email").value);if((B&2)==2){if(!w&&w!==0){alert("请输入邮箱！");$("add_email").focus();return}}var j=jQuery.trim($("add_IDnum").value);if((B&4)==4){if(!j&&j!==0){alert("请输入身份证号码！");$("add_IDnum").focus();return}}var v=jQuery.trim($("add_vipbirth").value);if((B&8)==8){if(!v&&v!==0){alert("请输入生日!");$("add_vipbirth").focus();return}}var u=jQuery("#add_type").val();if(p&&p=="NOR"){if(!t&&t!==0){alert("请输入VIP卡号...");$("add_vipNo").focus();return}}var m=0;for(var s=0;s<y.length;s++){var l=y.charCodeAt(s);if(l>=0&&l<=128){m++}else{m+=2}}if(m>50){alert("姓名超长（请输入20以内字符）");$("add_vipname").focus();return}if(v||v===0){var n=/^(\d{4})-(\d{2})-(\d{2})$/;if(n.test(v)){var o=v.split("-");var z=new Date(o[0],parseInt(o[1],10)-1,o[2]);if(!((z.getFullYear()==parseInt(o[0],10))&&((z.getMonth()+1)==parseInt(o[1],10))&&(z.getDate()==parseInt(o[2],10)))){alert("请输入生日!");$("add_vipbirth").focus();return}}else{alert("请输入生日");$("add_vipbirth").focus();return}}if(w||w===0){var r=/\w@\w*\.\w/;if(r.test(w)){}else{alert("邮件格式错误（例：email@126.com）");$("add_email").focus();return}}if(x||x===0){var q=/^[1,5,6,8,9][0-9]{7,10}$/;if(q.test(x)){}else{alert("请输入正确的手机号");$("add_tele").focus();return}}this.checkadd_func("1","","",u,"",""+A+"",y,x,w,C,"",v,this.master_data.c_store_id,t,j)},update_func:function(){var f=jQuery.trim($("update_cardno").value);var e=jQuery.trim($("update_post").value);var h=jQuery.trim($("update_address").value);var g=jQuery.trim(jQuery("#update_type").val());if(!f&&f!=0){alert("请输入卡号...");$("update_cardno").focus();return}if(!h&&h!=0){alert("请输入地址...");$("update_address").focus();return}this.checkadd_func("2","",f,g,h,"","","","","",e,"",this.master_data.c_store_id,"","")},change_func:function(){var e=jQuery.trim($("change_cardno").value);var d=jQuery.trim($("change_address").value);var f=jQuery.trim($("change_post").value);if(!e&&e!=0){alert("请输入卡号...");$("change_cardno").focus();return}if(!d&&d!=0){alert("请输入地址...");$("change_address").focus();return}this.checkadd_func("3","",e,"",d,"","","","","",f,"",this.master_data.c_store_id,"","")},checkadd_func:function(f,g,y,h,t,j,x,w,v,o,u,p,m,r,q){var s={};s.command="DBJSON";s.callbackEvent="BPOS_VIPACM";var n={};n.p_userid=bpos.master_data.operator.id;n.type=f;n.vip_id=g;n.hy_cardno=this.hy_cardno;n.vip_cardno=y;n.vip_type=h;n.vip_address=t;n.c_store_id=j;n.vip_name=x;n.vip_mobil=w;n.vip_email=v;n.vip_sex=o;n.vip_post=u;n.vip_birth=p;n.IDnum=""+q+"";n.cur_salerid=this.master_data.saler.id;n.cur_c_store_id=m+"";n.vip_addno=r;var l=n;s.param=Object.toJSON(l);s.table="m_retail";s.action="vip_acm";s.permission="r";this._executeCommandEvent(s)},checkUseSms:function(){if(this.master_data.params.useVipSms=="true"){return true}return false},smsVip:function(){if(!(this.vip&&this.vip.vip_id)){alert("未录入VIP！");return}var c={};c.command="cn.com.burgeon.command.webpos.SmsSend";c.callbackEvent="VIP_SMS";var d={cardno:this.vip.cardno,mobile:this.vip.mobil};c.param=Object.toJSON(d);this._executeCommandEvent(c)},_onSmsVip:function(f){var d=f.getUserData();var c=/<.+?>/g;d=d.replace(c,"");if(typeof(d)=="string"){ret=d.evalJSON()}else{ret=d.jsonResult.evalJSON()}if(ret.Code!=0){alert("无法发送短信，请确认该VIP手机号码是否维护正确！")}else{alert("短信已发送！请查收！")}},getConds:function(){var g=new Array();var d=false;var e=false;if(this.master_data.params.company&&jQuery.trim(this.master_data.params.company)=="aokang"){e=true}if(this.master_data.params.company&&jQuery.trim(this.master_data.params.company)=="jnby"){d=true}var j=parseInt(this.master_data.params.vipcontroltype,2);for(var f=3;f>=0;f--){var h;switch(f){case 3:if(e||(this.master_data.comptype==1&&(this.master_data.params.company&&jQuery.trim(this.master_data.params.company)=="bsw"))){h={name:"VIP&nbsp;卡号",key:"vip",upperCase:d,btn:{name:"刷卡",key:"swingCard"},disabled:true}}else{h={name:"VIP&nbsp;卡号",key:"vip",upperCase:d}}break;case 2:h={name:"手&nbsp;机&nbsp;号",key:"tele"};break;case 1:h={name:"VIP&nbsp;姓名",key:"name"};break;case 0:h={name:"身份证号",key:"vipidno"};break}g.push(h)}return g},drawQueryStore:function(){var h="查询店仓信息";var e=[{name:"编号",key:"qstoreCode"},{name:"名称描述",key:"qstoreDes"},{name:"城市",key:"qstoreCity"},{name:"地址",key:"qstoreDre"}];var g=[{name:"编号",key:"storeCodeI"},{name:"名称",key:"storeNameI"},{name:"地址",key:"storeDreI"},{name:"城市",key:"storeCityI"},{name:"省份",key:"storeProvinceI"},{name:"分公司",key:"storeBranchI"}];var f=[{name:"确定",key:"determineq"},{name:"取消",key:"cancelq"}];var c=["编号","名称","地址"];du.multiQuery(e,g,f,h,"",c);this.noAlert=false;var d=$("qstoreCode");if(d&&d.disabled!=true){d.focus()}jQuery("#qstoreCode,#qstoreDes,#qstoreCity,#qstoreDre").bind("keyup",function(j){if(j.target==this&&j.which==13){bpos.combineConditionAndsearchStore()}});jQuery("#cancelq").bind("click",function(j){bpos.tempStore=null;bpos.killAlert2("query-search-content");$("search_condition").focus()});jQuery("#determineq").bind("click",function(j){if(bpos.tempStore&&bpos.tempStore.name){jQuery("#storenamer").val(bpos.tempStore.name);bpos.tempStore=null;bpos.killAlert2("query-search-content");$("search_condition").focus()}})},combineConditionAndsearchStore:function(){var c={};jQuery("#qstoreCode,#qstoreDes,#qstoreCity,#qstoreDre").each(function(){if(this.value&&jQuery.trim(this.value)!=""){c[this.id]=this.value}});jQuery.ajax({type:"POST",url:this.URL+"getStoreInfo.jsp",timeout:3000,contentType:"application/x-www-form-urlencoded; charset=utf-8",data:"cn="+Object.toJSON(c),error:function(){alert("网络不畅,请稍后再试！")},success:function(e){var d=e.evalJSON();if(d.code==0){alert(d.msg);return}bpos.handlermultistore(d.msg)}})},handlermultistore:function(c){if(c.length>1){jQuery("#showmultivip").css("display","");var e="";for(var d=0;d<c.length;d++){e+='<div class="VIP-row" id="VIP-row-'+d+'"><div class="VIP-row-line"><div class="VIP-span-1">'+c[d].code+'</div><div class="VIP-span-2">'+(c[d].name=="null"?"":c[d].name)+'</div><div class="VIP-span-4">'+(c[d].address=="null"?"":c[d].address)+"</div></div></div>"}jQuery("#VIP-main").html(e);jQuery("#VIP-main>div").bind("click",function(f){jQuery("#VIP-main>div").css("background-color","");jQuery(this).css("background-color","#75A9D6")});jQuery("#VIP-main>div").bind("dblclick",function(g){var f=parseInt(this.id.replace("VIP-row-",""));bpos.docheckstore(c[f]);g.stopPropagation()})}else{this.docheckstore(c[0]);jQuery("#ok").focus()}},docheckstore:function(c){this.tempStore=c;$("storeCodeI").innerHTML=this.tempStore.code;$("storeNameI").innerHTML=this.tempStore.name;$("storeDreI").innerHTML=this.tempStore.address=="null"?"":this.tempStore.address;$("storeCityI").innerHTML=this.tempStore.city=="null"?"":this.tempStore.city;$("storeProvinceI").innerHTML=this.tempStore.province=="null"?"":this.tempStore.province;$("storeBranchI").innerHTML=this.tempStore.block=="null"?"":this.tempStore.block},drawvip_alert:function(j){var f=this.getConds();var h=[{name:"VIP&nbsp;姓名",key:"vipname"},{name:"VIP&nbsp;类型",key:"c_viptype"},{name:"英&nbsp;文&nbsp;&nbsp;名",key:"vipename"},{name:"出生日期",key:"birthday"},{name:"性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别",key:"sex"},{name:"身份证号",key:"idno"},{name:"失效日期",key:"validdate"},{name:"上次消费日期",key:"lastconsumption"},{name:"可用积分",key:"integral"},{name:"累计消费金额",key:"tot_amt_actual"},{name:"经销商",key:"toDealer"},{name:"开卡店仓",key:"toStore"},{name:"手机号码",key:"telephone"}];if(!j){var j="新零售单据：请输入VIP查询信息"}var e=new Array();if(this.master_data.params.vip_aum!="000"){var d=parseInt(this.master_data.params.vip_aum,2);if((4&d)==4){e.push({name:"新增",key:"retailadd"})}if((2&d)==2){e.push({name:"升级",key:"retailupdate"})}if((1&d)==1){e.push({name:"换卡",key:"retailchange"})}}e.push({name:"确定",key:"ok"});e.push({name:"取消",key:"nok"});var c="<tr "+(this.master_data.params.isIntlDis=="true"?"":'style="display:none;"')+' class="emtbts"><td align="right">是否积分：</td> <td><select id=\'isIntl\'><option value="Y">----是----</option><option value="N">----否----</option></select></td><td align="right">是否打折：</td><td><select id=\'isDis\'><option value="Y">----是----</option> <option value="N">----否----</option></select></td></tr>';var n=["姓名","手机号","卡号"];du.multiQuery(f,h,e,j,c,n);this.noAlert=false;var g=$("vip");if(g&&g.disabled!=true){g.focus()}jQuery("#vip,#tele,#name,#vipidno").bind("keyup",function(o){if(o.target==this&&o.which==13){if(!this.value&&this.id=="vip"){this.value=bpos.readvip()}bpos.combineConditionAndsearchVip()}});var m;var l=g;jQuery("#query-search-content").bind("keydown",function(r){var o=jQuery("#VIP-main>div");var q=jQuery("#vip,#tele,#name,#vipidno,#retailadd,#ok,#nok");if(r.which==40){if(o.length>0){var p=0;if(m){p=o.index(m)+1}if(!o[p]){p=0}m=o[p];var s=jQuery(m);s.click();m.tabIndex=-1;m.focus()}}else{if(r.which==38){if(o.length>0){var p=o.length-1;if(m){p=o.index(m)-1}if(!o[p]){p=o.length-1}m=o[p];var s=jQuery(m);s.click();m.tabIndex=-1;m.focus()}}else{if(r.which==13){if(o.index(m)!=-1){jQuery(m).dblclick()}}else{if(r.which==9){q=jQuery("#vip,#tele,#name,#vipidno,#retailadd,#retailupdate,#retailchange,#ok,#nok");r.stopPropagation();r.preventDefault();var t=0;if(l){t=q.index(l)+1}if(q[t]&&q[t].disabled==true||jQuery(q[t]).is(":hidden")){t++}if(!q[t]){t=0}l=q[t];l.focus()}}}}})},showvip_alert:function(){this.drawvip_alert();jQuery("#swingCard").bind("click",function(c){bpos.handleReadVip()});jQuery("#retailupdate").bind("click",function(c){bpos.retail_update()});jQuery("#retailadd").bind("click",function(c){bpos.retail_add()});jQuery("#retailchange").bind("click",function(c){bpos.retail_change()});jQuery("#ok").bind("click",function(c){bpos.checkvip2()});jQuery("#nok").bind("click",function(c){bpos.tryClose()})},commandExt:function(d){try{MainApp.commandExt(d)}catch(c){}},_editvip:function(c){if((this.MODEL&this.NEWODER)!=this.NEWODER){alert("请先付款或挂单！");return}if(this.items_data.length>0&&this.MODEL!=this.SHOWMODEL){if(!confirm("单据明细未保存，确认放弃此单据？")){return}}this.init(c);jQuery("#m_retail_idx").val("");jQuery("#comment").val("按下F10键输入商品备注...");if(this.master_data.params.showVIPAlertOnNewOrder!="false"){jQuery("#uploadvip").css("display","none")}this.updateheaderhtml(c);if(this.master_data.params.showVIPAlertOnNewOrder&&this.master_data.params.showVIPAlertOnNewOrder=="false"){}else{this.showvip_alert()}},_editretailno:function(){if(this.master_data.params.needorgno&&this.master_data.params.needorgno=="true"){if(this.master_data.params.pdtStyleModel&&this.master_data.params.pdtStyleModel=="true"){var c=$("m_retail_idx").value.strip().toUpperCase();var f="select count(1) as c from m_pdtalias_webpos where no='"+c+"' or INTSCODE='"+c+"'";var d=this.queryDateFromDB(f);if(!(d.length&&d[0].c==1)){this.killAlert("r_retail_no_content",true);this.pdtStyleModel(jQuery.trim($("m_retail_idx").value));return}}var e=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});e.innerHTML=$("r_retail_no").innerHTML.replace(/TMP/g,"");this.executeLoadedScript(e);this.noAlert=false;jQuery("#retaildata").tipInput("格式：20130304");$("search_condition").style.visibility="visible";jQuery("#queryvip").bind("click",function(g){bpos.drawvip_alert();jQuery("#swingCard").bind("click",function(h){bpos.handleReadVip()});jQuery("#ok").bind("click",function(h){bpos.checkvip3();$("search_condition").focus()});jQuery("#nok").bind("click",function(h){bpos.killAlert2("query-search-content")})});jQuery("#querystore").bind("click",function(g){bpos.drawQueryStore()});window.setTimeout('$("search_condition").focus();',500);this.search_control()}else{this.checkretailno("")}},search_condition:function(c){jQuery("#retail_no").toggle();jQuery("#store_name").toggle();jQuery("#vip_no").toggle();jQuery("#saler_name").toggle();jQuery("#retail_data").toggle();if(document.getElementById("search_condition").value=="2"){jQuery("#storenamer").val(this.master_data.c_store_name+"")}if(!c){this.search_control()}},search_control:function(){var d;var c=$("search_condition");var e=c;jQuery("#r_retail_no_content").bind("keydown",function(f){if(f.which==9){if(document.getElementById("search_condition").value=="2"){d=jQuery("#search_condition,#storenamer,#vipno,#saler,#retaildata,#search_ok,#search_nok")}else{d=jQuery("#search_condition,#retailno,#search_ok,#search_nok")}f.stopPropagation();f.preventDefault();var g=0;if(e){g=d.index(e)+1}if(d[g]&&d[g].disabled==true){g++}if(!d[g]){g=0}e=d[g];e.focus()}else{if(f.which==38&&document.getElementById("search_condition").value=="2"){jQuery("#search_condition option[text='原单查询']").attr("selected","true")}else{if(f.which==40&&document.getElementById("search_condition").value=="1"){jQuery("#search_condition option[text='条件查询']").attr("selected","true")}else{return}}bpos.search_condition("snd")}})},insertlineqaction:function(c){if(c.code&&c.code==-1){bpos.killAlert("login_content",true);if(this.master_data.params.pdtStyleModel&&this.master_data.params.pdtStyleModel=="true"){this.pdtStyleModel(jQuery.trim($("m_retail_idx").value));return}else{this.selectFirstType();$("m_retail_idx").value="";return}}if(jQuery.trim(this.master_data.params.orgModifyPer)=="false"){bpos.updateitems_data(c);bpos.killAlert("r_retail_no_content");$("m_retail_idx").value="";return}var e=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});e.innerHTML=$("r_retail_price").innerHTML.replace(/TMP/g,"");this.executeLoadedScript(e);this.noAlert=false;var d=0;if(this.master_data.params.returnPriceLimit.strip().toLowerCase()=="true"){var g=(c.m_retail_pricelist||0)*this.master_data.discountlimit;var f=parseFloat(g);if(f>=parseFloat(c.m_retail_priceactual)){c.m_retail_price=bpos.alg(-f);c.m_retail_priceactual=bpos.alg(f);c.m_retail_discount=c.m_retail_pricelist==0?0:f.div(c.m_retail_pricelist);bpos.updateitems_data(c);bpos.killAlert("r_retail_price_content");bpos.killAlert("r_retail_no_content");$("m_retail_idx").value="";return}else{d=f}}$("info_text").innerHTML="<span style='color:red'>     退货的价格在"+d+"~"+(-c.m_retail_price)+"</span>";$("tempx").value=-c.m_retail_price;window.setTimeout('$("retailprice").focus();',500);jQuery("#retailprice").keypress(function(h){if(h.target==this&&h.which==13){var j=parseFloat(this.value);if(isNaN(j)||j<d||j>-c.m_retail_price){alert("请输入正确的价格！");$("retailprice").value=""}else{c.m_retail_price=bpos.alg(-j);c.m_retail_priceactual=bpos.alg(j);c.m_retail_discount=c.m_retail_pricelist==0?0:j.div(c.m_retail_pricelist);bpos.updateitems_data(c);bpos.killAlert("r_retail_price_content");bpos.killAlert("r_retail_no_content");$("m_retail_idx").value=""}}});jQuery("#returnpricebutton").click(function(){var h=parseFloat($("retailprice").value);if(isNaN(h)||h<d||h>-c.m_retail_price){alert("请输入正确的价格！");$("retailprice").value=""}else{c.m_retail_price=bpos.alg(-h);c.m_retail_priceactual=bpos.alg(h);c.m_retail_discount=c.m_retail_pricelist==0?0:h.div(c.m_retail_pricelist);bpos.updateitems_data(c);bpos.killAlert("r_retail_price_content");bpos.killAlert("r_retail_no_content");$("m_retail_idx").value=""}});jQuery("#canclebutton").click(function(){bpos.killAlert("r_retail_price_content");bpos.killAlert("r_retail_no_content")})},_onInsertLine_q:function(f){var d=f.getUserData();var c;if(typeof(d)=="string"){c=d.evalJSON()}else{c=d.jsonResult.evalJSON()}if(document.getElementById("search_condition").value=="2"&&this.search_end=="1"){this.q_data=c;this.show_search(c)}else{this.insertlineqaction(c)}},selectitem:function(e){for(var d=0;d<this.linenos.length;d++){if(this.linenos[d]==e){this.selectid=d;this.clearSelectcolor();this.nextretail("s");var c=jQuery("#row-"+e).find(":checkbox");c.attr("checked")?c.attr("checked",false):c.attr("checked",true);break}}},clearSelectcolor:function(){for(var d=0;d<this.linenos.length;d++){var c=document.getElementById("row-"+this.linenos[d]).style.backgroundColor;if(c=="dodgerblue"){var e=this.linenos[d]%2==0?"#A3BAD4":"#DAE3EA";jQuery("#row-"+this.linenos[d]).css("background-color",e);break}}},nextretail:function(c){if(!this.items_data.length>0){return}$("from-main").focus();if(!c){this.selectid++}if(this.selectid==this.linenos.length){this.selectid=0}this.clearSelectcolor();if(this.linenos[this.selectid]==this.linenos[Math.round(document.getElementById("from-main").scrollTop/25)+12]){document.getElementById("from-main").scrollTop+=300}if(this.selectid==0){document.getElementById("from-main").scrollTop=0}jQuery("#row-"+this.linenos[this.selectid]).css("background-color","dodgerblue")},preretail:function(){if(!this.items_data.length>0){return}if(this.selectid==-1){this.nextretail();return}$("from-main").focus();this.selectid--;if(this.selectid==-1){this.selectid=this.linenos.length-1}this.clearSelectcolor();if(this.linenos[this.selectid]==this.linenos[Math.round(document.getElementById("from-main").scrollTop/25)-1]){document.getElementById("from-main").scrollTop-=300}if(this.selectid==this.linenos.length-1){document.getElementById("from-main").scrollTop=Math.ceil(this.linenos.length/12)*300}jQuery("#row-"+this.linenos[this.selectid]).css("background-color","dodgerblue")},enterSelect:function(){if(!this.items_data.length>0){return}var c=jQuery("#from-main input[value="+this.linenos[this.selectid]+"]");c.attr("checked")?c.attr("checked",false):c.attr("checked",true)},changeretailtype:function(){if(this.nosalererror()){return}var e=jQuery("#m_retailtype").attr("val");e=parseInt(e,10);var c=this.getFirstIndexActiveType();for(var d=0;d<this.types.length;d++){if(this.types[d].value==e){while(true){d++;if(!this.types[d]){break}if(this.types[d].active==1){c=d;break}}break}}if(c||c==0){this.changeretailtypeforspec(this.types[c].value,c)}},changeretailtypeforspec:function(f,c){var d=this.value2type(f);var g=jQuery("#m_retailtype");g.attr("val",f);g.val(d);if(!c){c=0}g.css("color",this.types[c].color);this.itemtype=f},value2type:function(d){for(var c=0;c<this.types.length;c++){if(d==this.types[c].value){return this.types[c].type}}return -1},tryClose1:function(){if(bpos.master_data.operator.isret=="N"){if(this.master_data.params.noOrderNOnoPass=="false"){bxl.validateEmployee("V")}else{bxl.closeEmp("Q")}}else{if(bpos.master_data.operator.isret=="Y"){if(this.master_data.params.noOrderNOnoPass=="false"){bxl.closeEmp("V");this.checkretailno("")}else{bxl.closeEmp("Q")}}}},checkNeedFullPrice:function(d){if(d.m_retail_type==1&&this.vip&&this.vip.vipdis&&this.vip.vipdis.ID){var c=this.getVipDisRemQty();if(this.vip.vipdis.ISFULLPRICE=="Y"&&this.vip.vipdis.LIMITTYPE==1&&c>0){if(confirm("您还剩余"+c+"件商品使用["+this.vip.vipdis.NAME+"]活动机会,是否使用？")){return true}}}return false},insertline_action:function(s,j,o,w,g,n,d,q){if(this.offline==true&&isIE()){if(s=="BPOS_CHANGAMT"){var x={};var l={};var c=new Array();c.push(j);l.m_retail_productno=c;var m=new Array();m.push(o);l.m_retail_qty=m;l.m_retail_price=(parseInt(o,10)).mul(parseFloat(n));l.billdate=$("sys_date").value;x.param=l;var B=this.checkdis(Object.toJSON(x));B=B.evalJSON();if(B.code==1){this.changamtaction(B,parseFloat(d))}else{if(B.code==-1){alert(B.meg)}}return}}var p={};p.callbackEvent=s;if(s=="BPOS_RET_FUZZYQUERY"){p.command="cn.com.burgeon.command.webpos.RetFuzzyQuery";p.permission="r";var z=jQuery.trim($("vipno").value);var y=jQuery.trim($("storenamer").value);var t=jQuery.trim($("saler").value);var r=jQuery.trim($("retaildata").value);var l={vip_cardno:z,store_name:y,saler_name:t,saleDate:r,productno:j};p.param=Object.toJSON(l)}else{var h=$("sys_date").value;var l={cardno:this.vip.vip_id||"-1",c_store_id:this.master_data.c_store_id,billdate:h,m_retail_productno:j,m_retail_qty:o,m_retail_type:w,m_retail_orgdocno:g,m_retail_priceactual:n,discount:d};p.param=Object.toJSON(l);if(this.offline==true&&isIE()&&!q){var x={};l.cardno=this.vip.cardno||"1";l.vipexp=this.vip.vipexp||"1";l.vipbir=this.vip.birthday||"";l.isDis=this.vip.isDis||"Y";x.param=l;var A=false;var f=this.checkNeedFullPrice(l);if(f){A=l.m_retail_type;x.param.m_retail_type=4}var B=this.getsku(Object.toJSON(x));try{B=B.evalJSON()}catch(v){alert(v.message);return}if(s=="BPOS_INSERT_LINE"){this.insertlineaction(B,A)}else{if(s=="BPOS_INSERT_LINE_Q"){this.insertlineqaction(B,A)}}return}else{if(q&&this.master_data.params.pdtStyleModel&&s=="BPOS_INSERT_LINE_Q"){var u="select count(1) as c from m_pdtalias_webpos where no='"+j+"' or INTSCODE='"+j+"'";var B=this.queryDateFromDB(u);if(!(B.length&&B[0].c==1)){this.killAlert("r_retail_no_content",true);this.pdtStyleModel(jQuery.trim($("m_retail_idx").value));return}}}p.command="DBJSON";p.action="insertline";p.permission="r"}p.table="m_retail";this._executeCommandEvent(p)},queryDateFromDB:function(g,d){if(!d){d="POSBase"}var f={};f.dataBaseName=d;f.sql=g;var e={};e.param=f;var c=MainApp.getSearchData(Object.toJSON(e));if(c){c=c.evalJSON()}if(c.NewDataSet&&c.NewDataSet.Table){return this.change2array(c.NewDataSet.Table)}return null},getposhook:function(c){return MainApp.GetPosHook(c)},initrefno:function(){this.master_data.refno=this.createrefno()},searchOrder:function(c){if(this.offline==true&&isIE()){return MainApp.searchOrder(c)}},updatedb:function(){if(this.offline==true&&isIE()){MainApp.Login()}},readvip:function(){var d="";if(this.offline==true&&isIE()&&this.master_data.params.company){switch(jQuery.trim(this.master_data.params.company)){case"aokang":try{d=MainApp.ReadVip();if(!d||d==""){d=MainApp.ReadVIP_MW()}}catch(f){d=MainApp.ReadVIP_MW()}break;case"bsw":var c=MainApp.GetVipCardNo().evalJSON();if(c.code==1){d=c.CardNo}break}}return d},posprint:function(c){MainApp.PosPrint(c)},config:function(){if(this.offline==true&&isIE()){MainApp.Config()}},download:function(){if(this.offline==true&&isIE()){if(this.items_data.length>0){alert("本单已有明细，不可更新！")}else{MainApp.Download()}}},updateSerialNumber:function(){var c={};var d={};d.billdate=$("sys_date").value;d.c_store_id=this.master_data.c_store_id;c.param=d;MainApp.UpdateDocno(Object.toJSON(c))},createrefno:function(){var g={};var j={};j.c_store_id=this.master_data.c_store_id;var h=new Date();j.billdate=h.getFullYear()+zeroize(h.getMonth()+1)+zeroize(h.getDate());j.refcode=(h.getHours()*3600+h.getMinutes()*60+h.getSeconds()).toString(32);g.param=j;var c;try{c=MainApp.GetRefno(Object.toJSON(g))}catch(f){alert(f.message)}return c},setvip:function(c){MainApp.Call2("SetVip",c)},gethookcount:function(){var d={};var e={};e.storeid=this.master_data.c_store_id;e.billdate=$("sys_date").value;d.param=e;var c=MainApp.GetHookCount(Object.toJSON(d));$("restordernum").innerHTML=c||"0"},printpreorder:function(){if(!this.printInfo.param){alert("没有单据可以打印！");return}this.printInfo.param.reprint=true;this.printorder(Object.toJSON(this.printInfo))},setparm:function(d,c){MainApp.SetParm(d);if(c){MainApp.SetHiddenConfigFile("storeId"+this.master_data.c_store_id,d)}},checkdis:function(c){return MainApp.CheckDis(c)},printorder:function(e){var d=parseInt(this.locationConfig.PosConfig.小票联打次数,10);if(isNaN(d)||d<1){d=this.master_data.params.printCount}MainApp.printOrder(e);if(d>1){for(var c=0;c<d-1;c++){MainApp.printOrder(e)}}},getposhooks:function(c){return MainApp.GetPosHooks(c)},poshook:function(c){return MainApp.PosHook(c)},getsku:function(c){return MainApp.GetSku(c)},getskus:function(c){return MainApp.GetSkus(c)},getBarcode:function(){return $("m_retail_idx").value.strip().toUpperCase()},checkretailno:function(g,e){var h=$("m_retail_idx").value.strip().toUpperCase();var d=this.itemtype+"";var c=-1;var f=g==""?false:true;if($("search_condition")&&$("search_condition").value=="2"&&!e){this.search_end=1;this.insertline_action("BPOS_RET_FUZZYQUERY",h,c,d,g,"","",f);return}this.insertline_action("BPOS_INSERT_LINE_Q",h,c,d,g,"","",f)},show_search:function(n){var g="";var f="";var m="";var d="";var o="";if(jQuery.trim($("retailno").value)){g=jQuery.trim($("retailno").value)}if(jQuery.trim($("storenamer").value)){f=jQuery.trim($("storenamer").value)}if(jQuery.trim($("vipno").value)){m=jQuery.trim($("vipno").value)}if(jQuery.trim($("saler").value)){d=jQuery.trim($("saler").value)}if(jQuery.trim($("retaildata").value)){o=jQuery.trim($("retaildata").value)}var t=Alerts.fireMessageBox({width:858,modal:true,title:gMessageHolder.EDIT_MEASURE});var h="";var l=0;if(n.length){l=n.length}var p=0;var c="";var r="";var e=0;if(l==0){h=h+'<div id="quit-search" class="desc-txt"><font color="red"><center>当前店铺没有退货记录!</center></font></div>';h=h+'<div id="qsearch_text" align="center"><input type="button" tabindex=1 value="确定" onclick="javascript:bpos.qsearch_ok();" class="qinput" id="qsearch_ok"/></div>'}else{h=h+'<div id="quit-search" class="desc-txt"><div id="qsearch_td"><div id="qsearch_text">原单退货：查询结果信息</div><div class="treatmentLL-table"><div class="treatmentLL-table-head"><div class="treatmentLL-span-1">序号</div><div style="display:none;"></div><div class="treatmentLL-span-4">单据日期</div><div class="treatmentLL-span-11">单据编号</div><div class="treatmentLL-span-4">店仓</div><div class="treatmentLL-span-4">VIP卡号</div><div class="treatmentLL-span-5">VIP姓名</div><div class="treatmentLL-span-8">总数量</div><div class="treatmentLL-span-5">总成交金额</div><div class="treatmentLL-span-11">备注</div></div></div><div id="qsearch-main" class="treatmentLL-sidebar" style="font-size: 14px;color:#000000; height: 130px; width: 854px; visibility: visible; opacity: 1;">';for(var q=0;q<l;q++){p=q+1;h=h+'<div class="treatmentLL-row"><div id="divrowline'+p+'" class="treatmentLL-row-line"><div id="divinputrowline'+p+'" class="treatmentLL-span-1"><input id="q_search_radio'+p+'" value="'+p+'" name="q_ret_radio" type="radio" />'+p+'</div><div style="display:none;"></div><div class="treatmentLL-span-4">'+(n[q].billdate?n[q].billdate:"-")+'</div><div class="treatmentLL-span-11">'+(n[q].refno?n[q].refno:"-")+'</div><div class="treatmentLL-span-4">'+(n[q].storename?n[q].storename:"-")+'</div><div class="treatmentLL-span-4">'+(n[q].vip_no?n[q].vip_no:"-")+'</div><div class="treatmentLL-span-5">'+(n[q].vip_name?n[q].vip_name:"-")+'</div><div class="treatmentLL-span-8">'+(n[q].tot_qty?n[q].tot_qty:"-")+'</div><div class="treatmentLL-span-5">'+(n[q].tot_amt?n[q].tot_amt:"-")+'</div><div class="treatmentLL-span-11"></div></div></div>'}h=h+'</div></div><div id="qsearch_td" align="center"><div id="qsearch_text"><input type="button" tabindex=1 value="确定" onclick="javascript:bpos.qsearch_ok(1);" class="qinput" id="qsearch_ok"/>&nbsp;<input type="button" tabindex=3 value="取消" onclick="javascript:bpos.qsearch_ok(2);" class="qinput" id="qsearch_nok" /></div></div></div></div>'}t.innerHTML=h;bpos.executeLoadedScript(t);bpos.noAlert=false;jQuery("#q_search_radio1").attr("checked",true);if(l==0){jQuery("#qsearch_ok").focus()}else{jQuery("#q_search_radio1").focus()}var j;var s;jQuery("#quit-search").bind("keydown",function(w){var v=jQuery("#quit-search input[type='radio']");var x=jQuery("#quit-search input[type='button']");if(w.which==40){var u=0;if(s){u=v.index(s)+1}if(!v[u]){u=0}s=v[u];s.focus()}else{if(w.which==9){w.stopPropagation();w.preventDefault();var u=0;if(j){u=x.index(j)+1}if(!x[u]){u=0}j=x[u];j.focus()}else{if(w.which==13){if(w.target!=$("qsearch_nok")){bpos.qsearch_ok(1)}else{bpos.qsearch_ok(2)}}}}})},qsearch_ok:function(d){if(d&&d=="1"){var c=jQuery("#quit-search input[name='q_ret_radio']:checked").attr("id");var e=jQuery("#"+c).val();this.search_end=0;this.checkretailno(this.q_data[e-1].refno,this.q_data[e-1])}this.killAlert("quit-search","noResetType");if(d&&d=="2"){bpos.noAlert=false;jQuery("#search_condition").focus();this.search_end=0}if(!d){bpos.killAlert("r_retail_no_content")}},neglect:function(){this._editretailprice()},changnumber:function(){if((this.MODEL&this.CHANGENUM)!=this.CHANGENUM){alert("该单不可修改数量！");return}if(this.nosalererror()){return}var h=jQuery("#from-main input:checked");var e=h.length;if(e!=1){alert("没有选择或多选了！")}else{var d=parseInt(h.val(),10);var f=this.getitembylinenofromitems_data(d);if(f.locked==1){alert("该明细不可修改！");return}var g=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});g.innerHTML=$("num").innerHTML.replace(/TMP/g,"");this.executeLoadedScript(g);this.noAlert=false;$("retail_num").value=Math.abs(f.qty);$("retail_id").value=d;var l=$("retail_num");dwr.util.selectRange(l,0,15);var c;jQuery("#num_content").bind("keydown",function(n){var j=jQuery("#retail_num,#ok,#cancle");if(n.which==9){n.stopPropagation();n.preventDefault();var m=0;if(c){m=j.index(c)+1}if(j[m]&&j[m].disabled==true){m++}if(!j[m]){m=0}c=j[m];c.focus()}else{if(n.which==13){var o=j[m];jQuery(o).click()}}})}},changnum:function(){var e=$("retail_id").value;e=parseInt(e);var f=this.getitembylinenofromitems_data(e);var d=$("retail_num").value;d=parseInt(d,10);if(d<1){alert("请输入大于0的数！");return}if(f.org_qty>0&&d>f.org_qty){alert("退货的数量不可大于原单的数量："+f.org_qty);return}if(!isNaN(d)&&f&&d!=f.qty){var c={};c.qty=d;this.manualupdateitem(e,c)}this.cancelnum();this.clearchecked("from-main")},cancelnum:function(){$("m_retail_idx").value="";this.killAlert("num_content")},changprice:function(){if((this.MODEL&this.CHANGEAMOUNT)!=this.CHANGEAMOUNT){alert("该单不可修改金额！");return}if(this.nosalererror()){return}var d=jQuery("#from-main input:checked");var c=d.length;if(c!=1){alert("没有选择或多选了！")}else{if(bpos.master_data.params.verifyPermission=="true"){bxl.validateEmployee("price");return}else{bpos.updateprice()}}},updateprice:function(){var l=jQuery("#from-main input:checked");var h=l.length;var g=parseInt(l.val(),10);var o=this.getitembylinenofromitems_data(g);var e=this.value2type(o.type);if(e=="退货"||e=="全额"||e=="赠品"){alert("促销、退货、全额及赠品不能改金额！")}else{this.tempretailid=g;var q=Alerts.fireMessageBox({width:398,modal:true,title:gMessageHolder.EDIT_MEASURE});q.innerHTML=$("amt").innerHTML.replace(/TMP/g,"");this.executeLoadedScript(q);this.noAlert=false;var f=this.master_data.discountlimit;f=f>o.lowest_discount?f:o.lowest_discount;$("minrate").innerHTML=f;$("minprice").innerHTML=this.alg(o.pricelist.mul(f),true);$("maxprice").innerHTML=this.alg(o.pricelist.mul(1-f),true);this.master_data.discountlimit=f;var n=$("discount_0");n.focus();var p;var c=jQuery("#treatment_table input[type='radio']");var d=c[0];jQuery(d).click();if(this.master_data.params.showLowestDisprice=="true"){jQuery("#discount0,#discount1,#discount2").show();jQuery("#zody_btn_sOh").hide()}var m=jQuery("#btn-ok,#cancle");jQuery("#amt_content").bind("keydown",function(s){if(s.which==9){s.stopPropagation();s.preventDefault();var r=0;if(p){r=m.index(p)+1}if(m[r]&&m[r].disabled==true){r++}if(!m[r]){r=0}p=m[r];p.focus()}else{if(s.which==13){if(s.target!=$("btn-ok")&&s.target!=$("cancle")){bpos.changamt()}}else{if(s.which==40){var r=0;if(d){r=c.index(d)+1}if(!c[r]){r=0}jQuery(c[r]).attr("checked",true);d=c[r];jQuery(d).click()}else{if(s.which==38){var j=c.length;var r=0;if(d){r=c.index(d)-1}if(r<0){r=j-1}jQuery(c[r]).attr("checked",true);d=c[r];jQuery(d).click()}else{if(s.ctrlKey==true&&s.which==39){if(!this.master_data.params.showLowestDisprice=="true"){bpos.show2_Model()}}}}}}})}},show2_Model:function(){jQuery("#discount0").toggle();jQuery("#discount1").toggle();jQuery("#discount2").toggle()},changamt:function(){var h,l;var s=this.getitembylinenofromitems_data(this.tempretailid);var n;var r=1;var f="";h=document.getElementsByName("radio_amt");l=document.getElementsByName("m_retail");var m=this.master_data.discountlimit;for(var o=3;o<h.length;o++){if(h[o].checked){n=o-3;if($("discount_"+n).value==""){alert("请输入相关数据！");r=0}else{if(n==0){var q=parseFloat($("discount_0").value);if(isNaN(q)||q<m){$("discount_0").value="";alert("你输入的折扣率不正确！");r=0}else{if(q>1&&!this.discountCanLgOne){$("discount_0").value="";alert("折扣率不允许大于1！");r=0}}}if(n==1){var g=parseFloat($("discount_1").value);if(isNaN(g)||g<this.alg(m.mul(s.pricelist))){$("discount_1").value="";alert("你输入的特价金额不正确！");r=0}else{if(g>s.pricelist&&!this.discountCanLgOne){$("discount_1").value="";alert("特价金额不容许大于零售价！");r=0}}}if(n==2){var e=parseFloat($("discount_2").value);if(isNaN(e)||e<0||e>this.alg(s.pricelist.sub(m.mul(s.pricelist)))){$("discount_2").value="";alert("你输入的优惠金额不正确！");r=0}}}}}if(r==1){var d="";if(n==0){d=$("discount_0").value;d=isNaN(parseFloat(d))?0:parseFloat(d);f=d.mul(s.pricelist)}else{if(n==1){f=$("discount_1").value;d=isNaN(parseFloat(f))?0:parseFloat(f);d=s.pricelist==0?0:d.div(s.pricelist)}else{if(n==2){var c=parseFloat($("discount_2").value);c=isNaN(c)?0:c;f=(s.pricelist-c).toString();d=isNaN(parseFloat(f))?0:parseFloat(f);d=s.pricelist==0?0:d.div(s.pricelist)}}}var j=$("m_retail_idx").value;$("m_retail_idx").value="";if(this.offline==true&&isIE()){var p={};p.discount=d;this.manualupdateitem(this.tempretailid,p);this.clearchecked("from-main")}else{this.insertline_action("BPOS_CHANGAMT",s.productno,s.qty,s.type,"",f,d)}this.killAlert("amt_content")}},checkamount:function(c){var d=jQuery("#discount_"+c).val();if(d){d=parseFloat(d);if(isNaN(d)){alert("数字格式不正确！");jQuery("#discount_"+c).val("");jQuery("#discount_"+c).focus()}else{jQuery("#discount_"+c).val(d)}}},checkdiscount:function(){var c=jQuery("#discount_0").val();if(c){c=parseFloat(c);if(c<0||isNaN(c)){alert("折扣率不正确！");jQuery("#discount_0").val("");jQuery("#discount_0").focus()}else{if(c>0){if(1<c&&!this.discountCanLgOne){alert("折扣率不可大于1");jQuery("#discount_0").val("");jQuery("#discount_0").focus()}else{jQuery("#discount_0").val(c)}}}}},changamtaction:function(c,e){var d={};if(e){d.discount=e}else{d.discount=parseFloat(c.m_retail_discount)}this.manualupdateitem(this.tempretailid,d);this.clearchecked("from-main")},_changamt:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();this.changamtaction(c)},wholedis:function(c){return(MainApp.WholeDis(c)).evalJSON()},dowholedis:function(d){if((this.MODEL&this.WHOLEDIS)!=this.WHOLEDIS){return}if(!d){d=this.items_data}var g={};var c=new Array();for(i=0;i<d.length;i++){var e=d[i];var h={};h.cardno=this.vip.cardno||"1";h.c_store_id=this.master_data.c_store_id;h.billdate=$("sys_date").value;h.m_retail_productno=e.productno;h.m_retail_qty=e.qty;h.m_retail_type=e.type;h.m_retail_orgdocno=e.orgdocno;h.m_retail_priceactual=e.priceactual;h.m_retail_price=e.price;h.discount=e.discount;h.vipexp=this.vip.vipexp||"1";h.vipbir=this.vip.birthday||"";h.lineid=e.lineno;c.push(h)}g.Table=c;var f={};f.param=g;return this.wholedis(Object.toJSON(f))},clearitems:function(){this.items_data=new Array();jQuery("#from-main").html("")},handlewholedis:function(c){if(!this.checkCanDoWholeDis()){return}var d;if(c){d=this.dowholedis(c);this.temp_items_data=new Array()}else{d=this.dowholedis()}if(d.NewDataSet){this.tdefposdis_id=parseInt(d.NewDataSet.tdefposdis_id,10)||-1;this.tdefposdis_name=d.NewDataSet.tdefposdis_name||-1}if(d.NewDataSet&&d.NewDataSet.Table){var c=this.change2array(d.NewDataSet.Table);if(c.length>0){for(var e=0;e<c.length;e++){this.updateretdata2items_data(c[e],this.temp_items_data)}}}},getvoupayway:function(){var e=new Array();for(var d=0;d<this.master_data.payways.length;d++){var c=this.master_data.payways[d];if(c.is_vou=="Y"){e.push(c)}}return e},getconsumecardpayway:function(){var e=new Array();for(var d=0;d<this.master_data.payways.length;d++){var c=this.master_data.payways[d];if(c.isconsumecard=="Y"){e.push(c)}}return e},getvipcardpayway:function(){var d=new Array();for(var e=0;e<this.master_data.payways.length;e++){var c=this.master_data.payways[e];if(c.iscashcard=="Y"){d.push(c)}}return d},getticketpayway:function(){var e=new Array();for(var d=0;d<this.master_data.payways.length;d++){var c=this.master_data.payways[d];if(c.isticket=="Y"){e.push(c)}}return e},alertvisitantticketpage:function(e){var f=Alerts.fireMessageBox({width:401,modal:true,title:gMessageHolder.EDIT_MEASURE});var d=this.vipTicketName;if(e){d="消费卡"}var c=false;if(jQuery.trim(this.master_data.params.company)=="aokang"){c=true}f.innerHTML='<div class="xiao_content" id="xiao_content"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td><div class="xiao_td"><div id="treatment_text">请输入'+d+'信息：</div></div></td</tr><tr><td><div class="xiao_botder"><ul><li><div class="xiaoLeft">'+d+'号：</div><div class="xiaoRight"><input'+(e&&c?" readonly":"")+' color=\'red\' id="ticketno" name="" type="text"  class="payment-vipTxt" /></div></li>'+(e&&c?'<li><input name="刷卡" type="button" class="btn-ka" value="刷卡" onclick="bpos.aokangSwipeConsumeCard();" /></li>':(!e?'<li><div class="xiaoLeft">验&nbsp;证&nbsp;码：</div><div class="xiaoRight"><input name="" id="ticketpw" type="text"  class="payment-vipTxt" /></div></li>':""))+'</ul></div></td></tr><tr><td><div id="treatment_td" align="center"><div id="treatment_text">&nbsp;<input type="button" value="确定" onclick="bpos.dealticket('+e+');" class="qinput" id="xiao_ok"/>&nbsp;<input name="Submit" type="button" onclick="Alerts.killAlert($(\'xiao_content\'));" class="qinput" id="xiao_cancel" value="取消" /></div></div></td></tr></table></div>';this.executeLoadedScript(f);var h=$("ticketpw");if(!h){h=$("ticketno")}h.focus();var g=jQuery("#ticketpw,#xiao_ok,#xiao_cancel",$("xiao_content"));if(!c){jQuery("#ticketno").bind("keyup",function(j){if(j.which==13){bpos.dealticket(e)}})}jQuery("#xiao_content").bind("keyup",function(l){if(l.which==9){l.stopPropagation();l.preventDefault();var j=g.index(h);j++;if(!g[j]){j=0}h=g[j];h.focus()}else{if(l.which==13){var m=l.target;if(m.value&&m!=$("xiao_cancel")){if($("ticketpw")&&!$("ticketpw").value){$("ticketpw").focus()}else{$("xiao_ok").focus()}}}}})},dealticket:function(e){jQuery("#xiao_content input[type='button']").attr("disabled","true");if(e){var f=jQuery.trim($("ticketno").value);var h=$("store_id")?$("store_id").value:-1;if(f==""){alert("错误：请输入卡信息！");jQuery("#xiao_content input[type='button']").removeAttr("disabled");return}jQuery.ajax({type:"POST",url:this.URL+"getConsumeCardInfo.jsp",timeout:3000,data:"cn="+f+"&storeid="+h,error:function(){alert("网络不畅,请稍后再试！");jQuery("#xiao_content input[type='button']").removeAttr("disabled")},success:function(l){jQuery("#xiao_content input[type='button']").removeAttr("disabled");l=jQuery.trim(l);if(l.indexOf("cardinfo")!=-1){var j=l.replace("cardinfo:","");j=parseFloat(j);if(isNaN(j)||j<=0){alert("余额不足")}else{bpos._ondealconsumecard(f,j)}}else{alert(l)}}});return}var c={};c.command="DBJSON";c.callbackEvent="BPOS_CHECKTICKET";var f="-1";var d=jQuery.trim($("ticketpw").value);if(d==""){alert("错误：信息不能为空！");jQuery("#xiao_content input[type='button']").removeAttr("disabled");return}var g={ticketno:f,ticketpw:d,c_store_id:this.master_data.c_store_id};c.param=Object.toJSON(g);c.table="m_retail";c.action="check_ticket";c.permission="r";this._executeCommandEvent(c)},updateConsumeCardsArray:function(f,e){for(var d=0;d<this.consumecards.length;d++){if(this.consumecards[d].cardno==f){return}}var c={};c.cardno=f;c.remCash=e;this.consumecards.push(c)},getConsumeCardRemCashByCardNo:function(d){for(var c=0;c<this.consumecards.length;c++){if(this.consumecards[c].cardno==d){return this.consumecards[c].remCash}}return 0},getPayAmountByConsumeCardno:function(d){var e=0;for(var c=0;c<this.payment.length;c++){if(jQuery.trim(this.payment[c].remark)==d){e=e.add(this.payment[c].num)}}return e},getRemAmountByConsumeCardno:function(c){var e=this.getPayAmountByConsumeCardno(c);var d=this.getConsumeCardRemCashByCardNo(c);return d.sub(e)},showPayConsumeCardHtml:function(h,e,n,g){var d="消费卡";var f="卡号";var j=this.getRemAmountByConsumeCardno(h);var l=true;if(g){d="购物券";f="券号";j=e;if(this.vouinfo.changeItemsPrice){l=false}}var c=j>n?n:j;var m=Alerts.fireMessageBox({width:400,modal:true,title:d});m.innerHTML='<div id="consumecardalert"><div class="sumfooter"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td><div>'+f+"：<span style='color=red'>"+h+"</span> 可用余额：<span style='color=red'>"+j+'</span></div></td></tr><tr><td><div><div>请输入金额:<input id="consumeprice" type="text" size="50" class="q_input" /></div><div id="consume-info"> 应付：'+n+'</div><input id="consumetempx" type="hidden" size="50" /></div></td></tr><tr><td><div align="center"><div>&nbsp;<input type="button" value="确定" class="qinput" onclick="bpos.dealconsumepay('+c+",'"+h+"',"+g+');"  id="returnconsume"/>'+(l?'<input type="button" value="取消" class="qinput" onclick="bpos.cancleconsume();"  id="cancleconsume"/>':"")+"</div></td></tr></table></div></div>";this.executeLoadedScript(m);this.noAlert=false;$("consumeprice").value=c;dwr.util.selectRange($("consumeprice"),0,30);jQuery("#consumeprice").bind("keyup",function(o){if(o.target==this&&o.which==13){jQuery("#returnconsume").click()}});jQuery("#consumeprice").bind("blur",function(o){jQuery("#consumeprice").val(bpos.alg(jQuery("#consumeprice").val(),true,2))})},killconsumepopup:function(){this.killAlert("consumecardalert");this.killAlert("xiao_content");this.killAlert("vouPayType");this.noAlert=false;dwr.util.selectRange($("currpay"),0,20)},cancleconsume:function(){this.tempvou={};this.vouinfo={};this.killconsumepopup()},dealconsumepay:function(c,m,l){var j=this.alg(parseFloat($("consumeprice").value),true,2);if(isNaN(j)||j<=0||j>c){alert("错误：价格无法解析或超出范围");return}this.evaluatepayitem(this.payitem,this.temppayitem);var d;var f;var e=0;if(l){f=this.voupayways[0].id;for(var h=0;h<this.voupayways.length;h++){if(this.voupayways[h].id==jQuery("#payselect").val()){f=jQuery("#payselect").val();e=h;break}}}else{f=this.consumecardpayways[0].id;for(var h=0;h<this.consumecardpayways.length;h++){if(this.consumecardpayways[h].id==jQuery("#payselect").val()){f=jQuery("#payselect").val();e=h;break}}}d=this.checkpayway(f);this.updatepayitem(d,j);if(this.CheckIsOK(this.payitem)){bxl.pay();var n=this.getpayableprice();var g;if(l){g=this.voupayways[e].name;this.vouinfo.payAl=j}else{g=this.consumecardpayways[e].name}this.handlepaypricewhencheckisok(g,j,m);$("payselect").selectedIndex=0;this.killconsumepopup()}else{this.evaluatepayitem(this.temppayitem,this.payitem);dwr.util.selectRange($("consumeprice"),0,30);$("discription").value=""}},_ondealconsumecard:function(e,d){if(this.consumecardpayways.length==0){alert("错误：未定义消费卡付款方式");return}this.updateConsumeCardsArray(e,d);var c=this.getpayableprice();this.showPayConsumeCardHtml(e,d,c)},getpayableprice:function(){return(this.payitem.TotalAmount).sub(this.gettotpayamount())},_ondealticket:function(q){var n=q.getUserData();var r=n.jsonResult.evalJSON();jQuery("#xiao_content input[type='button']").removeAttr("disabled");if(r.code&&r.code=="-1"){alert(r.msg);dwr.util.selectRange($("ticketpw"),0,30)}else{for(var o=0;o<bpos.ticketnos.length;o++){if(bpos.ticketnos[o]==r.code){alert("同一"+this.vipTicketName+"只能使用一次！");return}}if(this.ticketpayways.length==0){alert("未定义"+this.vipTicketName+"付款方式！");return}var p=jQuery.trim(r.isviponly);var d=jQuery.trim(r.isvip);var c=parseInt(r.vipid,10);if(p=="Y"&&!(this.vip&&this.vip.vip_id)){alert("该"+this.vipTicketName+"只能用于VIP用户！");return}if(d=="Y"&&!(this.vip&&this.vip.vip_id==c)){alert("该"+this.vipTicketName+"为专属VIP使用!");return}var m=parseFloat(r.data);jQuery("#ticketno").val(r.code);var l=this.ticketpayways[0].id;var g=0;for(var h=0;h<this.ticketpayways.length;h++){if(this.ticketpayways[h].id==jQuery("#payselect").val()){l=jQuery("#payselect").val();g=h;break}}var f=this.checkpayway(l);this.evaluatepayitem(this.payitem,this.temppayitem);this.updatepayitem(f,m);if(this.CheckIsOK(this.payitem)){bxl.pay();var s=this.getpayableprice();this.handlepaypricewhencheckisok(this.ticketpayways[g].name,m,r.code);$("payselect").selectedIndex=0;bpos.ticketnos.push(r.code);Alerts.killAlert($("xiao_content"))}else{this.evaluatepayitem(this.temppayitem,this.payitem);dwr.util.selectRange($("ticketno"),0,30);$("discription").value=""}}},checkOrderHasDis:function(){if(this.hasWholeDis){return true}var c=this.gettotdata();if(c.totprice<c.totpricelist){return true}return false},handlevou:function(){if(this.payitem.TotalAmount<this.getpaymentamount()){alert("已付金额大于应付金额，不可再付！");return}if(this.vouinfo&&this.vouinfo.isListLimit){alert("同笔单据只能使用一次购物券！");return}if(this.gettotpayamount()>0){alert("使用购物券前不能使用其他付款方式！");return}this.alertvoupage()},alertvoupage:function(){var c="购物券";var d=Alerts.fireMessageBox({width:401,modal:true,title:gMessageHolder.EDIT_MEASURE});d.innerHTML='<div class="xiao_content2" id="xiao_content"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td colspan=4><div class="xiao_td2"><div id="treatment_text">请输入'+c+'信息：</div></div></td></tr><tr><td colspan=4><div class="xiao_botder2"><ul><li><div class="xiaoLeft">'+c+'号：</div><div class="xiaoRight"><input color=\'red\' id="ticketno" name="" type="text"  class="payment-vipTxt" /></div></li></ul></div></td></tr><tr class="emtb"><td width="80" align="right">类型:</td><td width="110"><span id="vouType"></span></td><td width="90" align="right">姓名:</td><td width="110"><span id="epeName"></span></td></tr><tr class="emtb"><td width="80" align="right">折后限额:</td><td width="110"><span id="accountLimit"></span></td><td width="90" align="right">有效期:</td><td width="110"><span id="validDate"></span></td></tr><tr class="emtb"><td width="80" align="right">工号:</td><td width="110"><span id="epeNo"></span></td><td width="90"  align="right"><span style="display:none">账户金额:</span></td><td  width="110"><span style="display:none" id="amtAcount"></span></td></tr><tr><td colspan=4><div id="treatment_td" align="center"><div id="treatment_text">&nbsp;<input type="button" value="确定" onclick="bpos.confirmedVou();" class="qinput" id="xiao_ok"/>&nbsp;<input name="Submit" type="button" onclick="Alerts.killAlert($(\'xiao_content\'));" class="qinput" id="xiao_cancel" value="取消" /></div></div></td></tr></table></div>';this.executeLoadedScript(d);var f=$("ticketpw");if(!f){f=$("ticketno")}f.focus();var e=jQuery("#ticketpw,#xiao_ok,#xiao_cancel",$("xiao_content"));jQuery("#ticketno").bind("keyup",function(g){if(g.which==13){bpos.dealvou()}});jQuery("#xiao_content").bind("keyup",function(h){if(h.which==9){h.stopPropagation();h.preventDefault();var g=e.index(f);g++;if(!e[g]){g=0}f=e[g];f.focus()}else{if(h.which==13){var j=h.target;if(j.value&&j!=$("xiao_cancel")){$("xiao_ok").focus()}}}})},dealvou:function(){jQuery("#xiao_content input[type='button']").attr("disabled","true");var c=jQuery.trim($("ticketno").value);var d=$("store_id")?$("store_id").value:-1;if(c==""){alert("错误：请输入卡信息！");jQuery("#xiao_content input[type='button']").removeAttr("disabled");return}jQuery.ajax({type:"POST",url:this.URL+"getConsumeCardInfo.jsp",timeout:3000,data:"cn="+c+"&storeid="+d+"&isvou=true",error:function(){alert("网络不畅,请稍后再试！");jQuery("#xiao_content input[type='button']").removeAttr("disabled")},success:function(f){jQuery("#xiao_content input[type='button']").removeAttr("disabled");f=jQuery.trim(f);var e=f.evalJSON();if(e.code&&e.code==200){bpos._ondealvou(e.meg)}else{alert(e.meg)}}})},checkvoucandis:function(c){if(!c){c=this.gettotdata()}var d;if(this.vouinfo.qtyLimit>0&&c.totqty>this.vouinfo.qtyLimit){return false}if(this.vouinfo.isListLimit=="Y"){d=(c.totpricelist).mul(parseFloat(this.vouinfo.vouDis))}else{d=(c.totprice).mul(parseFloat(this.vouinfo.vouDis))}if(parseFloat(this.vouinfo.accountLimit)>=d&&this.vouinfo.vouDis<1&&this.gettotpayamount()==0){return true}else{return false}},showVouInfo:function(c){jQuery("#vouType").html(c.vouType||"");jQuery("#epeNo").html(c.epeNo||"");jQuery("#epeName").html(c.epeName||"");jQuery("#amtAcount").html(c.amtAcount||"");jQuery("#validDate").html(c.validDate||"");jQuery("#accountLimit").html(c.accountLimit||"")},checkvoucanpayprice:function(){if(this.vouinfo.amtAcount>0&&this.gettotpayamount()==0){return true}return false},checkVouPayType:function(){var e=this.vouinfo.isAccayAfterDis=="N"?false:true;var c=e?"checkbox":"radio";var f='<div id="vouPayType" class="xiao_content"><table width="300" border="0" cellspacing="0" cellpadding="0"><tr><td><div class="xiao_td"><div id="treatment_text">请选择使用方式：</div></div></td></tr><tr><td><div class="xiao_botder"><ul><li><div class="xiaoLeft"><input id="vouCanPay" checked="true" value="canPay" name="vouPayType" type="'+c+'"/></div><div class="xiaoRight">使用账户金额</div></li><li><div class="xiaoLeft"><input name="vouPayType" value="canDis" id="vouCanDis" type="'+c+'" /></div><div class="xiaoRight">使用折后限额</div></li></ul></div></td></tr><tr><td><div  class="VIP-td" align="center">&nbsp;<input type="button" value="确定"  class="qinput" id="vouPayTypeOk"/>&nbsp;<input name="Submit" type="button" id="vouPayTypeCancel"  class="qinput" value="取消" /></div></td></tr></table></div>';var d=Alerts.fireMessageBox({width:300,modal:true,title:gMessageHolder.EDIT_MEASURE});d.innerHTML=f;this.executeLoadedScript(d);this.noAlert=false;$("vouCanPay").focus();jQuery("#vouPayTypeOk").bind("click",function(){bpos.vouinfo.canDis=jQuery("#vouCanDis").is(":checked");bpos.vouinfo.canPay=jQuery("#vouCanPay").is(":checked");if(!bpos.vouinfo.canDis&&!bpos.vouinfo.canPay){alert("必须选择一种方式！");return}bpos.doVouPay()});jQuery("#vouPayTypeCancel").bind("click",function(){bpos.killAlert2("vouPayType")})},doVouPay:function(){var f;var e=this.vouinfo.vouDis;var d=this.gettotdata(this.temp_items_data);if(this.vouinfo.isListLimit=="Y"){f=(d.totpricelist).mul(parseFloat(this.vouinfo.vouDis))}else{f=(d.totprice).mul(parseFloat(this.vouinfo.vouDis))}this.vouinfo.changeItemsPrice=false;if(this.vouinfo.canDis||(this.vouinfo.isListLimit=="Y"&&d.totpricelist!=d.totprice)){if(!this.vouinfo.canDis){f=d.totpricelist;e=1}else{this.vouinfo.useDis=true}if(this.vouinfo.isListLimit=="Y"){this.handlewholediscount(this.temp_items_data,e,f,d.totprice)}else{this.dodiscountwithamount(this.temp_items_data,e,f,d.totprice)}this.initpaypriceAmount(this.temp_items_data);this.initpaypricehtml(f);this.vouinfo.changeItemsPrice=true}if(!this.vouinfo.canPay){$("payselect").selectedIndex=0;this.killconsumepopup();return}var c=this.getpayableprice();this.showPayConsumeCardHtml(this.vouinfo.vouNo,this.vouinfo.amtAcount,c,true)},confirmedVou:function(){this.vouinfo=this.tempvou;this.vouinfo.payAl=0;this.vouinfo.useDis=false;this.vouinfo.qtyLimit=isNaN(parseInt(this.vouinfo.qtyLimit,10))?0:parseInt(this.vouinfo.qtyLimit,10);var d=this.gettotdata(this.temp_items_data);var c=this.checkvoucandis(d);var e=this.checkvoucanpayprice();if(!c&&!e){alert("不能使用！");return}this.vouinfo.canDis=c;this.vouinfo.canPay=e;if(c&&e){this.checkVouPayType()}else{this.doVouPay()}},_ondealvou:function(c){if(c.isValid=="N"){alert("该购物券已被使用！");return}if(parseInt(c.sysDate)>parseInt(c.validDate)){alert("购物券已过期，使用截止时间："+c.validDate);return}this.showVouInfo(c);jQuery("#xiao_ok").focus();this.tempvou=c},handlevisitantticket:function(c){if(this.payitem.TotalAmount<this.getpaymentamount()){alert("已付金额大于应付金额，不可再付！");return}if(!c&&this.hasWholeDis&&!this.canUseTicketWhenWholeDis){alert("整单策略不可使用"+this.vipTicketName+"！");return}if(!c&&this.master_data.params.ticketnodis=="true"&&this.checkOrderHasDis()){alert("打折商品不可使用"+this.vipTicketName+"！");return}this.alertvisitantticketpage(c)},getAllOrgPayWays:function(){var h=new Array();for(var e=0;e<this.items_data.length;e++){var g=this.items_data[e];var f=this.value2type(g.type);if(f=="退货"){if(g.org_payways!=-1&&g.org_payways.length>0){h=h.concat(g.org_payways)}}}if(h.length>0){var l=new Array();a:for(var d=0;d<h.length;d++){for(var c=0;c<l.length;c++){if(l[c].id==h[d]){continue a}}for(var m=0;m<this.master_data.payways.length;m++){if(h[d]==this.master_data.payways[m].id){l.push(this.master_data.payways[m]);break}}}return l}else{return this.master_data.payways}},getPayWays:function(c){if(c>0){return this.master_data.payways}else{return this.getAllOrgPayWays()}},importpayways:function(g){var h=this.getPayWays(g);b:for(var e=0;e<h.length;e++){var d=h[e];if(this.master_data.params.company&&jQuery.trim(this.master_data.params.company)=="bsw"){if(d.name.search(/OK卡/i)!=-1){for(var f=0;f<this.items_data.length;f++){if(this.items_data[f].m_dim1&&this.items_data[f].m_dim1.search(/OK卡/i)!=-1){continue b}}}}var c=document.createElement("OPTION");c.innerHTML=d.name;c.value=d.id;$("payselect").appendChild(c)}$("payselect").style.visibility="visible";var j;jQuery("#payselect option[text="+this.master_data.params.defaultPayway+"]").attr("selected","true");jQuery("#payselect").bind("change",function(p){if(p.target==this){for(var o=0;o<bpos.voupayways.length;o++){if(this.value==bpos.voupayways[o].id){bpos.handlevou();return}}for(var m=0;m<bpos.ticketpayways.length;m++){if(this.value==bpos.ticketpayways[m].id){bpos.handlevisitantticket();return}}for(var n=0;n<bpos.consumecardpayways.length;n++){if(this.value==bpos.consumecardpayways[n].id){bpos.handlevisitantticket(true);return}}}})},initvipcosume:function(c){if(!c){c=this.vipaccount}jQuery("#vip_cardno").html(this.vip.cardno);jQuery("#vip_money").html(this.changenumber2yuan(c.amount));jQuery("#vip_paymoney").html(this.changenumber2yuan(this.payitem.TotalAmount));jQuery("#vip_pay").html(this.changenumber2yuan(this.payitem.TotalAmount.sub(this.gettotpayamount())));jQuery("#vip_currpay").val(this.formatint2float(this.payitem.TotalAmount.sub(this.gettotpayamount())))},loadpaypricepage:function(){var d=Alerts.fireMessageBox({width:620,modal:true,title:gMessageHolder.EDIT_MEASURE});d.innerHTML=$("pay").innerHTML.replace(/TMP/g,"").replace("VIP付款",this.vipPayTypeName);this.executeLoadedScript(d);var c="";$("next").disabled=true;if(this.checkUseSms()){c='<input type="button" value="找回密码" id="retailSms" onclick="bpos.smsVip();" class="qinput"/>'}if(c){jQuery("#vip_psw").after(c)}if(this.vip.vip_id&&this.vip.ifcharge=="Y"&&this.checkIsOnline()){jQuery("#v").show();jQuery.post(this.URL+"getvipinfo.jsp",{vipno:bpos.vip.cardno},function(e){if(jQuery.trim(e)!="error"){var f=e.evalJSON();f.cardno=bpos.vip.cardno;bpos.vipaccount=f;bpos.initvipcosume(f)}else{alert("该VIP账户不可用！")}})}jQuery("#v").bind("click",function(){bpos.initvipcosume()});jQuery("#vip_currpay,#vip_psw").bind("keydown",function(f){var e=parseFloat(jQuery.trim(this.value));if(f.which==13&&f.target==this){if(this.id=="vip_currpay"){if(bpos.checkvipaccount(e)){dwr.util.selectRange($("vip_psw"),0,30)}}else{if(this.id=="vip_psw"){$("vip_btn-search").focus()}}}});jQuery("#vip_btn-search").bind("click",function(){var e=parseFloat(jQuery.trim($("vip_currpay").value));var f=jQuery.trim($("vip_psw").value);jQuery.post(bpos.URL+"checkvippw.jsp",{cardno:bpos.vipaccount.cardno,pw:f},function(g){if(jQuery.trim(g)=="true"){bpos.handlevippayway(e)}else{alert("密码错误或当前操作员无权限！")}})});jQuery("#m").bind("click",function(){if(!jQuery("#m").is(":visible")){bpos.initpaypricehtml(bpos.payitem.TotalAmount)}});this.noAlert=false},evaluatepayitem:function(d,c){c.TotalAmount=d.TotalAmount;c._totalNoCashNoCharge=d._totalNoCashNoCharge;c._totalCashNoCharge=d._totalCashNoCharge;c._totalVipCharge=d._totalVipCharge;c._totalCashCharge=d._totalCashCharge},handlevippayway:function(c){if(isNaN(c)){alert("请输入正确价格！");return}if(!this.checkvipaccount(c)){return}if(this.cashcardpayways.length==0){alert("未定义"+this.vipPayTypeName+"方式");return}var g=this.cashcardpayways[0].id;var d=0;for(var f=0;f<this.cashcardpayways.length;f++){if(this.cashcardpayways[f].id==jQuery("#payselect").val()){g=jQuery("#payselect").val();d=f;break}}var e=this.checkpayway(g);this.evaluatepayitem(this.payitem,this.temppayitem);this.updatepayitem(e,c);if(this.CheckIsOK(this.payitem)){bxl.pay();this.handlepaypricewhencheckisok(this.cashcardpayways[d].name,c);this.vipaccount.amount-=c}else{this.evaluatepayitem(this.temppayitem,this.payitem);dwr.util.selectRange($("vip_currpay"),0,30);$("discription").value=""}},checkvipaccount:function(c){if(this.vipaccount.amount&&this.vipaccount.amount>=0){if(isNaN(c)){alert("请输入正确的金额！");return false}if(c>this.vipaccount.amount){alert("余额不足！");$("vip_currpay").value=this.vipaccount.amount;return false}return true}else{if(this.vipaccount.amount<=0){alert("VIP账户无余额！");return false}else{alert("VIP账户不可用");return false}}},killcomfirmvipdis:function(){this.killAlert("comfirmvipdis");this.tempvipdis=null},initconfirmvipdishtml:function(r){var p=this.gettotdata();var l;var e=false;if((r.distype=="CON"&&(this.master_data.params.integralDisBasePrice&2)==2)||(r.distype=="DIS"&&(this.master_data.params.integralDisBasePrice&1)==1)){l=p.totpricelist;e=true}else{l=p.totprice}var y=p.totpricelist;var t=y.mul(r.discountlimit);var g=l.sub(t)<0?0:l.sub(t);var m={};m.distype=r.distype;m.c_integralmin_id=r.id;m.isclear=r.isclear;m.discountlimit=r.discountlimit;m.integral=r.integral;m.basePriceList=e;var f;var x;var j;var h;if(r.isclear=="N"){m.totintegral=0}if(m.distype=="CON"){j=Math.floor(this.vip.integral.div(r.integral));h=g.div(r.content);j=Math.min(j,h);if(r.ismused=="N"){m.content=r.content}if(r.isclear=="Y"&&r.ismused=="N"){m.totintegral=r.integral}}else{if(m.distype=="DIS"){m.content=l.sub(l.mul(r.content>r.discountlimit?r.content:r.discountlimit));if(r.isclear=="Y"){m.totintegral=r.integral}}}var n=new Array();var c=true;if(m.distype=="CON"&&r.isclear=="Y"&&r.ismused=="Y"){j=Math.ceil(j);f='<input id="vipdisintegral" style="width:80px;border-color: #002f55 #6986a0 #6986a0 #002f55;border-style: solid;border-width: 1px;background-color: #DAE3EA;height: 18px;"/>';x='<span id="vipdiscountent"></span>';for(var v=1;v<=j;v++){var q=r.content.mul(v)>g?g:r.content.mul(v);var u={};u.intl=r.integral.mul(v)+"";u.cont=q;n.push(u)}}else{if(m.content>g){if(!confirm("积分抵扣金额为："+m.content+"，本单可抵扣金额为："+g+"。是否继续执行？")){return}m.content=g}f=m.totintegral;x='<span id="vipdiscountent">'+m.content+"</span>";c=false}var d='<div id=\'comfirmvipdis\' class="vip-back"><div class="vip-detail">&nbsp;&nbsp;共消费积分'+f+"，抵扣"+x+'元。<br />&nbsp;&nbsp;是否执行？</div><div class="vip-input">&nbsp;<input type="button" value="确定" class="qinput" id="vipdisyes"/>&nbsp;<input name="Submit" onclick="bpos.killcomfirmvipdis();" type="button" class="qinput" value="取消" id="vipdisno"/></div></div>';var o=Alerts.fireMessageBox({width:447,modal:true,title:"请确认！"});o.innerHTML=d;this.executeLoadedScript(o);this.noAlert=false;m.disitems=n;this.tempvipdis=m;if(c){jQuery("#vipdisintegral").focus();jQuery("#vipdisintegral").bind("keyup",function(z){if(z.which==13&&jQuery.trim(jQuery("#vipdisintegral").val())){jQuery("#vipdisyes").focus()}})}else{jQuery("#vipdisyes").focus()}var w=jQuery("#vipdisyes,#vipdisno");var s=jQuery("#vipdisyes")[0];jQuery("#vipdisyes").bind("click",function(D){if($("vipdisintegral")){var A=$("vipdisintegral").value;var z=jQuery("#vipdiscountent").html();var B=bpos.tempvipdis.disitems;var C=false;for(var E=0;E<B.length;E++){if(B[E].intl==A&&B[E].cont==z){C=true;break}}if(!C){alert("请填写正确的值！");return}}bpos.executevipdis()});jQuery("#comfirmvipdis").bind("keydown",function(A){if(A.which==9){A.stopPropagation();A.preventDefault();if(s){var z=0;if(w.index(s)==0){z=1}s=w[z];jQuery(s).focus()}}else{if(A.which==37){jQuery(w[0]).focus()}else{if(A.which==39){jQuery(w[1]).focus()}}}});if(c){jQuery(function(){jQuery("#vipdisintegral").autocomplete(n,{max:12,minChars:0,width:150,scrollHeight:300,matchContains:true,mustMatch:true,autoFill:true,formatItem:function(B,A,z){return"积分:"+B.intl+";抵扣："+B.cont},formatMatch:function(B,A,z){return B.intl},formatResult:function(z){return z.intl}}).result(function(z,B,A){bpos.tempvipdis.content=parseFloat(B.cont);bpos.tempvipdis.totintegral=parseFloat(B.intl);jQuery("#vipdiscountent").html(B.cont)})})}},copyJsonObject:function(d){var c=Object.toJSON(d);return c.evalJSON()},copyitems_data2temp_items_data:function(){this.temp_items_data=this.copyJsonObject(this.items_data)},executevipdis:function(){if(!(this.tempvipdis&&(this.tempvipdis.content||this.tempvipdis.content==0)&&(this.tempvipdis.totintegral||this.tempvipdis.totintegral==0)&&jQuery("#vipdiscountent").html())){alert("输入内容错误，未找到匹配项！");return}this.copyitems_data2temp_items_data();var c=this.gettotdata();var d=c.totprice;if(this.tempvipdis&&this.tempvipdis.basePriceList){d=c.totpricelist}if(this.tempvipdis){var e=(1).sub(d==0?0:(this.tempvipdis.content.div(d)));if(!this.tempvipdis.basePriceList){this.dodiscountwithamount(this.temp_items_data,e,d.sub(this.tempvipdis.content),d)}else{this.handlewholediscount(this.temp_items_data,e,d.sub(this.tempvipdis.content),d)}this.killAlert("comfirmvipdis");this.killAlert("VIPDISINFO");this.payprice(this.temp_items_data)}},validateVipPw:function(){if(jQuery("#vippwd").val()){var c=jQuery("#vippwd").val();if(jQuery.trim(c)==this.vip.pass_word){this.killAlert("vip_validate");this.initconfirmvipdishtml(this.t_vipdis)}else{alert("密码不正确")}}},validateVipPwHtml:function(){var c="";if(this.checkUseSms()){c='<input type="button" value="找回密码" id="retailSms" onclick="bpos.smsVip();" class="qinput"/>'}var d=Alerts.fireMessageBox({width:400,modal:true,title:gMessageHolder.EDIT_MEASURE});d.innerHTML='<div id="vip_validate"><table width="400" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="user_botder"><ul><li><div class="user-left">请输入密码：</div><div class="user-right"><input id="vippwd" name="vippwd" type="password" class="user-input" /></div></li></ul></div></div></td></tr> <tr><td><div id="treatment_td" align="center"><div id="treatment_text">&nbsp;'+c+'&nbsp;<input type="button" value="确定" class="qinput" id="btn-oks" onclick="bpos.validateVipPw()"/>&nbsp;<input name="cancle" id="btn-c" type="button" class="qinput" value="取消" onclick="javascript:bpos.killAlert(\'vip_validate\')" /></div></td></tr></table></div>';this.executeLoadedScript(d);this.noAlert=false;jQuery("#vippwd").focus();jQuery("#vippwd").bind("keydown",function(e){if(e.which==13){bpos.validateVipPw()}})},dealvipdis:function(c){this.t_vipdis={};if(c){this.t_vipdis=c;if(this.master_data.params.validateVipPw=="false"){this.initconfirmvipdishtml(c)}else{this.validateVipPwHtml()}}},dovipdis:function(){var c=jQuery("#VIPDISINFO input:checked[type='radio']")[0];if(c){var f=parseInt(c.id.replace("vipdis-",""),10);var e;for(var d=0;d<this.vipdisinfo.length;d++){if(this.vipdisinfo[d].id==f){e=this.vipdisinfo[d]}}this.dealvipdis(e)}},killvipdisinfo:function(){this.killAlert("VIPDISINFO");this.tempvipdis=null},initpaypricehtml:function(d){var c=this.changenumber2yuan(this.alg(d,true));jQuery("#payable").html(c);jQuery("#unpaidamount").html(c);jQuery("#currpay").val(this.formatint2float(this.alg(d,true)));jQuery("#paidamount").html(this.changenumber2yuan(this.gettotpayamount()));jQuery("#charge").html(this.changenumber2yuan(this.change));dwr.util.selectRange($("currpay"),0,20);if(this.alg(d,true)==0){jQuery("#next").removeAttr("disabled")}},initintegralpayhtml:function(){var e='<div id="VIPDISINFO" class="VIPpromotion"><div class="VIPpromtion-title">VIP卡号：'+this.vip.cardno+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIP可用积分："+this.vip.integral+'</div><div class="VIPpromtion-table"><div class="VIPpromtion-table-head"><div class="VIPpromtion-span-1">&nbsp;</div><div class="VIPpromtion-span-2">活动名称</div><div class="VIPpromtion-span-3">积分</div><div class="VIPpromtion-span-3">是否重复</div></div></div><div id="VIPpromtion-main" class="VIPpromtion-sidebar" style="height: 202px; width: 600px; visibility: visible; opacity: 1;">';for(var f=0;f<this.vipdisinfo.length;f++){e+="<div class="+(f%2==0?'"VIPpromtion-row"':'"VIPpromtion-conduct"')+'><div class="VIPpromtion-'+(f%2==0?"row":"conduct")+'-line"><div class="VIPpromtion-span-1"><input type="radio" id="vipdis-'+this.vipdisinfo[f].id+'" value="" name="checkvipdis" '+(f==0?'checked="checked"':"")+' /></div><div class="VIPpromtion-span-2">'+this.vipdisinfo[f].name+'</div><div class="VIPpromtion-span-3">'+this.vipdisinfo[f].integral+'</div><div class="VIPpromtion-span-4">'+(this.vipdisinfo[f].ismused=="Y"?"是":"否")+"</div></div></div>"}e+='</div><div  class="VIPpromtion-Input">&nbsp;<input type="button" value="确定" onclick="bpos.dovipdis();" class="qinput" id="VIPPRO"/>&nbsp;<input type="button" onclick="bpos.killvipdisinfo()" class="qinput" value="取消" id="VIPCANC" /></div></div>';var j=Alerts.fireMessageBox({width:600,modal:true,title:"可参加积分活动"});j.innerHTML=e;this.executeLoadedScript(j);this.noAlert=false;var d=jQuery("#VIPDISINFO input[type='radio'][id^='vipdis-']");var c=d[0];var h=$("VIPPRO");h.focus();var g=jQuery("#VIPPRO,#VIPCANC");jQuery("#VIPDISINFO").bind("keyup",function(m){if(m.which==40){if(c){var l=0;l=d.index(c)+1;if(!d[l]){l=0}c=d[l];jQuery(c).attr("checked","true")}}else{if(m.which==38){if(c){var l=d.length-1;l=d.index(c)-1;if(!d[l]){l=d.length-1}c=d[l];jQuery(c).attr("checked","true")}}else{if(m.which==13){if(d.index(c)!=-1){jQuery("#VIPPRO").click()}}else{if(m.which==9){m.stopPropagation();m.preventDefault();var n=0;if(h){n=g.index(h)+1}if(g[n]&&g[n].disabled==true){n++}if(!g[n]){n=0}h=g[n];h.focus()}}}}})},integralpay:function(){if(!this.vip.cardno){alert("未录入VIP，不可使用积分付款！");return}if(this.items_data.length===0){alert("没有零售商品，不可使用积分付款");return}if(!this.checkCanDo("integralpay")){alert("VIP或其他未达到积分付款条件！");return}var c=this.gettotdata().totcommonqty;jQuery.ajax({type:"POST",url:this.URL+"getvipdisinfo.jsp?storeid="+bpos.master_data.c_store_id+"&viptypeid="+bpos.vip.c_viptype_id+"&integral="+bpos.vip.integral+"&qty="+c,timeout:3000,error:function(){alert("网络不畅,请稍后再试！")},success:function(d){d=jQuery.trim(d);if(d!="error"&&d!="none"){bpos.vipdisinfo=d.evalJSON();bpos.vipdisinfo.pop();bpos.initintegralpayhtml()}else{if(d=="error"){alert("长时间未操作，信息已失效；请重新登录！")}else{if(d=="none"){alert("没有适合的积分消费活动！")}else{if(d=="error2"){alert("无法获取活动信息！")}}}}}})},readypay:function(){this.loadpaypricepage();this.importpayways(this.payitem.TotalAmount);this.initpaypricehtml(this.payitem.TotalAmount);var d=0;var f=$("payselect").options.length-1;var e=$("currpay");var c=jQuery("#currpay,#next,#re,#cancle",$("payment_content"));jQuery("#payment_content").bind("keydown",function(g){if(g.which==38||g.which==40){g.stopPropagation();g.preventDefault();if(g.which==38){d--;if(d<0){d=f}}else{if(g.which==40){d++;if(d>f){d=0}}}$("payselect").selectedIndex=d}if(g.which==9){g.stopPropagation();g.preventDefault();e=bpos.tabKeydown(c,e)}});jQuery("#currpay").bind("keydown",function(j){if(j.target==this&&j.which==13){j.stopPropagation();j.preventDefault();var h=parseFloat($("currpay").value);if(h!=bpos.alg(h,true,2)){$("discription").innerHTML="付款金额不符合进位要求，系统自动进位！";h=bpos.alg(h,true,2)}var g=parseFloat(jQuery("#unpaidamount").html().replace("￥",""));var l=parseFloat(jQuery("#paidamount").html().replace("￥",""));l=isNaN(l)?0:l;g=isNaN(g)?0:g;h=isNaN(h)?0:h;if(h!=0){bpos.insertpayment()}else{if(h==0&&g==0&&l==bpos.payitem.TotalAmount){$("currpay").disabled=true;$("next").focus()}else{dwr.util.selectRange($("currpay"),0,30)}}}})},tabKeydown:function(c,f){for(var e=0;e<c.length;e++){var d=c.index(f);d++;if(!c[d]){d=0}if(c[d]&&c[d].disabled==true){d++}f=c[d];if(f.disabled!=true){f.focus();return f}}},checkaddvip:function(){var d=$("zody_vip_input").value;if(!d||jQuery.trim(d)==""){alert("请输入VIP卡号！");return}var c={};c.command="DBJSON";c.callbackEvent="BPOS_CHECKADDVIP";var e=new Array();var f=new Array();e.push("vip");f.push(jQuery.trim(d));var g={ptype:e,pvalue:f,storeid:this.master_data.c_store_id};c.param=Object.toJSON(g);c.table="m_retail";c.action="load_vip";c.permission="r";this._executeCommandEvent(c)},existintempmaxitems:function(d){for(var c=0;c<this.tempmaxitems.length;c++){if(d.lineno==this.tempmaxitems[c].lineno){return true}}return false},getmaxpriceactualitem:function(d){var e;for(var c=0;c<d.length;c++){if(!this.existintempmaxitems(d[c])){if(!e){e=d[c]}else{if(e.priceactual<=d[c].priceactual){e=d[c]}}}}this.tempmaxitems.push(e);return e},handlediffwhendodiscountforitems:function(d,g){var e=this.getmaxpriceactualitem(d);if(!e){e=this.tempmaxitems[0];e.priceactual=this.alg(e.priceactual.add(g.div(e.qty)));e.price=e.priceactual.mul(e.qty);e.discount=e.pricelist==0?0:(e.priceactual.div(e.pricelist));return 0}if(this.discountCanLgOne){e.priceactual=this.alg(e.priceactual.add(g.div(e.qty)));e.price=e.price.add(g);e.discount=e.pricelist==0?0:(e.priceactual.div(e.pricelist));return 0}var c=this.getitembylinenofromitems_data(e.lineno);var f=(c.priceactual).sub(e.priceactual);f=f.mul(e.qty);if(f>0){if(g>f){e.priceactual=c.priceactual;e.discount=c.discount;e.price=c.price;g=g.sub(f)}else{e.priceactual=this.alg(e.priceactual.add(g.div(e.qty)));e.price=e.price.add(g);e.discount=e.pricelist==0?0:e.priceactual.div(e.pricelist);g=0}}return g},gettotpriceforitemtype:function(d,e){var f=0;for(var c=0;c<d.length;c++){if(d[c].type==e){f=f.add(d[c].price)}}return f},gettotpricelistforitemtype:function(d,e){var f=0;for(var c=0;c<d.length;c++){if(d[c].type==e){f=f.add(d[c].pricelist.mul(d[c].qty))}}return f},handlewholediscount:function(f,j,h,c){if(this.gettotpricelistforitemtype(f,1)<(c.sub(h))){alert("优惠金额不得大于正常零售总金额！");return false}for(var e=0;e<f.length;e++){if(f[e].type==1){j=j>f[e].lowest_discount?j:f[e].lowest_discount;f[e].discount=j;f[e].priceactual=this.alg(f[e].pricelist.mul(j));f[e].price=f[e].priceactual.mul(f[e].qty)}}var d=this.gettotdata(f);var g=h.sub(d.totprice);if(g>0){this.tempmaxitems=new Array();while(g>0){g=this.handlediffwhendodiscountforitems(f,g)}}return true},dodiscountwithamount:function(g,l,j,c){if(this.gettotpriceforitemtype(g,1)<(c.sub(j))){alert("优惠金额不得大于正常零售总金额！");return false}var e=0;for(var f=0;f<g.length;f++){if(g[f].type==1){l=l>g[f].lowest_discount?l:g[f].lowest_discount;g[f].priceactual=this.alg(g[f].priceactual.mul(l));g[f].price=g[f].priceactual.mul(g[f].qty);if(j.sub(e)<g[f].price){g[f].price=j.sub(e);g[f].priceactual=this.alg(g[f].price.div(g[f].qty))}g[f].discount=this.discountalg(g[f].pricelist==0?0:g[f].priceactual.div(g[f].pricelist));e=e.add(g[f].price)}}var d=this.gettotdata(g);var h=j.sub(d.totprice);if(h>0){this.tempmaxitems=new Array();while(h>0){h=this.handlediffwhendodiscountforitems(g,h)}}return true},dodiscountforitems:function(c,g){var d=this.gettotdata(c);var f=this.alg(d.totprice.mul(g));var e=zody.getTotLowestPrice();if(f<e){f=e;g=d.totprice==0?0:(Math.floor((f.div(d.totprice)).mul(100))).div(100)}if(this.dodiscountwithamount(c,g,f,d.totprice)){this.viprecharge=d.totprice.sub(f)}},dealwholeorderdiscount:function(c){this.dodiscountforitems(this.temp_items_data,c)},dealpaypriceforselectvipdiscount:function(){var c=jQuery("#zody_xo input:radio:checked").val();c=parseFloat(c);this.dealwholeorderdiscount(c);zody.killDiscountType();$("recharge").innerHTML=this.changenumber2yuan(this.viprecharge)},_dovipacm:function(f){var d=f.getUserData();var c=d.jsonResult.evalJSON();if(c.length==0){alert("未添加成功");return}if(c.rest=="true"&&c.msg=="VIP新增成功!"){alert("添加成功");this.killAlert("query-add-content");this.killAlert("query-search-content")}else{if(c.rest=="true"&&c.msg=="VIP升级成功!"){alert("VIP升级成功!");this.killAlert("query-update-content");this.killAlert("query-search-content");this._editvip("f2newretail")}else{if(c.rest=="true"&&c.msg=="VIP换卡成功!"){alert("VIP换卡成功!");this.killAlert("query-change-content");this.killAlert("query-search-content");this._editvip("f2newretail")}}}},_oncheckaddvip:function(l){var h=l.getUserData();var g=h.jsonResult.evalJSON();if(g.length==0){alert("未找到VIP或VIP不可用！");return}this.tempvip=this.changeret2vip(g[0]);if(this.tempvip.ifcharge=="N"){alert("非充值卡账户不可使用VIP补录功能！");return}zody.discountType();$("zody-discount").innerHTML=this.tempvip.discount;$("zody-rediscount").innerHTML=this.tempvip.vipexp;$("input90").value=this.tempvip.vipexp;$("input99").value=this.tempvip.discount;var j=jQuery("#zody_xo input[type='button']");var f=jQuery("#zody_xo input[type='radio']");var d=j[0];var c=f[0];jQuery("#zody_xo").bind("keydown",function(m){if(m.which==9){m.stopPropagation();m.preventDefault();var e=0;if(d){e=j.index(d)+1}if(!j[e]){e=0}d=j[e];d.focus()}else{if(m.which==13){if(m.target!=$("zody_btn-search_0")&&m.target!=$("zody_btn-cancel_0")){bpos.dealpaypriceforselectvipdiscount()}}else{if(m.which==38){var e=0;if(c){e=f.index(c)+1}if(!f[e]){e=0}c=f[e];if(e==1){jQuery("#input90").attr("checked",true);jQuery("#input90").focus()}else{jQuery("#input99").attr("checked",true);jQuery("#input99").focus()}}else{if(m.which==40){var e=0;if(c){e=f.index(c)+1}if(!f[e]){e=0}c=f[e];if(e==1){jQuery("#input90").attr("checked",true);jQuery("#input90").focus()}else{jQuery("#input99").attr("checked",true);jQuery("#input99").focus()}}}}}})},handlepayforadditionalvip:function(d){if((this.MODEL&this.ADDITIONVIP)!=this.ADDITIONVIP){return}zody.buLuVIP();var c;jQuery("#xiao_content_88").bind("keydown",function(f){var g=jQuery("#xiao_content_88 input[type='button']");if(f.which==9){f.stopPropagation();f.preventDefault();var e=0;if(c){e=g.index(c)+1}if(!g[e]){e=0}c=g[e];c.focus()}else{if(f.which==13){if(f.target!=$("zody_btn-search")&&f.target!=$("zody_btn-cancel")){bpos.checkaddvip()}}}})},countNoSelectMarketBillWayItem:function(){var d=0;if(this.master_data.markbaltypes.length>0){for(var c=0;c<this.items_data.length;c++){if(this.items_data[c].markbaltype==-1){d++}}}return d},checkHasQtyGTOrgQty:function(e){if(!e){e=this.items_data}var l=new Array();a:for(var g=0;g<e.length;g++){if(e[g].orgdocno!=""&&e[g].org_qty){for(var f=0;f<l.length;f++){if(l[f].orgdocno==e[g].orgdocno&&l[f].productno==e[g].productno){l[f].qty+=e[g].qty;continue a}}var d=this.copyJsonObject(e[g]);l.push(d)}}var h=new Array();for(var c=0;c<l.length;c++){if(Math.abs(l[c].qty)>l[c].org_qty){h.push(l[c].lineno)}}if(h.length>0){alert("错误：行 "+h.toString()+" 退货数量大于原单数量！");return true}return false},mergeOrgOrderPayItem:function(){this.mark=0;this.org_payitems=new Array();this.orgdocnos=new Array();var c=this.items_data;for(var e=0;e<c.length;e++){if(c[e].org_billdate!=-1&&c[e].org_payways!=-1){if(!this.isSameOrgOrder(c[e].org_docno)){for(var d=0;d<c[e].org_payways.length;d++){var f={};f.payway=c[e].org_payways[d];f.payamount=c[e].org_payamounts[d];f.billdate=c[e].org_billdate;f.sysdate=c[e].sysdate;f.org_orderno=c[e].org_docno;f.status=0;this.org_payitems.push(f)}}}}},string2Date:function(c){return"20"+c.substr(0,2)+"-"+c.substr(2,2)+"-"+c.substr(4,2)},date2String:function(c){return c.substr(5,2)+c.substr(8,2)},isSameOrgOrder:function(c){for(var d=0;d<this.orgdocnos.length;d++){if(c==this.orgdocnos[d]){return true}}this.orgdocnos.push(c);return false},findByOrgOrder:function(d,c){var f=new Array();for(var e=0;e<c.length;e++){if(d==c[e].org_docno){f.push(c[e])}}return f},payprice:function(d){if((this.MODEL&this.PAYPRICE)!=this.PAYPRICE){alert("该单不可付款！");return}if(this.checkNeedMarketBillWay()){var g=this.countNoSelectMarketBillWayItem();if(g>0){alert("错误：您有 "+g+" 条明细未选择商场结算类型！请选择！");return}}if(this.checkHasQtyGTOrgQty(d)){return}if(!d){this.temp_items_data=new Array()}this.tempvou={};this.vouinfo={};this.consumecards=new Array();this.viprecharge=0;this.tempAmount=0;this.execVipBirthdayMonthDis=false;this.tempvip={};this.initpayitem();this.hasWholeDis=false;if(bpos.items_data.length==0){alert("没有零售纪录！")}else{if(d){this.handlewholedis(d)}else{this.handlewholedis()}var e,f;if(this.temp_items_data.length>0){e=this.gettotdata(this.temp_items_data)}else{e=this.gettotdata()}f=this.gettotdata();if(Math.abs(e.totprice-f.totprice)>=0.01){this.hasWholeDis=true}this.initpaypriceAmount(false,e.totprice);if(this.payitem.TotalAmount<0){this.mergeOrgOrderPayItem()}if(this.checkCanDo("vipbirthdaymonthdiscount")){this.vipbirthdaymonthdiscount();return}if(this.checkCanDo("handlepayforadditionalvip")){this.handlepayforadditionalvip();return}if(this.checkCanDo("vipbirdis")){this.handleVipBirDisForOrder();return}this.readypay()}},checkCanDo:function(c){switch(c){case"vipbirthdaymonthdiscount":return this.master_data.params.company=="jnby"&&this.vip&&this.vip.vip_id&&this.tempvipdis==null&&((this.vip.directstore=="Y"&&this.vip.city==this.master_data.city)||(this.vip.directstore=="N"&&this.vip.customer==this.master_data.customer));break;case"handlepayforadditionalvip":return this.master_data.params.additionalvip=="true"&&this.payitem.TotalAmount>0&&!(this.vip&&this.vip.vip_id);break;case"integralpay":if(this.master_data.params.company=="jnby"){return !this.execVipBirthdayMonthDis&&((this.vip.directstore=="Y"&&this.vip.city==this.master_data.city)||(this.vip.directstore=="N"&&this.vip.customer==this.master_data.customer))}else{return !this.execVipBirthdayMonthDis}break;case"vipbirdis":return this.vip&&this.vip.vipdis&&this.vip.vipdis.LIMITTYPE==2&&confirm("您还有"+this.vip.vipdis.REMQTY+"笔可享受["+this.vip.vipdis.NAME+"]的活动，是否执行？");break}},vipbirthdaymonthdiscount:function(){var c={};c.command="cn.com.burgeon.command.webpos.VipBirthdayMonthDis";c.callbackEvent="BPOS_VIP_BIRTHDAYDIS";var d={};d.vip_id=this.vip.vip_id;c.param=d;c.table="C_VIPTYPE";c.permission="r";this._executeCommandEvent(c)},initpaypriceAmount:function(e,f){if(f||f==0){this.tempAmount=this.alg(f,true)}else{var c=e?e:this.items_data;var d=this.gettotdata(c);this.tempAmount=this.alg(d.totprice,true)}this.payitem.TotalAmount=this.tempAmount},handleVipBirDisForOrder:function(){var c=this.gettotdata(this.temp_items_data);var f=c.totprice;if(this.vip.vipdis.ISFULLPRICE=="Y"){f=c.totpricelist}var d=parseFloat(this.vip.vipdis.EXECONTENT);if(this.vip.vipdis.DISTYPE==1){f=this.alg(f.mul(d))}else{if(this.vip.vipdis.DISTYPE==3){f=this.alg(f.sub(d))}}var e=f.div(c.totpricelist);this.handlewholediscount(this.temp_items_data,e,f,c.totprice);this.initpaypriceAmount(this.temp_items_data);this.temp_items_data.vipbirdisid=this.vip.vipdis.ID;this.readypay()},_onbirthdaymonthdis:function(l){var h=l.getUserData();if(typeof(h)=="string"){ret=h.evalJSON()}else{ret=h.jsonResult.evalJSON()}if(ret.code==200){if(confirm("是否执行VIP当月优惠？")){var j=parseFloat(ret.vipdisatm);var g=parseFloat(ret.birdis);j=isNaN(j)?0:j;g=isNaN(g)?0:g;var f=this.gettotdata();var d=f.totpricelist;var c=this.alg(g.mul(d));if(c>j&&f.totqty>1){alert("付款金额大于VIP生日当月折扣限额！")}else{this.handlewholediscount(this.temp_items_data,g,c,d);this.execVipBirthdayMonthDis=true;this.initpaypriceAmount(this.temp_items_data)}}}this.readypay()},cancelamt:function(){this.killAlert("amt_content")},payclose:function(){this.initpayitem();this.payment=[];this.ticketnos=new Array();this.tempvipdis=null;this.tdefposdis_id=-1;this.tdefposdis_name=-1;this.tempvou={};this.vouinfo={};this.consumecards=new Array();this.killAlert("payment_content")},CheckIsOK:function(c){if(c.TotalAmount<0){return true}if((c._totalNoCashNoCharge-c.TotalAmount)>0){$("discription").innerHTML="卡类支付不能超过应付总额！\n请按重付按钮！";alert("卡类支付不能超过应付总额！");return false}if(c._totalNoCashNoCharge>0&&(c._totalNoCashNoCharge+c._totalCashNoCharge-c.TotalAmount)>0){$("discription").innerHTML="卡类支付不允许找零！\n请按重付按钮！";alert("卡类支付不允许找零！");return false}if(c._totalVipCharge>0&&(c._totalCashNoCharge-c.TotalAmount)>0){$("discription").innerHTML="券类(含VIP卡消费)支付\n不允许找零！请按重付按钮！";alert("券类(含VIP卡消费)支付不允许找零！");return false}if((c._totalCashCharge-c.TotalAmount)>=100){$("discription").innerHTML="找零金额不能大于100元！\n请按重付按钮！";alert("找零金额不能大于100元！");return false}if(c._totalCashCharge>0){if(c._totalCashNoCharge>0){if((c._totalCashNoCharge-c.TotalAmount)>0){$("discription").innerHTML="在已付现金的情况下券类支付\n不允许大于应付总额！\n请重付！";alert("在已付现金的情况下券类支付不允许大于应付总额！");return false}else{if((c._totalCashCharge+c._totalCashNoCharge-c.TotalAmount)>=100){$("discription").innerHTML="找零金额不能大于100元！\n请重付！";alert("找零金额不能大于100元！");return false}}if(c._totalNoCashNoCharge>0){if((c._totalCashNoCharge+c._totalNoCashNoCharge-c.TotalAmount)>0){$("discription").innerHTML="在已付现金的情况下券类\n和卡类支付总和不允许大于\n应付总额！请重付！";alert("在已付现金的情况下券类和卡类支付总和不允许大于应付总额！");return false}else{if((c._totalCashCharge+c._totalCashNoCharge+c._totalNoCashNoCharge-c.TotalAmount)>=100){$("discription").innerHTML="找零金额不能大于100元！\n请重付！";alert("找零金额不能大于100元！");return false}}}}else{if(c._totalNoCashNoCharge>0){if((c._totalCashCharge+c._totalNoCashNoCharge-c.TotalAmount)>=100){$("discription").innerHTML="找零金额不能大于100元！\n请重付！";alert("找零金额不能大于100元！");return false}}}}return true},checkpayway:function(d){var e=this.master_data.payways;for(var c=0;c<e.length;c++){if(d==e[c].id){if(e[c].is_vou=="Y"){return"vou"}if(e[c].isconsumecard=="Y"){return"consumecard"}if(e[c].iscashcard=="Y"){return"cashcard"}if(e[c].isticket=="Y"){return"ticket"}if(e[c].ischarge=="Y"&&e[c].iscash=="Y"){return"cash"}else{if(e[c].ischarge=="N"&&e[c].iscash=="N"){return"card"}else{if(e[c].ischarge=="N"&&e[c].iscash=="Y"){return"certificate"}}}}}},insertpayitemhtml:function(d,c){var e='<div class="payment-row"><div class="payment-row-line"><div class="payment-span-1">'+d+'</div><div class="payment-span-3">'+this.changenumber2yuan(c)+"</div></div></div>";jQuery("#payment-main").append(e);jQuery("#next").removeAttr("disabled")},updatepayitem:function(c,d){switch(c){case"vou":this.payitem._totalNoCashNoCharge=(this.payitem._totalNoCashNoCharge).add(d);break;case"consumecard":this.payitem._totalNoCashNoCharge=(this.payitem._totalNoCashNoCharge).add(d);break;case"cash":this.payitem._totalCashCharge=(this.payitem._totalCashCharge).add(d);break;case"card":this.payitem._totalNoCashNoCharge=(this.payitem._totalNoCashNoCharge).add(d);break;case"certificate":this.payitem._totalCashNoCharge=(this.payitem._totalCashNoCharge).add(d);break;case"cashcard":this.payitem._totalVipCharge=(this.payitem._totalVipCharge).add(d);this.payitem._totalNoCashNoCharge=(this.payitem._totalNoCashNoCharge).add(d);break;case"ticket":this.payitem._totalCashNoCharge=(this.payitem._totalCashNoCharge).add(d);break}},getpaywaybypayname:function(d){var e=this.master_data.payways;for(var c=0;c<e.length;c++){if(d==e[c].name){return e[c]}}},checkIsBankCardPayWay:function(c){if(c.iscash=="N"&&c.ischarge=="N"&&c.payid!=this.ticketpayways[0].id&&c.payid!=this.cashcardpayways[0].id){return true}return false},handlepaypricewhencheckisok:function(m,g,o){var c=this.getpaywaybypayname(m);var n=parseFloat(jQuery("#paidamount").html().replace("￥","")).add(g);var f=this.payitem.TotalAmount.sub(n);jQuery("#paidamount").html(this.changenumber2yuan(n));jQuery("#unpaidamount").html(this.changenumber2yuan(f<0?0:f));var l=f;if(this.payitem.TotalAmount>0&&f<0){l=0}jQuery("#currpay").val(this.formatint2float(l));this.insertpayitemhtml(m,g);i=this.payment.length;var e=c.id;var h="-1";if(o){h=o}this.payment[i]={payid:e,name:m,num:g,remark:h+""};if(f<=0&&this.payitem.TotalAmount>0){i=this.payment.length;var p=false;a:for(var d=0;d<i;d++){for(k=0;k<this.master_data.payways.length;k++){if(this.payment[d].payid==this.master_data.payways[k].id&&this.payment[d].name==this.master_data.payways[k].name&&this.payment[d].num>0){if(this.master_data.payways[k].iscash=="Y"&&this.master_data.payways[k].ischarge=="Y"){p=true;break a}}}}if(f<0&&p==true){this.change=f;jQuery("#charge").html(this.change==0?"":this.changenumber2yuan(-this.change));this.insertpayitemhtml(this.master_data.payways[k].name,f);this.payment[i]={payid:this.master_data.payways[k].id,name:this.master_data.payways[k].name,num:f,remark:h+""}}$("currpay").disabled=true;$("vip_currpay").disabled=true}if($("currpay").disabled!=true&&jQuery("#m").is(":visible")){dwr.util.selectRange($("currpay"),0,30)}if($("currpay").disabled){$("next").focus()}},bankPayActivexAccess:function(d,g,n,j,c,l,m){var f={};f.TransType=d;f.Amount=g;f.orderno=n;f.OldTraceNumber=j;f.HostSerialNumber=c;f.TransDate=l;f.PosType=m;var e={};e.param=f;var h=MainApp.BankCardPay(Object.toJSON(e));h=h.evalJSON();return h},TNActivexAccess:function(h,d,g,e,c,f){return this.bankPayActivexAccess(h,d,g,e,c,f,"TL")},KQActivexAccess:function(j,e,h,f,c,g){var d=this.bankPayActivexAccess(j,e,h,f,c,g,"KQ");if(d.responsecode=="00"){d.code="1"}if(d.code&&d.code=="-1"&&d.meg){alert("错误："+d.meg)}return d},bankCardPay:function(d,c){if(this.master_data.comptype==1){return this.TNActivexAccess("2",d,c,"","","")}if(this.master_data.comptype==2){return this.KQActivexAccess("1",d,c,"","","")}},TNRefund:function(e,d,c){if(this.master_data.comptype==1){return this.TNActivexAccess("4",d,c,"","",e)}if(this.master_data.comptype==2){return this.KQActivexAccess("2",d,c,"","",e)}},TNChargebacks:function(d,c){if(this.master_data.comptype==1){return this.TNActivexAccess("3",d,c,"","","")}if(this.master_data.comptype==2){return this.KQActivexAccess("3",d,c,"","","")}},insertpayment:function(n){var g=jQuery("#payselect").val();for(var u=0;u<bpos.voupayways.length;u++){if(g==bpos.voupayways[u].id){bpos.handlevou();return}}for(var l=0;l<this.ticketpayways.length;l++){if(g==this.ticketpayways[l].id){bpos.handlevisitantticket();return}}for(var c=0;c<this.consumecardpayways.length;c++){if(g==this.consumecardpayways[c].id){bpos.handlevisitantticket(true);return}}for(var h=0;h<this.cashcardpayways.length;h++){if(g==this.cashcardpayways[h].id){if(this.vip.vip_id){if(this.vip.ifcharge!="Y"){alert("非VIP充值卡用户不可使用"+this.vipPayTypeName+"!");return}bxl.vip();this.initvipcosume();return}else{alert("非VIP客户不能使用"+this.vipPayTypeName+"！");return}}}var l=0;var m=parseFloat($("currpay").value);m=this.alg(m,true,2);if(this.payitem.TotalAmount<0&&m>0){dwr.util.selectRange($("currpay"),0,20);return}var r=parseFloat(jQuery("#unpaidamount").html().replace("￥",""));var f=parseFloat(jQuery("#paidamount").html().replace("￥",""));f=isNaN(f)?0:f;r=isNaN(r)?0:r;m=isNaN(m)?0:m;if(r>0&&m<0){alert("错误：当未付金额大于零时，付款金额不可小于零！");return}if(m==0&&r==0&&f==this.payitem.TotalAmount){$("currpay").disabled=true;$("next").focus();return}var d=this.checkpayway(g);if(this.payitem.TotalAmount<0&&m<0&&this.master_data.comptype!=0&&d=="card"){if(this.payitem.TotalAmount>m){$("discription").innerHTML="退货输入金额不能超过应退总额！\n请按重付按钮！";alert("退货输入金额不能超过应退总额！");return}else{this.bankCardReturn(m,g);return}}this.evaluatepayitem(this.payitem,this.temppayitem);this.updatepayitem(d,m);if(this.CheckIsOK(this.payitem)){if(this.master_data.comptype!=0&&d=="card"){if(m>0){var q={};try{q=this.bankCardPay(m,this.master_data.refno)}catch(p){alert(p.message);q.code="0"}if(q.code=="1"){this.hasCreditBankCard=true;jQuery("#re,#cancle").attr("disabled","true")}else{this.evaluatepayitem(this.temppayitem,this.payitem);if($("currpay").disabled!=true){dwr.util.selectRange($("currpay"),0,20)}$("discription").value="";return}}else{}}var t=jQuery("#payselect").find("option:selected").text();this.handlepaypricewhencheckisok(t,m)}else{this.evaluatepayitem(this.temppayitem,this.payitem);if($("currpay").disabled!=true){dwr.util.selectRange($("currpay"),0,20)}$("discription").value=""}},revOrgOrder:function(d,c){return c.billdate==c.sysdate&&Math.abs(d)>=c.payamount},bankCardReturn:function(g,j){var h=new Array();var f=0;for(var e=0;e<this.org_payitems.length;e++){var d=this.org_payitems[e];if(!d.status&&d.payway==j){f++}if(!d.status&&this.revOrgOrder(g,d)&&d.payway==j){h.push(d)}}var c=false;if(!f){if(!confirm("原单中的"+jQuery("#payselect").find("option:selected").text()+"付款方式已退！是否继续使用？")){return}else{c=true}}zody.TNReturnFace(this.org_payitems,h.length?"TNCX":"TNTH",j,g,c)},repay:function(){jQuery("#payselect option[text="+this.master_data.params.defaultPayway+"]").attr("selected","true");if(this.vouinfo&&(this.vouinfo.useDis||this.vouinfo.changeItemsPrice)){alert("已使用购物券折算了价格，不能重付！若要重付，请取消付款！");return}bxl.pay();jQuery("#payment-main").html("");$("next").disabled=true;this.payment=[];this.ticketnos=new Array();this.consumecards=new Array();this.tempvou={};this.vouinfo={};this.initpayitem();this.payitem.TotalAmount=this.tempAmount;this.initpaypricehtml(this.tempAmount);if($("currpay").disabled){$("currpay").disabled=!$("currpay").disabled}if($("vip_currpay").disabled){$("vip_currpay").disabled=!$("vip_currpay").disabled}jQuery("#m").click();$("discription").value="";$("charge").value="";var c=$("currpay");dwr.util.selectRange(c,0,15)},_onsave_print:function(g){var f=g.getUserData();var c=f.jsonResult.evalJSON();var d=c.retailid;if($("next").disabled==true){jQuery("#next,#re,#cancle").removeAttr("disabled")}if(c.docno){this.doSomeThingWhenSaveOrderSucc(c)}},gettotpayamount:function(){var c=0;for(var e=0;e<this.payment.length;e++){var d=parseFloat(this.payment[e].num);d=isNaN(d)?0:d;c=c.add(d)}return c},getpaymentamount:function(){var c=0;for(var d=0;d<this.payment.length;d++){c=this.payment[d].num.add(c)}return c},testIsOnline:function(){jQuery.ajax({type:"POST",cache:false,url:this.URL+"testonline.jsp?r='+(new Date()).getTime()+'",timeout:3000,error:function(){alert("网络不畅。请稍后继续...");if($("next").disabled==true){jQuery("#next,#re,#cancle").removeAttr("disabled")}},success:function(c){bpos.doSave()}})},columnOfArrayJson2String:function(d,f,j){var e="";if(!d||d.length===0){return e}for(var g=0;g<d.length;g++){var h=d[g];for(var l in h){if(l==f){e+=g==0?h[l]:(j+h[l])}}}return e},salersTrueName2String:function(c){return this.columnOfArrayJson2String(c,"truename",",")},salersCode2String:function(c){return this.columnOfArrayJson2String(c,"name",",")},getSalerTrueName:function(e,d){if(d&&d.multisalers&&d.multisalers.length>0){return this.salersTrueName2String(d.multisalers)}for(var c=0;c<this.master_data.salers.length;c++){if(this.master_data.salers[c].name==e){return this.master_data.salers[c].truename}}return"-"},getSalerCode:function(e,d){if(d&&d.multisalers&&d.multisalers.length>0){return this.salersCode2String(d.multisalers)}for(var c=0;c<this.master_data.salers.length;c++){if(this.master_data.salers[c].name==e){return this.master_data.salers[c].name}}return"-"},getConsumecardsinfo:function(){var e=new Array();for(var c=0;c<this.consumecards.length;c++){var d={};d.cardno=this.consumecards[c].cardno;d.remCash=this.consumecards[c].remCash;d.pay=this.getPayAmountByConsumeCardno(this.consumecards[c].cardno);e.push(d)}return e},getSmallestUnit:function(g){g=parseFloat(g);if(g==parseInt(g,10)){if(g<0){return -1}return 1}else{g=g+"";var c=(g.substr(g.indexOf(".")+1)).length;var e=1;for(var f=1;f<=c;f++){e=e.mul(0.1)}if(g<0){e=-e}return e}},algItemsPrice:function(c){for(var d=0;d<c.length;d++){var e=c[d];e.priceactual=this.alg(e.priceactual,true);e.price=(e.priceactual).mul(e.qty)}},splitItemAndRefreshItems:function(e,d,f){var c=this.splitItem(e,f);this.items_datapushitem(c,d);return c},refrectItems:function(l){this.algItemsPrice(l);var j=this.gettotdata(l,"price").totprice;var g=(this.payitem.TotalAmount).sub(this.viprecharge);var n=g.sub(j);if(Math.abs(n)==0){return}var o=this.getSmallestUnit(n);var h=n.div(o);var d=0;var m=0;while(h>0){d++;for(var f=0;f<l.length;f++){var p=l[f];if((d==1||m>0)&&this.value2type(p.type)!="正常"){continue}if(h>=p.qty){p.priceactual=(p.priceactual).add(o);p.price=(o.mul(p.qty)).add(p.price);h=h.sub(p.qty);m++}else{if(h>0){var e=this.splitItemAndRefreshItems(p,l,(p.qty).sub(h));e.priceactual=(e.priceactual).add(o);e.price=(o.mul(e.qty)).add(e.price);m++;h=h.sub(e.qty)}else{break}}}}},initInsertSaveDate:function(){var T=this.getpaymentamount();if(this.payitem.TotalAmount-T>0){alert("付款金额小于应付金额！");return false}else{var M=$("comment").value.replace("按下F10键输入商品备注...","");var B=parseFloat($("sys_date").value);var O=new Array();var x=new Array();var N=new Array();var R=new Array();var m=new Array();var d=new Array();var l=new Array();var L=new Array();var q=new Array();var D=new Array();var I=new Array();var s=new Array();var h=new Array();var f=new Array();var y=new Array();var C=new Array();var V=new Array();var t=new Array();var g=new Array();var K=new Array();var S=new Array();var W=new Array();var Q=new Array();var u=new Array();var z=new Array();var H=new Array();var p=new Array();var e=new Array();var J=new Array();var ac=new Array();var r=new Array();var ab=new Array();var A=new Array();var v=new Array();this.sortToEndByName(this.payment,"现金");var Y=0;if(this.payment.length==0){u[0]=this.getpaywaybypayname("现金").id;z[0]=0;p[0]=0;W[0]="-1"}else{for(Y=0;Y<this.payment.length;Y++){u[Y]=parseFloat(this.payment[Y].payid);z[Y]=parseFloat(this.payment[Y].num);p[Y]=parseFloat(this.payment[Y].num);W[Y]=this.payment[Y].remark}}if(T>this.payitem.TotalAmount){for(var U=0;U<this.payment.length;U++){if(this.checkIsTicketPayWay(this.payment[U])){z[U]=z[U].sub(T.sub(this.payitem.TotalAmount));T=this.payitem.TotalAmount;this.change=0;break}}if(T!=this.payitem.TotalAmount){alert("付款金额与商品金额不相等，请重付！");return}}$("next").disabled=true;$("re").disabled=true;$("cancle").disabled=true;if(this.change!=0){W[Y-1]="找零"}var Z=0;var w;if(this.temp_items_data.length>0){w=this.temp_items_data}else{w=this.items_data}this.refrectItems(w);var ae=new Array();var X=new Array();for(Z=0;Z<w.length;Z++){var E=w[Z];O[Z]=E.productno;x[Z]=E.productvalue;N[Z]=E.qty;R[Z]=E.pricelist;m[Z]=this.dalg(E.discount);d[Z]=E.priceactual;l[Z]=E.price;L[Z]=E.salerid;q[Z]=E.saler;ae[Z]=this.getSalerTrueName(E.saler,E);X[Z]=this.getSalerCode(E.saler,E);D[Z]=this.columnOfArrayJson2String(E.multisalers,"id",",");I[Z]=this.columnOfArrayJson2String(E.multisalers,"truename",",");s[Z]=E.type;h[Z]=E.productname;f[Z]=E.color;y[Z]=E.colorname;C[Z]=E.size;V[Z]=E.sizename;t[Z]=E.mdim11;Q[Z]=parseInt(E.pda_id,10);H[Z]=E.markbaltype;if(E.discription==""||E.discription=="null"||!(E.discription)){g[Z]="-1"}else{g[Z]=E.discription}K[Z]=E.pricelist*E.qty;if(E.orgdocno==""||E.orgdocno=="null"){S[Z]="-1"}else{S[Z]=E.orgdocno}e[Z]=E.sin_disname;J[Z]=E.sin_disid;ac[Z]=E.com_disname;r[Z]=E.com_disid;ab[Z]=E.add_disname;A[Z]=E.add_disid;v[Z]=E.vipbirdisid||-1}var P=-1;var c=-1;var F="N";var n=0;if(this.tempvipdis){F="Y";P=this.tempvipdis.c_integralmin_id;c=this.tempvipdis.totintegral;n=this.tempvipdis.content}var G=new Array();if(this.consumecards&&this.consumecards.length>0){G=this.getConsumecardsinfo()}var aa=w.vipbirdisid||-1;var ad="N";if(this.vip&&this.vip.isIntl=="Y"){ad="Y"}this.submititems={storename:this.master_data.c_store_name,storeid:this.master_data.c_store_id,printmetrail:"Y",billdate:B,description:M,storecode:this.master_data.storecode,vipid:this.tempvip.vip_id||this.vip.vip_id||-1,amtchange:this.change,salerid:this.master_data.saler.id,salerid1:L,saler:q,saler_truename:ae,salercode:X,qty:N,priceactual:d,pricelist:R,price:l,productno:O,productname:h,color:f,colorname:y,size:C,sizename:V,productvalue:x,mdim11:t,orgdocno:S,description1:g,type:s,m_retail_markbaltype_id:H,paywayid:u,paymount:z,discount:m,discription2:W,realpaymount:p,m_pda_id:Q,ptype:"save",refno:this.master_data.refno,cardno:this.tempvip.cardno||this.vip.cardno,createtime:this.master_data.createTime,isaddvip:this.tempvip.vip_id?"Y":"N",operatorname:this.master_data.operator.name,operatorid:this.master_data.operator.id,vip_amt:this.viprecharge,isPendingOrder:this.master_data.canModify==0?"Y":"N",vip_cardno:this.vip.cardno,bpos_vip:this.vip,c_integralmin_id:P,integral:c,vipIntegralDis:F,vipDisContent:n,isintl:ad,sin_disid:J,consumecardsinfo:G,sin_disname:e,com_disid:r,com_disname:ac,add_disid:A,m_retail_vipbirdis_id:v,add_disname:ab,vouinfo:this.vouinfo,tdefposdis_id:this.tdefposdis_id,tdefposdis_name:this.tdefposdis_name,execVipBirthdayMonthDis:this.execVipBirthdayMonthDis?1:0,multisalerids:D,multisalerTrueNames:I,rememberSelectedRetailValue:this.master_data.remember_retail_value,market:this.master_data.market,vipbirdisid:aa};return true}},sortToEndByName:function(g,d){if(g.length!=0){var f=g.length;for(var e=0;e<f;e++){if(g[e].name==d){for(var c=1;c<f&&e<f-c;c++){if(g[f-c].name!=d){this.exchangeItemByIndex(g,e,f-c);f-=c;break}}}}}},exchangeItemByIndex:function(e,f,c){if(e.length!=0){var d=e[f];e[f]=e[c];e[c]=d}},doSave:function(){var c={};c.command="DBJSON";c.callbackEvent="BPOS_SAVE_PRINT";c.table="m_retail";c.action="insert_save";c.permission="r";c.isclob=true;c.param=Object.toJSON(this.submititems);this._executeCommandEvent(c)},checkHasVipPayWay:function(){if(this.payitem._totalVipCharge!=0){return true}return false},checkIsTicketPayWay:function(c){if(this.ticketpayways.length>0&&c.payid==this.ticketpayways[0].id){return true}for(var d=0;d<this.master_data.payways.length;d++){var e=this.master_data.payways[d];if(c.payid==e.id){if(e.isticket=="Y"||(e.ischarge=="N"&&e.iscash=="Y")){return true}}}return false},checkHasConsumeCardPayWay:function(){for(var d=0;d<this.payment.length;d++){for(var c=0;c<this.consumecardpayways.length;c++){if(this.payment[d].payid==this.consumecardpayways[c].id){return true}}}return false},checkHasVouPayWay:function(){if(this.vouinfo&&this.vouinfo.amtAcount){return true}for(var d=0;d<this.payment.length;d++){for(var c=0;c<this.voupayways.length;c++){if(this.payment[d].payid==this.voupayways[c].id){return true}}}return false},checkHasTicketPayWay:function(){for(var c=0;c<this.payment.length;c++){if(this.checkIsTicketPayWay(this.payment[c])){return true}}return false},checkHasVipBirDis:function(){if(this.refreshVipDisUseQty()>0){return true}if(this.temp_items_data.vipbirdisid&&this.temp_items_data.vipbirdisid>0){return true}return false},checkCanSaveOnOffLine:function(){if((this.checkIsOnline()&&this.master_data.params.offline=="false")||this.tempvipdis||this.checkHasVouPayWay()||this.checkHasVipPayWay()||this.checkHasConsumeCardPayWay()||this.checkHasVipBirDis()){return false}return true},checkCanDoWholeDis:function(){if(this.vip&&this.vip.vipdis&&this.vip.vipdis.ISFULLPRICE=="Y"&&this.checkHasVipBirDis()){return false}return true},checkCanPendingOrder:function(){if((this.MODEL&this.HOOKORDER)!=this.HOOKORDER){return false}if(this.checkHasVipBirDis()){return false}return true},doSomeThingWhenSaveOrderSucc:function(c){if(++this.orders%3==0){this.checkSession()}this.clearitems();if(this.master_data.params.defaultSaler.strip().toLowerCase()=="false"){this.master_data.saler={};this.master_data.multisalers=new Array();jQuery("#emp_name").html("");this.master_data.saler.id=-1}this.killAlert("payment_content");if(isIE()){var d={};this.submititems.operatorname=this.master_data.operator.name;if(c&&c.vipdocno){this.submititems.b_vipmoney_docno=c.vipdocno}if(!c){this.submititems.vip_integral="-";this.submititems.useIntegral="-";this.submititems.cur_vip_integral="-";this.submititems.integral_up="-";this.submititems.viplevel="-"}else{if(c&&c.integral){this.submititems.vip_integral=c.integral;this.submititems.cur_vip_integral=c.cur_vip_integral||"0";this.submititems.viplevel=c.viplevel||"-";this.submititems.integral_up=c.integral_up||"-";this.submititems.useIntegral=c.useIntegral||"-"}}d.param=this.submititems;this.printInfo=d;this.updateSerialNumber();this.printorder(Object.toJSON(d));if(this.master_data.params.QXAbsPath){this.commandExt("echo off \n copy "+this.master_data.params.QXAbsPath+" com1 \n exit")}}this.master_data.canModify=1;this._editvip("f2newretail")},checkSession:function(){jQuery.ajax({type:"POST",url:"/bpos/toindex.jsp?redirect&checkSession",timeout:120000,success:function(c){if(c=="noSession"){alert("由于长时间未操作，用户信息丢失，\n影响在线业务，请重新登录...")}}})},saveOrder:function(d){if(this.offline==true&&isIE()){var c=MainApp.saveOrder(d);c=c.evalJSON();if($("next").disabled==true){jQuery("#next,#re,#cancle").removeAttr("disabled")}if(c.code&&c.code==-1){alert(c.msg)}else{this.doSomeThingWhenSaveOrderSucc()}}},save:function(){if(this.initInsertSaveDate()){if(this.checkCanSaveOnOffLine()){var c={};c.param=this.submititems;this.saveOrder(Object.toJSON(c))}else{if(this.checkIsOnline()){this.testIsOnline()}else{alert("错误：离线模式无法上传！");if($("next").disabled==true){jQuery("#next,#re,#cancle").removeAttr("disabled")}}}}},alg:function(d,f,c){if(typeof(d)=="string"){d=parseFloat(d)}if(!f){return(Math.round(parseFloat(d.mul(100000)))).div(100000)}if(f&&c){return(Math.round(parseFloat(d.mul(Math.pow(10,c)))).div(Math.pow(10,c)))}var g=0;var e;if(this.master_data&&this.master_data.calculation){e=this.master_data.calculation}else{e=1}if(e==1){g=(Math.round(parseFloat(d.mul(100)))).div(100)}else{if(e==2){g=Math.round(d)}else{if(e==3){g=parseInt(d)}else{if(e==4){if(d<0){d=-d;g=-parseInt(d.add(0.99))}else{g=parseInt(d.add(0.99))}}else{if(e==5){g=(Math.round(d.mul(10))).div(10)}else{if(e==6){g=parseInt(d.mul(10)).div(10)}}}}}}return g},dalg:function(c){if(typeof(c)=="string"){c=parseFloat(c)}return(Math.round(parseFloat(c.mul(10000)))).div(10000)},discountalg:function(c){if(typeof(c)==="string"){c=parseFloat(c)}return(Math.round(parseFloat(c.mul(100)))).div(100)},handleMarketBillWayWhenSelectChanged:function(d){var c=this.getitembylinenofromitems_data(d);var e=parseInt(jQuery("#markbaltype-"+d).val(),10);c.markbaltype=isNaN(e)?-1:e},initItemMarketBillWay:function(d,c){var f='<select id="markbaltype-'+d+'" onchange="bpos.handleMarketBillWayWhenSelectChanged('+d+")\"><option value='-1' "+((-1==c)?"selected='true'":"")+">---无---</option>";for(var e=0;e<this.master_data.markbaltypes.length;e++){var g=this.master_data.markbaltypes[e].markbaltype_id;f+="<option value='"+g+"' "+((g==c)?"selected='true'":"")+" >"+this.master_data.markbaltypes[e].markbaltype_name+"</option>"}f+="</select>";return f},drawLine:function(l,o,e,m,n,f,p,h,c){var j=false;c=="showOrder"?j=true:j=false;var g='<div class="from-'+h+'" '+(j?"":"id='row-"+l+"' ondblclick='bpos.selectitem("+l+")'")+'><div class="from-'+h+'-line"><div class="from-span-'+e[0]+'">'+(j?"":'<input type="checkbox" value="'+l+'" name="m_retail">')+l+"</div>";for(var d=1;d<e.length;d++){if(f&&p==d){g+='<div class="from-span-'+e[d]+'">'+this.initItemMarketBillWay(l,o.markbaltype)+"</div>"}else{g+='<div class="from-span-'+e[d]+'" '+(j?"":'id="'+m[d]+"-"+l+'"')+((m[d]=="colorname"||m[d]=="sizename")?'style="text-align:left;"':"")+">"+this.getColumnHtmlValueByColumn(m[d],o,l,n[d],j)+"</div>"}}g+="</div></div>";return g},getColumnHtmlValueByColumn:function(e,f,d,c,g){var h;switch(e){case"productno":h=g?c:"<a style=\"color='red';cursor:pointer\" onclick=\"bpos.showAlert1('"+c+"',event,"+d+')">'+c+"</a>";break;case"productname":h=g?c:"<a style=\"color='red';cursor:pointer\" onclick=\"bpos.showAlert2('"+c+"',event)\" >"+c+"</a>";break;case"productvalue":h=(c||"-");break;case"pricelist":h=this.changenumber2yuan(c);break;case"discount":h=""+this.discountalg(c);break;case"priceactual":h=this.changenumber2yuan(c);break;case"price":h=this.changenumber2yuan(c);break;case"saler":h=this.getSalerTrueName(c,f);break;default:h=c}return h},ret_insertitem:function(l,o,g,h,c){var f="";var j=this.master_data.params.pageStyle;var d=new Array();var m=new Array();var n=new Array();var e=false;var p=-1;if(j=="redearth"){if(this.checkNeedMarketBillWay()){d=["2","4","7","4","4","16","17","17","16","16","18"];m=["","productname","MarketBillWay","productvalue","productno","pricelist","qty","discount","priceactual","price","saler"];n=[l,o.productname,o.markbaltype,o.productvalue,o.productno,o.pricelist,o.qty,o.discount,o.priceactual,o.price,o.saler];e=true;p=2}else{d=["6","4","4","4","5","5","5","16","16","19"];m=["","productname","productvalue","productno","pricelist","qty","discount","priceactual","price","saler"];n=[l,o.productname,o.productvalue,o.productno,o.pricelist,o.qty,o.discount,o.priceactual,o.price,o.saler]}}else{if(j=="tommy"){if(this.checkNeedMarketBillWay()){d=["13","4","04","7","19","19","13","13","2","16","13","16","16","9"];m=["","productno","productname","MarketBillWay","productvalue","colorname","color","size","qty","pricelist","discount","priceactual","price","saler"];n=[l,o.productno,o.productname,o.markbaltype,o.m_dim5,o.m_dim9,o.color,o.size,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler];e=true;p=3}else{d=["13","4","04","19","19","14","14","2","16","13","16","16","14"];m=["","productno","productname","productvalue","colorname","color","size","qty","pricelist","discount","priceactual","price","saler"];n=[l,o.productno,o.productname,o.m_dim5,o.m_dim9,o.color,o.size,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler]}}else{if(j=="busen"){if(this.checkNeedMarketBillWay()){d=["13","4","5","12","2","14","13","14","14","9","13","014","13","13","13","9"];m=["","productno","MarketBillWay","productname","qty","pricelist","discount","priceactual","price","saler","type","productvalue","color","colorname","size","sizename"];n=[l,o.productno,o.markbaltype,o.productname,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.m_dim20,o.color,o.colorname,o.size,o.sizename];e=true;p=2}else{d=["1","4","012","2","5","1","5","5","15","1","6","3","1","1","9"];m=["","productno","productname","qty","pricelist","discount","priceactual","price","saler","type","productvalue","color","colorname","size","sizename"];n=[l,o.productno,o.productname,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.m_dim20,o.color,o.colorname,o.size,o.sizename]}}else{if(j=="dunnu"){if(this.checkNeedMarketBillWay()){d=["13","4","5","12","2","14","13","14","14","9","13","14","13","13","13","9","15"];m=["","productno","MarketBillWay","productvalue","qty","pricelist","discount","priceactual","price","saler","type","productname","color","colorname","size","sizename","mdim11"];n=[l,o.productno,o.markbaltype,o.m_dim7,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.productname,o.color,o.m_dim8,o.size,o.sizename,o.mdim11];e=true;p=2}else{d=["1","4","12","2","5","1","5","5","9","1","6","3","1","1","9","18","9","18"];m=["","productno","productvalue","qty","pricelist","discount","priceactual","price","saler","type","productname","color","colorname","size","sizename","mdim11"];n=[l,o.productno,o.m_dim7,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.productname,o.color,o.m_dim8,o.size,o.sizename,o.mdim11]}}else{if(this.checkNeedMarketBillWay()){d=["13","4","5","12","2","14","13","14","14","9","13","14","13","13","13","9","15"];m=["","productno","MarketBillWay","productvalue","qty","pricelist","discount","priceactual","price","saler","type","productname","color","colorname","size","sizename","mdim11"];n=[l,o.productno,o.markbaltype,o.productvalue,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.productname,o.color,o.colorname,o.size,o.sizename,o.mdim11];e=true;p=2}else{d=["1","4","12","2","5","1","5","5","9","1","6","3","1","1","9","18","9","18"];m=["","productno","productvalue","qty","pricelist","discount","priceactual","price","saler","type","productname","color","colorname","size","sizename","mdim11"];n=[l,o.productno,o.productvalue,o.qty,o.pricelist,o.discount,o.priceactual,o.price,o.saler,g,o.productname,o.color,o.colorname,o.size,o.sizename,o.mdim11]}}}}}f+=this.drawLine(l,o,d,m,n,e,p,h,c);return f},insertitem:function(c,e){var f="";this.linenos.push(c);var g=c%2==0?"conduct":"row";var d="";switch(parseInt(e.type,10)){case 1:d="正常";break;case 2:d="退货";break;case 3:d="赠品";break;case 4:d="全额";break}f=this.ret_insertitem(c,e,d,g);jQuery("#from-main").append(f)},showAlert:function(d,f,h){var g=Event.element(f);this.canPopAlert=true;var j=jQuery(g).offset().top+jQuery(g).height();var c=jQuery(g).offset().left+jQuery(g).width();jQuery("#alertMsgContent").html("查询中...");jQuery("#alertMsg").css("top",j).css("left",c);jQuery("#alertMsg").fadeIn("normal");if((h||h==0)&&this.flag_num==0){var e=this.getitembylinenofromitems_data(h);if(e.org_qty!=undefined&&e.org_qty!=0){jQuery("#tipContent").html("原单数量：");jQuery("#alertMsgContent").html(e.org_qty);window.setTimeout('jQuery("#alertMsg").fadeOut("slow");',3000);return}else{d=e.productno}}jQuery("#tipContent").html("可用库存：");d=encodeURI(d);jQuery.ajax({type:"POST",cache:false,url:this.URL+"getBarcodeQtyCanByUserId.jsp?flag_num="+this.flag_num+"&barcode="+d+(this.URL?("&storeid="+bpos.master_data.c_store_id):""),timeout:3000,error:function(){jQuery("#alertMsgContent").html("网络不畅！");window.setTimeout('jQuery("#alertMsg").fadeOut("slow");',3000)},success:function(l){var m=parseInt(l);if(m==-99999||isNaN(m)){jQuery("#alertMsgContent").html("无库存！")}else{jQuery("#alertMsgContent").html(m)}window.setTimeout('jQuery("#alertMsg").fadeOut("slow");',3000)}})},showAlert1:function(c,d,e){this.flag_num=0;this.showAlert(c,d,e)},showAlert2:function(c,d){this.flag_num=1;this.showAlert(c,d)},hiddenAlert:function(){jQuery("#alertMsg").hide()},deletelines:function(){if((this.MODEL&this.DELETE)!=this.DELETE){alert("该单不可删除！");return}var d=this.getcheckedlinenoes();var c=d.length;if(c==0){alert("请选择明细！");return}var f=this.linenos[this.selectid];if(confirm("您选择了"+c+"行，确认删除！？")){for(var e=0;e<c;e++){this.deleline(d[e]);if(d[e]<f){this.selectid--}}}for(var e=0;e<this.delLineindex.length;e++){this.linenos.splice(this.delLineindex[e],1)}this.delLineindex=new Array();this.updatehtml();if(!this.linenos[this.selectid]){this.preretail()}else{this.nextretail("d")}},clearchecked:function(c){jQuery("#"+c+" input:checked").each(function(){this.checked=false})},getcheckedlinenoes:function(){var c=new Array();jQuery("#from-main input:checked").each(function(){var d=parseInt(jQuery(this).val(),10);c.push(d)});return c},updateheaderhtml:function(c){if(this.master_data){jQuery("#column_23983").html(this.master_data.refno||this.master_data.docno)}jQuery("#vipnum").html(this.vip.cardno||"");jQuery("#viptype1").html(this.vip.c_viptype||"");this.selectDate=this.nowDate;if(c&&c=="f2newretail"){}else{if(this.master_data&&this.master_data.params&&this.master_data.params.multiSalers=="true"){jQuery("#emp_name").html(this.salersTrueName2String(this.master_data.multisalers))}else{if(this.master_data&&this.master_data.saler&&this.master_data.saler.id){jQuery("#emp_name").html(this.master_data.saler.name+"("+this.master_data.saler.truename+")"||"")}}}},updatehtml:function(){var c=this.gettotdata();$("tot_num").innerHTML=c.totqty;$("tot_payable").innerHTML=this.formatint2float(this.alg(c.totprice,true));$("tot_amt").innerHTML=this.formatint2float(this.alg(c.totpricelist))},getindexbylinenofromitems_data:function(d){for(var c=0;c<this.items_data.length;c++){if(this.items_data[c].lineno==d){return c}}},deleline:function(d){var c=this.getindexbylinenofromitems_data(d);if(this.items_data[c].locked==1){alert("该行不可删除！");return}this.items_data.splice(c,1);this.delLineindex.push(c);jQuery("#row-"+d).remove()},updateline:function(e,d){if(d.productno){jQuery("#productno-"+e).html("<a style=\"color='red';cursor:pointer\" onclick=\"bpos.showAlert1('"+d.productno+"',event,"+e+')">'+d.productno+"</a>")}if(d.markbaltype){jQuery("#markbaltype-"+e).val(d.markbaltype)}if(d.qty||d.qty==0){jQuery("#qty-"+e).html(d.qty+"")}if(d.pricelist||d.pricelist==0){jQuery("#pricelist-"+e).html(this.changenumber2yuan(d.pricelist))}if(d.discount||d.discount==0){jQuery("#discount-"+e).html(this.discountalg(d.discount)+"")}if(d.priceactual||d.priceactual==0){jQuery("#priceactual-"+e).html(this.changenumber2yuan(d.priceactual))}if(d.price||d.price==0){jQuery("#price-"+e).html(this.changenumber2yuan(d.price))}if(d.saler){jQuery("#saler-"+e).html(this.getSalerTrueName(d.saler,d))}if(d.type){var c=this.value2type(d.type);jQuery("#type-"+e).html(c)}},change2array:function(c){var d=new Array();if(c.length){d=c}else{d.push(c)}return d},changenumber2yuan:function(c){var d=this.formatint2float(c);return"￥"+d},checkWorkAttendance:function(){try{MainApp.checkWorkAttendance()}catch(c){alert(c.message)}}};BPOS.main=function(){bpos=new BPOS()};jQuery(document).ready(BPOS.main);jQuery(document).ready(function(){jQuery("#from-main").bind("keydown",function(c){if(c.which==32){bpos.enterSelect();c.stopPropagation();c.preventDefault()}});jQuery("body").bind("keydown",function(c){if(bpos.noAlert){if(c.which==46){bpos.deletelines()}else{if(c.which==38){bpos.preretail();c.stopPropagation();c.preventDefault()}else{if(c.which==40){bpos.nextretail();c.stopPropagation();c.preventDefault()}else{if(c.target!=$("m_retail_idx")&&c.target!=$("comment")&&bpos.noAlert){$("m_retail_idx").focus()}}}}}if($("payselect")){var d=c.srcElement.id;if(c.which==13&&$("currpay").disabled!=true&&(d=="payselect"||d=="pos-body"||d==""||d=="payment_content"||d=="payment-main"||d=="alert-message")){dwr.util.selectRange($("currpay"),0,15)}if(c.ctrlKey==true&&c.which==81){bpos.handlevisitantticket()}if($("ticketno")&&c.ctrlKey==true&&c.which==84){jQuery("#ticketno").removeAttr("readonly")}}});jQuery(".hmain").hover(function(){jQuery(this).children("ul").fadeIn()},function(){jQuery(this).children("ul").fadeOut()})});